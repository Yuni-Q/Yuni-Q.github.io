{"version":3,"sources":["webpack:///./src/templates/tags.tsx"],"names":["data","location","initialCount","Storage","initialCategory","CATEGORY_TYPE","ALL","useState","count","setCount","countRef","useRef","category","setCategory","siteMetadata","site","countOfInitialPost","configs","posts","allMarkdownRemark","edges","categories","map","node","frontmatter","useEffect","sendGAEvent","GA_ACTION","EXPOSE","window","addEventListener","onScroll","passive","IOManager","ScrollManager","removeEventListener","current","document","querySelector","scrollIntoView","behavior","inline","block","currentPos","scrollY","innerHeight","isTriggerPos","Dom","getDistance","EventManager","prev","dismissCondition","triggerCondition","length","title","pathname","split","HOME_TITLE","keywords","selectCategory","pageQuery"],"mappings":"+TAsBe,sBAAwB,IAArBA,EAAqB,EAArBA,KAAMC,EAAe,EAAfA,SACjBC,EAAeC,IAAiB,GAChCC,EAAkBD,IAAoBE,IAAcC,KAFpB,EAGZC,mBAASL,GAA5BM,EAH+B,KAGxBC,EAHwB,KAIhCC,EAAWC,iBAAOH,GAJc,EAKND,mBAASH,GAAlCQ,EAL+B,KAKrBC,EALqB,KAO9BC,EAAiBd,EAAKe,KAAtBD,aACAE,EAAuBF,EAAaG,QAApCD,mBACFE,EAAQlB,EAAKmB,kBAAkBC,MAC/BC,EAAa,IAAOH,EAAMI,KAAI,qBAAGC,KAAgBC,YAAYZ,aAEnEa,qBAAU,WAMT,OALAC,YAAY,OAAQC,IAAUC,QAC9BC,OAAOC,iBAAP,SAAkCC,EAAU,CAAEC,SAAS,IACvDC,MACAC,MAEO,WACNL,OAAOM,oBAAP,SAAqCJ,GACrCE,MACAC,SAEC,IAEHT,qBAAU,WACTf,EAAS0B,QAAU5B,EACnByB,MACA9B,IAAiBK,GACjBL,IAAoBS,MAGrBa,qBAAU,WACTY,SAASC,cAAc,0BAA0BC,eAAe,CAC/DC,SAAU,SACVC,OAAQ,SACRC,MAAO,UAEN,CAAC9B,IAEJ,IAIMmB,EAAW,WAChB,IAAMY,EAAad,OAAOe,QAAUf,OAAOgB,YACrCC,EAAe,kBAlDvB,SAAqBH,GACpB,OAAOI,MAA0BJ,EAiDLK,CAAYL,GApDvB,IAwDhB,OAAOM,KAAmB,kBAAMxC,GAAS,SAAAyC,GAAI,OAAIA,EAAO,OAAI,CAC3DC,iBAAkB,kBAAOL,KACzBM,iBAAkB,kBAAMN,KAJxB5B,EAAMmC,OAAS3C,EAAS0B,QAAUpB,IAE5BiC,IAKR,OACC,kBAAC,IAAD,CACChD,SAAUA,EACVqD,MACCrD,EAAW,IAAIA,EAASsD,SAASC,MAAM,SAAS,GAAGA,MAAM,KAAK,GAAO1C,EAAawC,OAGnF,kBAAC,IAAD,CACCA,OAAOrD,aAAA,EAAAA,EAAUsD,SAASC,MAAM,SAAS,GAAGA,MAAM,KAAK,KAAMC,IAC7DC,SAAU5C,EAAa4C,WAExB,kBAAC,IAAD,CACCrC,WAAYA,EACZT,SAAUA,EACV+C,eA7BoB,SAAA/C,GACtBC,EAAYD,MA8BX,kBAAC,IAAD,CACCM,MAAOA,EACPF,mBAAoBA,EACpBR,MAAOA,EACPI,SAAUA,MAMP,IAAMgD,EAAY","file":"component---src-templates-tags-tsx-306bbc0d05f566f2ef22.js","sourcesContent":["import {graphql} from 'gatsby';\r\nimport _ from 'lodash';\r\nimport React,{useEffect,useRef,useState} from 'react';\r\nimport {Category} from '../components/category';\r\nimport {Contents} from '../components/contents';\r\nimport {Head} from '../components/head';\r\nimport {CATEGORY_TYPE,HOME_TITLE} from '../constants';\r\nimport {Layout} from '../layout';\r\nimport * as Dom from '../utils/dom';\r\nimport * as EventManager from '../utils/event-manager';\r\nimport sendGAEvent,{GA_ACTION} from '../utils/ga';\r\nimport * as ScrollManager from '../utils/scroll';\r\nimport * as Storage from '../utils/storage';\r\nimport * as IOManager from '../utils/visible';\r\n\r\nconst DEST_POS = 316;\r\nconst BASE_LINE = 80;\r\n\r\nfunction getDistance(currentPos) {\r\n\treturn Dom.getDocumentHeight() - currentPos;\r\n}\r\n\r\nexport default ({ data, location }) => {\r\n\tconst initialCount = Storage.getCount(1);\r\n\tconst initialCategory = Storage.getCategory(CATEGORY_TYPE.ALL);\r\n\tconst [count, setCount] = useState(initialCount);\r\n\tconst countRef = useRef(count);\r\n\tconst [category, setCategory] = useState(initialCategory);\r\n\r\n\tconst { siteMetadata } = data.site;\r\n\tconst { countOfInitialPost } = siteMetadata.configs;\r\n\tconst posts = data.allMarkdownRemark.edges;\r\n\tconst categories = _.uniq(posts.map(({ node }) => node.frontmatter.category));\r\n\r\n\tuseEffect(() => {\r\n\t\tsendGAEvent('tags', GA_ACTION.EXPOSE);\r\n\t\twindow.addEventListener(`scroll`, onScroll, { passive: false });\r\n\t\tIOManager.init();\r\n\t\tScrollManager.init();\r\n\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener(`scroll`, onScroll);\r\n\t\t\tIOManager.destroy();\r\n\t\t\tScrollManager.destroy();\r\n\t\t};\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tcountRef.current = count;\r\n\t\tIOManager.refreshObserver();\r\n\t\tStorage.setCount(count);\r\n\t\tStorage.setCategory(category);\r\n\t});\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.querySelector('li[aria-selected=true]').scrollIntoView({\r\n\t\t\tbehavior: 'smooth',\r\n\t\t\tinline: 'center',\r\n\t\t\tblock: 'end',\r\n\t\t});\r\n\t}, [category]);\r\n\r\n\tconst selectCategory = category => {\r\n\t\tsetCategory(category);\r\n\t};\r\n\r\n\tconst onScroll = () => {\r\n\t\tconst currentPos = window.scrollY + window.innerHeight;\r\n\t\tconst isTriggerPos = () => getDistance(currentPos) < BASE_LINE;\r\n\t\tconst doesNeedMore = () =>\r\n\t\t\tposts.length > countRef.current * countOfInitialPost;\r\n\r\n\t\treturn EventManager.toFit(() => setCount(prev => prev + 1), {\r\n\t\t\tdismissCondition: () => !isTriggerPos(),\r\n\t\t\ttriggerCondition: () => isTriggerPos() && doesNeedMore(),\r\n\t\t})();\r\n\t};\r\n\treturn (\r\n\t\t<Layout\r\n\t\t\tlocation={location}\r\n\t\t\ttitle={\r\n\t\t\t\tlocation ? `#${location.pathname.split('tags/')[1].split('/')[0]}` : siteMetadata.title\r\n\t\t\t}\r\n\t\t>\r\n\t\t\t<Head\r\n\t\t\t\ttitle={location?.pathname.split('tags/')[1].split('/')[0] || HOME_TITLE}\r\n\t\t\t\tkeywords={siteMetadata.keywords}\r\n\t\t\t/>\r\n\t\t\t<Category\r\n\t\t\t\tcategories={categories}\r\n\t\t\t\tcategory={category}\r\n\t\t\t\tselectCategory={selectCategory}\r\n\t\t\t/>\r\n\t\t\t<Contents\r\n\t\t\t\tposts={posts}\r\n\t\t\t\tcountOfInitialPost={countOfInitialPost}\r\n\t\t\t\tcount={count}\r\n\t\t\t\tcategory={category}\r\n\t\t\t/>\r\n\t\t</Layout>\r\n\t);\r\n};\r\n\r\nexport const pageQuery = graphql`\r\n\tquery($tag: String) {\r\n\t\tsite {\r\n\t\t\tsiteMetadata {\r\n\t\t\t\ttitle\r\n\t\t\t\tconfigs {\r\n\t\t\t\t\tcountOfInitialPost\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tallMarkdownRemark(\r\n\t\t\tlimit: 2000\r\n\t\t\tsort: { fields: [frontmatter___date], order: DESC }\r\n\t\t\tfilter: {\r\n\t\t\t\tfrontmatter: {\r\n\t\t\t\t\ttags: { in: [$tag] }\r\n\t\t\t\t\tcategory: { ne: null }\r\n\t\t\t\t\tdraft: { eq: false }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t) {\r\n\t\t\ttotalCount\r\n\t\t\tedges {\r\n\t\t\t\tnode {\r\n\t\t\t\t\texcerpt(pruneLength: 300)\r\n\t\t\t\t\tfields {\r\n\t\t\t\t\t\tslug\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfrontmatter {\r\n\t\t\t\t\t\tdate(formatString: \"DD [<span>] MMMM [</span>]\")\r\n\t\t\t\t\t\ttitle\r\n\t\t\t\t\t\tcategory\r\n\t\t\t\t\t\ttags\r\n\t\t\t\t\t\tdraft\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n`;\r\n"],"sourceRoot":""}