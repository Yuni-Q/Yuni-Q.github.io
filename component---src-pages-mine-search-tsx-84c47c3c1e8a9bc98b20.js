"use strict";(self.webpackChunkyuni_q_blog=self.webpackChunkyuni_q_blog||[]).push([[4467],{9985:function(e,t,a){a.r(t),a.d(t,{CLICK_MINE:function(){return N},CODE:function(){return n},FLAG_CELL:function(){return d},INCREMENT_TIMER:function(){return h},NORMALIZE_CELL:function(){return I},OPEN_CELL:function(){return s},QUESTION_CELL:function(){return i},START_GAME:function(){return E},TableContext:function(){return c}});var l=a(4506),r=a(6540);const n={MINE:-7,NORMAL:-1,QUESTION:-2,FLAG:-3,QUESTION_MINE:-4,FLAG_MINE:-5,CLICKED_MINE:-6,OPEN_MINE:-8,OPENED:0},c=(0,r.createContext)({tableData:[],halted:!0,dispatch:null,openedCount:0}),o={tableData:[],data:{row:0,cell:0,mine:0},timer:0,result:"",halted:!0,openedCount:0},u=(e,t,a)=>{const l=Array(e*t).fill(0).map(((e,t)=>t)),r=[];for(;l.length>e*t-a;){const e=l.splice(Math.floor(Math.random()*l.length),1)[0];r.push(e)}const c=[];for(let o=0;o<e;o++){const e=[];c.push(e);for(let a=0;a<t;a++)e.push(n.NORMAL)}for(let o=0;o<r.length;o++){const e=Math.floor(r[o]/t),a=r[o]%t;c[e][a]=n.MINE}return c},E="START_GAME",s="OPEN_CELL",N="CLICK_MINE",d="FLAG_CELL",i="QUESTION_CELL",I="NORMALIZE_CELL",h="INCREMENT_TIMER",M=(e,t)=>{switch(t.type){case E:return{...e,data:{row:t.row,cell:t.cell,mine:t.mine},openedCount:0,tableData:u(t.row,t.cell,t.mine),halted:!1,timer:0};case s:{const a=(0,l.A)(e.tableData);if(a.forEach(((e,t)=>{a[t]=(0,l.A)(e)})),!e.openedCount&&n.MINE===a[t.row][t.cell]){const l=[];for(let t=0;t<e.data.row;t++){const t=[];l.push(t);for(let a=0;a<e.data.cell;a++)t.push(!1)}let r=!1;const c=(t,o)=>{var u;if(!r&&!(t<0||t>=e.data.row||o<0||o>=e.data.cell||l[t][o])){if(l[t][o]=!0,n.NORMAL===(null===(u=a[t])||void 0===u?void 0:u[o]))return a[t][o]=n.MINE,void(r=!0);c(t-1,o-1),c(t-1,o),c(t-1,o+1),c(t,o-1),c(t,o+1),c(t+1,o-1),c(t+1,o),c(t+1,o+1)}};c(t.row,t.cell),a[t.row][t.cell]=n.NORMAL}const r=[];let c=0;const o=(t,l)=>{if(t<0||t>=a.length||l<0||l>=a[0].length)return{...e};if([n.OPENED,n.FLAG,n.FLAG_MINE,n.QUESTION_MINE,n.QUESTION].includes(a[t][l]))return;if(r.includes(t+"/"+l))return;r.push(t+"/"+l);let u=[a[t][l-1],a[t][l+1]];a[t-1]&&(u=u.concat([a[t-1][l-1],a[t-1][l],a[t-1][l+1]])),a[t+1]&&(u=u.concat([a[t+1][l-1],a[t+1][l],a[t+1][l+1]]));const E=u.filter((function(e){return[n.MINE,n.FLAG_MINE,n.QUESTION_MINE].includes(e)})).length;if(0===E&&t>-1){const e=[];t-1>-1&&(e.push([t-1,l-1]),e.push([t-1,l]),e.push([t-1,l+1])),e.push([t,l-1]),e.push([t,l+1]),t+1<a.length&&(e.push([t+1,l-1]),e.push([t+1,l]),e.push([t+1,l+1])),e.forEach((e=>{a[e[0]][e[1]]!==n.OPENED&&o(e[0],e[1])}))}a[t][l]===n.NORMAL&&(c+=1),a[t][l]=E};o(t.row,t.cell);let u=!1,E="";return e.data.row*e.data.cell-e.data.mine===e.openedCount+c&&(u=!0,E=`${e.timer}초만에 승리하셨습니다`),{...e,tableData:a,openedCount:e.openedCount+c,halted:u,result:E}}case N:{const a=(0,l.A)(e.tableData);return a.forEach(((e,t)=>{a[t]=(0,l.A)(e)})),a.forEach(((e,t)=>{e.forEach(((e,l)=>{a[t][l]!==n.MINE&&a[t][l]!==n.FLAG_MINE&&a[t][l]!==n.QUESTION_MINE||(a[t][l]=n.OPEN_MINE)}))})),a[t.row][t.cell]=n.CLICKED_MINE,{...e,tableData:a,halted:!0}}case d:{const a=(0,l.A)(e.tableData);return a[t.row]=(0,l.A)(e.tableData[t.row]),a[t.row][t.cell]===n.MINE?a[t.row][t.cell]=n.FLAG_MINE:a[t.row][t.cell]=n.FLAG,{...e,tableData:a}}case i:{const a=(0,l.A)(e.tableData);return a[t.row]=(0,l.A)(e.tableData[t.row]),a[t.row][t.cell]===n.FLAG_MINE?a[t.row][t.cell]=n.QUESTION_MINE:a[t.row][t.cell]=n.QUESTION,{...e,tableData:a}}case I:{const a=(0,l.A)(e.tableData);return a[t.row]=(0,l.A)(e.tableData[t.row]),a[t.row][t.cell]===n.QUESTION_MINE?a[t.row][t.cell]=n.MINE:a[t.row][t.cell]=n.NORMAL,{...e,tableData:a}}case h:return{...e,timer:e.timer+1};default:return e}};t.default=()=>{const{0:e,1:t}=(0,r.useReducer)(M,o),{tableData:a,halted:l,timer:n,result:u,openedCount:E}=e,s=(0,r.useMemo)((()=>({tableData:a,halted:l,dispatch:t,openedCount:E})),[a,l,E]);return(0,r.useEffect)((()=>{let e;return!1===l&&(e=setInterval((()=>{t({type:h})}),1e3)),()=>{clearInterval(e)}}),[l]),r.createElement(c.Provider,{value:s},r.createElement(C,null),r.createElement("div",null,n),r.createElement(p,null),r.createElement("div",null,u))};const C=(0,r.memo)((()=>{const{0:e,1:t}=(0,r.useState)(10),{0:a,1:l}=(0,r.useState)(10),{0:n,1:o}=(0,r.useState)(20),{dispatch:u}=(0,r.useContext)(c),s=(0,r.useCallback)((e=>{t(e.target.value)}),[]),N=(0,r.useCallback)((e=>{l(e.target.value)}),[]),d=(0,r.useCallback)((e=>{o(e.target.value)}),[]),i=(0,r.useCallback)((()=>{u({type:E,row:e,cell:a,mine:n})}),[e,a,n]);return r.createElement("div",null,r.createElement("input",{type:"number",placeholder:"세로",value:e,onChange:s}),r.createElement("input",{type:"number",placeholder:"가로",value:a,onChange:N}),r.createElement("input",{type:"number",placeholder:"지뢰",value:n,onChange:d}),r.createElement("button",{onClick:i},"시작"))})),p=(0,r.memo)((()=>{const{tableData:e}=(0,r.useContext)(c);return r.createElement("table",{style:{width:"unset"}},r.createElement("tbody",null,Array(e.length).fill(0).map(((e,t)=>r.createElement(L,{key:`tr-${t}`,rowIndex:t})))))})),L=(0,r.memo)((e=>{var t;let{rowIndex:a}=e;const{tableData:l}=(0,r.useContext)(c);if(null!==(t=l[0])&&void 0!==t&&t.length)return r.createElement("tr",null,Array(l[0].length).fill(0).map(((e,t)=>r.createElement(w,{key:`td-${t}`,rowIndex:a,cellIndex:t}))))})),f=e=>{switch(e){case n.NORMAL:case n.MINE:return{background:"#444"};case n.CLICKED_MINE:return{background:"red"};case n.OPEN_MINE:case n.OPENED:return{background:"white"};case n.QUESTION_MINE:case n.QUESTION:return{background:"yellow"};case n.FLAG_MINE:case n.FLAG:return{background:"red"};default:return{background:"white"}}},w=(0,r.memo)((e=>{let{rowIndex:t,cellIndex:a}=e;const{tableData:l,dispatch:o,halted:u,openedCount:E}=(0,r.useContext)(c),h=(0,r.useCallback)((()=>{if(!u)if(E)switch(l[t][a]){case n.OPENED:case n.FLAG_MINE:case n.FLAG:case n.QUESTION_MINE:case n.QUESTION:return;case n.NORMAL:return void o({type:s,row:t,cell:a});case n.MINE:return void o({type:N,row:t,cell:a});default:return}else o({type:s,row:t,cell:a})}),[l[t][a],u,E]),M=(0,r.useCallback)((e=>{if(e.preventDefault(),!u)switch(l[t][a]){case n.NORMAL:case n.MINE:return void o({type:d,row:t,cell:a});case n.FLAG_MINE:case n.FLAG:return void o({type:i,row:t,cell:a});case n.QUESTION_MINE:case n.QUESTION:return void o({type:I,row:t,cell:a});default:return}}),[l[t][a],u]);return r.createElement(A,{onClickTd:h,onRightClickTd:M,data:l[t][a]})})),A=(0,r.memo)((e=>{let{onClickTd:t,onRightClickTd:a,data:l}=e;return r.createElement("td",{style:{...f(l),width:60,height:60,padding:0,textAlign:"center"},onClick:t,onContextMenu:a},(e=>{switch(e){case n.NORMAL:return"";case n.MINE:return"X";case n.CLICKED_MINE:case n.OPEN_MINE:return"펑";case n.FLAG_MINE:case n.FLAG:return"!";case n.QUESTION_MINE:case n.QUESTION:return"?";default:return e||""}})(l))}))}}]);
//# sourceMappingURL=component---src-pages-mine-search-tsx-84c47c3c1e8a9bc98b20.js.map