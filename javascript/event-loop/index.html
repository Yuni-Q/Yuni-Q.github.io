<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg"/><link rel="preload" as="image" href="/images/profile.png"/><link rel="stylesheet" href="/_next/static/css/bc8bb31cb71603b2.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-57fdca2934e5ae0a.js"/><script src="/_next/static/chunks/6217bb07-738e49d824771fea.js" async=""></script><script src="/_next/static/chunks/5647-b33901b11da845dc.js" async=""></script><script src="/_next/static/chunks/main-app-ec1611f00934714e.js" async=""></script><script src="/_next/static/chunks/app/layout-3ad8bb7cb2292578.js" async=""></script><script src="/_next/static/chunks/9243-972bdccd4ceb11ae.js" async=""></script><script src="/_next/static/chunks/5800-4312aed1aa8a4305.js" async=""></script><script src="/_next/static/chunks/549-2babc012700e23ed.js" async=""></script><script src="/_next/static/chunks/4853-73ca7990eb89674b.js" async=""></script><script src="/_next/static/chunks/app/%5Bcategory%5D/%5B...slug%5D/page-6aac7cf9456deffb.js" async=""></script><script id="ads" async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><title>event loop</title><meta name="description" content="## 자바스크립트 이벤트 루프에 대해 알아보겠습니다.  ---  ## 자바스크립트는 싱글 스레드 프로그래밍 언어&lt;br /&gt;(Single threaded programming language) 입니다.  - 자바스크립트는 기본적으로 싱글 스레드 프로그래밍 언어입니다. 여기서 싱글 스레드라는 것은 한 번에 하나의 작업만 할 수 있다는 뜻입니다.   - 유저가"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="icon" type="image/png" href="/favicon2.png"/><link rel="shortcut icon" href="/favicon2.png"/><link rel="apple-touch-icon" href="/favicon2.png"/><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&amp;display=swap" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=Catamaran:wght@800&amp;display=swap" rel="stylesheet"/><script>(adsbygoogle=window.adsbygoogle||[]).requestNonPersonalizedAds=1;</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div class="top-header"><a class="top-link" href="/">Yuni-Q</a><div class="flex items-center"><button class="outline-0 bg-white mx-[5px] p-0 appearance-none items-center rounded-[5px] border-0 cursor-pointer inline-flex h-10 justify-center opacity-75 overflow-hidden relative scale-75 transition-opacity duration-300 ease-in-out w-10 flex-shrink-0 hover:bg-black max-[800px]:hover:bg-white"><a href="https://github.com/Yuni-Q/blog" class="github" aria-label="GitHub"><svg class="github transition-all duration-300 ease-in-out pt-1 text-[#78757a] w-8 hover:text-white max-[800px]:hover:text-[#78757a]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></button><button class="outline-0 bg-white mx-[5px] p-0 appearance-none items-center rounded-[5px] border-0 cursor-pointer inline-flex h-10 justify-center opacity-75 overflow-hidden relative scale-75 transition-opacity duration-300 ease-in-out w-10 flex-shrink-0 hover:bg-black max-[800px]:hover:bg-white group"><div class="theme1 rounded-full h-6 relative w-6 transition-all duration-[450ms] ease-in-out bg-[#78757a]" style="border:none;overflow:visible;transform:scale(0.55)"><div class="absolute rounded-full h-6 w-6 transition-transform duration-[450ms] ease-in-out" style="border:none;opacity:0;right:-9px;top:-9px;transform:translate(14px, -14px);background:#78757a"></div><div class="absolute rounded-full h-2 w-2 left-1/2 top-1/2 transition-all duration-[350ms] ease-in-out" style="box-shadow:0 -23px 0 #78757a, 0 23px 0 #78757a, 23px 0 0 #78757a, -23px 0 0 #78757a, 15px 15px 0 #78757a, -15px 15px 0 #78757a, 15px -15px 0 #78757a, -15px -15px 0 #78757a;transform:scale(1);margin:-4px 0px 0px -4px"></div></div><div class="theme2 rounded-full border-0 h-6 absolute right-0 top-0 w-6 transition-all duration-[450ms] ease-in-out" style="background:none;opacity:0;transform:translate(14px, -14px)"></div></button><button class="outline-0 bg-white mx-[5px] p-0 appearance-none items-center rounded-[5px] border-0 cursor-pointer inline-flex h-10 justify-center opacity-75 overflow-hidden relative scale-75 transition-opacity duration-300 ease-in-out w-10 flex-shrink-0 hover:bg-black max-[800px]:hover:bg-white group"><svg class="snow transition-all duration-300 ease-in-out w-7 group-hover:fill-white max-[800px]:group-hover:fill-[#78757a]" style="fill:#78757a" version="1.1" id="레이어_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 23.9 22.9"><path d="M23.9,10c0-0.3-0.2-0.5-0.4-0.6l-1.1-0.3C22.1,9.1,22,9,21.9,8.8c-0.1-0.2,0-0.4,0.1-0.6l0.8-0.9       c0.2-0.2,0.2-0.5,0-0.7c-1.2-1.4-3.1-2-5-1.4c-0.4,0.1-0.9,0.4-1.4,0.7c0.1-0.6,0.2-1.1,0.2-1.6c0-1.9-1.2-3.6-2.9-4.3       c-0.2-0.1-0.5,0-0.7,0.2l-0.6,1c-0.1,0.2-0.3,0.3-0.5,0.3c-0.2,0-0.4-0.1-0.5-0.3l-0.6-1C10.7,0,10.4-0.1,10.2,0       C8.5,0.7,7.3,2.4,7.3,4.3c0,0.5,0.1,1,0.2,1.6C7,5.6,6.5,5.4,6.1,5.2c-1.8-0.6-3.8,0-5,1.4c-0.2,0.2-0.2,0.5,0,0.7l0.8,0.9       C2,8.4,2.1,8.6,2,8.8c0,0.2-0.2,0.3-0.4,0.4L0.4,9.5C0.2,9.5,0,9.8,0,10c0.1,1.8,1.4,3.5,3.2,4c0.4,0.1,1,0.2,1.5,0.3       c-0.4,0.4-0.8,0.8-1.1,1.1c-1.1,1.6-1.2,3.6-0.2,5.2c0.1,0.2,0.4,0.3,0.7,0.2l1.1-0.4c0.2-0.1,0.4-0.1,0.6,0C6,20.6,6,20.8,6,21.1       l-0.1,1.2c0,0.3,0.2,0.5,0.4,0.6c1.8,0.4,3.7-0.2,4.8-1.8c0.3-0.4,0.5-0.8,0.8-1.4c0.2,0.5,0.5,1,0.8,1.4c1.1,1.6,3.1,2.2,4.8,1.8       c0.3-0.1,0.4-0.3,0.4-0.6l-0.1-1.2c0-0.3,0.1-0.4,0.2-0.5c0.1-0.1,0.3-0.1,0.6,0l1.1,0.4c0.2,0.1,0.5,0,0.7-0.2       c1-1.6,0.9-3.6-0.2-5.2c-0.3-0.4-0.6-0.8-1.1-1.1c0.6-0.1,1.1-0.2,1.5-0.3C22.6,13.5,23.8,11.8,23.9,10z M14.1,12.8       c0.3-0.2,0.7-0.3,1.1-0.1c0.4,0.3,0.6,0.8,0.3,1.3c-0.3,0.4-0.8,0.6-1.3,0.3c-0.3-0.2-0.5-0.6-0.4-1l-1.4-0.8v1.6       c0.4,0.1,0.6,0.5,0.6,0.9c0,0.5-0.4,0.9-0.9,0.9c-0.5,0-0.9-0.4-0.9-0.9c0-0.4,0.3-0.7,0.6-0.9v-1.6l-1.4,0.8c0.1,0.4-0.1,0.8-0.4,1       c-0.4,0.3-1,0.1-1.3-0.3c-0.3-0.4-0.1-1,0.3-1.3c0.3-0.2,0.8-0.1,1.1,0.1l1.4-0.8L10,11.1c-0.3,0.2-0.7,0.3-1.1,0.1       C8.5,11,8.3,10.4,8.6,10c0.3-0.4,0.8-0.6,1.3-0.3c0.3,0.2,0.5,0.6,0.4,1l1.4,0.8V9.8c-0.4-0.1-0.6-0.5-0.6-0.9C11.1,8.4,11.5,8,12,8       c0.5,0,0.9,0.4,0.9,0.9c0,0.4-0.3,0.7-0.6,0.9v1.6l1.4-0.8c-0.1-0.4,0.1-0.8,0.4-1c0.4-0.3,1-0.1,1.3,0.3c0.3,0.4,0.1,1-0.3,1.3       c-0.3,0.2-0.8,0.1-1.1-0.1l-1.4,0.8L14.1,12.8z"></path></svg></button><a class="w-[30px] h-[30px] leading-[30px] mx-[5px] text-black flex-shrink-0 flex items-center justify-center" href="/search/">검색</a></div></div><div class="layout-content" style="margin-right:0;max-width:none"><div class="mb-6 max-w-4xl mx-auto px-4 xl:pr-[220px]"><ins class="adsbygoogle block min-w-[320px] min-h-0 mx-auto bg-gray-300" data-ad-client="ca-pub-2667251850399676" data-ad-slot="9586629994" data-ad-format="auto" data-full-width-responsive="true"></ins></div><div class="relative"><div class="max-w-4xl mx-auto px-4 xl:pr-[220px]"><h1 class="text-4xl md:text-5xl font-extrabold mb-6 leading-tight text-gray-900 dark:text-gray-100">event loop</h1><div class="flex flex-col gap-4 mb-8"><div class="flex items-center gap-2 text-gray-600 dark:text-gray-400"><span class="text-sm font-medium">yuni-q</span><span class="text-gray-400 dark:text-gray-500">·</span><span class="text-sm">2020년 8월 25일</span></div><div class="flex flex-wrap gap-2"><span class="px-3 py-1.5 text-sm rounded-md bg-green-50 dark:bg-green-900/20 text-gray-700 dark:text-gray-300 hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors cursor-pointer">javascript</span><span class="px-3 py-1.5 text-sm rounded-md bg-green-50 dark:bg-green-900/20 text-gray-700 dark:text-gray-300 hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors cursor-pointer">event loop</span></div></div><div class="jsx-4115489982 post-content prose prose-lg max-w-none  prose-headings:font-semibold prose-p:leading-relaxed prose-a:text-blue-600 dark:prose-a:text-blue-400 prose-a:no-underline hover:prose-a:underline prose-strong:font-semibold prose-code:font-mono prose-code:text-sm prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-pre:bg-gray-900 dark:prose-pre:bg-gray-800 prose-blockquote:border-l-4 prose-blockquote:pl-4 prose-blockquote:italic prose-blockquote:my-6 prose-img:rounded-lg prose-img:shadow-md prose-table:w-full prose-ul:list-disc prose-ol:list-decimal prose-li:my-1"><h2 id="자바스크립트-이벤트-루프에-대해-알아보겠습니다">자바스크립트 이벤트 루프에 대해 알아보겠습니다.<a aria-hidden="true" tabindex="-1" href="#자바스크립트-이벤트-루프에-대해-알아보겠습니다"><span class="anchor"></span></a></h2>
<hr>
<h2 id="자바스크립트는-싱글-스레드-프로그래밍-언어single-threaded-programming-language-입니다">자바스크립트는 싱글 스레드 프로그래밍 언어(Single threaded programming language) 입니다.<a aria-hidden="true" tabindex="-1" href="#자바스크립트는-싱글-스레드-프로그래밍-언어single-threaded-programming-language-입니다"><span class="anchor"></span></a></h2>
<ul>
<li>자바스크립트는 기본적으로 싱글 스레드 프로그래밍 언어입니다. 여기서 싱글 스레드라는 것은 한 번에 하나의 작업만 할 수 있다는 뜻입니다.
<ul>
<li>유저가 컨트롤 할 수 있는 스레드가 하나라는 뜻에서 싱글 스레드 프로그래밍 언어라고 부릅니다. 실제로는 백드라운드(C++로 구현되어 있는)가 존재합니다. 또한 web worker나 worker thread(node v14에서 나왔습니다)도 컨트롤 할 수 있게 되었습니다.</li>
</ul>
</li>
</ul>
<hr>
<h2 id="우선-call-stack에-대해-알아보겠습니다">우선 call stack에 대해 알아보겠습니다.<a aria-hidden="true" tabindex="-1" href="#우선-call-stack에-대해-알아보겠습니다"><span class="anchor"></span></a></h2>
<ul>
<li>call stack은 프로그램 상에서 우리가 어떤 순서로 작업을 수행하는지 기록하는 작업 <code class="inline-code">스케쥴링과 관련된 자료 구조</code>입니다. 우리가 어떤 함수를 실행하게 되면 우리는 그 함수를 스택의 맨 위에 놓는데, 이것을 push라고 합니다. 만약에 함수가 어떤 값을 리턴하거나 실행을 종료하면 우리는 다시 그 함수를 스택 맨 위에서부터 꺼내는데 이것을 pop이라고 합니다.</li>
<li>함수가 호출되기 때문에 만약에 우리가 잘못해서 무한 호출되는 재귀 함수를 실행시키면 스택에 함수 호출이 계속해서 쌓이다가 <code class="inline-code">Maximum call stack size exceeded</code>라는 에러 메시지를 만나게 됩니다.</li>
</ul>
<hr>
<h2 id="자바스크립트는-싱글-스레드-언어이기-때문에-비동기-콜백을-사용합니다">자바스크립트는 싱글 스레드 언어이기 때문에 비동기 콜백을 사용합니다.<a aria-hidden="true" tabindex="-1" href="#자바스크립트는-싱글-스레드-언어이기-때문에-비동기-콜백을-사용합니다"><span class="anchor"></span></a></h2>
<ul>
<li>자바스크립트는 싱글 스레드 언어이기 때문에 함수를 실행하면 함수 호출이 스택에 순차적으로 쌓이고 스택의 맨 위에서부터 차례대로 한 번에 하나의 함수만 처리할 수 있습니다. 간단한 프로그램이라면 상관없지만 만약에 우리가 아주 복잡한 프로그램을 구동한다면 시간이 매우 오래 걸리는 작업이 스택에 쌓이고 실행되면 그 다음 작업은 무한정 대기할 수밖에 없습니다. 이렇게 다른 작업을 실행하기 위해서 이 전 작업이 완료될 때까지 기다려야만 하는 상황을 <code class="inline-code">블로킹(blocking)</code>이라고 합니다. 왜 이것이 문제가 되냐면 어떤 작업이 실행되어 동작하고 있는 동안에는 브라우저가 다른 일을 전혀 할 수 없으므로 잠시 먹통이 되기 때문입니다. 이러한 점을 극복하기 위한 해결 방안이 바로 <code class="inline-code">Asynchronous Callbacks(비동기 콜백)</code>입니다.</li>
</ul>
<hr>
<h2 id="비동기-콜백은-web-apis와-callback-queue를-활용하여-작동합니다">비동기 콜백은 Web APIs와 callback queue를 활용하여 작동합니다.<a aria-hidden="true" tabindex="-1" href="#비동기-콜백은-web-apis와-callback-queue를-활용하여-작동합니다"><span class="anchor"></span></a></h2>
<ul>
<li>자바스크립트가 싱글 스레드 언어임에도 불구하고 우리가 웹 사이트에서 끊김없이 여러 작업을 동시에 할 수 있는 것은 바로 브라우저가 Web APIs 같은 것들을 제공하여 비동기 작업을 가능하게 해주기 때문입니다.</li>
<li>함수를 동기 호출하게 되면 call stack에 차곡차곡 쌓여 순차적으로 실행됩니다. 이 때 만약에 우리가 AJAX나 setTimeout 혹은 DOM event 함수를 실행하면 자바스크립트 엔진은 call stack에서 Web APIs로 보내고 정해진 시간 혹은 이벤트가 발생한 순간에 순차적으로 callback queue에 적재합니다. callback queue에 줄을 선 함수들은 call stack에 쌓여있던 것들이 모두 제거되어 깨끗해지면 차례대로 스택에 쌓여서 실행되게 됩니다.</li>
</ul>
<hr>
<h2 id="큐queue란">큐(Queue)란?<a aria-hidden="true" tabindex="-1" href="#큐queue란"><span class="anchor"></span></a></h2>
<ul>
<li>큐는 스택과 같이 자료 구조의 일종입니다. 한 쪽에서만 삽입과 삭제가 이루어졌던 스택과는 달리 한쪽에서는 삽입이 되고 다른 한쪽에서는 삭제 작업이 이루어지는 자료 구조입니다. 가장 먼저 삽입된 자료가 가장 먼저 삭제되는 구조이므로 <code class="inline-code">선입선출(FIFO: First In First Out)</code>이라고도 부릅니다.</li>
<li>callback queue에서 Promise의 then/catch와 process.nextTick의 경우 큐의 다른 작업보다(timeout과 같은) 우선순위를 높게 가져갑니다.</li>
</ul>
<hr>
<h2 id="자바스크립트-이벤트-루프에-대한-대표적인-잘못된-개념들을-살펴보겠습니다">자바스크립트 이벤트 루프에 대한 대표적인 잘못된 개념들을 살펴보겠습니다.<a aria-hidden="true" tabindex="-1" href="#자바스크립트-이벤트-루프에-대한-대표적인-잘못된-개념들을-살펴보겠습니다"><span class="anchor"></span></a></h2>
<hr>
<h3 id="이벤트-루프는-자바스크립트-엔진-내부에-있다">이벤트 루프는 자바스크립트 엔진 내부에 있다?<a aria-hidden="true" tabindex="-1" href="#이벤트-루프는-자바스크립트-엔진-내부에-있다"><span class="anchor"></span></a></h3>
<ul>
<li>대표적인 잘못된 개념들 중 하나는 바로 이벤트 루프가 자바스크립트 엔진(V8, Spider Monkey 등)의 일부라는 것입니다. 하지만 이벤트 루프는 단지 자바스크립트 코드를 실행하기위해 자바스크립트 엔진을 이용하기만 할 뿐입니다.</li>
<li>실제로 V8 엔진에는 이벤트 루프를 관리하는 코드가 없습니다. <code class="inline-code">Node.js나 브라우저가 이벤트 루프를 담당</code>하는 것입니다.</li>
</ul>
<hr>
<h3 id="이벤트-루프는-하나의-스택-또는-하나의-큐로만-작동한다">이벤트 루프는 하나의 스택 또는 하나의 큐로만 작동한다?<a aria-hidden="true" tabindex="-1" href="#이벤트-루프는-하나의-스택-또는-하나의-큐로만-작동한다"><span class="anchor"></span></a></h3>
<ul>
<li>이벤트 루프에 작업을 담아놓는 스택 같은 것은 존재하지 않습니다. 그리고 이벤트 루프가 작동하는 과정은 <code class="inline-code">여러 개의 큐를 사용하는 복잡한 과정</code>입니다. 그러나 대부분의 개발자들은 자바스크립트의 모든 콜백이 단 하나의 큐만 사용하여 수행된다고 알고 있는데, 이것은 완전히 잘못된 생각입니다.</li>
</ul>
<hr>
<h3 id="이벤트-루프는-여러-개의-스레드에서-실행된다">이벤트 루프는 여러 개의 스레드에서 실행된다?<a aria-hidden="true" tabindex="-1" href="#이벤트-루프는-여러-개의-스레드에서-실행된다"><span class="anchor"></span></a></h3>
<ul>
<li>Node.js 이벤트 루프의 잘못된 다이어그램들 때문에 우리는 한 개의 스레드가 자바스크립트의 실행을 담당하고 다른 한 개는 이벤트 루프를 담당하는, 총 두 개의 스레드가 있다고 생각하게 되었습니다. 그러나 실제로는 <code class="inline-code">단일 스레드로 이 모든 것을 처리</code>합니다.</li>
</ul>
<hr>
<h2 id="이벤트-루프는-단-하나의-스레드를-사용하여-자바스크립트를-실행합니다">이벤트 루프는 <code class="inline-code">단 하나의 스레드</code>를 사용하여 자바스크립트를 실행합니다!<a aria-hidden="true" tabindex="-1" href="#이벤트-루프는-단-하나의-스레드를-사용하여-자바스크립트를-실행합니다"><span class="anchor"></span></a></h2>
<ul>
<li>이벤트 루프 자체에서 V8 또는 다른 엔진을 사용하여 자바스크립트를 실행하는 것이고 이때, 단 하나의 스레드를 사용하여 자바스크립트가 실행되는 것입니다. 실행 자체는 동기적이고, 현재 실행시킨 자바스크립트의 실행이 완료되지 않는다면 이벤트 루프 또한 진행되지 않습니다.</li>
</ul>
<hr>
<h3 id="settimeout은-일부-비동기-os-api와-관련있다">setTimeout은 일부 비동기 OS API와 관련있다?<a aria-hidden="true" tabindex="-1" href="#settimeout은-일부-비동기-os-api와-관련있다"><span class="anchor"></span></a></h3>
<ul>
<li>setTimeout의 딜레이가 끝났을 때 콜백이 외부의 요인(OS나 커널 같은)으로 인해 어떤 작업 큐에 들어가게 된다고 생각하는 것입니다. 하지만 <code class="inline-code">이벤트 루프에 이런 외부의 요인 같은 건 없습니다</code>.</li>
</ul>
<hr>
<h3 id="setimmediate의-콜백은-작업-큐의-가장-첫번째에-위치한다">setImmediate의 콜백은 작업 큐의 가장 첫번째에 위치한다?<a aria-hidden="true" tabindex="-1" href="#setimmediate의-콜백은-작업-큐의-가장-첫번째에-위치한다"><span class="anchor"></span></a></h3>
<ul>
<li>보통 일반적인 이벤트 루프에 대한 설명들은 하나의 큐만 가지고 설명을 진행하기 때문에, 몇몇 개발자들은 setImmediate()가 콜백을 작업 큐의 가장 앞쪽에 배치하는 API라고 생각하게 됩니다. 하지만 이것은 완전히 틀린 생각이며, <code class="inline-code">모든 작업 큐들은 FIFO(First In First Out)로만 작동합니다</code>.</li>
</ul>
<hr>
<h2 id="왜-우리는-settimeoutfn-0가-있는데도-setimmediate를-사용해야-할까요">왜 우리는 setTimeout(fn, 0)가 있는데도 setImmediate를 사용해야 할까요?<a aria-hidden="true" tabindex="-1" href="#왜-우리는-settimeoutfn-0가-있는데도-setimmediate를-사용해야-할까요"><span class="anchor"></span></a></h2>
<ul>
<li>setTimeout(fn, 0)은 실질적으로 <code class="inline-code">0이 아닙니다. 이건 사실 1 입니다</code>. 타이머의 딜레이를 1ms보다 작거나 2147483647ms보다 크게 설정하면 딜레이는 자동으로 1로 세팅 됩니다. 그렇기 때문에 setTimeout의 딜레이를 0으로 설정하려고 한다면 이 딜레이는 자동으로 1이 되는 것입니다.</li>
<li>setImmediate을 사용하면 타이머를 사용할 때처럼 <code class="inline-code">딜레이의 시간을 추가적으로 체크할 필요가 없어집니다</code>. 그래서 setImmediate은 빠른 것입니다. 또한 setImmediate의 체크 작업은 Poll phase 직후에 수행되기 때문에 HTTP 요청 콜백과 같은 곳에서 사용된 setImmediate의 콜백 함수는 바로 실행된다고 할 수 있습니다.</li>
</ul>
<hr>
<h2 id="자바스크립트는-block-될-수-있을까요">자바스크립트는 Block 될 수 있을까요?<a aria-hidden="true" tabindex="-1" href="#자바스크립트는-block-될-수-있을까요"><span class="anchor"></span></a></h2>
<ul>
<li>네! 있습니다.</li>
<li>nextTickQueue는 콜백 실행에 있어서 어떤 제한도 가지고 있지 않습니다. 그렇기 때문에 만약 process.nextTick()이 재귀 호출된다면, 여러분의 프로그램은 다른 페이즈들의 큐가 어떤 콜백을 가지고 있든간에 절대 그 작업에서 빠져나오지 못할 것입니다.</li>
</ul>
<hr>
<h2 id="만약-exit-callback-phase에서-settimeout을-호출하면-어떻게-될까요">만약 Exit callback phase에서 setTimeout을 호출하면 어떻게 될까요?<a aria-hidden="true" tabindex="-1" href="#만약-exit-callback-phase에서-settimeout을-호출하면-어떻게-될까요"><span class="anchor"></span></a></h2>
<ul>
<li>타이머 자체는 시작될 수 있겠지만 <code class="inline-code">setTimeout의 콜백은 절대 호출되지 않을 것입니다</code>. 이미 Node.js가 Exit callbacks에 들어와 있다는 것은 이미 이벤트 루프에서 빠져나왔다는 것을 의미합니다.</li>
</ul>
<hr>
<h2 id="중요한-점들을-정리하고-가겠습니다">중요한 점들을 정리하고 가겠습니다.<a aria-hidden="true" tabindex="-1" href="#중요한-점들을-정리하고-가겠습니다"><span class="anchor"></span></a></h2>
<ul>
<li>이벤트 루프는 작업 스택을 가지고 있지 않습니다.</li>
<li>이벤트 루프가 별도의 스레드에서 실행되고 자바스크립트 실행은 어떤 큐에서 하나씩 꺼내와서 다른 곳에서 하는 것이 아니라 자바스크립트의 실행 자체가 이벤트 루프 안에서 수행되는 것입니다.</li>
<li>setImmediate는 콜백을 작업 큐의 앞 쪽에 밀어넣는 것이 아니라 setImmediate 만을 처리하기 위한 전용 페이즈와 큐가 존재합니다.</li>
<li>setImmediate은 실질적으로 다음 페이즈 혹은 다음 이벤트 루프의 순회에서 실행되고, nextTick이 오히려 실질적으로 더 빠르게 실행됩니다.</li>
<li>nextTickQueue에 담긴 작업이 재귀 호출을 수행하는 경우 Node.js의 작업 프로세스를 블록킹할 수 있습니다.</li>
</ul>
<hr>
<h2 id="이벤트-루프-이미지를-보겠습니다">이벤트 루프 이미지를 보겠습니다.<a aria-hidden="true" tabindex="-1" href="#이벤트-루프-이미지를-보겠습니다"><span class="anchor"></span></a></h2>
<p><img src="./images/nodejs-event-loop-phase.png" alt="" loading="lazy" decoding="async" style="max-width: 100%; height: auto;"></p>
<hr>
<h2 id="이제-이벤트-루프의-구조에-대해-알아보겠습니다">이제 이벤트 루프의 구조에 대해 알아보겠습니다.<a aria-hidden="true" tabindex="-1" href="#이제-이벤트-루프의-구조에-대해-알아보겠습니다"><span class="anchor"></span></a></h2>
<ul>
<li>각각의 박스는 특정 작업을 수행하기 위한 페이즈들을 의미합니다.</li>
<li>각 페이즈는 각자 하나의 큐를 가지고 있으며, 자바스크립트의 실행은 이 페이즈들 중 Idle, prepare 페이즈를 제외한 어느 단계에서나 할 수 있습니다.</li>
<li><code class="inline-code">nextTickQueue</code>와 <code class="inline-code">microTaskQueue</code>는 이벤트 루프의 일부가 아니며, 이 큐들에 들어있는 작업 또한 어떤 페이즈에서든 실행될 수 있습니다. 또한 이 큐들에 들어있는 작업은 가장 높은 실행 우선 순위를 가지고 있습니다.</li>
</ul>
<hr>
<h3 id="첫번째로-timer-phase-입니다">첫번째로 Timer phase 입니다.<a aria-hidden="true" tabindex="-1" href="#첫번째로-timer-phase-입니다"><span class="anchor"></span></a></h3>
<ul>
<li>Timer phase는 이벤트 루프의 시작을 알리는 페이즈입니다.</li>
<li>이 페이즈가 가지고 있는 큐에는 setTimeout이나 setInterval 같은 <code class="inline-code">타이머들의 콜백을 저장</code>하게 됩니다. 이 페이즈에서 바로 타이머들의 콜백이 큐에 들어가는 것은 아니지만 타이머들을 min-heap으로 유지하고 있다가 실행할 때가 된 타이머들의 콜백을 큐에 넣고 실행하는 것입니다.</li>
</ul>
<hr>
<h3 id="timer-phase의-동작을-조금-더-상세히-살펴보겠습니다">Timer phase의 동작을 조금 더 상세히 살펴보겠습니다.<a aria-hidden="true" tabindex="-1" href="#timer-phase의-동작을-조금-더-상세히-살펴보겠습니다"><span class="anchor"></span></a></h3>
<ul>
<li>이벤트 루프가 Timer phase에 들어가게 되면 실행할 타이머 콜백 큐에 뭐가 있는지 확인부터 시작합니다.</li>
<li>타이머 스크립트는 오름차순으로 힙에 저장됩니다. 그래서 제일 먼저 저장된 타이머들을 하나씩 까서 <code class="inline-code">now - registeredTime === delta</code> 같은 조건을 통해 타이머의 콜백을 실행할 시간이 되었는지 검사하게 됩니다. 만약 조건에 해당된다면 이 타이머의 콜백을 실행하고 다음 타이머를 확인합니다. 만약 조건에 해당하지 않는 타이머를 만난다면, 탐색을 바로 종료하고 다음 페이즈로 이동합니다. <code class="inline-code">타이머는 힙 내부에 오름차순으로 정렬되어있기 때문에 그 이후로는 탐색을 해도 의미가 없습니다</code>.</li>
</ul>
<hr>
<h3 id="두번째로-pending-io-callback-phase-입니다">두번째로 Pending i/o callback phase 입니다.<a aria-hidden="true" tabindex="-1" href="#두번째로-pending-io-callback-phase-입니다"><span class="anchor"></span></a></h3>
<ul>
<li>이 페이즈에서는 이벤트 루프의 pending_queue에 들어있는 콜백들을 실행합니다.</li>
<li>이 큐에 들어와있는 콜백들은 현재 돌고 있는 <code class="inline-code">루프 이전에 한 작업에서 이미 큐에 들어와있던 콜백</code>들입니다.</li>
<li>타임 페이즈가 종료된 후 이벤트 루프는 Pending i/o 페이즈에 진입하고, 가장 먼저 이전 작업들의 콜백이 실행 대기 중인지, 즉 pending_queue에 들어와 있는지를 체크하게 됩니다. 만약 실행 대기 중이라면 pending_queue가 비거나 시스템의 실행 한도 초과에 도달할 때까지 대기하고 있던 콜백들을 실행합니다. 이 과정이 종료되면 이벤트 루프는 Idle Handler Phase로 이동하게 된 후 내부 처리를 위한 Prepare phase를 거쳐 최종적으로 가장 중요한 단계인 Poll Phase에 도달하게 됩니다.</li>
</ul>
<hr>
<h3 id="세번째는-idle-prepare-phase-입니다">세번째는 Idle, Prepare phase 입니다.<a aria-hidden="true" tabindex="-1" href="#세번째는-idle-prepare-phase-입니다"><span class="anchor"></span></a></h3>
<ul>
<li>이름은 Idle phase이지만 이 페이즈는 매 Tick마다 실행됩니다.</li>
<li>Prepare phase 또한 매 폴링(Polling)때마다 실행됩니다.</li>
<li>이 두개의 페이즈는 이벤트 루프와 직접적인 관련이 있다기보다는 Node.js의 내부적인 관리를 위한 것입니다.</li>
</ul>
<hr>
<h3 id="네번째는-poll-phase-입니다">네번째는 Poll phase 입니다.<a aria-hidden="true" tabindex="-1" href="#네번째는-poll-phase-입니다"><span class="anchor"></span></a></h3>
<ul>
<li>이 페이즈에서는 새로운 수신 커넥션(새로운 소켓 설정 등)과 데이터(파일 읽기 등)를 허용합니다.</li>
<li>이름에서 알 수 있듯이 이 페이즈는 폴링하는 단계입니다. 이벤트 루프가 Poll phase에 들어왔을 때 watcher_queue 내부에 파일 읽기의 응답 콜백, HTTP 응답 콜백 같이 수행해야 할 작업들이 있다면 이 작업들을 실행하게 됩니다. 이 과정 또한 watcher_queue가 비거나 시스템의 실행 한도 초과에 다다를 때까지 계속 됩니다.</li>
</ul>
<hr>
<h3 id="poll-phase의-동작에-대해-조금-더-자세히-알아보겠습니다">Poll phase의 동작에 대해 조금 더 자세히 알아보겠습니다.<a aria-hidden="true" tabindex="-1" href="#poll-phase의-동작에-대해-조금-더-자세히-알아보겠습니다"><span class="anchor"></span></a></h3>
<ul>
<li>일단 watch_queue가 비어있다면, Node.js는 곧바로 다음 페이즈로 넘어가는 것이 아니라 <code class="inline-code">약간 대기시간</code>을 가지게 됩니다. Node.js가 기다리는 시간은 여러 가지 요인에 따라 계산됩니다.</li>
<li>만약 더 이상 콜백들을 실행할 수 없는 상태가 된다면 만약 check_queue, pending_queue, closing_callbacks_queue에 해야할 작업이 있는지를 검사하고, 만약 해야할 작업이 있다면 바로 Poll phase가 종료되고 다음 페이즈로 넘어가게 됩니다. 하지만 특별히 해야할 작업이 더 이상 없는 경우 Poll phase는 <code class="inline-code">다음 페이즈로 넘어가지 않고 계속 대기</code>하게 됩니다.</li>
</ul>
<hr>
<h3 id="다섯번째는-check-phase-입니다">다섯번째는 Check phase 입니다.<a aria-hidden="true" tabindex="-1" href="#다섯번째는-check-phase-입니다"><span class="anchor"></span></a></h3>
<ul>
<li>Poll phase의 다음 페이즈는 바로 <code class="inline-code">setImmediate의 콜백</code>만을 위한 페이즈인 Check phase입니다.</li>
<li>Poll phase가 지나면 이벤트 루프는 바로 setImmediate() API의 콜백과 관련이 있는 Check phase에 들어서게 됩니다. 이 페이즈에서는 다른 페이즈와 마찬가지로 큐가 비거나 시스템 실행 한도 초과에 도달할 때까지 계속 해서 setImmediate의 콜백들을 실행합니다.</li>
</ul>
<hr>
<h3 id="여섯번째는-close-callbacks-입니다">여섯번째는 Close callbacks 입니다.<a aria-hidden="true" tabindex="-1" href="#여섯번째는-close-callbacks-입니다"><span class="anchor"></span></a></h3>
<ul>
<li>socket.on('close', () => {})과 같은 close 이벤트 타입의 핸들러들은 여기서 처리됩니다.</li>
<li>Check Phase가 종료된 후에, 이벤트 루프의 다음 목적지는 close나 destroy 콜백 타입들을 관리하는 Close callback 입니다.</li>
<li>이벤트 루프가 Close callback들과 함께 종료되고나면 이벤트 루프는 다음에 돌아야할 루프가 있는지 다시 체크 하게 됩니다. 만약 아니라면 그대로 이벤트 루프는 종료됩니다. 하지만 만약 더 수행해야할 작업들이 남아 있다면 이벤트 루프는 다음 순회를 돌기 시작하고 다시 Timer Phase부터 시작하게 됩니다.</li>
</ul>
<hr>
<h3 id="이벤트-루프에-포함되지-않았던-nexttickqueue와-microtaskqueue에-대해-알아보겠습니다">이벤트 루프에 포함되지 않았던 nextTickQueue와 microTaskQueue에 대해 알아보겠습니다.<a aria-hidden="true" tabindex="-1" href="#이벤트-루프에-포함되지-않았던-nexttickqueue와-microtaskqueue에-대해-알아보겠습니다"><span class="anchor"></span></a></h3>
<ul>
<li>nextTickQueue는 process.nextTick() API의 콜백들을 가지고 있습니다.</li>
<li>microTaskQueue는 Resolve된 프로미스의 콜백을 가지고 있습니다.</li>
<li>이 두개의 큐는 기술적으로 이벤트 루프의 일부가 아닙니다. 즉, libUV 라이브러리에 포함된 것이 아니라 Node.js에 포함된 기술이라는 것입니다. 이 친구들이 가지고 있는 작업들은 현재 실행되고 있는 작업이 끝나자마자 호출되어야합니다.</li>
</ul>
<hr>
<h3 id="nexttickqueue와-microtaskqueue의-특별한-점">nextTickQueue와 microTaskQueue의 특별한 점<a aria-hidden="true" tabindex="-1" href="#nexttickqueue와-microtaskqueue의-특별한-점"><span class="anchor"></span></a></h3>
<ul>
<li>이 두 큐의 콜백들은 어떤 페이즈에서 다음 페이즈로 넘어가기 전에 자신이 가지고 있는 콜백들을 최대한 빨리 실행해야하는 역할을 맡고 있습니다.</li>
<li>다른 페이즈들과는 다르게 이 두 큐는 시스템 <code class="inline-code">실행 한도 초과에 영향을 받지 않기 때문에</code> Node.js는 이 큐가 완전히 비워질 때까지 콜백들을 실행합니다. 그리고 nextTickQueue는 microTaskQueue보다는 높은 우선 순위를 가지고 있습니다.</li>
</ul>
<hr>
<h2 id="비동기-작업의-핵심인-thread-pool에-대해-알아보겠습니다">비동기 작업의 핵심인 Thread-pool에 대해 알아보겠습니다.<a aria-hidden="true" tabindex="-1" href="#비동기-작업의-핵심인-thread-pool에-대해-알아보겠습니다"><span class="anchor"></span></a></h2>
<ul>
<li>Node.js가 모든 비동기 명령을 관리하는 별도의 스레드풀을 가지고 있다는 오해가 있습니다. 그러나 이 스레드풀은 Node.js가 아니라 Node.js가 비동기 작업을 처리하기 위해 사용하는 라이브러리인 <code class="inline-code">libUV에 포함된 기능</code>입니다.</li>
<li>스레드풀은 이벤트 루프 매커니즘의 일부가 아닙니다.</li>
</ul>
<hr>
<h2 id="libuv-이외의-별도의-스레드풀도-필요합니다">libUV 이외의 별도의 스레드풀도 필요합니다.<a aria-hidden="true" tabindex="-1" href="#libuv-이외의-별도의-스레드풀도-필요합니다"><span class="anchor"></span></a></h2>
<ul>
<li>libUV는 OS커널의 비동기 API만을 사용하여 이벤트 드리븐을 유도할 수 있을 만큼 충분히 훌륭합니다. 그러나 파일 읽기, DNS Lookup 등 OS 커널이 비동기 API를 지원하지 않는 작업들의 경우에는 별도의 스레드풀을 사용하게 되는데, 이때 기본 값으로 4개의 스레드를 사용하도록 설정되어있습니다. uv_threadpool 환경 변수를 사용하면 최대 128개까지 스레드 개수를 늘릴 수도 있습니다.</li>
</ul>
<hr>
<h2 id="workflow에-대한-예제-입니다">Workflow에 대한 예제 입니다.<a aria-hidden="true" tabindex="-1" href="#workflow에-대한-예제-입니다"><span class="anchor"></span></a></h2>
<pre class="language-javascript optimized-code-block" style="max-height: 600px; overflow-y: auto;"><code class="language-javascript code-highlight"><span class="code-line"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'setImmediate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<ul>
<li>무엇이 먼저 실행될지 예측할 수 없습니다.</li>
<li>메인 모듈이 실행되고나서 이벤트 루프가 Timer phase에 진입할 때 여러분의 타이머를 찾을 수도 있고 못 찾을 수도 있기 때문입니다.</li>
</ul>
<hr>
<h3 id="이유">이유<a aria-hidden="true" tabindex="-1" href="#이유"><span class="anchor"></span></a></h3>
<ul>
<li>왜냐하면 타이머는 시스템의 시간과 사용자가 제공한 시간을 사용하여 등록되기 때문입니다. setTimeout이 호출된 순간, 타이머는 메모리에 이 타이머를 저장하게되는데, 그 순간 컴퓨터의 성능이나 Node.js가 아닌 외부 작업 때문에 약간의 딜레이가 발생할 수 있기 때문입니다. 또 다른 포인트는 Node.js가 Timer phase에 진입하기 전에 변수 now를 선언하고 그 변수 now를 현재 시간으로 간주한다는 점입니다. 그러므로 정확한 계산이라고 하기에는 약간의 노이즈가 껴있다는 것이고, 이게 바로 setTimeout이 반드시 먼저 실행될 것이라고 확신할 수 없는 불확실성의 이유가 됩니다.</li>
</ul>
<hr>
<h3 id="명확히-실행-순서를-정하는-방법이-있습니다">명확히 실행 순서를 정하는 방법이 있습니다.<a aria-hidden="true" tabindex="-1" href="#명확히-실행-순서를-정하는-방법이-있습니다"><span class="anchor"></span></a></h3>
<pre class="language-javascript optimized-code-block" style="max-height: 600px; overflow-y: auto;"><code class="language-javascript code-highlight"><span class="code-line">fs<span class="token punctuation">.</span><span class="token method function property-access">readFile</span><span class="token punctuation">(</span><span class="token string">'my-file-path.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'setImmediate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<ul>
<li>코드를 I/O 사이클의 내부로 옮긴다면, 반드시 setTimeout보다 setImmediate가 먼저 실행되는 것을 보장할 수 있게 됩니다.</li>
</ul>
<hr>
<h2 id="setimmediate의-vs-settimeout">setImmediate의 vs setTimeout<a aria-hidden="true" tabindex="-1" href="#setimmediate의-vs-settimeout"><span class="anchor"></span></a></h2>
<h3 id="setimmediate">setImmediate<a aria-hidden="true" tabindex="-1" href="#setimmediate"><span class="anchor"></span></a></h3>
<pre class="language-javascript optimized-code-block" style="max-height: 600px; overflow-y: auto;"><code class="language-javascript code-highlight"><span class="code-line"><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">var</span> start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	i<span class="token operator">++</span><span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>i <span class="token operator">&#x3C;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token function">setImmediate</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">var</span> end <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">		<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Execution time: '</span><span class="token punctuation">,</span> end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<hr>
<h3 id="settimeout">setTimeout<a aria-hidden="true" tabindex="-1" href="#settimeout"><span class="anchor"></span></a></h3>
<pre class="language-js optimized-code-block" style="max-height: 600px; overflow-y: auto;"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">var</span> start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	i<span class="token operator">++</span><span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>i <span class="token operator">&#x3C;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token function">setTimeout</span><span class="token punctuation">(</span>bar<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">var</span> end <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">		<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Execution time: '</span><span class="token punctuation">,</span> end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<hr>
<h3 id="setimmediate가-더-좋습니다">setImmediate가 더 좋습니다.<a aria-hidden="true" tabindex="-1" href="#setimmediate가-더-좋습니다"><span class="anchor"></span></a></h3>
<ul>
<li>Timer phase에서는 타이머를 실행할 시간이 되었는지, 콜백을 실행해야 하는지를 검사하기 위해 몇가지 작업을 거쳐야 하는데 이 과정을 매 이터레이션마다 하고 있으니 느려질 수 밖에 없습니다. 그러나 setImmediate의 경우 이런 과정이 필요없기 때문에 setTimeout보다 실행 속도가 빠릅니다.</li>
</ul>
<hr>
<h2 id="nexttick-vs-settimeout">nextTick vs setTimeout<a aria-hidden="true" tabindex="-1" href="#nexttick-vs-settimeout"><span class="anchor"></span></a></h2>
<pre class="language-javascript optimized-code-block" style="max-height: 600px; overflow-y: auto;"><code class="language-javascript code-highlight"><span class="code-line"><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	i<span class="token operator">++</span><span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>i <span class="token operator">></span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">	process<span class="token punctuation">.</span><span class="token method function property-access">nextTick</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token function">setTimeout</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<hr>
<h2 id="결과">결과<a aria-hidden="true" tabindex="-1" href="#결과"><span class="anchor"></span></a></h2>
<pre class="language-js optimized-code-block" style="max-height: 600px; overflow-y: auto;"><code class="language-js code-highlight"><span class="code-line"><span class="token comment">// foo 1</span>
</span><span class="code-line"><span class="token comment">// foo 2</span>
</span><span class="code-line"><span class="token comment">// foo 3</span>
</span><span class="code-line"><span class="token comment">// foo 4</span>
</span><span class="code-line"><span class="token comment">// foo 5</span>
</span><span class="code-line"><span class="token comment">// foo 6</span>
</span><span class="code-line"><span class="token comment">// foo 7</span>
</span><span class="code-line"><span class="token comment">// foo 8</span>
</span><span class="code-line"><span class="token comment">// foo 9</span>
</span><span class="code-line"><span class="token comment">// foo 10</span>
</span><span class="code-line"><span class="token comment">// foo 11</span>
</span><span class="code-line"><span class="token comment">// foo 12</span>
</span><span class="code-line"><span class="token comment">// foo 13</span>
</span><span class="code-line"><span class="token comment">// foo 14</span>
</span><span class="code-line"><span class="token comment">// foo 15</span>
</span><span class="code-line"><span class="token comment">// foo 16</span>
</span><span class="code-line"><span class="token comment">// foo 17</span>
</span><span class="code-line"><span class="token comment">// foo 18</span>
</span><span class="code-line"><span class="token comment">// foo 19</span>
</span><span class="code-line"><span class="token comment">// foo 20</span>
</span><span class="code-line"><span class="token comment">// Other setTimeout</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span><span class="code-line"><span class="token comment">// setTimeout 21</span>
</span></code></pre>
<h2 id="참조">참조<a aria-hidden="true" tabindex="-1" href="#참조"><span class="anchor"></span></a></h2>
<ul>
<li><a href="https://im-developer.tistory.com/113">[JS/Event Loop] 자바스크립트, 이벤트 루프(Event Loop)와 동시성(concurrency)에 대하여</a></li>
<li><a href="https://evan-moon.github.io/2019/08/01/nodejs-event-loop-workflow/?fbclid=IwAR1QP82JVrNfICEK1UNYGIDnrIlmzzD70AYYcEPiAnW9QzMH26GDker1-B8">로우 레벨로 살펴보는 Node.js 이벤트 루프</a></li>
</ul></div></div></div><div class="flex flex-col gap-5 my-10 max-w-4xl mx-auto px-4 xl:pr-[220px]"><div class="sponsor-button"><a class="flex items-center justify-center gap-3 px-6 py-3.5 bg-gradient-to-r from-amber-400 via-amber-500 to-amber-600 hover:from-amber-500 hover:via-amber-600 hover:to-amber-700 active:from-amber-600 active:via-amber-700 active:to-amber-800 text-white rounded-2xl transition-all duration-300 cursor-pointer border-0 shadow-lg hover:shadow-xl hover:scale-[1.02] active:scale-[0.98] font-semibold text-base no-underline" target="_blank" rel="noopener noreferrer" href="https://www.buymeacoffee.com/yuniq"><img src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg" alt="Buy me a coffee" class="w-7 h-7 flex-shrink-0"/><span>Buy me a coffee</span></a></div></div><div class="max-w-4xl mx-auto px-4 xl:pr-[220px]"><ins class="kakao_ad_area block" data-ad-unit="DAN-kkYIHzVbuDz3kYsq" data-ad-width="320" data-ad-height="50" style="width:320px;height:50px"></ins></div><div class="max-w-4xl mx-auto px-4 xl:pr-[220px]"><hr class="custom-hr"/></div><div class="my-8 max-w-4xl mx-auto px-4 xl:pr-[220px]"><div class="bio-container"><div class="author-description flex"><img class="bio-author-image" src="/images/profile.png" alt="yuni-q" width="72"/><div><span class="author-name-prefix text-[90%] mr-1">Written by</span><a class="author-name-content" href="/about/"><span>@<!-- -->yuni-q</span></a><div class="author-introduction mt-1 text-[80%] leading-[1.4]">yuni-q&#x27;s graffiti.</div><p class="author-socials mt-[-4px]"><a href="https://github.com/Yuni-Q" class="mr-2 text-[80%]">GitHub</a></p></div></div></div></div><div class="max-w-4xl mx-auto px-4 xl:pr-[220px]"><nav class="navigator my-8"><ul class="flex flex-col gap-4"><li><a rel="prev" class="block p-4 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-blue-400 dark:hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200 group" href="/javascript/hoisting/"><div class="text-xs text-gray-500 dark:text-gray-400 mb-1 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">이전 글</div><div class="text-sm font-medium text-gray-900 dark:text-gray-100 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">← <!-- -->hoisting</div></a></li><li><a rel="next" class="block p-4 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-blue-400 dark:hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200 group text-right" href="/javascript/lambda/"><div class="text-xs text-gray-500 dark:text-gray-400 mb-1 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">다음 글</div><div class="text-sm font-medium text-gray-900 dark:text-gray-100 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">lambda<!-- --> →</div></a></li></ul></nav></div><div class="max-w-4xl mx-auto px-4 xl:pr-[220px]"><div class="utterences"></div></div><footer class="pt-[52px] text-center text-xs">©<a href="https://github.com/Yuni-Q" class="no-underline">yuni-q</a>, Built with<!-- --> <a href="https://nextjs.org" class="no-underline">Next.js</a></footer></div><script src="/_next/static/chunks/webpack-57fdca2934e5ae0a.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/bc8bb31cb71603b2.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"2:I[1633,[],\"\"]\n5:I[808,[],\"\"]\n8:I[6217,[],\"\"]\n9:I[5217,[\"3185\",\"static/chunks/app/layout-3ad8bb7cb2292578.js\"],\"ServiceWorkerCleanup\"]\na:I[6484,[\"3185\",\"static/chunks/app/layout-3ad8bb7cb2292578.js\"],\"ThemeProvider\"]\nc:I[7768,[],\"\"]\n6:[\"category\",\"javascript\",\"d\"]\n7:[\"slug\",\"event-loop\",\"c\"]\nd:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L2\",null,{\"buildId\":\"static-build-id\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"javascript\",\"event-loop\",\"\"],\"initialTree\":[\"\",{\"children\":[[\"category\",\"javascript\",\"d\"],{\"children\":[[\"slug\",\"event-loop\",\"c\"],{\"children\":[\"__PAGE__?{\\\"category\\\":\\\"javascript\\\",\\\"slug\\\":[\\\"event-loop\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"category\",\"javascript\",\"d\"],{\"children\":[[\"slug\",\"event-loop\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L3\",\"$L4\",null],null],null]},[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$6\",\"children\",\"$7\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$6\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/bc8bb31cb71603b2.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"ko\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://fonts.googleapis.com\"}],[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://fonts.gstatic.com\",\"crossOrigin\":\"anonymous\"}],[\"$\",\"link\",null,{\"href\":\"https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700\u0026display=swap\",\"rel\":\"stylesheet\"}],[\"$\",\"link\",null,{\"href\":\"https://fonts.googleapis.com/css2?family=Catamaran:wght@800\u0026display=swap\",\"rel\":\"stylesheet\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"href\":\"/favicon2.png\"}],[\"$\",\"link\",null,{\"rel\":\"shortcut icon\",\"href\":\"/favicon2.png\"}],[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"href\":\"/favicon2.png\"}],[\"$\",\"script\",null,{\"id\":\"ads\",\"async\":true,\"src\":\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\"}],[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"(adsbygoogle=window.adsbygoogle||[]).requestNonPersonalizedAds=1;\"}}]]}],[\"$\",\"body\",null,{\"children\":[[\"$\",\"noscript\",null,{\"children\":\"You need to enable JavaScript to run this app.\"}],[\"$\",\"$L9\",null,{}],[\"$\",\"$La\",null,{\"children\":[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}]}]]}]]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Lb\"],\"globalErrorComponent\":\"$c\",\"missingSlots\":\"$Wd\"}]\n"])</script><script>self.__next_f.push([1,"e:I[5553,[\"9243\",\"static/chunks/9243-972bdccd4ceb11ae.js\",\"5800\",\"static/chunks/5800-4312aed1aa8a4305.js\",\"549\",\"static/chunks/549-2babc012700e23ed.js\",\"4853\",\"static/chunks/4853-73ca7990eb89674b.js\",\"8936\",\"static/chunks/app/%5Bcategory%5D/%5B...slug%5D/page-6aac7cf9456deffb.js\"],\"BlogPostPageClient\"]\nf:T5309,"])</script><script>self.__next_f.push([1,"\n## 자바스크립트 이벤트 루프에 대해 알아보겠습니다.\n\n---\n\n## 자바스크립트는 싱글 스레드 프로그래밍 언어\u003cbr /\u003e(Single threaded programming language) 입니다.\n\n- 자바스크립트는 기본적으로 싱글 스레드 프로그래밍 언어입니다. 여기서 싱글 스레드라는 것은 한 번에 하나의 작업만 할 수 있다는 뜻입니다.\n  - 유저가 컨트롤 할 수 있는 스레드가 하나라는 뜻에서 싱글 스레드 프로그래밍 언어라고 부릅니다. 실제로는 백드라운드(C++로 구현되어 있는)가 존재합니다. 또한 web worker나 worker thread(node v14에서 나왔습니다)도 컨트롤 할 수 있게 되었습니다.\n\n---\n\n## 우선 call stack에 대해 알아보겠습니다.\n\n- call stack은 프로그램 상에서 우리가 어떤 순서로 작업을 수행하는지 기록하는 작업 `스케쥴링과 관련된 자료 구조`입니다. 우리가 어떤 함수를 실행하게 되면 우리는 그 함수를 스택의 맨 위에 놓는데, 이것을 push라고 합니다. 만약에 함수가 어떤 값을 리턴하거나 실행을 종료하면 우리는 다시 그 함수를 스택 맨 위에서부터 꺼내는데 이것을 pop이라고 합니다.\n- 함수가 호출되기 때문에 만약에 우리가 잘못해서 무한 호출되는 재귀 함수를 실행시키면 스택에 함수 호출이 계속해서 쌓이다가 `Maximum call stack size exceeded`라는 에러 메시지를 만나게 됩니다.\n\n---\n\n## 자바스크립트는 싱글 스레드 언어이기 때문에 비동기 콜백을 사용합니다.\n\n- 자바스크립트는 싱글 스레드 언어이기 때문에 함수를 실행하면 함수 호출이 스택에 순차적으로 쌓이고 스택의 맨 위에서부터 차례대로 한 번에 하나의 함수만 처리할 수 있습니다. 간단한 프로그램이라면 상관없지만 만약에 우리가 아주 복잡한 프로그램을 구동한다면 시간이 매우 오래 걸리는 작업이 스택에 쌓이고 실행되면 그 다음 작업은 무한정 대기할 수밖에 없습니다. 이렇게 다른 작업을 실행하기 위해서 이 전 작업이 완료될 때까지 기다려야만 하는 상황을 `블로킹(blocking)`이라고 합니다. 왜 이것이 문제가 되냐면 어떤 작업이 실행되어 동작하고 있는 동안에는 브라우저가 다른 일을 전혀 할 수 없으므로 잠시 먹통이 되기 때문입니다. 이러한 점을 극복하기 위한 해결 방안이 바로 `Asynchronous Callbacks(비동기 콜백)`입니다.\n\n---\n\n## 비동기 콜백은 Web APIs와 callback queue를 활용하여 작동합니다.\n\n- 자바스크립트가 싱글 스레드 언어임에도 불구하고 우리가 웹 사이트에서 끊김없이 여러 작업을 동시에 할 수 있는 것은 바로 브라우저가 Web APIs 같은 것들을 제공하여 비동기 작업을 가능하게 해주기 때문입니다.\n- 함수를 동기 호출하게 되면 call stack에 차곡차곡 쌓여 순차적으로 실행됩니다. 이 때 만약에 우리가 AJAX나 setTimeout 혹은 DOM event 함수를 실행하면 자바스크립트 엔진은 call stack에서 Web APIs로 보내고 정해진 시간 혹은 이벤트가 발생한 순간에 순차적으로 callback queue에 적재합니다. callback queue에 줄을 선 함수들은 call stack에 쌓여있던 것들이 모두 제거되어 깨끗해지면 차례대로 스택에 쌓여서 실행되게 됩니다.\n\n---\n\n## 큐(Queue)란?\n\n- 큐는 스택과 같이 자료 구조의 일종입니다. 한 쪽에서만 삽입과 삭제가 이루어졌던 스택과는 달리 한쪽에서는 삽입이 되고 다른 한쪽에서는 삭제 작업이 이루어지는 자료 구조입니다. 가장 먼저 삽입된 자료가 가장 먼저 삭제되는 구조이므로 `선입선출(FIFO: First In First Out)`이라고도 부릅니다.\n- callback queue에서 Promise의 then/catch와 process.nextTick의 경우 큐의 다른 작업보다(timeout과 같은) 우선순위를 높게 가져갑니다.\n\n---\n\n## 자바스크립트 이벤트 루프에 대한 대표적인 잘못된 개념들을 살펴보겠습니다.\n\n---\n\n### 이벤트 루프는 자바스크립트 엔진 내부에 있다?\n\n- 대표적인 잘못된 개념들 중 하나는 바로 이벤트 루프가 자바스크립트 엔진(V8, Spider Monkey 등)의 일부라는 것입니다. 하지만 이벤트 루프는 단지 자바스크립트 코드를 실행하기위해 자바스크립트 엔진을 이용하기만 할 뿐입니다.\n- 실제로 V8 엔진에는 이벤트 루프를 관리하는 코드가 없습니다. `Node.js나 브라우저가 이벤트 루프를 담당`하는 것입니다.\n\n---\n\n### 이벤트 루프는 하나의 스택 또는 하나의 큐로만 작동한다?\n\n- 이벤트 루프에 작업을 담아놓는 스택 같은 것은 존재하지 않습니다. 그리고 이벤트 루프가 작동하는 과정은 `여러 개의 큐를 사용하는 복잡한 과정`입니다. 그러나 대부분의 개발자들은 자바스크립트의 모든 콜백이 단 하나의 큐만 사용하여 수행된다고 알고 있는데, 이것은 완전히 잘못된 생각입니다.\n\n---\n\n### 이벤트 루프는 여러 개의 스레드에서 실행된다?\n\n- Node.js 이벤트 루프의 잘못된 다이어그램들 때문에 우리는 한 개의 스레드가 자바스크립트의 실행을 담당하고 다른 한 개는 이벤트 루프를 담당하는, 총 두 개의 스레드가 있다고 생각하게 되었습니다. 그러나 실제로는 `단일 스레드로 이 모든 것을 처리`합니다.\n\n---\n\n## 이벤트 루프는 `단 하나의 스레드`를 사용하여 자바스크립트를 실행합니다!\n\n- 이벤트 루프 자체에서 V8 또는 다른 엔진을 사용하여 자바스크립트를 실행하는 것이고 이때, 단 하나의 스레드를 사용하여 자바스크립트가 실행되는 것입니다. 실행 자체는 동기적이고, 현재 실행시킨 자바스크립트의 실행이 완료되지 않는다면 이벤트 루프 또한 진행되지 않습니다.\n\n---\n\n### setTimeout은 일부 비동기 OS API와 관련있다?\n\n- setTimeout의 딜레이가 끝났을 때 콜백이 외부의 요인(OS나 커널 같은)으로 인해 어떤 작업 큐에 들어가게 된다고 생각하는 것입니다. 하지만 `이벤트 루프에 이런 외부의 요인 같은 건 없습니다`.\n\n---\n\n### setImmediate의 콜백은 작업 큐의 가장 첫번째에 위치한다?\n\n- 보통 일반적인 이벤트 루프에 대한 설명들은 하나의 큐만 가지고 설명을 진행하기 때문에, 몇몇 개발자들은 setImmediate()가 콜백을 작업 큐의 가장 앞쪽에 배치하는 API라고 생각하게 됩니다. 하지만 이것은 완전히 틀린 생각이며, `모든 작업 큐들은 FIFO(First In First Out)로만 작동합니다`.\n\n---\n\n## 왜 우리는 setTimeout(fn, 0)가 있는데도 setImmediate를 사용해야 할까요?\n\n- setTimeout(fn, 0)은 실질적으로 `0이 아닙니다. 이건 사실 1 입니다`. 타이머의 딜레이를 1ms보다 작거나 2147483647ms보다 크게 설정하면 딜레이는 자동으로 1로 세팅 됩니다. 그렇기 때문에 setTimeout의 딜레이를 0으로 설정하려고 한다면 이 딜레이는 자동으로 1이 되는 것입니다.\n- setImmediate을 사용하면 타이머를 사용할 때처럼 `딜레이의 시간을 추가적으로 체크할 필요가 없어집니다`. 그래서 setImmediate은 빠른 것입니다. 또한 setImmediate의 체크 작업은 Poll phase 직후에 수행되기 때문에 HTTP 요청 콜백과 같은 곳에서 사용된 setImmediate의 콜백 함수는 바로 실행된다고 할 수 있습니다.\n\n---\n\n## 자바스크립트는 Block 될 수 있을까요?\n\n- 네! 있습니다.\n- nextTickQueue는 콜백 실행에 있어서 어떤 제한도 가지고 있지 않습니다. 그렇기 때문에 만약 process.nextTick()이 재귀 호출된다면, 여러분의 프로그램은 다른 페이즈들의 큐가 어떤 콜백을 가지고 있든간에 절대 그 작업에서 빠져나오지 못할 것입니다.\n\n---\n\n## 만약 Exit callback phase에서 setTimeout을 호출하면 어떻게 될까요?\n\n- 타이머 자체는 시작될 수 있겠지만 `setTimeout의 콜백은 절대 호출되지 않을 것입니다`. 이미 Node.js가 Exit callbacks에 들어와 있다는 것은 이미 이벤트 루프에서 빠져나왔다는 것을 의미합니다.\n\n---\n\n## 중요한 점들을 정리하고 가겠습니다.\n\n- 이벤트 루프는 작업 스택을 가지고 있지 않습니다.\n- 이벤트 루프가 별도의 스레드에서 실행되고 자바스크립트 실행은 어떤 큐에서 하나씩 꺼내와서 다른 곳에서 하는 것이 아니라 자바스크립트의 실행 자체가 이벤트 루프 안에서 수행되는 것입니다.\n- setImmediate는 콜백을 작업 큐의 앞 쪽에 밀어넣는 것이 아니라 setImmediate 만을 처리하기 위한 전용 페이즈와 큐가 존재합니다.\n- setImmediate은 실질적으로 다음 페이즈 혹은 다음 이벤트 루프의 순회에서 실행되고, nextTick이 오히려 실질적으로 더 빠르게 실행됩니다.\n- nextTickQueue에 담긴 작업이 재귀 호출을 수행하는 경우 Node.js의 작업 프로세스를 블록킹할 수 있습니다.\n\n---\n\n## 이벤트 루프 이미지를 보겠습니다.\n\n![](./images/nodejs-event-loop-phase.png)\n\n---\n\n## 이제 이벤트 루프의 구조에 대해 알아보겠습니다.\n\n- 각각의 박스는 특정 작업을 수행하기 위한 페이즈들을 의미합니다.\n- 각 페이즈는 각자 하나의 큐를 가지고 있으며, 자바스크립트의 실행은 이 페이즈들 중 Idle, prepare 페이즈를 제외한 어느 단계에서나 할 수 있습니다.\n- `nextTickQueue`와 `microTaskQueue`는 이벤트 루프의 일부가 아니며, 이 큐들에 들어있는 작업 또한 어떤 페이즈에서든 실행될 수 있습니다. 또한 이 큐들에 들어있는 작업은 가장 높은 실행 우선 순위를 가지고 있습니다.\n\n---\n\n### 첫번째로 Timer phase 입니다.\n\n- Timer phase는 이벤트 루프의 시작을 알리는 페이즈입니다.\n- 이 페이즈가 가지고 있는 큐에는 setTimeout이나 setInterval 같은 `타이머들의 콜백을 저장`하게 됩니다. 이 페이즈에서 바로 타이머들의 콜백이 큐에 들어가는 것은 아니지만 타이머들을 min-heap으로 유지하고 있다가 실행할 때가 된 타이머들의 콜백을 큐에 넣고 실행하는 것입니다.\n\n---\n\n### Timer phase의 동작을 조금 더 상세히 살펴보겠습니다.\n\n- 이벤트 루프가 Timer phase에 들어가게 되면 실행할 타이머 콜백 큐에 뭐가 있는지 확인부터 시작합니다.\n- 타이머 스크립트는 오름차순으로 힙에 저장됩니다. 그래서 제일 먼저 저장된 타이머들을 하나씩 까서 `now - registeredTime === delta` 같은 조건을 통해 타이머의 콜백을 실행할 시간이 되었는지 검사하게 됩니다. 만약 조건에 해당된다면 이 타이머의 콜백을 실행하고 다음 타이머를 확인합니다. 만약 조건에 해당하지 않는 타이머를 만난다면, 탐색을 바로 종료하고 다음 페이즈로 이동합니다. `타이머는 힙 내부에 오름차순으로 정렬되어있기 때문에 그 이후로는 탐색을 해도 의미가 없습니다`.\n\n---\n\n### 두번째로 Pending i/o callback phase 입니다.\n\n- 이 페이즈에서는 이벤트 루프의 pending_queue에 들어있는 콜백들을 실행합니다.\n- 이 큐에 들어와있는 콜백들은 현재 돌고 있는 `루프 이전에 한 작업에서 이미 큐에 들어와있던 콜백`들입니다.\n- 타임 페이즈가 종료된 후 이벤트 루프는 Pending i/o 페이즈에 진입하고, 가장 먼저 이전 작업들의 콜백이 실행 대기 중인지, 즉 pending_queue에 들어와 있는지를 체크하게 됩니다. 만약 실행 대기 중이라면 pending_queue가 비거나 시스템의 실행 한도 초과에 도달할 때까지 대기하고 있던 콜백들을 실행합니다. 이 과정이 종료되면 이벤트 루프는 Idle Handler Phase로 이동하게 된 후 내부 처리를 위한 Prepare phase를 거쳐 최종적으로 가장 중요한 단계인 Poll Phase에 도달하게 됩니다.\n\n---\n\n### 세번째는 Idle, Prepare phase 입니다.\n\n- 이름은 Idle phase이지만 이 페이즈는 매 Tick마다 실행됩니다.\n- Prepare phase 또한 매 폴링(Polling)때마다 실행됩니다.\n- 이 두개의 페이즈는 이벤트 루프와 직접적인 관련이 있다기보다는 Node.js의 내부적인 관리를 위한 것입니다.\n\n---\n\n### 네번째는 Poll phase 입니다.\n\n- 이 페이즈에서는 새로운 수신 커넥션(새로운 소켓 설정 등)과 데이터(파일 읽기 등)를 허용합니다.\n- 이름에서 알 수 있듯이 이 페이즈는 폴링하는 단계입니다. 이벤트 루프가 Poll phase에 들어왔을 때 watcher_queue 내부에 파일 읽기의 응답 콜백, HTTP 응답 콜백 같이 수행해야 할 작업들이 있다면 이 작업들을 실행하게 됩니다. 이 과정 또한 watcher_queue가 비거나 시스템의 실행 한도 초과에 다다를 때까지 계속 됩니다.\n\n---\n\n### Poll phase의 동작에 대해 조금 더 자세히 알아보겠습니다.\n\n- 일단 watch_queue가 비어있다면, Node.js는 곧바로 다음 페이즈로 넘어가는 것이 아니라 `약간 대기시간`을 가지게 됩니다. Node.js가 기다리는 시간은 여러 가지 요인에 따라 계산됩니다.\n- 만약 더 이상 콜백들을 실행할 수 없는 상태가 된다면 만약 check_queue, pending_queue, closing_callbacks_queue에 해야할 작업이 있는지를 검사하고, 만약 해야할 작업이 있다면 바로 Poll phase가 종료되고 다음 페이즈로 넘어가게 됩니다. 하지만 특별히 해야할 작업이 더 이상 없는 경우 Poll phase는 `다음 페이즈로 넘어가지 않고 계속 대기`하게 됩니다.\n\n---\n\n### 다섯번째는 Check phase 입니다.\n\n- Poll phase의 다음 페이즈는 바로 `setImmediate의 콜백`만을 위한 페이즈인 Check phase입니다.\n- Poll phase가 지나면 이벤트 루프는 바로 setImmediate() API의 콜백과 관련이 있는 Check phase에 들어서게 됩니다. 이 페이즈에서는 다른 페이즈와 마찬가지로 큐가 비거나 시스템 실행 한도 초과에 도달할 때까지 계속 해서 setImmediate의 콜백들을 실행합니다.\n\n---\n\n### 여섯번째는 Close callbacks 입니다.\n\n- socket.on('close', () =\u003e {})과 같은 close 이벤트 타입의 핸들러들은 여기서 처리됩니다.\n- Check Phase가 종료된 후에, 이벤트 루프의 다음 목적지는 close나 destroy 콜백 타입들을 관리하는 Close callback 입니다.\n- 이벤트 루프가 Close callback들과 함께 종료되고나면 이벤트 루프는 다음에 돌아야할 루프가 있는지 다시 체크 하게 됩니다. 만약 아니라면 그대로 이벤트 루프는 종료됩니다. 하지만 만약 더 수행해야할 작업들이 남아 있다면 이벤트 루프는 다음 순회를 돌기 시작하고 다시 Timer Phase부터 시작하게 됩니다.\n\n---\n\n### 이벤트 루프에 포함되지 않았던 nextTickQueue와 microTaskQueue에 대해 알아보겠습니다.\n\n- nextTickQueue는 process.nextTick() API의 콜백들을 가지고 있습니다.\n- microTaskQueue는 Resolve된 프로미스의 콜백을 가지고 있습니다.\n- 이 두개의 큐는 기술적으로 이벤트 루프의 일부가 아닙니다. 즉, libUV 라이브러리에 포함된 것이 아니라 Node.js에 포함된 기술이라는 것입니다. 이 친구들이 가지고 있는 작업들은 현재 실행되고 있는 작업이 끝나자마자 호출되어야합니다.\n\n---\n\n### nextTickQueue와 microTaskQueue의 특별한 점\n\n- 이 두 큐의 콜백들은 어떤 페이즈에서 다음 페이즈로 넘어가기 전에 자신이 가지고 있는 콜백들을 최대한 빨리 실행해야하는 역할을 맡고 있습니다.\n- 다른 페이즈들과는 다르게 이 두 큐는 시스템 `실행 한도 초과에 영향을 받지 않기 때문에` Node.js는 이 큐가 완전히 비워질 때까지 콜백들을 실행합니다. 그리고 nextTickQueue는 microTaskQueue보다는 높은 우선 순위를 가지고 있습니다.\n\n---\n\n## 비동기 작업의 핵심인 Thread-pool에 대해 알아보겠습니다.\n\n- Node.js가 모든 비동기 명령을 관리하는 별도의 스레드풀을 가지고 있다는 오해가 있습니다. 그러나 이 스레드풀은 Node.js가 아니라 Node.js가 비동기 작업을 처리하기 위해 사용하는 라이브러리인 `libUV에 포함된 기능`입니다.\n- 스레드풀은 이벤트 루프 매커니즘의 일부가 아닙니다.\n\n---\n\n## libUV 이외의 별도의 스레드풀도 필요합니다.\n\n- libUV는 OS커널의 비동기 API만을 사용하여 이벤트 드리븐을 유도할 수 있을 만큼 충분히 훌륭합니다. 그러나 파일 읽기, DNS Lookup 등 OS 커널이 비동기 API를 지원하지 않는 작업들의 경우에는 별도의 스레드풀을 사용하게 되는데, 이때 기본 값으로 4개의 스레드를 사용하도록 설정되어있습니다. uv_threadpool 환경 변수를 사용하면 최대 128개까지 스레드 개수를 늘릴 수도 있습니다.\n\n---\n\n## Workflow에 대한 예제 입니다.\n\n```javascript\nsetTimeout(() =\u003e {\n\tconsole.log('setTimeout');\n}, 0);\nsetImmediate(() =\u003e {\n\tconsole.log('setImmediate');\n});\n```\n\n- 무엇이 먼저 실행될지 예측할 수 없습니다.\n- 메인 모듈이 실행되고나서 이벤트 루프가 Timer phase에 진입할 때 여러분의 타이머를 찾을 수도 있고 못 찾을 수도 있기 때문입니다.\n\n---\n\n### 이유\n\n- 왜냐하면 타이머는 시스템의 시간과 사용자가 제공한 시간을 사용하여 등록되기 때문입니다. setTimeout이 호출된 순간, 타이머는 메모리에 이 타이머를 저장하게되는데, 그 순간 컴퓨터의 성능이나 Node.js가 아닌 외부 작업 때문에 약간의 딜레이가 발생할 수 있기 때문입니다. 또 다른 포인트는 Node.js가 Timer phase에 진입하기 전에 변수 now를 선언하고 그 변수 now를 현재 시간으로 간주한다는 점입니다. 그러므로 정확한 계산이라고 하기에는 약간의 노이즈가 껴있다는 것이고, 이게 바로 setTimeout이 반드시 먼저 실행될 것이라고 확신할 수 없는 불확실성의 이유가 됩니다.\n\n---\n\n### 명확히 실행 순서를 정하는 방법이 있습니다.\n\n```javascript\nfs.readFile('my-file-path.txt', () =\u003e {\n\tsetTimeout(() =\u003e {\n\t\tconsole.log('setTimeout');\n\t}, 0);\n\tsetImmediate(() =\u003e {\n\t\tconsole.log('setImmediate');\n\t});\n});\n```\n\n- 코드를 I/O 사이클의 내부로 옮긴다면, 반드시 setTimeout보다 setImmediate가 먼저 실행되는 것을 보장할 수 있게 됩니다.\n\n---\n\n## setImmediate의 vs setTimeout\n\n### setImmediate\n\n```javascript\nvar i = 0;\nvar start = new Date();\nfunction foo() {\n\ti++;\n\tif (i \u003c 1000) {\n\t\tsetImmediate(foo);\n\t} else {\n\t\tvar end = new Date();\n\t\tconsole.log('Execution time: ', end - start);\n\t}\n}\nfoo();\n```\n\n---\n\n### setTimeout\n\n```js\nvar i = 0;\nvar start = new Date();\nfunction bar() {\n\ti++;\n\tif (i \u003c 1000) {\n\t\tsetTimeout(bar, 0);\n\t} else {\n\t\tvar end = new Date();\n\t\tconsole.log('Execution time: ', end - start);\n\t}\n}\nbar();\n```\n\n---\n\n### setImmediate가 더 좋습니다.\n\n- Timer phase에서는 타이머를 실행할 시간이 되었는지, 콜백을 실행해야 하는지를 검사하기 위해 몇가지 작업을 거쳐야 하는데 이 과정을 매 이터레이션마다 하고 있으니 느려질 수 밖에 없습니다. 그러나 setImmediate의 경우 이런 과정이 필요없기 때문에 setTimeout보다 실행 속도가 빠릅니다.\n\n---\n\n## nextTick vs setTimeout\n\n```javascript\nvar i = 0;\nfunction foo() {\n\ti++;\n\tif (i \u003e 20) {\n\t\treturn;\n\t}\n\tconsole.log('foo', i);\n\tsetTimeout(() =\u003e {\n\t\tconsole.log('setTimeout', i);\n\t}, 0);\n\tprocess.nextTick(foo);\n}\nsetTimeout(foo, 2);\n```\n\n---\n\n## 결과\n\n```js\n// foo 1\n// foo 2\n// foo 3\n// foo 4\n// foo 5\n// foo 6\n// foo 7\n// foo 8\n// foo 9\n// foo 10\n// foo 11\n// foo 12\n// foo 13\n// foo 14\n// foo 15\n// foo 16\n// foo 17\n// foo 18\n// foo 19\n// foo 20\n// Other setTimeout\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n// setTimeout 21\n```\n\n## 참조\n\n- [[JS/Event Loop] 자바스크립트, 이벤트 루프(Event Loop)와 동시성(concurrency)에 대하여](https://im-developer.tistory.com/113)\n- [로우 레벨로 살펴보는 Node.js 이벤트 루프](https://evan-moon.github.io/2019/08/01/nodejs-event-loop-workflow/?fbclid=IwAR1QP82JVrNfICEK1UNYGIDnrIlmzzD70AYYcEPiAnW9QzMH26GDker1-B8)\n"])</script><script>self.__next_f.push([1,"10:Tb295,"])</script><script>self.__next_f.push([1,"\u003ch2 id=\"자바스크립트-이벤트-루프에-대해-알아보겠습니다\"\u003e자바스크립트 이벤트 루프에 대해 알아보겠습니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#자바스크립트-이벤트-루프에-대해-알아보겠습니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003chr\u003e\n\u003ch2 id=\"자바스크립트는-싱글-스레드-프로그래밍-언어single-threaded-programming-language-입니다\"\u003e자바스크립트는 싱글 스레드 프로그래밍 언어(Single threaded programming language) 입니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#자바스크립트는-싱글-스레드-프로그래밍-언어single-threaded-programming-language-입니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e자바스크립트는 기본적으로 싱글 스레드 프로그래밍 언어입니다. 여기서 싱글 스레드라는 것은 한 번에 하나의 작업만 할 수 있다는 뜻입니다.\n\u003cul\u003e\n\u003cli\u003e유저가 컨트롤 할 수 있는 스레드가 하나라는 뜻에서 싱글 스레드 프로그래밍 언어라고 부릅니다. 실제로는 백드라운드(C++로 구현되어 있는)가 존재합니다. 또한 web worker나 worker thread(node v14에서 나왔습니다)도 컨트롤 할 수 있게 되었습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"우선-call-stack에-대해-알아보겠습니다\"\u003e우선 call stack에 대해 알아보겠습니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#우선-call-stack에-대해-알아보겠습니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ecall stack은 프로그램 상에서 우리가 어떤 순서로 작업을 수행하는지 기록하는 작업 \u003ccode class=\"inline-code\"\u003e스케쥴링과 관련된 자료 구조\u003c/code\u003e입니다. 우리가 어떤 함수를 실행하게 되면 우리는 그 함수를 스택의 맨 위에 놓는데, 이것을 push라고 합니다. 만약에 함수가 어떤 값을 리턴하거나 실행을 종료하면 우리는 다시 그 함수를 스택 맨 위에서부터 꺼내는데 이것을 pop이라고 합니다.\u003c/li\u003e\n\u003cli\u003e함수가 호출되기 때문에 만약에 우리가 잘못해서 무한 호출되는 재귀 함수를 실행시키면 스택에 함수 호출이 계속해서 쌓이다가 \u003ccode class=\"inline-code\"\u003eMaximum call stack size exceeded\u003c/code\u003e라는 에러 메시지를 만나게 됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"자바스크립트는-싱글-스레드-언어이기-때문에-비동기-콜백을-사용합니다\"\u003e자바스크립트는 싱글 스레드 언어이기 때문에 비동기 콜백을 사용합니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#자바스크립트는-싱글-스레드-언어이기-때문에-비동기-콜백을-사용합니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e자바스크립트는 싱글 스레드 언어이기 때문에 함수를 실행하면 함수 호출이 스택에 순차적으로 쌓이고 스택의 맨 위에서부터 차례대로 한 번에 하나의 함수만 처리할 수 있습니다. 간단한 프로그램이라면 상관없지만 만약에 우리가 아주 복잡한 프로그램을 구동한다면 시간이 매우 오래 걸리는 작업이 스택에 쌓이고 실행되면 그 다음 작업은 무한정 대기할 수밖에 없습니다. 이렇게 다른 작업을 실행하기 위해서 이 전 작업이 완료될 때까지 기다려야만 하는 상황을 \u003ccode class=\"inline-code\"\u003e블로킹(blocking)\u003c/code\u003e이라고 합니다. 왜 이것이 문제가 되냐면 어떤 작업이 실행되어 동작하고 있는 동안에는 브라우저가 다른 일을 전혀 할 수 없으므로 잠시 먹통이 되기 때문입니다. 이러한 점을 극복하기 위한 해결 방안이 바로 \u003ccode class=\"inline-code\"\u003eAsynchronous Callbacks(비동기 콜백)\u003c/code\u003e입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"비동기-콜백은-web-apis와-callback-queue를-활용하여-작동합니다\"\u003e비동기 콜백은 Web APIs와 callback queue를 활용하여 작동합니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#비동기-콜백은-web-apis와-callback-queue를-활용하여-작동합니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e자바스크립트가 싱글 스레드 언어임에도 불구하고 우리가 웹 사이트에서 끊김없이 여러 작업을 동시에 할 수 있는 것은 바로 브라우저가 Web APIs 같은 것들을 제공하여 비동기 작업을 가능하게 해주기 때문입니다.\u003c/li\u003e\n\u003cli\u003e함수를 동기 호출하게 되면 call stack에 차곡차곡 쌓여 순차적으로 실행됩니다. 이 때 만약에 우리가 AJAX나 setTimeout 혹은 DOM event 함수를 실행하면 자바스크립트 엔진은 call stack에서 Web APIs로 보내고 정해진 시간 혹은 이벤트가 발생한 순간에 순차적으로 callback queue에 적재합니다. callback queue에 줄을 선 함수들은 call stack에 쌓여있던 것들이 모두 제거되어 깨끗해지면 차례대로 스택에 쌓여서 실행되게 됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"큐queue란\"\u003e큐(Queue)란?\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#큐queue란\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e큐는 스택과 같이 자료 구조의 일종입니다. 한 쪽에서만 삽입과 삭제가 이루어졌던 스택과는 달리 한쪽에서는 삽입이 되고 다른 한쪽에서는 삭제 작업이 이루어지는 자료 구조입니다. 가장 먼저 삽입된 자료가 가장 먼저 삭제되는 구조이므로 \u003ccode class=\"inline-code\"\u003e선입선출(FIFO: First In First Out)\u003c/code\u003e이라고도 부릅니다.\u003c/li\u003e\n\u003cli\u003ecallback queue에서 Promise의 then/catch와 process.nextTick의 경우 큐의 다른 작업보다(timeout과 같은) 우선순위를 높게 가져갑니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"자바스크립트-이벤트-루프에-대한-대표적인-잘못된-개념들을-살펴보겠습니다\"\u003e자바스크립트 이벤트 루프에 대한 대표적인 잘못된 개념들을 살펴보겠습니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#자바스크립트-이벤트-루프에-대한-대표적인-잘못된-개념들을-살펴보겠습니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003chr\u003e\n\u003ch3 id=\"이벤트-루프는-자바스크립트-엔진-내부에-있다\"\u003e이벤트 루프는 자바스크립트 엔진 내부에 있다?\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#이벤트-루프는-자바스크립트-엔진-내부에-있다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e대표적인 잘못된 개념들 중 하나는 바로 이벤트 루프가 자바스크립트 엔진(V8, Spider Monkey 등)의 일부라는 것입니다. 하지만 이벤트 루프는 단지 자바스크립트 코드를 실행하기위해 자바스크립트 엔진을 이용하기만 할 뿐입니다.\u003c/li\u003e\n\u003cli\u003e실제로 V8 엔진에는 이벤트 루프를 관리하는 코드가 없습니다. \u003ccode class=\"inline-code\"\u003eNode.js나 브라우저가 이벤트 루프를 담당\u003c/code\u003e하는 것입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"이벤트-루프는-하나의-스택-또는-하나의-큐로만-작동한다\"\u003e이벤트 루프는 하나의 스택 또는 하나의 큐로만 작동한다?\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#이벤트-루프는-하나의-스택-또는-하나의-큐로만-작동한다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e이벤트 루프에 작업을 담아놓는 스택 같은 것은 존재하지 않습니다. 그리고 이벤트 루프가 작동하는 과정은 \u003ccode class=\"inline-code\"\u003e여러 개의 큐를 사용하는 복잡한 과정\u003c/code\u003e입니다. 그러나 대부분의 개발자들은 자바스크립트의 모든 콜백이 단 하나의 큐만 사용하여 수행된다고 알고 있는데, 이것은 완전히 잘못된 생각입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"이벤트-루프는-여러-개의-스레드에서-실행된다\"\u003e이벤트 루프는 여러 개의 스레드에서 실행된다?\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#이벤트-루프는-여러-개의-스레드에서-실행된다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eNode.js 이벤트 루프의 잘못된 다이어그램들 때문에 우리는 한 개의 스레드가 자바스크립트의 실행을 담당하고 다른 한 개는 이벤트 루프를 담당하는, 총 두 개의 스레드가 있다고 생각하게 되었습니다. 그러나 실제로는 \u003ccode class=\"inline-code\"\u003e단일 스레드로 이 모든 것을 처리\u003c/code\u003e합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"이벤트-루프는-단-하나의-스레드를-사용하여-자바스크립트를-실행합니다\"\u003e이벤트 루프는 \u003ccode class=\"inline-code\"\u003e단 하나의 스레드\u003c/code\u003e를 사용하여 자바스크립트를 실행합니다!\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#이벤트-루프는-단-하나의-스레드를-사용하여-자바스크립트를-실행합니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e이벤트 루프 자체에서 V8 또는 다른 엔진을 사용하여 자바스크립트를 실행하는 것이고 이때, 단 하나의 스레드를 사용하여 자바스크립트가 실행되는 것입니다. 실행 자체는 동기적이고, 현재 실행시킨 자바스크립트의 실행이 완료되지 않는다면 이벤트 루프 또한 진행되지 않습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"settimeout은-일부-비동기-os-api와-관련있다\"\u003esetTimeout은 일부 비동기 OS API와 관련있다?\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#settimeout은-일부-비동기-os-api와-관련있다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003esetTimeout의 딜레이가 끝났을 때 콜백이 외부의 요인(OS나 커널 같은)으로 인해 어떤 작업 큐에 들어가게 된다고 생각하는 것입니다. 하지만 \u003ccode class=\"inline-code\"\u003e이벤트 루프에 이런 외부의 요인 같은 건 없습니다\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"setimmediate의-콜백은-작업-큐의-가장-첫번째에-위치한다\"\u003esetImmediate의 콜백은 작업 큐의 가장 첫번째에 위치한다?\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#setimmediate의-콜백은-작업-큐의-가장-첫번째에-위치한다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e보통 일반적인 이벤트 루프에 대한 설명들은 하나의 큐만 가지고 설명을 진행하기 때문에, 몇몇 개발자들은 setImmediate()가 콜백을 작업 큐의 가장 앞쪽에 배치하는 API라고 생각하게 됩니다. 하지만 이것은 완전히 틀린 생각이며, \u003ccode class=\"inline-code\"\u003e모든 작업 큐들은 FIFO(First In First Out)로만 작동합니다\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"왜-우리는-settimeoutfn-0가-있는데도-setimmediate를-사용해야-할까요\"\u003e왜 우리는 setTimeout(fn, 0)가 있는데도 setImmediate를 사용해야 할까요?\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#왜-우리는-settimeoutfn-0가-있는데도-setimmediate를-사용해야-할까요\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003esetTimeout(fn, 0)은 실질적으로 \u003ccode class=\"inline-code\"\u003e0이 아닙니다. 이건 사실 1 입니다\u003c/code\u003e. 타이머의 딜레이를 1ms보다 작거나 2147483647ms보다 크게 설정하면 딜레이는 자동으로 1로 세팅 됩니다. 그렇기 때문에 setTimeout의 딜레이를 0으로 설정하려고 한다면 이 딜레이는 자동으로 1이 되는 것입니다.\u003c/li\u003e\n\u003cli\u003esetImmediate을 사용하면 타이머를 사용할 때처럼 \u003ccode class=\"inline-code\"\u003e딜레이의 시간을 추가적으로 체크할 필요가 없어집니다\u003c/code\u003e. 그래서 setImmediate은 빠른 것입니다. 또한 setImmediate의 체크 작업은 Poll phase 직후에 수행되기 때문에 HTTP 요청 콜백과 같은 곳에서 사용된 setImmediate의 콜백 함수는 바로 실행된다고 할 수 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"자바스크립트는-block-될-수-있을까요\"\u003e자바스크립트는 Block 될 수 있을까요?\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#자바스크립트는-block-될-수-있을까요\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e네! 있습니다.\u003c/li\u003e\n\u003cli\u003enextTickQueue는 콜백 실행에 있어서 어떤 제한도 가지고 있지 않습니다. 그렇기 때문에 만약 process.nextTick()이 재귀 호출된다면, 여러분의 프로그램은 다른 페이즈들의 큐가 어떤 콜백을 가지고 있든간에 절대 그 작업에서 빠져나오지 못할 것입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"만약-exit-callback-phase에서-settimeout을-호출하면-어떻게-될까요\"\u003e만약 Exit callback phase에서 setTimeout을 호출하면 어떻게 될까요?\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#만약-exit-callback-phase에서-settimeout을-호출하면-어떻게-될까요\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e타이머 자체는 시작될 수 있겠지만 \u003ccode class=\"inline-code\"\u003esetTimeout의 콜백은 절대 호출되지 않을 것입니다\u003c/code\u003e. 이미 Node.js가 Exit callbacks에 들어와 있다는 것은 이미 이벤트 루프에서 빠져나왔다는 것을 의미합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"중요한-점들을-정리하고-가겠습니다\"\u003e중요한 점들을 정리하고 가겠습니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#중요한-점들을-정리하고-가겠습니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e이벤트 루프는 작업 스택을 가지고 있지 않습니다.\u003c/li\u003e\n\u003cli\u003e이벤트 루프가 별도의 스레드에서 실행되고 자바스크립트 실행은 어떤 큐에서 하나씩 꺼내와서 다른 곳에서 하는 것이 아니라 자바스크립트의 실행 자체가 이벤트 루프 안에서 수행되는 것입니다.\u003c/li\u003e\n\u003cli\u003esetImmediate는 콜백을 작업 큐의 앞 쪽에 밀어넣는 것이 아니라 setImmediate 만을 처리하기 위한 전용 페이즈와 큐가 존재합니다.\u003c/li\u003e\n\u003cli\u003esetImmediate은 실질적으로 다음 페이즈 혹은 다음 이벤트 루프의 순회에서 실행되고, nextTick이 오히려 실질적으로 더 빠르게 실행됩니다.\u003c/li\u003e\n\u003cli\u003enextTickQueue에 담긴 작업이 재귀 호출을 수행하는 경우 Node.js의 작업 프로세스를 블록킹할 수 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"이벤트-루프-이미지를-보겠습니다\"\u003e이벤트 루프 이미지를 보겠습니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#이벤트-루프-이미지를-보겠습니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"./images/nodejs-event-loop-phase.png\" alt=\"\" loading=\"lazy\" decoding=\"async\" style=\"max-width: 100%; height: auto;\"\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"이제-이벤트-루프의-구조에-대해-알아보겠습니다\"\u003e이제 이벤트 루프의 구조에 대해 알아보겠습니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#이제-이벤트-루프의-구조에-대해-알아보겠습니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e각각의 박스는 특정 작업을 수행하기 위한 페이즈들을 의미합니다.\u003c/li\u003e\n\u003cli\u003e각 페이즈는 각자 하나의 큐를 가지고 있으며, 자바스크립트의 실행은 이 페이즈들 중 Idle, prepare 페이즈를 제외한 어느 단계에서나 할 수 있습니다.\u003c/li\u003e\n\u003cli\u003e\u003ccode class=\"inline-code\"\u003enextTickQueue\u003c/code\u003e와 \u003ccode class=\"inline-code\"\u003emicroTaskQueue\u003c/code\u003e는 이벤트 루프의 일부가 아니며, 이 큐들에 들어있는 작업 또한 어떤 페이즈에서든 실행될 수 있습니다. 또한 이 큐들에 들어있는 작업은 가장 높은 실행 우선 순위를 가지고 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"첫번째로-timer-phase-입니다\"\u003e첫번째로 Timer phase 입니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#첫번째로-timer-phase-입니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eTimer phase는 이벤트 루프의 시작을 알리는 페이즈입니다.\u003c/li\u003e\n\u003cli\u003e이 페이즈가 가지고 있는 큐에는 setTimeout이나 setInterval 같은 \u003ccode class=\"inline-code\"\u003e타이머들의 콜백을 저장\u003c/code\u003e하게 됩니다. 이 페이즈에서 바로 타이머들의 콜백이 큐에 들어가는 것은 아니지만 타이머들을 min-heap으로 유지하고 있다가 실행할 때가 된 타이머들의 콜백을 큐에 넣고 실행하는 것입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"timer-phase의-동작을-조금-더-상세히-살펴보겠습니다\"\u003eTimer phase의 동작을 조금 더 상세히 살펴보겠습니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#timer-phase의-동작을-조금-더-상세히-살펴보겠습니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e이벤트 루프가 Timer phase에 들어가게 되면 실행할 타이머 콜백 큐에 뭐가 있는지 확인부터 시작합니다.\u003c/li\u003e\n\u003cli\u003e타이머 스크립트는 오름차순으로 힙에 저장됩니다. 그래서 제일 먼저 저장된 타이머들을 하나씩 까서 \u003ccode class=\"inline-code\"\u003enow - registeredTime === delta\u003c/code\u003e 같은 조건을 통해 타이머의 콜백을 실행할 시간이 되었는지 검사하게 됩니다. 만약 조건에 해당된다면 이 타이머의 콜백을 실행하고 다음 타이머를 확인합니다. 만약 조건에 해당하지 않는 타이머를 만난다면, 탐색을 바로 종료하고 다음 페이즈로 이동합니다. \u003ccode class=\"inline-code\"\u003e타이머는 힙 내부에 오름차순으로 정렬되어있기 때문에 그 이후로는 탐색을 해도 의미가 없습니다\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"두번째로-pending-io-callback-phase-입니다\"\u003e두번째로 Pending i/o callback phase 입니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#두번째로-pending-io-callback-phase-입니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e이 페이즈에서는 이벤트 루프의 pending_queue에 들어있는 콜백들을 실행합니다.\u003c/li\u003e\n\u003cli\u003e이 큐에 들어와있는 콜백들은 현재 돌고 있는 \u003ccode class=\"inline-code\"\u003e루프 이전에 한 작업에서 이미 큐에 들어와있던 콜백\u003c/code\u003e들입니다.\u003c/li\u003e\n\u003cli\u003e타임 페이즈가 종료된 후 이벤트 루프는 Pending i/o 페이즈에 진입하고, 가장 먼저 이전 작업들의 콜백이 실행 대기 중인지, 즉 pending_queue에 들어와 있는지를 체크하게 됩니다. 만약 실행 대기 중이라면 pending_queue가 비거나 시스템의 실행 한도 초과에 도달할 때까지 대기하고 있던 콜백들을 실행합니다. 이 과정이 종료되면 이벤트 루프는 Idle Handler Phase로 이동하게 된 후 내부 처리를 위한 Prepare phase를 거쳐 최종적으로 가장 중요한 단계인 Poll Phase에 도달하게 됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"세번째는-idle-prepare-phase-입니다\"\u003e세번째는 Idle, Prepare phase 입니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#세번째는-idle-prepare-phase-입니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e이름은 Idle phase이지만 이 페이즈는 매 Tick마다 실행됩니다.\u003c/li\u003e\n\u003cli\u003ePrepare phase 또한 매 폴링(Polling)때마다 실행됩니다.\u003c/li\u003e\n\u003cli\u003e이 두개의 페이즈는 이벤트 루프와 직접적인 관련이 있다기보다는 Node.js의 내부적인 관리를 위한 것입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"네번째는-poll-phase-입니다\"\u003e네번째는 Poll phase 입니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#네번째는-poll-phase-입니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e이 페이즈에서는 새로운 수신 커넥션(새로운 소켓 설정 등)과 데이터(파일 읽기 등)를 허용합니다.\u003c/li\u003e\n\u003cli\u003e이름에서 알 수 있듯이 이 페이즈는 폴링하는 단계입니다. 이벤트 루프가 Poll phase에 들어왔을 때 watcher_queue 내부에 파일 읽기의 응답 콜백, HTTP 응답 콜백 같이 수행해야 할 작업들이 있다면 이 작업들을 실행하게 됩니다. 이 과정 또한 watcher_queue가 비거나 시스템의 실행 한도 초과에 다다를 때까지 계속 됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"poll-phase의-동작에-대해-조금-더-자세히-알아보겠습니다\"\u003ePoll phase의 동작에 대해 조금 더 자세히 알아보겠습니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#poll-phase의-동작에-대해-조금-더-자세히-알아보겠습니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e일단 watch_queue가 비어있다면, Node.js는 곧바로 다음 페이즈로 넘어가는 것이 아니라 \u003ccode class=\"inline-code\"\u003e약간 대기시간\u003c/code\u003e을 가지게 됩니다. Node.js가 기다리는 시간은 여러 가지 요인에 따라 계산됩니다.\u003c/li\u003e\n\u003cli\u003e만약 더 이상 콜백들을 실행할 수 없는 상태가 된다면 만약 check_queue, pending_queue, closing_callbacks_queue에 해야할 작업이 있는지를 검사하고, 만약 해야할 작업이 있다면 바로 Poll phase가 종료되고 다음 페이즈로 넘어가게 됩니다. 하지만 특별히 해야할 작업이 더 이상 없는 경우 Poll phase는 \u003ccode class=\"inline-code\"\u003e다음 페이즈로 넘어가지 않고 계속 대기\u003c/code\u003e하게 됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"다섯번째는-check-phase-입니다\"\u003e다섯번째는 Check phase 입니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#다섯번째는-check-phase-입니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003ePoll phase의 다음 페이즈는 바로 \u003ccode class=\"inline-code\"\u003esetImmediate의 콜백\u003c/code\u003e만을 위한 페이즈인 Check phase입니다.\u003c/li\u003e\n\u003cli\u003ePoll phase가 지나면 이벤트 루프는 바로 setImmediate() API의 콜백과 관련이 있는 Check phase에 들어서게 됩니다. 이 페이즈에서는 다른 페이즈와 마찬가지로 큐가 비거나 시스템 실행 한도 초과에 도달할 때까지 계속 해서 setImmediate의 콜백들을 실행합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"여섯번째는-close-callbacks-입니다\"\u003e여섯번째는 Close callbacks 입니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#여섯번째는-close-callbacks-입니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003esocket.on('close', () =\u003e {})과 같은 close 이벤트 타입의 핸들러들은 여기서 처리됩니다.\u003c/li\u003e\n\u003cli\u003eCheck Phase가 종료된 후에, 이벤트 루프의 다음 목적지는 close나 destroy 콜백 타입들을 관리하는 Close callback 입니다.\u003c/li\u003e\n\u003cli\u003e이벤트 루프가 Close callback들과 함께 종료되고나면 이벤트 루프는 다음에 돌아야할 루프가 있는지 다시 체크 하게 됩니다. 만약 아니라면 그대로 이벤트 루프는 종료됩니다. 하지만 만약 더 수행해야할 작업들이 남아 있다면 이벤트 루프는 다음 순회를 돌기 시작하고 다시 Timer Phase부터 시작하게 됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"이벤트-루프에-포함되지-않았던-nexttickqueue와-microtaskqueue에-대해-알아보겠습니다\"\u003e이벤트 루프에 포함되지 않았던 nextTickQueue와 microTaskQueue에 대해 알아보겠습니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#이벤트-루프에-포함되지-않았던-nexttickqueue와-microtaskqueue에-대해-알아보겠습니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003enextTickQueue는 process.nextTick() API의 콜백들을 가지고 있습니다.\u003c/li\u003e\n\u003cli\u003emicroTaskQueue는 Resolve된 프로미스의 콜백을 가지고 있습니다.\u003c/li\u003e\n\u003cli\u003e이 두개의 큐는 기술적으로 이벤트 루프의 일부가 아닙니다. 즉, libUV 라이브러리에 포함된 것이 아니라 Node.js에 포함된 기술이라는 것입니다. 이 친구들이 가지고 있는 작업들은 현재 실행되고 있는 작업이 끝나자마자 호출되어야합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"nexttickqueue와-microtaskqueue의-특별한-점\"\u003enextTickQueue와 microTaskQueue의 특별한 점\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#nexttickqueue와-microtaskqueue의-특별한-점\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e이 두 큐의 콜백들은 어떤 페이즈에서 다음 페이즈로 넘어가기 전에 자신이 가지고 있는 콜백들을 최대한 빨리 실행해야하는 역할을 맡고 있습니다.\u003c/li\u003e\n\u003cli\u003e다른 페이즈들과는 다르게 이 두 큐는 시스템 \u003ccode class=\"inline-code\"\u003e실행 한도 초과에 영향을 받지 않기 때문에\u003c/code\u003e Node.js는 이 큐가 완전히 비워질 때까지 콜백들을 실행합니다. 그리고 nextTickQueue는 microTaskQueue보다는 높은 우선 순위를 가지고 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"비동기-작업의-핵심인-thread-pool에-대해-알아보겠습니다\"\u003e비동기 작업의 핵심인 Thread-pool에 대해 알아보겠습니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#비동기-작업의-핵심인-thread-pool에-대해-알아보겠습니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eNode.js가 모든 비동기 명령을 관리하는 별도의 스레드풀을 가지고 있다는 오해가 있습니다. 그러나 이 스레드풀은 Node.js가 아니라 Node.js가 비동기 작업을 처리하기 위해 사용하는 라이브러리인 \u003ccode class=\"inline-code\"\u003elibUV에 포함된 기능\u003c/code\u003e입니다.\u003c/li\u003e\n\u003cli\u003e스레드풀은 이벤트 루프 매커니즘의 일부가 아닙니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"libuv-이외의-별도의-스레드풀도-필요합니다\"\u003elibUV 이외의 별도의 스레드풀도 필요합니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#libuv-이외의-별도의-스레드풀도-필요합니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003elibUV는 OS커널의 비동기 API만을 사용하여 이벤트 드리븐을 유도할 수 있을 만큼 충분히 훌륭합니다. 그러나 파일 읽기, DNS Lookup 등 OS 커널이 비동기 API를 지원하지 않는 작업들의 경우에는 별도의 스레드풀을 사용하게 되는데, 이때 기본 값으로 4개의 스레드를 사용하도록 설정되어있습니다. uv_threadpool 환경 변수를 사용하면 최대 128개까지 스레드 개수를 늘릴 수도 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"workflow에-대한-예제-입니다\"\u003eWorkflow에 대한 예제 입니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#workflow에-대한-예제-입니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre class=\"language-javascript optimized-code-block\" style=\"max-height: 600px; overflow-y: auto;\"\u003e\u003ccode class=\"language-javascript code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token function\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'setTimeout'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token function\"\u003esetImmediate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'setImmediate'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e무엇이 먼저 실행될지 예측할 수 없습니다.\u003c/li\u003e\n\u003cli\u003e메인 모듈이 실행되고나서 이벤트 루프가 Timer phase에 진입할 때 여러분의 타이머를 찾을 수도 있고 못 찾을 수도 있기 때문입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"이유\"\u003e이유\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#이유\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e왜냐하면 타이머는 시스템의 시간과 사용자가 제공한 시간을 사용하여 등록되기 때문입니다. setTimeout이 호출된 순간, 타이머는 메모리에 이 타이머를 저장하게되는데, 그 순간 컴퓨터의 성능이나 Node.js가 아닌 외부 작업 때문에 약간의 딜레이가 발생할 수 있기 때문입니다. 또 다른 포인트는 Node.js가 Timer phase에 진입하기 전에 변수 now를 선언하고 그 변수 now를 현재 시간으로 간주한다는 점입니다. 그러므로 정확한 계산이라고 하기에는 약간의 노이즈가 껴있다는 것이고, 이게 바로 setTimeout이 반드시 먼저 실행될 것이라고 확신할 수 없는 불확실성의 이유가 됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"명확히-실행-순서를-정하는-방법이-있습니다\"\u003e명확히 실행 순서를 정하는 방법이 있습니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#명확히-실행-순서를-정하는-방법이-있습니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-javascript optimized-code-block\" style=\"max-height: 600px; overflow-y: auto;\"\u003e\u003ccode class=\"language-javascript code-highlight\"\u003e\u003cspan class=\"code-line\"\u003efs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ereadFile\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'my-file-path.txt'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\u003cspan class=\"token function\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\t\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'setTimeout'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\u003cspan class=\"token function\"\u003esetImmediate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\t\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'setImmediate'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e코드를 I/O 사이클의 내부로 옮긴다면, 반드시 setTimeout보다 setImmediate가 먼저 실행되는 것을 보장할 수 있게 됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"setimmediate의-vs-settimeout\"\u003esetImmediate의 vs setTimeout\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#setimmediate의-vs-settimeout\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"setimmediate\"\u003esetImmediate\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#setimmediate\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-javascript optimized-code-block\" style=\"max-height: 600px; overflow-y: auto;\"\u003e\u003ccode class=\"language-javascript code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e start \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003efoo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\ti\u003cspan class=\"token operator\"\u003e++\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ei \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e \u003cspan class=\"token number\"\u003e1000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\t\u003cspan class=\"token function\"\u003esetImmediate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efoo\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eelse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\t\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e end \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\t\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'Execution time: '\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e end \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e start\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token function\"\u003efoo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch3 id=\"settimeout\"\u003esetTimeout\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#settimeout\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-js optimized-code-block\" style=\"max-height: 600px; overflow-y: auto;\"\u003e\u003ccode class=\"language-js code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e start \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ebar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\ti\u003cspan class=\"token operator\"\u003e++\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ei \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e \u003cspan class=\"token number\"\u003e1000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\t\u003cspan class=\"token function\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebar\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eelse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\t\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e end \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\t\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'Execution time: '\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e end \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e start\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token function\"\u003ebar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch3 id=\"setimmediate가-더-좋습니다\"\u003esetImmediate가 더 좋습니다.\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#setimmediate가-더-좋습니다\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eTimer phase에서는 타이머를 실행할 시간이 되었는지, 콜백을 실행해야 하는지를 검사하기 위해 몇가지 작업을 거쳐야 하는데 이 과정을 매 이터레이션마다 하고 있으니 느려질 수 밖에 없습니다. 그러나 setImmediate의 경우 이런 과정이 필요없기 때문에 setTimeout보다 실행 속도가 빠릅니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"nexttick-vs-settimeout\"\u003enextTick vs setTimeout\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#nexttick-vs-settimeout\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre class=\"language-javascript optimized-code-block\" style=\"max-height: 600px; overflow-y: auto;\"\u003e\u003ccode class=\"language-javascript code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003efoo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\ti\u003cspan class=\"token operator\"\u003e++\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ei \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token number\"\u003e20\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\t\u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'foo'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e i\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\u003cspan class=\"token function\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\t\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'setTimeout'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e i\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\tprocess\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003enextTick\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efoo\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token function\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efoo\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2 id=\"결과\"\u003e결과\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#결과\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre class=\"language-js optimized-code-block\" style=\"max-height: 600px; overflow-y: auto;\"\u003e\u003ccode class=\"language-js code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 1\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 2\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 3\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 4\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 5\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 6\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 7\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 8\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 9\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 10\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 11\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 12\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 13\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 14\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 15\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 16\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 17\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 18\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 19\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// foo 20\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// Other setTimeout\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e// setTimeout 21\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"참조\"\u003e참조\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#참조\"\u003e\u003cspan class=\"anchor\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://im-developer.tistory.com/113\"\u003e[JS/Event Loop] 자바스크립트, 이벤트 루프(Event Loop)와 동시성(concurrency)에 대하여\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://evan-moon.github.io/2019/08/01/nodejs-event-loop-workflow/?fbclid=IwAR1QP82JVrNfICEK1UNYGIDnrIlmzzD70AYYcEPiAnW9QzMH26GDker1-B8\"\u003e로우 레벨로 살펴보는 Node.js 이벤트 루프\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e"])</script><script>self.__next_f.push([1,"4:[\"$\",\"$Le\",null,{\"post\":{\"slug\":\"/javascript/event-loop\",\"frontmatter\":{\"title\":\"event loop\",\"date\":\"2020-08-25T22:09:18.000Z\",\"category\":\"javascript\",\"tags\":[\"javascript\",\"event loop\"],\"draft\":false,\"marp\":true,\"theme\":\"gaia\"},\"content\":\"$f\",\"html\":\"$10\",\"excerpt\":\"## 자바스크립트 이벤트 루프에 대해 알아보겠습니다.  ---  ## 자바스크립트는 싱글 스레드 프로그래밍 언어\u003cbr /\u003e(Single threaded programming language) 입니다.  - 자바스크립트는 기본적으로 싱글 스레드 프로그래밍 언어입니다. 여기서 싱글 스레드라는 것은 한 번에 하나의 작업만 할 수 있다는 뜻입니다.   - 유저가\"},\"previousPost\":{\"slug\":\"/javascript/hoisting\",\"frontmatter\":{\"title\":\"hoisting\",\"date\":\"2020-08-21T08:09:10.000Z\",\"category\":\"javascript\",\"tags\":[\"javascript\",\"hoisting\"],\"draft\":false}},\"nextPost\":{\"slug\":\"/javascript/lambda\",\"frontmatter\":{\"title\":\"lambda\",\"date\":\"2020-11-24T13:11:04.000Z\",\"category\":\"javascript\",\"tags\":[],\"draft\":false}}}]\nb:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"event loop\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"## 자바스크립트 이벤트 루프에 대해 알아보겠습니다.  ---  ## 자바스크립트는 싱글 스레드 프로그래밍 언어\u003cbr /\u003e(Single threaded programming language) 입니다.  - 자바스크립트는 기본적으로 싱글 스레드 프로그래밍 언어입니다. 여기서 싱글 스레드라는 것은 한 번에 하나의 작업만 할 수 있다는 뜻입니다.   - 유저가\"}]]\n3:null\n"])</script></body></html>