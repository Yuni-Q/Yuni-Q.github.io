{"version":3,"sources":["webpack:///./src/pages/apple.tsx"],"names":["Body","styled","div","VideoWrapper","Canvas","canvas","Video","video","Apple","elemCanvas","useRef","elemVideo","useEffect","elemPhone","windowWidth","windowHeight","canvasWidth","canvasHeight","scrollY","relativeScrollY","prevDurations","totalScrollHeight","currentKeyframe","pixelDuration","keyframes","animationValue","videoScale","triangleMove","rectangleMove","elemBody","document","body","context","current","getContext","resizeHandler","window","innerWidth","innerHeight","forEach","keyframe","style","height","width","render","calcAnimationValue","values","drawCanvas","save","translate","drawImage","restore","fillStyle","beginPath","moveTo","lineTo","fill","closePath","fillRect","transform","clearRect","scrollHandler","pageYOffset","addEventListener","requestAnimationFrame","createElement","src","ref","muted","playsInline","autoPlay","loop"],"mappings":"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","file":"component---src-pages-apple-tsx-4dbb6437a9c7583e3f07.js","sourcesContent":["import React, { useEffect, useRef } from 'react'\nimport styled from 'styled-components'\nconst Body = styled.div`\n  background: black;\n`;\n\nconst VideoWrapper = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  overflow: hidden;\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n`;\n\nconst Canvas = styled.canvas`\n  position: fixed;\n  top: 0;\n  left: 0;\n`;\n\nconst Video = styled.video`\n  transform: scale(1);\n`;\n\nconst Apple = () => {\n  const elemCanvas = useRef<HTMLCanvasElement>(null);\n  const elemVideo = useRef<HTMLVideoElement>(null);\n  useEffect(() => {\n    let elemPhone;\n    let windowWidth = 0\n    let windowHeight = 0\n    let canvasWidth = 0\n    let canvasHeight = 0\n    let scrollY = 0\n    let relativeScrollY = 0\n    let prevDurations = 0\n    let totalScrollHeight = 0\n    let currentKeyframe = 0\n    let phoneWidth = 1380\n    let phoneHeight = 3000\n\n    let pixelDuration = 0\n    let keyframes = [\n      {\n        animationValue: {\n          videoScale: [1, 2],\n          triangleMove: [0, 200],\n          rectangleMove: [0, 500]\n        }\n      },\n      {\n        animationValue: {\n          videoScale: [2, 0.3],\n          triangleMove: [200, 1000],\n          rectangleMove: [500, 500]\n        }\n      },\n    ]\n    const elemBody = document.body;\n    const context = elemCanvas.current.getContext('2d')\n    const resizeHandler = () => {\n      windowWidth = window.innerWidth\n      windowHeight = window.innerHeight\n      totalScrollHeight = 0;\n      pixelDuration = 0.5 * windowHeight\n\n      keyframes.forEach(keyframe => {\n        totalScrollHeight += windowHeight\n      })\n\n      elemBody.style.height = `${totalScrollHeight}px`\n      elemCanvas.current.width = canvasWidth = windowWidth * 2\n      elemCanvas.current.height = canvasHeight = windowHeight * 2\n      elemCanvas.current.style.width = `${windowWidth}px`\n      elemCanvas.current.style.height = `${windowHeight}px`\n      render()\n    }\n\n    const calcAnimationValue = (values) => {\n      return (relativeScrollY / pixelDuration) * (values[1] - values[0]) + values[0];\n    };\n\n    const drawCanvas = (videoScale: number = 1, triangleMove: number = 0, rectangleMove: number = 0) => {\n      context.save()\n      context.translate((canvasWidth - phoneWidth * videoScale) * 0.5, (canvasHeight - phoneHeight * videoScale) * 0.5)\n      context.drawImage(elemPhone, 0, 0, phoneWidth * videoScale, phoneHeight * videoScale)\n      context.restore()\n\n      context.fillStyle = 'black';\n\n      // 위 삼각형\n      context.beginPath();\n      context.moveTo(canvasWidth * 0.5 - 1500, -triangleMove - 1700);\n      context.lineTo(canvasWidth * 0.5, canvasHeight * 0.5 - 150 - triangleMove);\n      context.lineTo(canvasWidth * 0.5 + 1500, -triangleMove - 1700);\n      context.lineTo(canvasWidth * 0.5 - 1500, -triangleMove - 1700);\n      context.fill();\n      context.closePath();\n\n      // 아래 삼각형\n      context.beginPath();\n      context.moveTo(canvasWidth * 0.5 - 1500, canvasHeight + triangleMove + 1700);\n      context.lineTo(canvasWidth * 0.5, canvasHeight * 0.5 + 150 + triangleMove);\n      context.lineTo(canvasWidth * 0.5 + 1500, canvasHeight + triangleMove + 1700);\n      context.lineTo(canvasWidth * 0.5 - 1500, canvasHeight + triangleMove + 1700);\n      context.fill();\n      context.closePath();\n\n      // 왼쪽 삼각형\n      context.beginPath();\n      context.moveTo(canvasWidth * 0.5 - 1700 - triangleMove, -1700);\n      context.lineTo(canvasWidth * 0.5 - 130 - triangleMove, canvasHeight * 0.5);\n      context.lineTo(canvasWidth * 0.5 - 1700 - triangleMove, canvasHeight + 1700);\n      context.lineTo(canvasWidth * 0.5 - 1700 - triangleMove, -1700);\n      context.fill();\n      context.closePath();\n\n      // 오른쪽 삼각형\n      context.beginPath();\n      context.moveTo(canvasWidth * 0.5 + 1700 + triangleMove, -1700);\n      context.lineTo(canvasWidth * 0.5 + 130 + triangleMove, canvasHeight * 0.5);\n      context.lineTo(canvasWidth * 0.5 + 1700 + triangleMove, canvasHeight + 1700);\n      context.lineTo(canvasWidth * 0.5 + 1700 + triangleMove, -1700);\n      context.fill();\n      context.closePath();\n\n      // 박스 상, 하\n      context.fillRect(0, canvasHeight * 0.5 - 2600 - rectangleMove, canvasWidth, 2000);\n      context.fillRect(0, canvasHeight * 0.5 + 600 + rectangleMove, canvasWidth, 2000);\n    }\n\n    const render = () => {\n      let videoScale\n      let triangleMove\n      let rectangleMove\n\n      if (keyframes[currentKeyframe]) {\n        videoScale = calcAnimationValue(keyframes[currentKeyframe].animationValue.videoScale);\n        triangleMove = calcAnimationValue(keyframes[currentKeyframe].animationValue.triangleMove);\n        rectangleMove = calcAnimationValue(keyframes[currentKeyframe].animationValue.rectangleMove);\n      } else {\n        return\n      }\n\n      elemVideo.current.style.transform = `scale(${videoScale})`;\n      context.clearRect(0, 0, canvasWidth, canvasHeight);\n      if (elemPhone) {\n        drawCanvas(videoScale, triangleMove, rectangleMove)\n      }\n\n    }\n    const scrollHandler = () => {\n      scrollY = window.pageYOffset;\n\n      if (scrollY < 0 || scrollY > (totalScrollHeight - windowHeight)) {\n        return;\n      }\n\n      if (scrollY > pixelDuration + prevDurations) {\n        prevDurations += pixelDuration;\n        currentKeyframe++;\n      } else if (scrollY < prevDurations) {\n        prevDurations -= pixelDuration;\n        currentKeyframe--;\n      }\n\n      relativeScrollY = scrollY - prevDurations;\n\n      render();\n\n    }\n    const init = () => {\n      windowWidth = window.innerWidth\n      windowHeight = window.innerHeight\n\n      resizeHandler()\n      render()\n\n      window.addEventListener('resize', () => {\n        requestAnimationFrame(resizeHandler)\n      })\n      window.addEventListener('scroll', () => {\n        requestAnimationFrame(scrollHandler)\n      })\n\n      elemPhone = document.createElement('img');\n      elemPhone.src = 'phone.png';\n      elemPhone.addEventListener('load', function () {\n        drawCanvas();\n      });\n    }\n\n    init()\n  }, [])\n  return (\n    <Body>\n      <VideoWrapper>\n        <Video ref={elemVideo} muted playsInline autoPlay loop src=\"https://images.apple.com/media/us/iphone-x/2017/01df5b43-28e4-4848-bf20-490c34a926a7/overview/primary/hero/large_2x.mp4\" />\n        <Canvas ref={elemCanvas} />\n      </VideoWrapper>\n    </Body>)\n}\n\nexport default Apple;\n"],"sourceRoot":""}