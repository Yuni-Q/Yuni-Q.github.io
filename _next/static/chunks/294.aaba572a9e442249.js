"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[294],{294:function(e,t,n){n.d(t,{m:function(){return c}});var a=n(2769),s=n(5709);class i{getAvailableGames(){return[{gameType:"yacht-dice",name:"Yacht Dice",minPlayers:2,maxPlayers:4,description:"주사위 게임",icon:"\uD83C\uDFB2",singleDeviceAvailable:!0},{gameType:"las-vegas",name:"Las Vegas",minPlayers:2,maxPlayers:5,description:"라스베가스 게임",icon:"\uD83C\uDFB0",singleDeviceAvailable:!0},{gameType:"uno",name:"우노",minPlayers:2,maxPlayers:4,description:"카드 게임",icon:"\uD83C\uDCCF",singleDeviceAvailable:!1},{gameType:"sudoku",name:"스도쿠",minPlayers:1,maxPlayers:1,description:"클래식한 숫자 퍼즐 게임",icon:"\uD83D\uDD22",singleDeviceAvailable:!0}]}filterGamesByPlayerCount(e,t){return e.filter(e=>t<=e.maxPlayers)}validateGameSelection(e,t){return t>e.maxPlayers?(0,s.T)({type:"PLAYER_COUNT_EXCEEDS_MAX",message:"Current player count (".concat(t,") exceeds game's maximum (").concat(e.maxPlayers,")"),gameType:e.gameType,currentCount:t,maxCount:e.maxPlayers}):t<e.minPlayers?(0,s.T)({type:"GAME_NOT_AVAILABLE",message:"Current player count (".concat(t,") is below game's minimum (").concat(e.minPlayers,")"),gameType:e.gameType}):(0,s.f)(!0)}selectGame(e){let t=this.getAvailableGames();return t.some(t=>t.gameType===e.gameType)?(0,s.f)({availableGames:t,selectedGame:e,filteredGames:t,currentPlayerCount:0,isSelectionActive:!1,selectionTimeout:null}):(0,s.T)({type:"GAME_NOT_AVAILABLE",message:"Game ".concat(e.gameType," is not available"),gameType:e.gameType})}}var l=n(7135);class c{getSceneKeyFromGameType(e){return({"yacht-dice":"YachtDiceScene","las-vegas":"LasVegasScene",uno:"UnoScene",sudoku:"SudokuScene"})[e]||null}initialize(e,t){if(!e)throw TypeError("Scene cannot be null");this.scene=e,this.eventListeners=[],this.screenElements=[]}setSceneCallbacks(e){this.sceneCallbacks=e}clearGameSelectionUI(){this.screenElements.forEach(e=>{e&&e.scene&&(e instanceof a.GameObjects.Container&&e.removeAll(!0),e.destroy())}),this.screenElements=[]}showGameSelectionScreen(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.scene.cameras.main.width,s=this.scene.cameras.main.height,i=n/2;this.clearGameSelectionUI(),l.F.clearUI(this.scene);let c=this.gameSelectionService.getAvailableGames(),o=this.gameSelectionService.filterGamesByPlayerCount(c,e);o=t?o.filter(e=>1!==e.maxPlayers):o.filter(e=>!1!==e.singleDeviceAvailable);let r=l.F.createPopupBackground(this.scene,{width:.8,height:.5,strokeColor:2201331}),m=r.width,h=r.height,u=l.F.createPopupTitle(this.scene,"게임 선택",r,{offsetY:-(.4*h)}),y=.08*s,p=.05*n,g=.02*s,d=s/2+.05*h,S=.6*h,v=.85*m,G=this.scene.add.container(i,d);G.setSize(v,S),G.setDepth(1e3),this.screenElements.push(G);let T=this.scene.make.graphics();T.fillStyle(16777215),T.fillRect(i-.5*v,d-.5*S,v,S);let C=T.createGeometryMask();G.setMask(C),this.screenElements.push(T);let b=0,f=Math.max(0,o.length*(y+g)-g-S),E=-S/2+y/2,k=[],A=0,D=0,L=!1,x=0;o.forEach((e,t)=>{let s=l.F.createButton(this.scene,{text:"".concat(e.icon||""," ").concat(e.name),color:5025616,strokeColor:6732650,x:0,y:E+t*(y+g),buttonHeight:y,buttonPadding:p,minWidth:.3*n,onClick:()=>{}});s.bg.removeAllListeners("pointerdown"),s.text.removeAllListeners("pointerdown");let i=e=>{A=e.y,D=b,x=Date.now(),L=!1},c=e=>{if(f>0&&A>0&&Math.abs(e.y-A)>10){L=!0;let t=e.y-A;b=a.Math.Clamp(D-t,0,f),P()}},o=t=>{let n=Date.now()-x,a=A>0?Math.abs(t.y-A):0;!L&&n<300&&a<10&&this.selectGame(e),A=0,D=0,L=!1,x=0},r=()=>{A=0,D=0,L=!1,x=0};s.bg.on("pointerdown",i).on("pointermove",c).on("pointerup",o).on("pointerout",r),s.text.on("pointerdown",i).on("pointermove",c).on("pointerup",o).on("pointerout",r),G.add([s.bg,s.text]),k.push(s.bg,s.text),this.screenElements.push(s.bg,s.text)});let P=()=>{b=a.Math.Clamp(b,0,f),G.setY(d-b)};G.setInteractive(new a.Geom.Rectangle(-(.5*v),-(.5*S),v,S),a.Geom.Rectangle.Contains),G.on("pointerdown",e=>{f>0&&(A=e.y,D=b,x=Date.now(),L=!1)}).on("pointermove",e=>{if(f>0&&A>0&&Math.abs(e.y-A)>10){L=!0;let t=e.y-A;b=a.Math.Clamp(D-t,0,f),P()}}).on("pointerup",()=>{A=0,D=0,L=!1,x=0}).on("pointerout",()=>{A=0,D=0,L=!1,x=0}),this.scene.input.on("wheel",(e,t,n,a,s)=>{f>0&&(b-=.5*a,P())}),P();let w=l.F.createBackButton(this.scene,{onClick:()=>{this.cancelGameSelection()}});this.screenElements.push(r,u,w.bg,w.text),this.startSelectionTimeout()}startSelectionTimeout(){this.clearSelectionTimeout(),this.selectionTimeout=this.scene.time.delayedCall(3e4,()=>{this.handleSelectionTimeout()})}clearSelectionTimeout(){this.selectionTimeout&&(this.selectionTimeout.destroy(),this.selectionTimeout=null)}handleSelectionTimeout(){let e=this.scene.cameras.main.width,t=this.scene.cameras.main.height,n=this.scene.add.text(e/2,t/2,"게임 선택 시간이 초과되었습니다.",{fontSize:"".concat(.03*t,"px"),color:"#ff6b6b",fontStyle:"bold"}).setOrigin(.5).setDepth(3e3);this.screenElements.push(n),this.scene.time.delayedCall(2e3,()=>{this.cancelGameSelection(),n&&n.scene&&n.destroy()})}selectGame(e){var t,n;this.clearSelectionTimeout();let a=this.getSceneKeyFromGameType(e.gameType);if(!a){console.error("[GameSelectionManager] Unknown game type: ".concat(e.gameType));return}console.log("[GameSelectionManager] selectGame called",{gameType:e.gameType,sceneKey:a,hasCallback:!!(null===(t=this.sceneCallbacks)||void 0===t?void 0:t.onGameSelected)}),(null===(n=this.sceneCallbacks)||void 0===n?void 0:n.onGameSelected)?(console.log("[GameSelectionManager] Calling onGameSelected callback"),this.sceneCallbacks.onGameSelected(a)):console.error("[GameSelectionManager] onGameSelected callback not set!"),this.notifyListeners({type:"GAME_SELECTED",sceneKey:a,gameInfo:e})}selectGameByType(e){let t=this.gameSelectionService.getAvailableGames(),n=t.find(t=>t.gameType===e);n?this.selectGame(n):console.error("[GameSelectionManager] Game not found: ".concat(e),{availableGames:t.map(e=>e.gameType)})}cancelGameSelection(){var e;this.clearSelectionTimeout(),(null===(e=this.sceneCallbacks)||void 0===e?void 0:e.onGameSelectionCancelled)&&this.sceneCallbacks.onGameSelectionCancelled(),this.notifyListeners({type:"GAME_SELECTION_CANCELLED"})}filterGamesByPlayerCount(e){let t=this.gameSelectionService.getAvailableGames();return this.gameSelectionService.filterGamesByPlayerCount(t,e)}addEventListener(e){return this.eventListeners.push(e),()=>{this.eventListeners=this.eventListeners.filter(t=>t!==e)}}notifyListeners(e){this.eventListeners.forEach(t=>t(e))}destroy(){this.clearSelectionTimeout(),this.eventListeners=[],this.screenElements.forEach(e=>{e&&e.scene&&e.destroy()}),this.screenElements=[]}constructor(){this.eventListeners=[],this.screenElements=[],this.selectionTimeout=null,this.gameSelectionService=new i}}}}]);