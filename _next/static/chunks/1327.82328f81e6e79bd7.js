"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1327],{1327:function(e,t,r){r.r(t),r.d(t,{default:function(){return p}});var i,s,a,o,n=r(2769),l=r(8782),h=r(7135),d=r(3382),c=r(6332),u=r(2966),y=r(9309);(i=a||(a={})).Red="Red",i.Yellow="Yellow",i.Green="Green",i.Blue="Blue",i.Wild="Wild",(s=o||(o={})).Number="Number",s.Skip="Skip",s.Reverse="Reverse",s.DrawTwo="DrawTwo",s.Wild="Wild",s.WildDrawFour="WildDrawFour";class p extends n.Scene{init(e){if(this.isOnlineMode=(null==e?void 0:e.isOnlineMode)||!1,!this.isOnlineMode)throw Error("Uno game requires online multiplayer mode. Single device mode is not supported.");if(this.roomId=(null==e?void 0:e.roomId)||null,this.roomInfo=(null==e?void 0:e.roomInfo)||null,!this.roomInfo)throw Error("Room info is required for online multiplayer mode");let t=Array.isArray(this.roomInfo.players)?this.roomInfo.players:Object.values(this.roomInfo.players||{});this.numberOfPlayers=t.length}getMyPlayerIndex(){return this.isOnlineMode&&this.roomInfo&&this.playerId?(Array.isArray(this.roomInfo.players)?this.roomInfo.players:Object.values(this.roomInfo.players||{})).sort((e,t)=>(e.joinedAt||0)-(t.joinedAt||0)).findIndex(e=>e.id===this.playerId):-1}isMyTurn(){if(!this.isOnlineMode||!this.roomInfo||!this.playerId)return!1;let e=this.getMyPlayerIndex();return e>=0&&e===this.currentPlayer}create(){let e=this.cameras.main.width,t=this.cameras.main.height;if(this.popupSystem=new y.T(this),this.add.rectangle(e/2,t/2,e,t,872205,1),this.add.text(e/2,.05*t,"우노",{fontSize:"".concat(.06*t,"px"),color:"#fff",fontStyle:"bold"}).setOrigin(.5),!this.isOnlineMode||!this.roomId){this.showOnlineModeSelection();return}if(!this.playerId&&this.supabaseManager&&(this.playerId=this.supabaseManager.getPlayerId()),this.ensureOnlineMultiplayerManagerInitialized(),this.roomId&&this.playerId){var r,i,s;let e=(null===(r=this.roomInfo)||void 0===r?void 0:r.hostId)===this.playerId||this.roomId&&this.playerId&&!this.roomInfo;this.isOnlineMode&&this.roomId&&this.playerId&&(!e||(null===(s=this.roomInfo)||void 0===s?void 0:null===(i=s.gameState)||void 0===i?void 0:i.gameStarted)?(this.setupOnlineMode(),this.roomInfo&&this.roomInfo.gameState&&this.syncGameState(this.roomInfo.gameState)):(this.setupOnlineMode(),this.startGame()))}}startGame(){let e=this.cameras.main.width,t=this.cameras.main.height;this.children.removeAll(),this.add.rectangle(e/2,t/2,e,t,872205,1),this.initializeDeck(),this.dealCards(),this.currentPlayer=0,this.isClockwise=!0,this.isGameActive=!0,this.discardPile=[],this.isColorSelectionMode=!1;let r=this.deck.shift();this.discardPile.push(r),this.currentColor="Wild"===r.color?"Red":r.color,this.roomId&&this.roomInfo&&this.roomInfo.hostId===this.playerId&&this.supabaseManager&&this.saveGameStateToSupabase(),this.createGameUI(),this.updateGameState()}async saveGameStateToSupabase(){if(this.roomId&&this.supabaseManager)try{let e={currentRound:1,currentPlayer:this.currentPlayer,gameStarted:this.isGameActive,deck:this.deck,discardPile:this.discardPile,playerHands:this.playerHands,isClockwise:this.isClockwise,currentColor:this.currentColor,isColorSelectionMode:this.isColorSelectionMode},t=this.supabaseManager.supabase;if(t){let{error:r}=await t.from("game_rooms").update({game_state:e}).eq("room_id",this.roomId);r&&console.error("[UnoScene] Error updating game state:",r)}}catch(e){console.error("[UnoScene] Error saving game state:",e)}}initializeDeck(){this.deck=[];let e=["Red","Yellow","Green","Blue"];e.forEach(e=>{this.deck.push({color:e,type:"Number",value:0});for(let t=1;t<=9;t++)this.deck.push({color:e,type:"Number",value:t}),this.deck.push({color:e,type:"Number",value:t})}),e.forEach(e=>{for(let t=0;t<2;t++)this.deck.push({color:e,type:"Skip",value:0}),this.deck.push({color:e,type:"Reverse",value:0}),this.deck.push({color:e,type:"DrawTwo",value:0})});for(let e=0;e<4;e++)this.deck.push({color:"Wild",type:"Wild",value:0}),this.deck.push({color:"Wild",type:"WildDrawFour",value:0});for(let e=this.deck.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[this.deck[e],this.deck[t]]=[this.deck[t],this.deck[e]]}}dealCards(){this.playerHands=[];for(let e=0;e<this.numberOfPlayers;e++){this.playerHands[e]=[];for(let t=0;t<7;t++)this.deck.length>0&&this.playerHands[e].push(this.deck.shift())}}createGameUI(){let e=this.cameras.main.width,t=this.cameras.main.height,r=.15*t,i=e/(this.numberOfPlayers+1);this.playerCardCountTexts=[];for(let s=0;s<this.numberOfPlayers;s++){let a=i*(s+1),o=s===this.currentPlayer;this.add.rectangle(a,r,.15*e,.08*t,o?5025616:3355443,.9).setStrokeStyle(2,o?8505220:6710886),this.add.text(a,r-.02*t,"플레이어 ".concat(s+1),{fontSize:"".concat(.025*t,"px"),color:"#fff",fontStyle:"bold"}).setOrigin(.5);let n=this.add.text(a,r+.02*t,"".concat(this.playerHands[s].length,"장"),{fontSize:"".concat(.03*t,"px"),color:o?"#4caf50":"#fff",fontStyle:"bold"});n.setOrigin(.5),this.playerCardCountTexts.push(n)}this.currentPlayerIndicator=this.add.text(e/2,.25*t,"플레이어 ".concat(this.currentPlayer+1,"의 턴"),{fontSize:"".concat(.04*t,"px"),color:"#ffd700",fontStyle:"bold"}),this.currentPlayerIndicator.setOrigin(.5),this.statusText=this.add.text(e/2,.3*t,"카드를 선택하거나 뽑으세요",{fontSize:"".concat(.03*t,"px"),color:"#fff"}),this.statusText.setOrigin(.5);let s=e/2,a=.5*t,o=this.discardPile[this.discardPile.length-1];o?this.discardCardObject=this.createCardObject(s,a,Math.min(.12*e,.15*t),o):this.discardCardObject=this.createCardObject(s,a,Math.min(.12*e,.15*t),{color:"Red",type:"Number",value:0});let n=e/2-.2*e,h=.5*t,d=this.add.rectangle(n,h,Math.min(.12*e,.15*t),1.4*Math.min(.12*e,.15*t),2763306,1);d.setStrokeStyle(2,16777215),d.setInteractive({useHandCursor:!0}),d.on("pointerdown",()=>{l.Wc.setup(d,()=>{this.drawCard()})});let c=this.add.text(n,h,"뽑기",{fontSize:"".concat(.025*t,"px"),color:"#fff",fontStyle:"bold"});c.setOrigin(.5),c.setInteractive({useHandCursor:!0}),c.on("pointerdown",()=>{l.Wc.setup(c,()=>{this.drawCard()})}),this.updateHandDisplay();let u=this.add.rectangle(.9*e,.05*t,.15*e,.08*t,6710886,.9);u.setStrokeStyle(3,10066329),u.setInteractive({useHandCursor:!0}),u.on("pointerdown",()=>{l.Wc.setup(u,()=>{this.goToMainMenu()})});let y=this.add.text(.9*e,.05*t,"메인 메뉴",{fontSize:"".concat(.03*t,"px"),color:"#fff",fontStyle:"bold"});y.setOrigin(.5),y.setInteractive({useHandCursor:!0}),y.on("pointerdown",()=>{l.Wc.setup(y,()=>{this.goToMainMenu()})})}createCardObject(e,t,r,i){let s=this.add.container(0,0),a=1.4*r;i||(i={color:"Red",type:"Number",value:0});let o=this.add.rectangle(e,t,r,a,16777215,1);o.setStrokeStyle(2,0);let n=new Map([["Red",16007990],["Yellow",16771899],["Green",5025616],["Blue",2201331],["Wild",0]]).get(i.color)||16777215,l=this.add.rectangle(e,t,.9*r,.6*a,n,1),h="";"Number"===i.type?h=i.value.toString():"Skip"===i.type?h="⏭":"Reverse"===i.type?h="↩":"DrawTwo"===i.type?h="+2":"Wild"===i.type?h="W":"WildDrawFour"===i.type&&(h="+4");let d=this.add.text(e,t,h,{fontSize:"".concat(.3*r,"px"),color:"Wild"===i.color?"#fff":"#000",fontStyle:"bold"});return d.setOrigin(.5),s.add([o,l,d]),s}updateHandDisplay(){let e=this.cameras.main.width,t=this.cameras.main.height;this.handCardObjects.forEach(e=>e.destroy()),this.handCardObjects=[];let r=this.getMyPlayerIndex();if(r<0||r>=this.playerHands.length)return;let i=this.playerHands[r],s=Math.min(.08*e,.1*t),a=.15*s,o=.85*t,n=e/2-(i.length-1)*(s+a)/2;i.forEach((e,t)=>{let r=this.createCardObject(n+t*(s+a),o,s,e);r.setInteractive({useHandCursor:!0}),r.on("pointerdown",()=>{l.Wc.setup(r,()=>{this.selectCard(t)})}),r.on("pointerover",()=>{r.setScale(1.1)}),r.on("pointerout",()=>{r.setScale(1)}),this.selectedCardIndex===t&&r.setScale(1.15),this.handCardObjects.push(r)})}selectCard(e){if(!this.isMyTurn()){this.showError("지금은 다른 플레이어의 턴입니다.");return}if(this.isColorSelectionMode)return;let t=this.getMyPlayerIndex();if(t<0||t>=this.playerHands.length)return;let r=this.playerHands[t][e];this.canPlayCard(r)?(this.selectedCardIndex=e,this.playCard(t,e)):(this.statusText.setText("낼 수 없는 카드입니다"),this.statusText.setColor("#f44336"))}canPlayCard(e){let t=this.discardPile[this.discardPile.length-1];return"Wild"===e.type||"WildDrawFour"===e.type||e.color===this.currentColor||e.type===t.type||"Number"===e.type&&"Number"===t.type&&e.value===t.value}playCard(e,t){if(!this.isMyTurn()){this.showError("지금은 다른 플레이어의 턴입니다.");return}if(e!==this.getMyPlayerIndex()){this.showError("다른 플레이어의 카드를 낼 수 없습니다.");return}let r=this.playerHands[e][t];if(this.playerHands[e].splice(t,1),this.discardPile.push(r),"Wild"===r.type||"WildDrawFour"===r.type){this.isColorSelectionMode=!0,this.pendingWildCard=r,this.showColorSelection(),this.saveGameStateToSupabase();return}if(this.currentColor=r.color,this.handleSpecialCard(r),0===this.playerHands[e].length){this.showWinMessage(e),this.saveGameStateToSupabase();return}if(1===this.playerHands[e].length){var i,s,a;let t=(null===(a=(Array.isArray(null===(i=this.roomInfo)||void 0===i?void 0:i.players)?this.roomInfo.players:Object.values((null===(s=this.roomInfo)||void 0===s?void 0:s.players)||{})).sort((e,t)=>(e.joinedAt||0)-(t.joinedAt||0))[e])||void 0===a?void 0:a.name)||"플레이어 ".concat(e+1);this.statusText.setText("".concat(t,"가 우노를 선언했습니다!")),this.statusText.setColor("#ffd700")}this.saveGameStateToSupabase(),this.updateGameState(),this.nextPlayer()}handleSpecialCard(e){switch(e.type){case"Skip":this.nextPlayer();break;case"Reverse":this.isClockwise=!this.isClockwise;break;case"DrawTwo":this.nextPlayer(),this.drawCardForPlayer(this.currentPlayer),this.drawCardForPlayer(this.currentPlayer),this.nextPlayer();break;case"WildDrawFour":this.nextPlayer(),this.drawCardForPlayer(this.currentPlayer),this.drawCardForPlayer(this.currentPlayer),this.drawCardForPlayer(this.currentPlayer),this.drawCardForPlayer(this.currentPlayer),this.nextPlayer()}}showColorSelection(){let e=this.cameras.main.width,t=this.cameras.main.height,r=e/2,i=.4*t;this.add.text(r,i-.1*t,"색상을 선택하세요",{fontSize:"".concat(.04*t,"px"),color:"#fff",fontStyle:"bold"}).setOrigin(.5);let s=[{color:"Red",value:16007990},{color:"Yellow",value:16771899},{color:"Green",value:5025616},{color:"Blue",value:2201331}],a=.1*e,o=.05*e,h=r-(s.length-1)*(a+o)/2;s.forEach((e,t)=>{let r=h+t*(a+o),s=this.add.circle(r,i,a/2,e.value,1);s.setStrokeStyle(3,16777215),s.setInteractive({useHandCursor:!0}),s.on("pointerdown",()=>{l.Wc.setup(s,()=>{this.selectColor(e.color)})});let d=this.add.container(0,0);d.add([s]),d.setInteractive(new n.Geom.Circle(r,i,a/2),n.Geom.Circle.Contains),d.setInteractive({useHandCursor:!0}),d.on("pointerdown",()=>{l.Wc.setup(d,()=>{this.selectColor(e.color)})}),this.colorSelectButtons.push(d)})}selectColor(e){this.currentColor=e,this.isColorSelectionMode=!1,this.colorSelectButtons.forEach(e=>e.destroy()),this.colorSelectButtons=[],this.pendingWildCard&&(this.handleSpecialCard(this.pendingWildCard),this.pendingWildCard=null),this.saveGameStateToSupabase(),this.updateGameState(),this.nextPlayer()}drawCard(){if(!this.isMyTurn()){this.showError("지금은 다른 플레이어의 턴입니다.");return}let e=this.getMyPlayerIndex();if(!(e<0)){if(0===this.deck.length){let e=this.discardPile.pop();this.deck=this.discardPile,this.discardPile=[e];for(let e=this.deck.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[this.deck[e],this.deck[t]]=[this.deck[t],this.deck[e]]}}this.drawCardForPlayer(e),this.saveGameStateToSupabase(),this.updateGameState(),this.nextPlayer()}}drawCardForPlayer(e){if(0===this.deck.length)return;let t=this.deck.shift();this.playerHands[e].push(t)}nextPlayer(){this.isClockwise?this.currentPlayer=(this.currentPlayer+1)%this.numberOfPlayers:this.currentPlayer=(this.currentPlayer-1+this.numberOfPlayers)%this.numberOfPlayers,this.updateGameState()}updateGameState(){if(!this.playerCardCountTexts||0===this.playerCardCountTexts.length)return;for(let e=0;e<this.numberOfPlayers;e++)if(this.playerCardCountTexts[e]){this.playerCardCountTexts[e].setText("".concat(this.playerHands[e].length,"장"));let t=e===this.currentPlayer;this.playerCardCountTexts[e].setColor(t?"#4caf50":"#fff")}this.currentPlayerIndicator&&this.currentPlayerIndicator.setText("플레이어 ".concat(this.currentPlayer+1,"의 턴")),this.discardCardObject&&this.discardCardObject.destroy();let e=this.discardPile[this.discardPile.length-1];if(e){let t=this.cameras.main.width,r=this.cameras.main.height;this.discardCardObject=this.createCardObject(t/2,.5*r,Math.min(.12*t,.15*r),e)}this.updateHandDisplay()}showWinMessage(e){this.isGameActive=!1;let t=this.cameras.main.width,r=this.cameras.main.height,i=t/2,s=r/2;this.add.rectangle(i,s,t,r,0,.7),this.add.rectangle(i,s,.6*t,.4*r,2763306,1).setStrokeStyle(4,5025616),this.add.text(i,s-.1*r,"\uD83C\uDF89 플레이어 ".concat(e+1," 승리!"),{fontSize:"".concat(.06*r,"px"),color:"#4caf50",fontStyle:"bold"}).setOrigin(.5);let a=this.add.rectangle(i,s+.1*r,.3*t,.08*r,5025616,.9);a.setStrokeStyle(3,8505220),a.setInteractive({useHandCursor:!0}),a.on("pointerdown",()=>{l.Wc.setup(a,()=>{this.goToMainMenu()})});let o=this.add.text(i,s+.1*r,"메인 메뉴",{fontSize:"".concat(.035*r,"px"),color:"#fff",fontStyle:"bold"});o.setOrigin(.5),o.setInteractive({useHandCursor:!0}),o.on("pointerdown",()=>{l.Wc.setup(o,()=>{this.goToMainMenu()})})}goToMainMenu(){l.rX.startScene(this,"DeviceSelectionScene")}showOnlineModeSelection(){let e=this.cameras.main.width,t=this.cameras.main.height;this.roomWaitingGroup&&(this.roomWaitingGroup.destroy(!0),this.roomWaitingGroup=null),this.roomWaitingUnsubscribers.forEach(e=>e()),this.roomWaitingUnsubscribers=[],this.onlineModeButtons&&(this.onlineModeButtons.destroy(!0),this.onlineModeButtons=null),h.F.clearUI(this);let r=h.F.createPopupBackground(this,{width:.8,height:.4,strokeColor:2201331}),i=h.F.createPopupTitle(this,"온라인 멀티플레이어",r),s=r.height,a=.06*t,o=.02*t,n=.015*t,d=t/2-.1*s,c=d+a+n;h.F.createColumnButtons(this,[{text:"새 룸 만들기",color:5025616,strokeColor:6732650,hoverColor:4563017,y:d,buttonHeight:a,onClick:()=>{l.rX.startScene(this,"GameSelectionScene",{isOnlineMode:!0})}},{text:"룸 참가하기",color:2201331,strokeColor:6600182,hoverColor:1668818,y:c,buttonHeight:a,onClick:()=>{l.rX.startScene(this,"RoomListScene")}}],{x:e/2,buttonPadding:.05*e,fontSize:o}),h.F.createBackButton(this,{onClick:()=>{l.rX.startScene(this,"DeviceSelectionScene")},y:c+a+n,width:.4*r.width*.7,height:.7*a,fontSize:.8*o}),r.setDepth(1e3),i.setDepth(1001)}ensureOnlineMultiplayerManagerInitialized(){if(this.onlineMultiplayerManager)return;let e=(0,u.S)(this.numberOfPlayers||1);e.currentPlayer=this.currentPlayer,e.isOnlineMode=this.isOnlineMode,e.roomId=this.roomId,e.playerId=this.playerId,this.onlineMultiplayerManager||(this.onlineMultiplayerManager=new c.L,this.onlineMultiplayerManager.initialize(this,e),this.onlineMultiplayerManager.setSceneCallbacks({getNumberOfPlayers:()=>this.numberOfPlayers,setNumberOfPlayers:t=>{this.numberOfPlayers=t,e.numberOfPlayers=t},getCurrentPlayer:()=>this.currentPlayer,setCurrentPlayer:t=>{this.currentPlayer=t,e.currentPlayer=t},getScores:()=>[],setScores:()=>{},getRoomInfo:()=>this.roomInfo,setRoomInfo:e=>{this.roomInfo=e},getRoomId:()=>this.roomId,setRoomId:e=>{this.roomId=e},getPlayerId:()=>this.playerId,setPlayerId:e=>{this.playerId=e},getIsOnlineMode:()=>this.isOnlineMode,setIsOnlineMode:t=>{this.isOnlineMode=t,e.isOnlineMode=t},getIsPlayerSelectMode:()=>!1,showError:e=>this.showError(e),updateUI:()=>this.updateGameState(),updateScorecardText:()=>{},updateTotals:()=>{},updatePlayerScores:()=>{},updateDiceAppearance:()=>{this.updateGameState()},updateRollButtonText:()=>{},endGame:()=>{this.isGameActive=!1},calculatePotentialScores:()=>{},getIsRolling:()=>!1,getDiceRollSound:()=>null,restartScene:e=>this.scene.restart(e),startScene:(e,t)=>l.rX.startScene(this,e,t),getOnlineModeButtons:()=>this.onlineModeButtons,setOnlineModeButtons:e=>{this.onlineModeButtons=e}}),this.onlineMultiplayerManager.addEventListener(t=>{if("SHOW_ONLINE_MODE_SELECTION"===t.type)this.showOnlineModeSelection();else if("GAME_SELECTION_CANCELLED"===t.type)this.showOnlineModeSelection();else if("GAME_STATE_CHANGED"===t.type)this.syncGameState(t.gameState);else if("START_ONLINE_GAME"===t.type){let r=t.roomInfo;if("UnoScene"!==r.sceneKey){console.warn("[UnoScene] START_ONLINE_GAME event received for non-uno game, ignoring",{roomId:r.roomId,sceneKey:r.sceneKey});return}this.isOnlineMode=!0,this.roomId=r.roomId,this.playerId=this.supabaseManager.getPlayerId();let i=Array.isArray(r.players)?r.players:Object.values(r.players||{});if(this.numberOfPlayers=i.length,e.numberOfPlayers=this.numberOfPlayers,this.roomInfo=r,!this.popupSystem){this.scene.restart({numberOfPlayers:this.numberOfPlayers,isOnlineMode:!0,roomId:this.roomId,roomInfo:r});return}this.roomId&&this.playerId&&this.setupOnlineMode(),r.gameState||r.hostId!==this.playerId||this.startGame()}}))}async joinOnlineRoom(e){this.ensureOnlineMultiplayerManagerInitialized(),await this.onlineMultiplayerManager.joinOnlineRoom(e)}createActiveSceneCallback(e){return function(){for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];e(...r)}}setupOnlineMode(){if(this.roomId){let e=this.supabaseManager.onGameStateUpdate(this.createActiveSceneCallback(e=>{this.syncGameState(e)})),t=this.supabaseManager.onRoomUpdate(this.createActiveSceneCallback(e=>{let t;if(this.roomInfo=e,e.sceneKey&&"UnoScene"!==e.sceneKey&&this.roomId){console.log("[UnoScene] Room sceneKey changed (host changed game), redirecting to RoomWaitingScene",{sceneKey:e.sceneKey,roomId:this.roomId}),l.rX.startScene(this,"RoomWaitingScene",{roomId:this.roomId,roomInfo:e});return}if(t=Array.isArray(e.players)?e.players:Object.keys(e.players||{}).map(t=>{let r=e.players[t];return r&&"object"==typeof r&&"id"in r?r:null}).filter(e=>null!==e).sort((e,t)=>(e.joinedAt||0)-(t.joinedAt||0)),this.numberOfPlayers!==t.length){var r,i,s,a;this.numberOfPlayers=t.length,!(this.numberOfPlayers>0)||(null===(i=this.roomInfo)||void 0===i?void 0:null===(r=i.gameState)||void 0===r?void 0:r.gameStarted)?this.numberOfPlayers>0&&(null===(a=this.roomInfo)||void 0===a?void 0:null===(s=a.gameState)||void 0===s?void 0:s.gameStarted)&&this.updateGameState():this.scene&&this.scene.isActive()&&this.scene.restart({numberOfPlayers:this.numberOfPlayers,isOnlineMode:!0,roomId:this.roomId,roomInfo:this.roomInfo,playerId:this.playerId})}})),r=this.supabaseManager.onPlayerLeft(this.createActiveSceneCallback(async(e,t)=>{var r,i;let s="플레이어",a=t.find(t=>t.id===e);if(a&&(s=a.name),this.showError("".concat(s,"이(가) 게임에서 나갔습니다.")),null===(i=this.roomInfo)||void 0===i?void 0:null===(r=i.gameState)||void 0===r?void 0:r.gameStarted)try{await this.supabaseManager.removePlayerFromGame(e)}catch(t){console.error("Failed to remove player from game:",t);let e=t instanceof Error?t.message:"알 수 없는 오류";this.showError("플레이어 제거 실패: ".concat(e))}}));this.events.once("shutdown",()=>{e(),t(),r()})}}syncGameState(e){var t,r,i,s;if((0,d.Cx)(e,null===(t=this.roomInfo)||void 0===t?void 0:t.sceneKey)&&e.gameStarted){if(e.deck&&Array.isArray(e.deck)&&(this.deck=e.deck.map(e=>({color:e.color,type:e.type,value:e.value}))),e.discardPile&&Array.isArray(e.discardPile)&&(this.discardPile=e.discardPile.map(e=>({color:e.color,type:e.type,value:e.value}))),e.playerHands&&Array.isArray(e.playerHands)&&(this.playerHands=e.playerHands.map(e=>Array.isArray(e)?e.map(e=>({color:e.color,type:e.type,value:e.value})):[])),this.currentPlayer=null!==(r=e.currentPlayer)&&void 0!==r?r:0,this.isClockwise=null===(i=e.isClockwise)||void 0===i||i,this.currentColor=e.currentColor||"Red",this.isColorSelectionMode=null!==(s=e.isColorSelectionMode)&&void 0!==s&&s,this.isGameActive=e.gameStarted,!this.playerCardCountTexts||0===this.playerCardCountTexts.length){e.playerHands&&Array.isArray(e.playerHands)&&(this.numberOfPlayers=e.playerHands.length);let t=e.deck&&Array.isArray(e.deck)&&e.deck.length>0,r=e.playerHands&&Array.isArray(e.playerHands)&&e.playerHands.length>0,i=e.discardPile&&Array.isArray(e.discardPile)&&e.discardPile.length>0;if(t&&r&&i)this.createGameUI();else{console.log("[UnoScene] Game state not fully initialized, skipping UI creation",{hasDeck:t,hasPlayerHands:r,hasDiscardPile:i});return}}this.updateGameState()}}showError(e){this.popupSystem.show({message:e,buttons:[{text:"확인",color:5025616,strokeColor:6732650,onClick:()=>{this.popupSystem.close()}}],width:.8,height:.3})}shutdown(){if(this.roomId){try{this.supabaseManager.leaveRoom()}catch(e){console.error("Error leaving room on shutdown:",e)}this.supabaseManager.cleanup()}}constructor(){super("UnoScene"),this.numberOfPlayers=2,this.deck=[],this.discardPile=[],this.playerHands=[],this.currentPlayer=0,this.isClockwise=!0,this.currentColor="Red",this.isGameActive=!1,this.selectedCardIndex=-1,this.handCardObjects=[],this.playerCardCountTexts=[],this.colorSelectButtons=[],this.isColorSelectionMode=!1,this.pendingWildCard=null,this.isOnlineMode=!1,this.roomId=null,this.playerId=null,this.roomInfo=null,this.supabaseManager=(0,d.nc)(),this.roomWaitingGroup=null,this.roomWaitingUnsubscribers=[],this.onlineModeButtons=null}}}}]);