"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6455],{6455:function(e,t,o){o.r(t),o.d(t,{default:function(){return r}});var n=o(2769),s=o(6201),i=o(3382),a=o(8782);class r extends n.Scene{init(e){var t;this.roomId=(null==e?void 0:e.roomId)||null,this.roomInfo=(null==e?void 0:e.roomInfo)||null,this.sceneKey=(null==e?void 0:e.sceneKey)||(null==e?void 0:null===(t=e.roomInfo)||void 0===t?void 0:t.sceneKey)||null}async create(){var e,t,o;let n=this.cameras.main.width,s=this.cameras.main.height;if(this.add.rectangle(n/2,s/2,n,s,1710618,1),!this.roomId){let e=new URLSearchParams(window.location.search).get("room");e&&(this.roomId=e)}console.log("[RoomWaitingScene] create() called",{roomId:this.roomId,sceneKey:this.sceneKey,hasRoomInfo:!!this.roomInfo,gameStarted:null===(t=this.roomInfo)||void 0===t?void 0:null===(e=t.gameState)||void 0===e?void 0:e.gameStarted});try{!this.sceneKey||this.roomId||this.roomInfo?this.roomId&&!this.roomInfo?await this.autoJoinRoom(this.roomId):this.roomInfo&&((null===(o=this.roomInfo.gameState)||void 0===o?void 0:o.gameStarted)?(console.log("[RoomWaitingScene] Game already started, starting game scene:",this.roomInfo.sceneKey),this.startOnlineGame(this.roomInfo)):(console.log("[RoomWaitingScene] Showing waiting screen for room:",this.roomInfo.roomId),await this.showRoomWaitingScreen(this.roomInfo.roomId))):await this.createRoomAndShowWaitingScreen(this.sceneKey)}catch(e){console.error("[RoomWaitingScene] Error in create():",e),a.rX.startScene(this,"GameSelectionScene",{isOnlineMode:!0})}}async createRoomAndShowWaitingScreen(e){console.log("[RoomWaitingScene] createRoomAndShowWaitingScreen called with sceneKey: ".concat(e));let t=s.P.getInstance().getGame(e);if(!t){console.error("[RoomWaitingScene] Unknown scene key: ".concat(e)),a.rX.startScene(this,"GameSelectionScene",{isOnlineMode:!0});return}console.log("[RoomWaitingScene] Creating room for game: ".concat(t.name,", maxPlayers: ").concat(t.maxPlayers));try{let o=await this.supabaseManager.createRoom(t.maxPlayers,e);if(console.log("[RoomWaitingScene] Room created with ID: ".concat(o)),o){this.roomId=o;try{console.log("[RoomWaitingScene] Showing waiting screen for room: ".concat(o)),await this.showRoomWaitingScreen(o),console.log("[RoomWaitingScene] Waiting screen shown successfully for room: ".concat(o))}catch(e){console.error("[RoomWaitingScene] Error showing waiting screen:",e),a.rX.startScene(this,"GameSelectionScene",{isOnlineMode:!0})}}else console.error("[RoomWaitingScene] Failed to create room: roomId is null or empty"),a.rX.startScene(this,"GameSelectionScene",{isOnlineMode:!0})}catch(e){console.error("[RoomWaitingScene] Error creating room:",e),e instanceof Error&&console.error("[RoomWaitingScene] Error details:",{message:e.message,stack:e.stack}),a.rX.startScene(this,"GameSelectionScene",{isOnlineMode:!0})}}async autoJoinRoom(e){try{let o=e.toUpperCase().trim();if(!/^[A-Z0-9]{6,8}$/.test(o)){console.error("[RoomWaitingScene] Invalid room ID format:",e),a.rX.startScene(this,"DeviceSelectionScene");return}try{this.roomInfo=await this.supabaseManager.joinRoom(o,"Player")}catch(e){console.error("[RoomWaitingScene] Failed to join room:",e),a.rX.startScene(this,"DeviceSelectionScene");return}if(this.roomInfo||(this.roomInfo=await this.supabaseManager.getRoomInfo()),!this.roomInfo)for(let e=0;e<10&&(await new Promise(e=>setTimeout(e,500)),this.roomInfo=await this.supabaseManager.getRoomInfo(),!this.roomInfo);e++);if(this.roomInfo){var t;(null===(t=this.roomInfo.gameState)||void 0===t?void 0:t.gameStarted)?this.startOnlineGame(this.roomInfo):await this.showRoomWaitingScreen(o)}else console.error("[RoomWaitingScene] Failed to get room info after joining"),a.rX.startScene(this,"DeviceSelectionScene")}catch(e){console.error("[RoomWaitingScene] Failed to join room:",e),a.rX.startScene(this,"DeviceSelectionScene")}}async showRoomWaitingScreen(e){var t,o,n;this.roomId=e;let i=this.cameras.main.width,r=this.cameras.main.height,c=i/2,l=r/2;if(this.roomWaitingGroup&&(this.roomWaitingGroup.destroy(!0),this.roomWaitingGroup=null),this.roomUnsubscribers.forEach(e=>e()),this.roomUnsubscribers=[],!this.roomInfo){let t=this.supabaseManager.getRoomId();this.supabaseManager.roomId=e;try{this.roomInfo=await this.supabaseManager.getRoomInfo()}finally{this.supabaseManager.roomId=t}}this.roomWaitingGroup=this.add.container(0,0);let h="게임";if(null===(t=this.roomInfo)||void 0===t?void 0:t.sceneKey){let e=s.P.getInstance().getGame(this.roomInfo.sceneKey);e&&(h=e.name)}else if(this.sceneKey){let e=s.P.getInstance().getGame(this.sceneKey);e&&(h=e.name)}if(!this.roomWaitingGroup)return;let d=.8*i,m=.5*r,g=this.add.rectangle(c,l,d,m,1710618,.95).setStrokeStyle(3,5025616);this.roomWaitingGroup.add(g);let f=.04*r,y=.022*r,u=.025*r,S=.018*r,p=.02*r,I=this.add.text(0,0,"룸 대기 중...",{fontSize:"".concat(f,"px"),color:"#fff",fontStyle:"bold"}).setOrigin(.5,.5),v=I.height;I.destroy();let b=this.add.text(0,0,"게임: ".concat(h),{fontSize:"".concat(y,"px"),color:"#fff"}).setOrigin(.5,.5),w=b.height;b.destroy();let R=this.add.text(0,0,"룸 코드: ".concat(e),{fontSize:"".concat(u,"px"),color:"#4caf50",fontStyle:"bold"}).setOrigin(.5,.5),x=R.height;R.destroy();let K=this.add.text(0,0,"플레이어: (1/4)",{fontSize:"".concat(p,"px"),color:"#fff",fontStyle:"bold"}).setOrigin(.5,.5),W=K.height;K.destroy();let B=.012*r,G=l-m/2+.02*r+v/2,C=this.add.text(c,G,"룸 대기 중...",{fontSize:"".concat(f,"px"),color:"#fff",fontStyle:"bold"}).setOrigin(.5,.5);this.roomWaitingGroup.add(C);let T=G+v/2+B+w/2,M=this.add.text(c,T,"게임: ".concat(h),{fontSize:"".concat(y,"px"),color:"#fff"}).setOrigin(.5,.5);this.roomWaitingGroup.add(M);let O=T+w/2+B+x/2,k=this.add.text(c,O,"룸 코드: ".concat(e),{fontSize:"".concat(u,"px"),color:"#4caf50",fontStyle:"bold"}).setOrigin(.5,.5);this.roomWaitingGroup.add(k);let D=.04*r,A=.02*d,P=O+x/2+B+D/2,j=this.add.text(0,0,"\uD83D\uDCCB 복사",{fontSize:"".concat(S,"px"),color:"#fff",fontStyle:"bold"}).setOrigin(.5),E=j.width;j.destroy();let z=this.add.rectangle(c,P,Math.max(E+2*A,.2*d),D,2201331,.9).setStrokeStyle(2,6600182).setInteractive({useHandCursor:!0}).on("pointerdown",t=>{this.copyRoomCodeToClipboardSync(e,t)}).on("pointerover",()=>{z.setFillStyle(1668818,.9)}).on("pointerout",()=>{z.setFillStyle(2201331,.9)}).setDepth(1001);this.roomWaitingGroup.add(z);let H=this.add.text(c,P,"\uD83D\uDCCB 복사",{fontSize:"".concat(S,"px"),color:"#fff",fontStyle:"bold"}).setOrigin(.5).setInteractive({useHandCursor:!0}).on("pointerdown",t=>{t.event.stopPropagation(),this.copyRoomCodeToClipboardSync(e,t)}).setDepth(1002);this.roomWaitingGroup.add(H);let U=this.roomInfo?Array.isArray(this.roomInfo.players)?this.roomInfo.players.length:Object.keys(this.roomInfo.players||{}).length:1,_=(null===(o=this.roomInfo)||void 0===o?void 0:o.maxPlayers)||4,F=P+D/2+B+W/2;this.playersCountText=this.add.text(c,F,"플레이어: (".concat(U,"/").concat(_,")"),{fontSize:"".concat(p,"px"),color:"#fff",fontStyle:"bold"}).setOrigin(.5,.5),this.roomWaitingGroup.add(this.playersCountText);let X=F+W/2+B,L=l+m/2,V=.02*r,J=.05*r+.02*r,N=.12*r,Z=Math.max(N,Math.min(L-V-J-X,.2*m)),$=X+Z/2,q=L-V-J;if($+Z/2>q){let e=Math.max(N,q-X);Z=e,$=X+e/2}let Q=this.add.rectangle(c,$,.8*d,Z,2201331,.3).setStrokeStyle(2,2201331);this.roomWaitingGroup.add(Q);let Y=this.add.text(c,$-.35*Z,"플레이어 목록",{fontSize:"".concat(.018*r,"px"),color:"#fff",fontStyle:"bold"}).setOrigin(.5);this.roomWaitingGroup.add(Y);let ee=[];this.roomInfo&&Array.isArray(this.roomInfo.players)?ee=this.roomInfo.players.filter(e=>e&&e.id):this.roomInfo&&this.roomInfo.players&&"object"==typeof this.roomInfo.players&&(ee=Object.keys(this.roomInfo.players).map(e=>{let t=this.roomInfo.players[e];return t&&"object"==typeof t&&"id"in t?t:t&&"object"==typeof t&&"player_id"in t?{id:t.player_id,name:t.player_name||t.name||"Player ".concat(e)}:null}).filter(e=>null!==e).sort((e,t)=>{var o,n;return((null===(o=this.roomInfo.players[e.id])||void 0===o?void 0:o.joinedAt)||0)-((null===(n=this.roomInfo.players[t.id])||void 0===n?void 0:n.joinedAt)||0)}));let et=ee.length>0?ee.map((e,t)=>e.name||"Player ".concat(t+1)).join("\n"):"대기 중...";this.playerListText=this.add.text(c,$+.1*Z,et,{fontSize:"".concat(.016*r,"px"),color:"#fff"}).setOrigin(.5),this.roomWaitingGroup.add(this.playerListText);let eo=this.supabaseManager.getPlayerId(),en=(null===(n=this.roomInfo)||void 0===n?void 0:n.hostId)===eo,es=en&&U>=2,ei=.05*r,ea=.022*r,er=.05*d,ec=L-V,el=$+Z/2+.02*r+ei/2,eh=el+ei/2>ec?ec-ei/2:el;if(en){let e=.3*d;this.startButtonBg=this.add.rectangle(c-er/2-e/2,eh,e,ei,es?5025616:5592405,es?.9:.5).setStrokeStyle(2,es?6732650:6710886).setVisible(en),this.roomWaitingGroup.add(this.startButtonBg),es?(this.startButtonBg.setInteractive({useHandCursor:!0}),this.startButtonBg.on("pointerdown",async()=>{this.startButtonBg&&await this.handleStartGame(this.startButtonBg)})):this.startButtonBg.disableInteractive(),this.startButtonText=this.add.text(c-er/2-e/2,eh,"게임 시작",{fontSize:"".concat(ea,"px"),color:es?"#fff":"#888",fontStyle:"bold"}).setOrigin(.5,.5).setVisible(en),this.roomWaitingGroup.add(this.startButtonText),es&&(this.startButtonText.setInteractive({useHandCursor:!0}),this.startButtonText.on("pointerdown",async()=>{this.startButtonBg&&await this.handleStartGame(this.startButtonBg)}))}let ed=.3*d,em=en?c+er/2+ed/2:c,eg=this.add.rectangle(em,eh,ed,ei,6710886,.9).setStrokeStyle(2,10066329).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{a.rX.startScene(this,"RoomCreationScene")});this.roomWaitingGroup.add(eg);let ef=this.add.text(em,eh,"뒤로가기",{fontSize:"".concat(ea,"px"),color:"#fff",fontStyle:"bold"}).setOrigin(.5,.5).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{a.rX.startScene(this,"RoomCreationScene")});this.roomWaitingGroup.add(ef);let ey=this.supabaseManager.roomId;this.supabaseManager.roomId=e;try{let t=this.supabaseManager.onRoomUpdate(async t=>{var o,n,s,i;this.roomInfo=t;let a=this.sceneKey,r=t.sceneKey;if(a&&r&&a!==r){console.log("[RoomWaitingScene] Game type changed, skipping game start check",{previousSceneKey:a,newSceneKey:r}),this.sceneKey=r;return}if(!a&&r?(this.sceneKey=r,(null===(n=t.gameState)||void 0===n?void 0:n.gameStarted)||console.log("[RoomWaitingScene] Game not started yet, skipping game start check",{sceneKey:r,gameStarted:null===(s=t.gameState)||void 0===s?void 0:s.gameStarted})):r&&(this.sceneKey=r),this.playersCountText){let e=Array.isArray(t.players)?t.players.length:Object.keys(t.players||{}).length;this.playersCountText.setText("플레이어: (".concat(e,"/").concat(t.maxPlayers,")"))}if(this.playerListText){let e=[];Array.isArray(t.players)?e=t.players.filter(e=>e&&e.id):t.players&&"object"==typeof t.players&&(e=Object.keys(t.players).map(e=>{let o=t.players[e];return o&&"object"==typeof o&&"id"in o?o:o&&"object"==typeof o&&"player_id"in o?{id:o.player_id,name:o.player_name||o.name||"Player ".concat(e)}:null}).filter(e=>null!==e).sort((e,o)=>{var n,s;let i=(null===(n=t.players[e.id])||void 0===n?void 0:n.joinedAt)||0,a=(null===(s=t.players[o.id])||void 0===s?void 0:s.joinedAt)||0;return i-a}));let o=e.length>0?e.map((e,t)=>e.name||"Player ".concat(t+1)).join("\n"):"대기 중...";this.playerListText.setText(o)}let c=this.supabaseManager.getPlayerId(),l=t.hostId===c,h=Array.isArray(t.players)?t.players.length:Object.keys(t.players||{}).length,d=l&&h>=2;if(this.startButtonBg&&this.startButtonText&&(this.startButtonBg.setFillStyle(d?5025616:5592405,d?.9:.5),this.startButtonBg.setStrokeStyle(2,d?6732650:6710886),this.startButtonBg.setVisible(l),this.startButtonText.setVisible(l),this.startButtonText.setColor(d?"#fff":"#888"),d?(this.startButtonBg.setInteractive({useHandCursor:!0}),this.startButtonBg.off("pointerdown"),this.startButtonBg.on("pointerdown",async()=>{this.startButtonBg&&await this.handleStartGame(this.startButtonBg)}),this.startButtonText.setInteractive({useHandCursor:!0}),this.startButtonText.off("pointerdown"),this.startButtonText.on("pointerdown",async()=>{this.startButtonBg&&await this.handleStartGame(this.startButtonBg)})):(this.startButtonBg.disableInteractive(),this.startButtonText.disableInteractive())),null===(o=t.gameState)||void 0===o?void 0:o.gameStarted){let o=this.supabaseManager.roomId;this.supabaseManager.roomId=e;try{let e=!0===window.__CI__?1e4:5e3,o=this.supabaseManager.getRoomInfo(),n=new Promise(t=>{setTimeout(()=>t(null),e)}),s=await Promise.race([o,n]);s&&(null===(i=s.gameState)||void 0===i?void 0:i.gameStarted)?(this.roomInfo=s,this.checkAndStartGame(s)):(console.warn("[RoomWaitingScene] Failed to get latest room info, using existing room object",{timeout:null===s,hasRoom:!!t}),t.sceneKey&&(this.roomInfo=t,this.checkAndStartGame(t)))}catch(e){console.error("[RoomWaitingScene] Error getting latest room info in onRoomUpdate:",e),t.sceneKey&&(console.warn("[RoomWaitingScene] Using existing room object as fallback"),this.roomInfo=t,this.checkAndStartGame(t))}finally{this.supabaseManager.roomId=o}}else this.checkAndStartGame(t)});this.roomUnsubscribers.push(()=>{t(),this.supabaseManager.roomId=ey})}catch(e){throw this.supabaseManager.roomId=ey,e}}copyRoomCodeToClipboardSync(e,t){try{let t=new URL(window.location.href);t.searchParams.set("room",e);let o=t.toString();if(navigator.clipboard&&navigator.clipboard.writeText){navigator.clipboard.writeText(o).then(()=>{this.showShareSuccessMessage()}).catch(t=>{console.warn("[RoomWaitingScene] Clipboard copy failed:",t),this.tryWebShareAPI(e,o)});return}this.tryWebShareAPI(e,o)}catch(o){console.error("[RoomWaitingScene] Failed to share room code:",o);let t=new URL(window.location.href);t.searchParams.set("room",e),this.showRoomCodeForManualCopy(e,t.toString())}}tryWebShareAPI(e,t){if(navigator.share&&navigator.canShare&&navigator.canShare({text:e,url:t})){navigator.share({title:"게임 룸 초대",text:"게임 룸에 참가하세요! 룸 코드: ".concat(e),url:t}).then(()=>{this.showShareSuccessMessage()}).catch(o=>{"AbortError"!==o.name&&(console.warn("[RoomWaitingScene] Web Share failed:",o),this.showRoomCodeForManualCopy(e,t))});return}this.showRoomCodeForManualCopy(e,t)}showRoomCodeForManualCopy(e,t){let o=this.cameras.main.width,n=this.cameras.main.height,s=o/2,i=n/2;this.roomWaitingGroup&&this.roomWaitingGroup.list.forEach(e=>{(e.getData("isRoomCodePopup")||e.getData("isRoomCodeText"))&&e.destroy()});let a=.85*o,r=.3*n,c=this.add.rectangle(s,i,a,r,1710618,.95).setStrokeStyle(3,5025616).setDepth(2e3).setData("isRoomCodePopup",!0),l=this.add.text(s,i-.3*r,"룸 코드",{fontSize:"".concat(.03*n,"px"),color:"#fff",fontStyle:"bold"}).setOrigin(.5).setDepth(2001).setData("isRoomCodeText",!0),h=this.add.text(s,i,e,{fontSize:"".concat(.05*n,"px"),color:"#4caf50",fontStyle:"bold"}).setOrigin(.5).setDepth(2001).setData("isRoomCodeText",!0),d=this.add.text(s,i+.25*r,"룸 코드를 길게 눌러 복사하세요",{fontSize:"".concat(.02*n,"px"),color:"#fff"}).setOrigin(.5).setDepth(2001).setData("isRoomCodeText",!0),m=this.add.rectangle(s,i+.4*r,.3*a,.05*n,6710886,.9).setStrokeStyle(2,10066329).setInteractive({useHandCursor:!0}).setDepth(2001).setData("isRoomCodePopup",!0).on("pointerdown",()=>{c.destroy(),l.destroy(),h.destroy(),d.destroy(),m.destroy(),g.destroy()}),g=this.add.text(s,i+.4*r,"닫기",{fontSize:"".concat(.025*n,"px"),color:"#fff",fontStyle:"bold"}).setOrigin(.5).setInteractive({useHandCursor:!0}).setDepth(2002).setData("isRoomCodeText",!0).on("pointerdown",()=>{c.destroy(),l.destroy(),h.destroy(),d.destroy(),m.destroy(),g.destroy()})}showShareSuccessMessage(){let e=this.cameras.main.height,t=this.cameras.main.width/2,o=this.cameras.main.height/2,n=this.add.text(t,o,"공유되었습니다!",{fontSize:"".concat(.025*e,"px"),color:"#4caf50",fontStyle:"bold"}).setOrigin(.5).setDepth(2e3);this.time.delayedCall(2e3,()=>{n&&n.scene&&n.destroy()})}checkAndStartGame(e){var t;(null===(t=e.gameState)||void 0===t?void 0:t.gameStarted)&&this.startOnlineGame(e)}async handleStartGame(e){if(!this.roomInfo)return;let t=this.supabaseManager.getPlayerId(),o=this.roomInfo.hostId===t,n=Array.isArray(this.roomInfo.players)?this.roomInfo.players.length:Object.keys(this.roomInfo.players||{}).length,s=o&&n>=2;if(!s){console.warn("[RoomWaitingScene] Cannot start game:",{isHost:o,playerCount:n});return}e.disableInteractive();try{var i,a,r,c,l;let e=await this.supabaseManager.getRoomInfo();e&&e.sceneKey&&(this.sceneKey=e.sceneKey);let t=await this.supabaseManager.startGame();if(!t||!t.roomId)throw Error("Invalid room info returned from startGame");if(!(null===(i=t.gameState)||void 0===i?void 0:i.gameStarted))throw console.error("[RoomWaitingScene] gameStarted is not true after startGame:",{gameState:t.gameState,updatedRoomInfo:t}),Error("gameStarted is not true after startGame");let o=t.sceneKey;if(o||(o=this.sceneKey||void 0),!o&&this.roomInfo&&(o=this.roomInfo.sceneKey||void 0),!o)throw console.error("[RoomWaitingScene] sceneKey is missing:",{updatedRoomInfoSceneKey:t.sceneKey,thisSceneKey:this.sceneKey,roomInfoSceneKey:null===(c=this.roomInfo)||void 0===c?void 0:c.sceneKey,updatedRoomInfo:t}),Error("sceneKey is missing in roomInfo and scene");let n={...t,sceneKey:o};if(console.log("[RoomWaitingScene] Game started successfully, transitioning to scene:",n.sceneKey,{updatedRoomInfoSceneKey:t.sceneKey,thisSceneKey:this.sceneKey,finalSceneKey:n.sceneKey,roomInfoSceneKey:null===(a=this.roomInfo)||void 0===a?void 0:a.sceneKey,gameStarted:null===(r=n.gameState)||void 0===r?void 0:r.gameStarted,updatedRoomInfo:t}),this.roomUnsubscribers.forEach(e=>e()),this.roomUnsubscribers=[],!n.sceneKey)throw console.error("[RoomWaitingScene] sceneKey is missing in finalRoomInfo, cannot start game:",{finalRoomInfo:n,thisSceneKey:this.sceneKey,roomInfoSceneKey:null===(l=this.roomInfo)||void 0===l?void 0:l.sceneKey}),Error("sceneKey is missing in finalRoomInfo");this.startOnlineGame(n)}catch(o){console.error("[RoomWaitingScene] Failed to start game:",o),s&&e.setInteractive({useHandCursor:!0});let t=o instanceof Error?o.message:"알 수 없는 오류";console.error("[RoomWaitingScene] Game start error: ".concat(t))}}startOnlineGame(e){let t=e.sceneKey;if(t||(t=this.sceneKey||void 0),!t&&this.roomInfo&&(t=this.roomInfo.sceneKey||void 0),!t){var o,n;throw console.error("[RoomWaitingScene] Cannot start game: sceneKey is missing",{roomInfoSceneKey:e.sceneKey,thisSceneKey:this.sceneKey,roomInfoSceneKeyFromRoomInfo:null===(o=this.roomInfo)||void 0===o?void 0:o.sceneKey,roomInfo:e,roomId:e.roomId}),Error("sceneKey is missing: roomInfo.sceneKey=".concat(e.sceneKey,", this.sceneKey=").concat(this.sceneKey,", roomInfo?.sceneKey=").concat(null===(n=this.roomInfo)||void 0===n?void 0:n.sceneKey))}if(console.log("[RoomWaitingScene] Starting game scene: ".concat(t),{roomId:e.roomId,sceneKey:t,roomInfoSceneKey:e.sceneKey,thisSceneKey:this.sceneKey}),!this.scene.get(t)){let e=Error("Scene ".concat(t," not found in scene manager"));throw console.error("[RoomWaitingScene] ".concat(e.message)),e}try{let o={isOnlineMode:!0,roomId:e.roomId,roomInfo:{...e,sceneKey:t}};a.rX.startScene(this,t,o),console.log("[RoomWaitingScene] Scene.start() called successfully for ".concat(t),{previousScene:this.scene.key,newScene:t})}catch(o){throw console.error("[RoomWaitingScene] Failed to start scene:",o,{sceneKey:t,roomId:e.roomId,roomInfoSceneKey:e.sceneKey,thisSceneKey:this.sceneKey}),o}}shutdown(){this.roomUnsubscribers.forEach(e=>e()),this.roomUnsubscribers=[],this.roomWaitingGroup&&(this.roomWaitingGroup.destroy(!0),this.roomWaitingGroup=null),this.playersCountText=null,this.playerListText=null,this.startButtonBg=null,this.startButtonText=null}constructor(){super("RoomWaitingScene"),this.supabaseManager=(0,i.nc)(),this.roomInfo=null,this.roomId=null,this.sceneKey=null,this.roomWaitingGroup=null,this.roomUnsubscribers=[],this.playersCountText=null,this.playerListText=null,this.startButtonBg=null,this.startButtonText=null}}},8782:function(e,t,o){o.d(t,{Wc:function(){return s},rX:function(){return n},vz:function(){return i}});class n{static startScene(e,t,o){if(e.scene.start(t,o),!e.game){let o=e.scene.key;if(o&&o!==t){let n=e.scene.get(o);n&&n.scene.isActive()&&(console.log("[SceneTransitionUtils] Stopping current scene: ".concat(o," -> ").concat(t)),n.scene.stop())}return}let n=e.game.scene.scenes||[],s=[];for(let e of n){let o=e.scene.key;o!==t&&e.scene.isActive()&&(console.log("[SceneTransitionUtils] Stopping active scene: ".concat(o," (transitioning to ").concat(t,")")),e.scene.stop(),s.push(o))}s.length>0&&console.log("[SceneTransitionUtils] Stopped ".concat(s.length," scene(s): [").concat(s.join(", "),"] -> ").concat(t))}}class s{static setup(e,t){let o=0,n=0,s=!1;e.on("pointerdown",e=>{o=e.x,n=e.y,s=!1}),e.on("pointermove",e=>{if(e.isDown){let t=Math.abs(e.x-o),i=Math.abs(e.y-n);(t>this.DRAG_THRESHOLD||i>this.DRAG_THRESHOLD)&&(s=!0)}}),e.on("pointerup",()=>{s||t(),s=!1}),e.on("pointercancel",()=>{s=!1})}}s.DRAG_THRESHOLD=10;class i{static create(e,t){let{x:o,y:n,width:i,height:a,text:r,backgroundColor:c=2201331,backgroundAlpha:l=.9,strokeColor:h=6600182,strokeWidth:d=3,textColor:m="#fff",fontSize:g,onClick:f}=t,y=e.add.container(0,0),u=e.add.rectangle(o,n,i,a,c,l);u.setStrokeStyle(d,h),u.setInteractive({useHandCursor:!0}),s.setup(u,f);let S=e.add.text(o,n,r,{fontSize:g?"".concat(g,"px"):void 0,color:m,fontStyle:"bold"});return S.setOrigin(.5),S.setInteractive({useHandCursor:!0}),s.setup(S,f),y.add([u,S]),{container:y,background:u,text:S}}}}}]);