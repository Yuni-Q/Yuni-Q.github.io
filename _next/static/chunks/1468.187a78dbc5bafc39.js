"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1468],{1468:function(t,e,o){o.r(e),o.d(e,{default:function(){return a}});var s=o(2769),n=o(3382),i=o(6201),r=o(8782);class a extends s.Scene{async create(){let t=this.cameras.main.width,e=this.cameras.main.height;this.add.rectangle(t/2,e/2,t,e,1710618,1),await this.showRoomList()}async showRoomList(){let t=this.cameras.main.width,e=this.cameras.main.height,o=t/2,s=e/2;this.clearRoomListUI();let n=Math.min(.8*t,t-12),i=.6*e,r=this.add.rectangle(o,s,n,i,1710618,.95).setStrokeStyle(3,2201331);this.roomListElements.push(r);let a=this.add.text(o,s-.4*i,"방 목록",{fontSize:"".concat(.04*e,"px"),color:"#fff",fontStyle:"bold"}).setOrigin(.5);this.roomListElements.push(a);let c=this.add.text(o,s,"방 목록을 불러오는 중...",{fontSize:"".concat(.025*e,"px"),color:"#aaa"}).setOrigin(.5);try{let t=await this.supabaseManager.getActiveRooms();if(c.destroy(),0===t.length){let t=this.add.text(o,s,"현재 열려있는 방이 없습니다.",{fontSize:"".concat(.025*e,"px"),color:"#aaa"}).setOrigin(.5);this.roomListElements.push(t);let r=.3*n,a=s+.2*i,c=this.add.rectangle(o,a,r,.05*e,2201331,.9).setStrokeStyle(2,6600182).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.showRoomList()}).on("pointerover",()=>{c.setFillStyle(1668818,.9)}).on("pointerout",()=>{c.setFillStyle(2201331,.9)});this.roomListElements.push(c);let l=this.add.text(o,a,"새로고침",{fontSize:"".concat(.022*e,"px"),color:"#fff",fontStyle:"bold"}).setOrigin(.5);this.roomListElements.push(l)}else this.renderRoomList(t,o,s,n,i);this.createBackButton(o,s,n,i)}catch(r){console.error("[RoomListScene] Failed to load room list:",r),c.destroy();let t=this.add.text(o,s,"방 목록을 불러오는데 실패했습니다.",{fontSize:"".concat(.025*e,"px"),color:"#ff4444"}).setOrigin(.5);this.roomListElements.push(t),this.createBackButton(o,s,n,i)}}renderRoomList(t,e,o,n,r){let a=this.cameras.main.height,c=o-.05*r,l=.65*r,h=.08*a,d=.02*a,m=.85*n;this.scrollContainer=this.add.container(e,c),this.scrollContainer.setSize(m,l),this.roomListElements.push(this.scrollContainer);let p=this.make.graphics();p.fillStyle(16777215),p.fillRect(e-.5*m,c-.5*l,m,l);let u=p.createGeometryMask();this.scrollContainer.setMask(u),this.roomListElements.push(p),this.scrollY=0;let f=Math.max(0,t.length*(h+d)-d-l),S=-l/2+h/2,y=0,g=0,x=!1,L=0;t.forEach((t,e)=>{let o=S+e*(h+d),n=(Array.isArray(t.players)?t.players:Object.values(t.players||{})).length,r=this.add.rectangle(0,o,m,h,3355443,.9).setStrokeStyle(2,5592405).setInteractive({useHandCursor:!0}).setData("roomId",t.roomId).setDepth(1e3).on("pointerover",()=>{x||r.setFillStyle(4473924,.9)}).on("pointerout",()=>{r.setFillStyle(3355443,.9)}),l=t=>{y=t.y,g=this.scrollY,L=Date.now(),x=!1},p=t=>{if(f>0&&y>0&&Math.abs(t.y-y)>10){x=!0;let e=t.y-y;this.scrollY=s.Math.Clamp(g-e,0,f),this.updateScroll(c)}},u=async e=>{if(0===f){await this.joinRoom(t.roomId);return}let o=Date.now()-L,s=y>0?Math.abs(e.y-y):0;!x&&o<300&&s<10&&await this.joinRoom(t.roomId),y=0,g=0,x=!1,L=0},R=()=>{y=0,g=0,x=!1,L=0};r.on("pointerdown",l).on("pointermove",p).on("pointerup",u).on("pointerout",R);let v=.022*a,w="게임",C="\uD83C\uDFAE";if(t.sceneKey){let e=i.P.getInstance().getGame(t.sceneKey);e&&(w=e.name,C=e.icon||"\uD83C\uDFAE")}let E=this.add.text(0,0,"".concat(C," ").concat(w),{fontSize:"".concat(v,"px"),color:"#ffd700",fontStyle:"bold"}).setOrigin(.5,.5),I=E.height;E.destroy();let b=this.add.text(0,0,"룸 코드: ".concat(t.roomId),{fontSize:"".concat(v,"px"),color:"#4caf50",fontStyle:"bold"}).setOrigin(.5,.5),O=b.height;b.destroy();let k=this.add.text(0,0,"플레이어: ".concat(n,"/").concat(t.maxPlayers),{fontSize:"".concat(v,"px"),color:"#fff"}).setOrigin(.5,.5),D=k.height;k.destroy();let z=o-(I+4+O+4+D)/2+I/2,M=z+I/2+4+O/2,H=this.add.text(0,z,"".concat(C," ").concat(w),{fontSize:"".concat(v,"px"),color:"#ffd700",fontStyle:"bold"}).setOrigin(.5,.5),A=this.add.text(0,M,"룸 코드: ".concat(t.roomId),{fontSize:"".concat(v,"px"),color:"#4caf50",fontStyle:"bold"}).setOrigin(.5,.5),F=this.add.text(0,M+O/2+4+D/2,"플레이어: ".concat(n,"/").concat(t.maxPlayers),{fontSize:"".concat(v,"px"),color:"#fff"}).setOrigin(.5,.5);[H,A,F].forEach(t=>{t.setInteractive({useHandCursor:!0}),t.setDepth(1001),t.on("pointerdown",l).on("pointermove",p).on("pointerup",u).on("pointerout",R)}),this.scrollContainer.add([r,H,A,F])}),this.scrollContainer.setInteractive(new s.Geom.Rectangle(-(.5*m),-(.5*l),m,l),s.Geom.Rectangle.Contains);let R=0,v=0;this.scrollContainer.on("pointerdown",t=>{f>0&&(R=t.y,v=this.scrollY)}).on("pointermove",t=>{if(f>0&&R>0&&Math.abs(t.y-R)>10){let e=t.y-R;this.scrollY=s.Math.Clamp(v-e,0,f),this.updateScroll(c)}}).on("pointerup",()=>{R=0,v=0}).on("pointerout",()=>{R=0,v=0}),this.input.on("wheel",(t,e,o,s,n)=>{f>0&&(this.scrollY-=.5*s,this.updateScroll(c))}),this.updateScroll(c)}updateScroll(t){this.scrollContainer&&this.scrollContainer.setY(t-this.scrollY)}createBackButton(t,e,o,s){let n=this.cameras.main.height,i=e+.35*s,a=this.add.rectangle(t,i,.3*o,.05*n,6710886,.9).setStrokeStyle(2,8947848).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{r.rX.startScene(this,"DeviceSelectionScene")}).on("pointerover",()=>{a.setFillStyle(7829367,.9)}).on("pointerout",()=>{a.setFillStyle(6710886,.9)});this.roomListElements.push(a);let c=this.add.text(t,i,"뒤로",{fontSize:"".concat(.022*n,"px"),color:"#fff",fontStyle:"bold"}).setOrigin(.5);this.roomListElements.push(c)}async joinRoom(t){try{let e=await this.supabaseManager.joinRoom(t,"Player");if(!e||!e.sceneKey){console.error("[RoomListScene] Invalid room info:",e);return}r.rX.startScene(this,e.sceneKey,{isOnlineMode:!0,roomId:e.roomId,roomInfo:e})}catch(e){console.error("[RoomListScene] Failed to join room:",e);let t=e instanceof Error?e.message:"알 수 없는 오류";console.error("[RoomListScene] Join room error: ".concat(t))}}clearRoomListUI(){this.roomListElements.forEach(t=>{t&&t.scene&&t.destroy()}),this.roomListElements=[],this.scrollContainer=null,this.scrollY=0}shutdown(){this.clearRoomListUI()}constructor(){super("RoomListScene"),this.supabaseManager=(0,n.nc)(),this.roomListElements=[],this.scrollContainer=null,this.scrollY=0}}},8782:function(t,e,o){o.d(e,{Wc:function(){return n},rX:function(){return s},vz:function(){return i}});class s{static startScene(t,e,o){if(t.scene.start(e,o),!t.game){let o=t.scene.key;if(o&&o!==e){let s=t.scene.get(o);s&&s.scene.isActive()&&(console.log("[SceneTransitionUtils] Stopping current scene: ".concat(o," -> ").concat(e)),s.scene.stop())}return}let s=t.game.scene.scenes||[],n=[];for(let t of s){let o=t.scene.key;o!==e&&t.scene.isActive()&&(console.log("[SceneTransitionUtils] Stopping active scene: ".concat(o," (transitioning to ").concat(e,")")),t.scene.stop(),n.push(o))}n.length>0&&console.log("[SceneTransitionUtils] Stopped ".concat(n.length," scene(s): [").concat(n.join(", "),"] -> ").concat(e))}}class n{static setup(t,e){let o=0,s=0,n=!1;t.on("pointerdown",t=>{o=t.x,s=t.y,n=!1}),t.on("pointermove",t=>{if(t.isDown){let e=Math.abs(t.x-o),i=Math.abs(t.y-s);(e>this.DRAG_THRESHOLD||i>this.DRAG_THRESHOLD)&&(n=!0)}}),t.on("pointerup",()=>{n||e(),n=!1}),t.on("pointercancel",()=>{n=!1})}}n.DRAG_THRESHOLD=10;class i{static create(t,e){let{x:o,y:s,width:i,height:r,text:a,backgroundColor:c=2201331,backgroundAlpha:l=.9,strokeColor:h=6600182,strokeWidth:d=3,textColor:m="#fff",fontSize:p,onClick:u}=e,f=t.add.container(0,0),S=t.add.rectangle(o,s,i,r,c,l);S.setStrokeStyle(d,h),S.setInteractive({useHandCursor:!0}),n.setup(S,u);let y=t.add.text(o,s,a,{fontSize:p?"".concat(p,"px"):void 0,color:m,fontStyle:"bold"});return y.setOrigin(.5),y.setInteractive({useHandCursor:!0}),n.setup(y,u),f.add([S,y]),{container:f,background:S,text:y}}}}}]);