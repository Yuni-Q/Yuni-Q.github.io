/*! For license information please see 22559bd3-842dd5561564a5105736.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{VcbP:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return ec})),n.d(e,"b",(function(){return sc})),n.d(e,"c",(function(){return cc})),n.d(e,"d",(function(){return L})),n.d(e,"e",(function(){return rc})),n.d(e,"f",(function(){return nc})),n.d(e,"g",(function(){return oc})),n.d(e,"h",(function(){return ya})),n.d(e,"i",(function(){return va})),n.d(e,"j",(function(){return Ns})),n.d(e,"k",(function(){return pc})),n.d(e,"l",(function(){return _c})),n.d(e,"m",(function(){return vc})),n.d(e,"n",(function(){return bc})),n.d(e,"o",(function(){return uc})),n.d(e,"p",(function(){return wc})),n.d(e,"q",(function(){return mc})),n.d(e,"r",(function(){return dc}));n("E9XD");var r=n("q/0M"),i=n("qOnz"),o=n("x7I3"),u=n("mrSG"),s=function(t,e,n,r,i,o){this.t=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.i=o},a=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"o",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),c=new r.b("@firebase/firestore");function h(){return c.logLevel}function f(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(c.logLevel<=r.a.DEBUG){var i=e.map(d);c.debug.apply(c,Object(u.g)(["Firestore (8.2.6): "+t],i))}}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(c.logLevel<=r.a.ERROR){var i=e.map(d);c.error.apply(c,Object(u.g)(["Firestore (8.2.6): "+t],i))}}function p(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(c.logLevel<=r.a.WARN){var i=e.map(d);c.warn.apply(c,Object(u.g)(["Firestore (8.2.6): "+t],i))}}function d(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function v(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.2.6) INTERNAL ASSERTION FAILED: "+t;throw l(e),new Error(e)}function y(t,e){t||v()}function m(t,e){return t}function b(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var g=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=b(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function w(t,e){return t<e?-1:t>e?1:0}function _(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function I(t){return t+"\0"}var E=function(){function t(t){this.h=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.h,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.h)},t.prototype.l=function(){return 2*this.h.length},t.prototype._=function(t){return w(this.h,t.h)},t.prototype.isEqual=function(t){return this.h===t.h},t}();E.T=new E("");var O={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},T=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(u.c)(e,t),e}(Error),N=function(){function t(t){this.I=t}return t.fromBase64String=function(e){try{return new t(E.fromBase64String(e))}catch(e){throw new T(O.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(E.fromUint8Array(e))},t.prototype.toBase64=function(){return this.I.toBase64()},t.prototype.toUint8Array=function(){return this.I.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this.I.isEqual(t.I)},t}(),j=function(){function t(t){this.uid=t}return t.prototype.m=function(){return null!=this.uid},t.prototype.A=function(){return this.m()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();j.UNAUTHENTICATED=new j(null),j.R=new j("google-credentials-uid"),j.P=new j("first-party-uid");var A=function(t,e){this.user=e,this.type="OAuth",this.g={},this.g.Authorization="Bearer "+t},D=function(){function t(){this.V=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.p=function(){},t.prototype.v=function(t){this.V=t,t(j.UNAUTHENTICATED)},t.prototype.S=function(){this.V=null},t}(),S=function(){function t(t){var e=this;this.D=null,this.currentUser=j.UNAUTHENTICATED,this.C=!1,this.N=0,this.V=null,this.forceRefresh=!1,this.D=function(){e.N++,e.currentUser=e.F(),e.C=!0,e.V&&e.V(e.currentUser)},this.N=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.D):(this.D(null),t.get().then((function(t){e.auth=t,e.D&&e.auth.addAuthTokenListener(e.D)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.N,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.N!==e?(f("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(y("string"==typeof n.accessToken),new A(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.p=function(){this.forceRefresh=!0},t.prototype.v=function(t){this.V=t,this.C&&t(this.currentUser)},t.prototype.S=function(){this.auth&&this.auth.removeAuthTokenListener(this.D),this.D=null,this.V=null},t.prototype.F=function(){var t=this.auth&&this.auth.getUid();return y(null===t||"string"==typeof t),new j(t)},t}(),x=function(){function t(t,e){this.O=t,this.k=e,this.type="FirstParty",this.user=j.P}return Object.defineProperty(t.prototype,"g",{get:function(){var t={"X-Goog-AuthUser":this.k},e=this.O.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),k=function(){function t(t,e){this.O=t,this.k=e}return t.prototype.getToken=function(){return Promise.resolve(new x(this.O,this.k))},t.prototype.v=function(t){t(j.P)},t.prototype.S=function(){},t.prototype.p=function(){},t}(),P=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.M=function(t){return n.L(t)},this.$=function(t){return e.B(t)})}return t.prototype.L=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.$&&this.$(t),t},t}();P.q=-1;var L=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new T(O.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new T(O.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new T(O.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new T(O.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.U=function(t){return this.seconds===t.seconds?w(this.nanoseconds,t.nanoseconds):w(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),V=function(){function t(t){this.timestamp=t}return t.K=function(e){return new t(e)},t.min=function(){return new t(new L(0,0))},t.prototype._=function(t){return this.timestamp.U(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.W=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.j=function(){return this.timestamp},t}(),C=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&v(),void 0===n?n=t.length-e:n>t.length-e&&v(),this.segments=t,this.offset=e,this.G=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.G},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.H(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.J(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.Y=function(t){return t=void 0===t?1:t,this.J(this.segments,this.offset+t,this.length-t)},t.prototype.X=function(){return this.J(this.segments,this.offset,this.length-1)},t.prototype.Z=function(){return this.segments[this.offset]},t.prototype.tt=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.et=function(){return 0===this.length},t.prototype.nt=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.st=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.it=function(){return this.segments.slice(this.offset,this.limit())},t.H=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),R=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.J=function(t,n,r){return new e(t,n,r)},e.prototype.rt=function(){return this.it().join("/")},e.prototype.toString=function(){return this.rt()},e.ot=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var u=o[i];if(u.indexOf("//")>=0)throw new T(O.INVALID_ARGUMENT,"Invalid segment ("+u+"). Paths must not contain // in them.");r.push.apply(r,u.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.ct=function(){return new e([])},e}(C),U=/^[_a-zA-Z][_a-zA-Z0-9]*$/,M=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.J=function(t,n,r){return new e(t,n,r)},e.at=function(t){return U.test(t)},e.prototype.rt=function(){return this.it().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.at(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.rt()},e.prototype.ut=function(){return 1===this.length&&"__name__"===this.get(0)},e.ht=function(){return new e(["__name__"])},e.lt=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new T(O.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},u=!1;i<t.length;){var s=t[i];if("\\"===s){if(i+1===t.length)throw new T(O.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[i+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new T(O.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=a,i+=2}else"`"===s?(u=!u,i++):"."!==s||u?(r+=s,i++):(o(),i++)}if(o(),u)throw new T(O.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.ct=function(){return new e([])},e}(C),q=function(){function t(t){this.path=t}return t._t=function(e){return new t(R.ot(e))},t.ft=function(e){return new t(R.ot(e).Y(5))},t.prototype.dt=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===R.H(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.H=function(t,e){return R.H(t.path,e.path)},t.wt=function(t){return t.length%2==0},t.Et=function(e){return new t(new R(e.slice()))},t}();function F(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function z(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function G(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var B=function(){function t(t){this.fields=t,t.sort(M.H)}return t.prototype.Tt=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].nt(t))return!0;return!1},t.prototype.isEqual=function(t){return _(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),Q=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Y(t){if(y(!!t),"string"==typeof t){var e=0,n=Q.exec(t);if(y(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:H(t.seconds),nanos:H(t.nanos)}}function H(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function K(t){return"string"==typeof t?E.fromBase64String(t):E.fromUint8Array(t)}function X(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function W(t){var e=Y(t.mapValue.fields.__local_write_time__.timestampValue);return new L(e.seconds,e.nanos)}function Z(t){return null==t}function J(t){return 0===t&&1/t==-1/0}function $(t){return"number"==typeof t&&Number.isInteger(t)&&!J(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function tt(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?X(t)?4:10:v()}function et(t,e){var n=tt(t);if(n!==tt(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return W(t).isEqual(W(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Y(t.timestampValue),r=Y(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return K(t.bytesValue).isEqual(K(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return H(t.geoPointValue.latitude)===H(e.geoPointValue.latitude)&&H(t.geoPointValue.longitude)===H(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return H(t.integerValue)===H(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=H(t.doubleValue),r=H(e.doubleValue);return n===r?J(n)===J(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return _(t.arrayValue.values||[],e.arrayValue.values||[],et);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(F(n)!==F(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!et(n[i],r[i])))return!1;return!0}(t,e);default:return v()}}function nt(t,e){return void 0!==(t.values||[]).find((function(t){return et(t,e)}))}function rt(t,e){var n=tt(t),r=tt(e);if(n!==r)return w(n,r);switch(n){case 0:return 0;case 1:return w(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=H(t.integerValue||t.doubleValue),r=H(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return it(t.timestampValue,e.timestampValue);case 4:return it(W(t),W(e));case 5:return w(t.stringValue,e.stringValue);case 6:return function(t,e){var n=K(t),r=K(e);return n._(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=w(n[i],r[i]);if(0!==o)return o}return w(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=w(H(t.latitude),H(e.latitude));return 0!==n?n:w(H(t.longitude),H(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=rt(n[i],r[i]);if(o)return o}return w(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var u=0;u<r.length&&u<o.length;++u){var s=w(r[u],o[u]);if(0!==s)return s;var a=rt(n[r[u]],i[o[u]]);if(0!==a)return a}return w(r.length,o.length)}(t.mapValue,e.mapValue);default:throw v()}}function it(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return w(t,e);var n=Y(t),r=Y(e),i=w(n.seconds,r.seconds);return 0!==i?i:w(n.nanos,r.nanos)}function ot(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=Y(t);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?K(e.bytesValue).toBase64():"referenceValue"in e?(r=e.referenceValue,q.ft(r).toString()):"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++)r?r=!1:n+=",",n+=t(o[i]);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var u=o[i];r?r=!1:n+=",",n+=u+":"+t(e.fields[u])}return n+"}"}(e.mapValue):v();var n,r}(t)}function ut(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.rt()}}function st(t){return!!t&&"integerValue"in t}function at(t){return!!t&&"arrayValue"in t}function ct(t){return!!t&&"nullValue"in t}function ht(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function ft(t){return!!t&&"mapValue"in t}var lt=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.et())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!ft(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.tt()])||null},t.prototype.isEqual=function(t){return et(this.proto,t.proto)},t}(),pt=function(){function t(t){void 0===t&&(t=lt.empty()),this.It=t,this.At=new Map}return t.prototype.set=function(t,e){return this.Rt(t,e),this},t.prototype.delete=function(t){return this.Rt(t,null),this},t.prototype.Rt=function(t,e){for(var n=this.At,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===tt(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.tt(),e)},t.prototype.Pt=function(){var t=this.yt(M.ct(),this.At);return null!=t?new lt(t):this.It},t.prototype.yt=function(t,e){var n=this,r=!1,i=this.It.field(t),o=ft(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var u=n.yt(t.child(i),e);null!=u&&(o[i]=u,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},t}();function dt(t){var e=[];return z(t.fields||{},(function(t,n){var r=new M([t]);if(ft(n)){var i=dt(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,u=i;o<u.length;o++){var s=u[o];e.push(r.child(s))}}else e.push(r)})),new B(e)}var vt=function(t,e){this.key=t,this.version=e},yt=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this,e,n)||this).gt=r,o.Vt=!!i.Vt,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return Object(u.c)(e,t),e.prototype.field=function(t){return this.gt.field(t)},e.prototype.data=function(){return this.gt},e.prototype.bt=function(){return this.gt.proto},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Vt===t.Vt&&this.hasCommittedMutations===t.hasCommittedMutations&&this.gt.isEqual(t.gt)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.gt.toString()+", {hasLocalMutations: "+this.Vt+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.Vt||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e}(vt),mt=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return Object(u.c)(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(vt),bt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(vt),gt=function(t,e,n,r,i,o,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=u,this.vt=null};function wt(t,e,n,r,i,o,u){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===u&&(u=null),new gt(t,e,n,r,i,o,u)}function _t(t){var e=m(t);if(null===e.vt){var n=e.path.rt();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.rt()+t.op.toString()+ot(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.rt()+t.dir}(t)})).join(","),Z(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Lt(e.startAt)),e.endAt&&(n+="|ub:",n+=Lt(e.endAt)),e.vt=n}return e.vt}function It(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Ct(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!et(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Ut(t.startAt,e.startAt)&&Ut(t.endAt,e.endAt)}function Et(t){return q.wt(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Ot=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(u.c)(e,t),e.create=function(t,n,r){return t.ut()?"in"===n||"not-in"===n?this.St(t,n,r):new Tt(t,n,r):"array-contains"===n?new Dt(t,r):"in"===n?new St(t,r):"not-in"===n?new xt(t,r):"array-contains-any"===n?new kt(t,r):new e(t,n,r)},e.St=function(t,e,n){return"in"===e?new Nt(t,n):new jt(t,n)},e.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this.Dt(rt(e,this.value)):null!==e&&tt(this.value)===tt(e)&&this.Dt(rt(e,this.value))},e.prototype.Dt=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return v()}},e.prototype.Ct=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),Tt=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=q.ft(r.referenceValue),i}return Object(u.c)(e,t),e.prototype.matches=function(t){var e=q.H(t.key,this.key);return this.Dt(e)},e}(Ot),Nt=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=At("in",n),r}return Object(u.c)(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Ot),jt=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=At("not-in",n),r}return Object(u.c)(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Ot);function At(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return q.ft(t.referenceValue)}))}var Dt=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(u.c)(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return at(e)&&nt(e.arrayValue,this.value)},e}(Ot),St=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(u.c)(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&nt(this.value.arrayValue,e)},e}(Ot),xt=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(u.c)(e,t),e.prototype.matches=function(t){if(nt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.field(this.field);return null!==e&&!nt(this.value.arrayValue,e)},e}(Ot),kt=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(u.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!at(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return nt(e.value.arrayValue,t)}))},e}(Ot),Pt=function(t,e){this.position=t,this.before=e};function Lt(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return ot(t)})).join(",")}var Vt=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Ct(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Rt(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],u=t.position[i];if(r=o.field.ut()?q.H(q.ft(u.referenceValue),n.key):rt(u,n.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Ut(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!et(t.position[n],e.position[n]))return!1;return!0}var Mt=function(t,e,n,r,i,o,u,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===u&&(u=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.xt=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=u,this.endAt=s,this.Nt=null,this.Ft=null,this.startAt,this.endAt};function qt(t,e,n,r,i,o,u,s){return new Mt(t,e,n,r,i,o,u,s)}function Ft(t){return new Mt(t)}function zt(t){return!Z(t.limit)&&"F"===t.limitType}function Gt(t){return!Z(t.limit)&&"L"===t.limitType}function Bt(t){return t.xt.length>0?t.xt[0].field:null}function Qt(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.Ct())return r.field}return null}function Yt(t){return null!==t.collectionGroup}function Ht(t){var e=m(t);if(null===e.Nt){e.Nt=[];var n=Qt(e),r=Bt(e);if(null!==n&&null===r)n.ut()||e.Nt.push(new Vt(n)),e.Nt.push(new Vt(M.ht(),"asc"));else{for(var i=!1,o=0,u=e.xt;o<u.length;o++){var s=u[o];e.Nt.push(s),s.field.ut()&&(i=!0)}if(!i){var a=e.xt.length>0?e.xt[e.xt.length-1].dir:"asc";e.Nt.push(new Vt(M.ht(),a))}}}return e.Nt}function Kt(t){var e=m(t);if(!e.Ft)if("F"===e.limitType)e.Ft=wt(e.path,e.collectionGroup,Ht(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Ht(e);r<i.length;r++){var o=i[r],u="desc"===o.dir?"asc":"desc";n.push(new Vt(o.field,u))}var s=e.endAt?new Pt(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Pt(e.startAt.position,!e.startAt.before):null;e.Ft=wt(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.Ft}function Xt(t,e,n){return new Mt(t.path,t.collectionGroup,t.xt.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Wt(t,e){return It(Kt(t),Kt(e))&&t.limitType===e.limitType}function Zt(t){return _t(Kt(t))+"|lt:"+t.limitType}function Jt(t){return"Query(target="+function(t){var e=t.path.rt();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.rt()+" "+e.op+" "+ot(e.value);var e})).join(", ")+"]"),Z(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.rt()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Lt(t.startAt)),t.endAt&&(e+=", endAt: "+Lt(t.endAt)),"Target("+e+")"}(Kt(t))+"; limitType="+t.limitType+")"}function $t(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.dt(t.collectionGroup)&&t.path.nt(n):q.wt(t.path)?t.path.isEqual(n):t.path.st(n)}(t,e)&&function(t,e){for(var n=0,r=t.xt;n<r.length;n++){var i=r[n];if(!i.field.ut()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Rt(t.startAt,Ht(t),e)||t.endAt&&Rt(t.endAt,Ht(t),e))}(t,e)}function te(t){return function(e,n){for(var r=!1,i=0,o=Ht(t);i<o.length;i++){var u=o[i],s=ee(u,e,n);if(0!==s)return s;r=r||u.field.ut()}return 0}}function ee(t,e,n){var r=t.field.ut()?q.H(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?rt(r,i):v()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return v()}}var ne=function(){function t(t,e,n,r,i,o,u){void 0===i&&(i=V.min()),void 0===o&&(o=V.min()),void 0===u&&(u=E.T),this.target=t,this.targetId=e,this.Ot=n,this.sequenceNumber=r,this.kt=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u}return t.prototype.Mt=function(e){return new t(this.target,this.targetId,this.Ot,e,this.kt,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.Lt=function(e,n){return new t(this.target,this.targetId,this.Ot,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.$t=function(e){return new t(this.target,this.targetId,this.Ot,this.sequenceNumber,this.kt,e,this.resumeToken)},t}();function re(t,e){if(t.Bt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:J(e)?"-0":e}}function ie(t){return{integerValue:""+t}}function oe(t,e){return $(e)?ie(e):re(t,e)}var ue=function(){this.qt=void 0};function se(t,e,n){return t instanceof he?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof fe?le(t,e):t instanceof pe?de(t,e):function(t,e){var n=ce(t,e),r=ye(n)+ye(t.Ut);return st(n)&&st(t.Ut)?ie(r):re(t.Qt,r)}(t,e)}function ae(t,e,n){return t instanceof fe?le(t,e):t instanceof pe?de(t,e):n}function ce(t,e){return t instanceof ve?st(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var he=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e}(ue),fe=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(u.c)(e,t),e}(ue);function le(t,e){for(var n=me(e),r=function(t){n.some((function(e){return et(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var pe=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(u.c)(e,t),e}(ue);function de(t,e){for(var n=me(e),r=function(t){n=n.filter((function(e){return!et(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ve=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Qt=e,r.Ut=n,r}return Object(u.c)(e,t),e}(ue);function ye(t){return H(t.integerValue||t.doubleValue)}function me(t){return at(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var be=function(t,e){this.field=t,this.transform=e},ge=function(t,e){this.version=t,this.transformResults=e},we=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.Kt=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"Wt",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function _e(t,e){return void 0!==t.updateTime?e instanceof yt&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof yt}var Ie=function(){};function Ee(t,e,n){return t instanceof Ae?function(t,e,n){var r=t.value;if(n.transformResults){var i=xe(t.fieldTransforms,e,n.transformResults);r=Pe(t.fieldTransforms,r,i)}return new yt(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof De?function(t,e,n){if(!_e(t.jt,e))return new bt(t.key,n.version);var r=Se(t,e,n.transformResults?xe(t.fieldTransforms,e,n.transformResults):[]);return new yt(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new mt(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function Oe(t,e,n){return t instanceof Ae?function(t,e,n){if(!_e(t.jt,e))return e;var r=t.value,i=ke(t.fieldTransforms,n,e);r=Pe(t.fieldTransforms,r,i);var o=je(e);return new yt(t.key,o,r,{Vt:!0})}(t,e,n):t instanceof De?function(t,e,n){if(!_e(t.jt,e))return e;var r=je(e),i=Se(t,e,ke(t.fieldTransforms,n,e));return new yt(t.key,r,i,{Vt:!0})}(t,e,n):function(t,e){return _e(t.jt,e)?new mt(t.key,V.min()):e}(t,e)}function Te(t,e){return function(t,e){for(var n=null,r=0,i=t;r<i.length;r++){var o=i[r],u=e instanceof yt?e.field(o.field):void 0,s=ce(o.transform,u||null);null!=s&&(n=null==n?(new pt).set(o.field,s):n.set(o.field,s))}return n?n.Pt():null}(t.fieldTransforms,e)}function Ne(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.jt.isEqual(e.jt)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&_(t,e,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof fe&&e instanceof fe||t instanceof pe&&e instanceof pe?_(t.elements,e.elements,et):t instanceof ve&&e instanceof ve?et(t.Ut,e.Ut):t instanceof he&&e instanceof he}(t.transform,e.transform)}(t,e)}))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.Gt.isEqual(e.Gt))}function je(t){return t instanceof yt?t.version:V.min()}var Ae=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.jt=r,o.fieldTransforms=i,o.type=0,o}return Object(u.c)(e,t),e}(Ie),De=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var u=this;return(u=t.call(this)||this).key=e,u.data=n,u.Gt=r,u.jt=i,u.fieldTransforms=o,u.type=1,u}return Object(u.c)(e,t),e}(Ie);function Se(t,e,n){var r;return r=function(t,e){var n=new pt(e);return t.Gt.fields.forEach((function(e){if(!e.et()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}})),n.Pt()}(t,r=e instanceof yt?e.data():lt.empty()),Pe(t.fieldTransforms,r,n)}function xe(t,e,n){var r=[];y(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],u=o.transform,s=null;e instanceof yt&&(s=e.field(o.field)),r.push(ae(u,s,n[i]))}return r}function ke(t,e,n){for(var r=[],i=0,o=t;i<o.length;i++){var u=o[i],s=u.transform,a=null;n instanceof yt&&(a=n.field(u.field)),r.push(se(s,a,e))}return r}function Pe(t,e,n){for(var r=new pt(e),i=0;i<t.length;i++){var o=t[i];r.set(o.field,n[i])}return r.Pt()}var Le,Ve,Ce=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.jt=n,r.type=2,r.fieldTransforms=[],r}return Object(u.c)(e,t),e}(Ie),Re=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.jt=n,r.type=3,r.fieldTransforms=[],r}return Object(u.c)(e,t),e}(Ie),Ue=function(t){this.count=t};function Me(t){switch(t){case O.OK:return v();case O.CANCELLED:case O.UNKNOWN:case O.DEADLINE_EXCEEDED:case O.RESOURCE_EXHAUSTED:case O.INTERNAL:case O.UNAVAILABLE:case O.UNAUTHENTICATED:return!1;case O.INVALID_ARGUMENT:case O.NOT_FOUND:case O.ALREADY_EXISTS:case O.PERMISSION_DENIED:case O.FAILED_PRECONDITION:case O.ABORTED:case O.OUT_OF_RANGE:case O.UNIMPLEMENTED:case O.DATA_LOSS:return!0;default:return v()}}function qe(t){if(void 0===t)return l("GRPC error has no .code"),O.UNKNOWN;switch(t){case Le.OK:return O.OK;case Le.CANCELLED:return O.CANCELLED;case Le.UNKNOWN:return O.UNKNOWN;case Le.DEADLINE_EXCEEDED:return O.DEADLINE_EXCEEDED;case Le.RESOURCE_EXHAUSTED:return O.RESOURCE_EXHAUSTED;case Le.INTERNAL:return O.INTERNAL;case Le.UNAVAILABLE:return O.UNAVAILABLE;case Le.UNAUTHENTICATED:return O.UNAUTHENTICATED;case Le.INVALID_ARGUMENT:return O.INVALID_ARGUMENT;case Le.NOT_FOUND:return O.NOT_FOUND;case Le.ALREADY_EXISTS:return O.ALREADY_EXISTS;case Le.PERMISSION_DENIED:return O.PERMISSION_DENIED;case Le.FAILED_PRECONDITION:return O.FAILED_PRECONDITION;case Le.ABORTED:return O.ABORTED;case Le.OUT_OF_RANGE:return O.OUT_OF_RANGE;case Le.UNIMPLEMENTED:return O.UNIMPLEMENTED;case Le.DATA_LOSS:return O.DATA_LOSS;default:return v()}}(Ve=Le||(Le={}))[Ve.OK=0]="OK",Ve[Ve.CANCELLED=1]="CANCELLED",Ve[Ve.UNKNOWN=2]="UNKNOWN",Ve[Ve.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ve[Ve.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ve[Ve.NOT_FOUND=5]="NOT_FOUND",Ve[Ve.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ve[Ve.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ve[Ve.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ve[Ve.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ve[Ve.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ve[Ve.ABORTED=10]="ABORTED",Ve[Ve.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ve[Ve.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ve[Ve.INTERNAL=13]="INTERNAL",Ve[Ve.UNAVAILABLE=14]="UNAVAILABLE",Ve[Ve.DATA_LOSS=15]="DATA_LOSS";var Fe=function(){function t(t,e){this.H=t,this.root=e||Ge.EMPTY}return t.prototype.zt=function(e,n){return new t(this.H,this.root.zt(e,n,this.H).copy(null,null,Ge.Ht,null,null))},t.prototype.remove=function(e){return new t(this.H,this.root.remove(e,this.H).copy(null,null,Ge.Ht,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.et();){var n=this.H(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.et();){var r=this.H(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.et=function(){return this.root.et()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.Jt=function(){return this.root.Jt()},t.prototype.Yt=function(){return this.root.Yt()},t.prototype.Xt=function(t){return this.root.Xt(t)},t.prototype.forEach=function(t){this.Xt((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.Xt((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.Zt=function(t){return this.root.Zt(t)},t.prototype.te=function(){return new ze(this.root,null,this.H,!1)},t.prototype.ee=function(t){return new ze(this.root,t,this.H,!1)},t.prototype.ne=function(){return new ze(this.root,null,this.H,!0)},t.prototype.se=function(t){return new ze(this.root,t,this.H,!0)},t}(),ze=function(){function t(t,e,n,r){this.ie=r,this.re=[];for(var i=1;!t.et();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.ie?t.left:t.right;else{if(0===i){this.re.push(t);break}this.re.push(t),t=this.ie?t.right:t.left}}return t.prototype.oe=function(){var t=this.re.pop(),e={key:t.key,value:t.value};if(this.ie)for(t=t.left;!t.et();)this.re.push(t),t=t.right;else for(t=t.right;!t.et();)this.re.push(t),t=t.left;return e},t.prototype.ce=function(){return this.re.length>0},t.prototype.ae=function(){if(0===this.re.length)return null;var t=this.re[this.re.length-1];return{key:t.key,value:t.value}},t}(),Ge=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.et=function(){return!1},t.prototype.Xt=function(t){return this.left.Xt(t)||t(this.key,this.value)||this.right.Xt(t)},t.prototype.Zt=function(t){return this.right.Zt(t)||t(this.key,this.value)||this.left.Zt(t)},t.prototype.min=function(){return this.left.et()?this:this.left.min()},t.prototype.Jt=function(){return this.min().key},t.prototype.Yt=function(){return this.right.et()?this.key:this.right.Yt()},t.prototype.zt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.zt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.zt(t,e,n))).ue()},t.prototype.he=function(){if(this.left.et())return t.EMPTY;var e=this;return e.left.le()||e.left.left.le()||(e=e._e()),(e=e.copy(null,null,null,e.left.he(),null)).ue()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.et()||i.left.le()||i.left.left.le()||(i=i._e()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.le()&&(i=i.fe()),i.right.et()||i.right.le()||i.right.left.le()||(i=i.de()),0===n(e,i.key)){if(i.right.et())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.he())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.ue()},t.prototype.le=function(){return this.color},t.prototype.ue=function(){var t=this;return t.right.le()&&!t.left.le()&&(t=t.we()),t.left.le()&&t.left.left.le()&&(t=t.fe()),t.left.le()&&t.right.le()&&(t=t.Ee()),t},t.prototype._e=function(){var t=this.Ee();return t.right.left.le()&&(t=(t=(t=t.copy(null,null,null,null,t.right.fe())).we()).Ee()),t},t.prototype.de=function(){var t=this.Ee();return t.left.left.le()&&(t=(t=t.fe()).Ee()),t},t.prototype.we=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.fe=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.Ee=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.Te=function(){var t=this.Ie();return Math.pow(2,t)<=this.size+1},t.prototype.Ie=function(){if(this.le()&&this.left.le())throw v();if(this.right.le())throw v();var t=this.left.Ie();if(t!==this.right.Ie())throw v();return t+(this.le()?0:1)},t}();Ge.EMPTY=null,Ge.RED=!0,Ge.Ht=!1,Ge.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw v()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.zt=function(t,e,n){return new Ge(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.et=function(){return!0},t.prototype.Xt=function(t){return!1},t.prototype.Zt=function(t){return!1},t.prototype.Jt=function(){return null},t.prototype.Yt=function(){return null},t.prototype.le=function(){return!1},t.prototype.Te=function(){return!0},t.prototype.Ie=function(){return 0},t}());var Be=function(){function t(t){this.H=t,this.data=new Fe(this.H)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.Jt()},t.prototype.last=function(){return this.data.Yt()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.Xt((function(e,n){return t(e),!1}))},t.prototype.me=function(t,e){for(var n=this.data.ee(t[0]);n.ce();){var r=n.oe();if(this.H(r.key,t[1])>=0)return;e(r.key)}},t.prototype.Ae=function(t,e){var n;for(n=void 0!==e?this.data.ee(e):this.data.te();n.ce();)if(!t(n.oe().key))return},t.prototype.Re=function(t){var e=this.data.ee(t);return e.ce()?e.oe().key:null},t.prototype.te=function(){return new Qe(this.data.te())},t.prototype.ee=function(t){return new Qe(this.data.ee(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).zt(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.et=function(){return this.data.et()},t.prototype.Pe=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.te(),r=e.data.te();n.ce();){var i=n.oe().key,o=r.oe().key;if(0!==this.H(i,o))return!1}return!0},t.prototype.it=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.H);return n.data=e,n},t}(),Qe=function(){function t(t){this.ye=t}return t.prototype.oe=function(){return this.ye.oe().key},t.prototype.ce=function(){return this.ye.ce()},t}(),Ye=new Fe(q.H);function He(){return Ye}function Ke(){return He()}var Xe=new Fe(q.H);function We(){return Xe}var Ze=new Fe(q.H);function Je(){return Ze}var $e=new Be(q.H);function tn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=$e,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var en=new Be(w);function nn(){return en}var rn=function(){function t(t){this.H=t?function(e,n){return t(e,n)||q.H(e.key,n.key)}:function(t,e){return q.H(t.key,e.key)},this.ge=We(),this.Ve=new Fe(this.H)}return t.pe=function(e){return new t(e.H)},t.prototype.has=function(t){return null!=this.ge.get(t)},t.prototype.get=function(t){return this.ge.get(t)},t.prototype.first=function(){return this.Ve.Jt()},t.prototype.last=function(){return this.Ve.Yt()},t.prototype.et=function(){return this.Ve.et()},t.prototype.indexOf=function(t){var e=this.ge.get(t);return e?this.Ve.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.Ve.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.Ve.Xt((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.ge.zt(t.key,t),e.Ve.zt(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.ge.remove(t),this.Ve.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.Ve.te(),r=e.Ve.te();n.ce();){var i=n.oe().key,o=r.oe().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.H=this.H,r.ge=e,r.Ve=n,r},t}(),on=function(){function t(){this.be=new Fe(q.H)}return t.prototype.track=function(t){var e=t.doc.key,n=this.be.get(e);n?0!==t.type&&3===n.type?this.be=this.be.zt(e,t):3===t.type&&1!==n.type?this.be=this.be.zt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.be=this.be.zt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.be=this.be.zt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.be=this.be.remove(e):1===t.type&&2===n.type?this.be=this.be.zt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.be=this.be.zt(e,{type:2,doc:t.doc}):v():this.be=this.be.zt(e,t)},t.prototype.ve=function(){var t=[];return this.be.Xt((function(e,n){t.push(n)})),t},t}(),un=function(){function t(t,e,n,r,i,o,u,s){this.query=t,this.docs=e,this.Se=n,this.docChanges=r,this.De=i,this.fromCache=o,this.Ce=u,this.xe=s}return t.Ne=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,rn.pe(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.De.et()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Ce===t.Ce&&this.De.isEqual(t.De)&&Wt(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Se.isEqual(t.Se)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),sn=function(){function t(t,e,n,r,i){this.kt=t,this.Fe=e,this.Oe=n,this.ke=r,this.Me=i}return t.Le=function(e,n){var r=new Map;return r.set(e,an.$e(e,n)),new t(V.min(),r,nn(),He(),tn())},t}(),an=function(){function t(t,e,n,r,i){this.resumeToken=t,this.Be=e,this.qe=n,this.Ue=r,this.Qe=i}return t.$e=function(e,n){return new t(E.T,n,tn(),tn(),tn())},t}(),cn=function(t,e,n,r){this.Ke=t,this.removedTargetIds=e,this.key=n,this.We=r},hn=function(t,e){this.targetId=t,this.je=e},fn=function(t,e,n,r){void 0===n&&(n=E.T),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},ln=function(){function t(){this.Ge=0,this.ze=vn(),this.He=E.T,this.Je=!1,this.Ye=!0}return Object.defineProperty(t.prototype,"Be",{get:function(){return this.Je},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.He},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Xe",{get:function(){return 0!==this.Ge},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Ze",{get:function(){return this.Ye},enumerable:!1,configurable:!0}),t.prototype.tn=function(t){t.l()>0&&(this.Ye=!0,this.He=t)},t.prototype.en=function(){var t=tn(),e=tn(),n=tn();return this.ze.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:v()}})),new an(this.He,this.Je,t,e,n)},t.prototype.nn=function(){this.Ye=!1,this.ze=vn()},t.prototype.sn=function(t,e){this.Ye=!0,this.ze=this.ze.zt(t,e)},t.prototype.rn=function(t){this.Ye=!0,this.ze=this.ze.remove(t)},t.prototype.on=function(){this.Ge+=1},t.prototype.cn=function(){this.Ge-=1},t.prototype.an=function(){this.Ye=!0,this.Je=!0},t}(),pn=function(){function t(t){this.un=t,this.hn=new Map,this.ln=He(),this._n=dn(),this.fn=new Be(w)}return t.prototype.dn=function(t){for(var e=0,n=t.Ke;e<n.length;e++){var r=n[e];t.We instanceof yt?this.wn(r,t.We):t.We instanceof mt&&this.En(r,t.key,t.We)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.En(r,t.key,t.We)},t.prototype.Tn=function(t){var e=this;this.In(t,(function(n){var r=e.mn(n);switch(t.state){case 0:e.An(n)&&r.tn(t.resumeToken);break;case 1:r.cn(),r.Xe||r.nn(),r.tn(t.resumeToken);break;case 2:r.cn(),r.Xe||e.removeTarget(n);break;case 3:e.An(n)&&(r.an(),r.tn(t.resumeToken));break;case 4:e.An(n)&&(e.Rn(n),r.tn(t.resumeToken));break;default:v()}}))},t.prototype.In=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.hn.forEach((function(t,r){n.An(r)&&e(r)}))},t.prototype.Pn=function(t){var e=t.targetId,n=t.je.count,r=this.yn(e);if(r){var i=r.target;if(Et(i))if(0===n){var o=new q(i.path);this.En(e,o,new mt(o,V.min()))}else y(1===n);else this.gn(e)!==n&&(this.Rn(e),this.fn=this.fn.add(e))}},t.prototype.Vn=function(t){var e=this,n=new Map;this.hn.forEach((function(r,i){var o=e.yn(i);if(o){if(r.Be&&Et(o.target)){var u=new q(o.target.path);null!==e.ln.get(u)||e.pn(i,u)||e.En(i,u,new mt(u,t))}r.Ze&&(n.set(i,r.en()),r.nn())}}));var r=tn();this._n.forEach((function(t,n){var i=!0;n.Ae((function(t){var n=e.yn(t);return!n||2===n.Ot||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new sn(t,n,this.fn,this.ln,r);return this.ln=He(),this._n=dn(),this.fn=new Be(w),i},t.prototype.wn=function(t,e){if(this.An(t)){var n=this.pn(t,e.key)?2:0;this.mn(t).sn(e.key,n),this.ln=this.ln.zt(e.key,e),this._n=this._n.zt(e.key,this.bn(e.key).add(t))}},t.prototype.En=function(t,e,n){if(this.An(t)){var r=this.mn(t);this.pn(t,e)?r.sn(e,1):r.rn(e),this._n=this._n.zt(e,this.bn(e).delete(t)),n&&(this.ln=this.ln.zt(e,n))}},t.prototype.removeTarget=function(t){this.hn.delete(t)},t.prototype.gn=function(t){var e=this.mn(t).en();return this.un.vn(t).size+e.qe.size-e.Qe.size},t.prototype.on=function(t){this.mn(t).on()},t.prototype.mn=function(t){var e=this.hn.get(t);return e||(e=new ln,this.hn.set(t,e)),e},t.prototype.bn=function(t){var e=this._n.get(t);return e||(e=new Be(w),this._n=this._n.zt(t,e)),e},t.prototype.An=function(t){var e=null!==this.yn(t);return e||f("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.yn=function(t){var e=this.hn.get(t);return e&&e.Xe?null:this.un.Sn(t)},t.prototype.Rn=function(t){var e=this;this.hn.set(t,new ln),this.un.vn(t).forEach((function(n){e.En(t,n,null)}))},t.prototype.pn=function(t,e){return this.un.vn(t).has(e)},t}();function dn(){return new Fe(q.H)}function vn(){return new Fe(q.H)}var yn={asc:"ASCENDING",desc:"DESCENDING"},mn={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},bn=function(t,e){this.t=t,this.Bt=e};function gn(t,e){return t.Bt?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function wn(t,e){return t.Bt?e.toBase64():e.toUint8Array()}function _n(t,e){return gn(t,e.j())}function In(t){return y(!!t),V.K(function(t){var e=Y(t);return new L(e.seconds,e.nanos)}(t))}function En(t,e){return function(t){return new R(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).rt()}function On(t){var e=R.ot(t);return y(Hn(e)),e}function Tn(t,e){return En(t.t,e.path)}function Nn(t,e){var n=On(e);if(n.get(1)!==t.t.projectId)throw new T(O.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.t.projectId);if(n.get(3)!==t.t.database)throw new T(O.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.t.database);return new q(Sn(n))}function jn(t,e){return En(t.t,e)}function An(t){var e=On(t);return 4===e.length?R.ct():Sn(e)}function Dn(t){return new R(["projects",t.t.projectId,"databases",t.t.database]).rt()}function Sn(t){return y(t.length>4&&"documents"===t.get(4)),t.Y(5)}function xn(t,e,n){return{name:Tn(t,e),fields:n.proto.mapValue.fields}}function kn(t,e,n){var r=Nn(t,e.name),i=In(e.updateTime),o=new lt({mapValue:{fields:e.fields}});return new yt(r,i,o,{hasCommittedMutations:!!n})}function Pn(t,e){var n;if(e instanceof Ae)n={update:xn(t,e.key,e.value)};else if(e instanceof Ce)n={delete:Tn(t,e.key)};else if(e instanceof De)n={update:xn(t,e.key,e.data),updateMask:Yn(e.Gt)};else{if(!(e instanceof Re))return v();n={verify:Tn(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof he)return{fieldPath:e.field.rt(),setToServerValue:"REQUEST_TIME"};if(n instanceof fe)return{fieldPath:e.field.rt(),appendMissingElements:{values:n.elements}};if(n instanceof pe)return{fieldPath:e.field.rt(),removeAllFromArray:{values:n.elements}};if(n instanceof ve)return{fieldPath:e.field.rt(),increment:n.Ut};throw v()}(0,t)}))),e.jt.Wt||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:_n(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:v()}(t,e.jt)),n}function Ln(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?we.updateTime(In(t.updateTime)):void 0!==t.exists?we.exists(t.exists):we.Kt()}(e.currentDocument):we.Kt(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)y("REQUEST_TIME"===e.setToServerValue),n=new he;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new fe(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new pe(i)}else"increment"in e?n=new ve(t,e.increment):v();var o=M.lt(e.fieldPath);return new be(o,n)}(t,e)})):[];if(e.update){e.update.name;var i=Nn(t,e.update.name),o=new lt({mapValue:{fields:e.update.fields}});if(e.updateMask){var u=function(t){var e=t.fieldPaths||[];return new B(e.map((function(t){return M.lt(t)})))}(e.updateMask);return new De(i,o,u,n,r)}return new Ae(i,o,n,r)}if(e.delete){var s=Nn(t,e.delete);return new Ce(s,n)}if(e.verify){var a=Nn(t,e.verify);return new Re(a,n)}return v()}function Vn(t,e){return{documents:[jn(t,e.path)]}}function Cn(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=jn(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=jn(t,r.X()),n.structuredQuery.from=[{collectionId:r.tt()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(ht(t.value))return{unaryFilter:{field:zn(t.field),op:"IS_NAN"}};if(ct(t.value))return{unaryFilter:{field:zn(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ht(t.value))return{unaryFilter:{field:zn(t.field),op:"IS_NOT_NAN"}};if(ct(t.value))return{unaryFilter:{field:zn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:zn(t.field),op:Fn(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:zn(t.field),direction:qn(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var u=function(t,e){return t.Bt||Z(e)?e:{value:e}}(t,e.limit);return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=Un(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Un(e.endAt)),n}function Rn(t){var e=An(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){y(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var u=[];n.where&&(u=function t(e){return e?void 0!==e.unaryFilter?[Qn(e)]:void 0!==e.fieldFilter?[Bn(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):v():[]}(n.where));var s=[];n.orderBy&&(s=n.orderBy.map((function(t){return function(t){return new Vt(Gn(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var a=null;n.limit&&(a=function(t){var e;return Z(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Mn(n.startAt));var h=null;return n.endAt&&(h=Mn(n.endAt)),qt(e,i,s,u,a,"F",c,h)}function Un(t){return{before:t.before,values:t.position}}function Mn(t){var e=!!t.before,n=t.values||[];return new Pt(n,e)}function qn(t){return yn[t]}function Fn(t){return mn[t]}function zn(t){return{fieldPath:t.rt()}}function Gn(t){return M.lt(t.fieldPath)}function Bn(t){return Ot.create(Gn(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return v()}}(t.fieldFilter.op),t.fieldFilter.value)}function Qn(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Gn(t.unaryFilter.field);return Ot.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Gn(t.unaryFilter.field);return Ot.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Gn(t.unaryFilter.field);return Ot.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Gn(t.unaryFilter.field);return Ot.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return v()}}function Yn(t){var e=[];return t.fields.forEach((function(t){return e.push(t.rt())})),{fieldPaths:e}}function Hn(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}var Kn=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},Xn=function(){function t(t){var e=this;this.Dn=null,this.Cn=null,this.result=void 0,this.error=void 0,this.xn=!1,this.Nn=!1,t((function(t){e.xn=!0,e.result=t,e.Dn&&e.Dn(t)}),(function(t){e.xn=!0,e.error=t,e.Cn&&e.Cn(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.Nn&&v(),this.Nn=!0,this.xn?this.error?this.Fn(n,this.error):this.On(e,this.result):new t((function(t,i){r.Dn=function(n){r.On(e,n).next(t,i)},r.Cn=function(e){r.Fn(n,e).next(t,i)}}))},t.prototype.kn=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.Mn=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.On=function(e,n){return e?this.Mn((function(){return e(n)})):t.resolve(n)},t.prototype.Fn=function(e,n){return e?this.Mn((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.Ln=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.$n=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.Ln(r)},t}(),Wn=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.Bn=new Kn,this.transaction.oncomplete=function(){n.Bn.resolve()},this.transaction.onabort=function(){e.error?n.Bn.reject(new $n(t,e.error)):n.Bn.resolve()},this.transaction.onerror=function(e){var r=ir(e.target.error);n.Bn.reject(new $n(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new $n(n,e)}},Object.defineProperty(t.prototype,"qn",{get:function(){return this.Bn.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.Bn.reject(t),this.aborted||(f("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new er(e)},t}(),Zn=function(){function e(t,n,r){this.name=t,this.version=n,this.Un=r,12.2===e.Qn(Object(i.m)())&&l("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.delete=function(t){return f("SimpleDb","Removing database:",t),nr(window.indexedDB.deleteDatabase(t)).kn()},e.Kn=function(){if("undefined"==typeof indexedDB)return!1;if(e.Wn())return!0;var t=Object(i.m)(),n=e.Qn(t),r=0<n&&n<10,o=e.jn(t),u=0<o&&o<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||u)},e.Wn=function(){var e;return void 0!==t&&"YES"===(null===(e={})||void 0===e?void 0:e.Gn)},e.zn=function(t,e){return t.store(e)},e.Qn=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},e.jn=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},e.prototype.Hn=function(t){return Object(u.b)(this,void 0,void 0,(function(){var e,n=this;return Object(u.d)(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(f("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new $n(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new T(O.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new $n(t,n))},i.onupgradeneeded=function(t){f("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.Un.Jn(e,i.transaction,t.oldVersion,n.version).next((function(){f("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.Yn&&(this.db.onversionchange=function(t){return n.Yn(t)}),this.db)]}}))}))},e.prototype.Xn=function(t){this.Yn=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},e.prototype.runTransaction=function(t,e,n,r){return Object(u.b)(this,void 0,void 0,(function(){var i,o,s,a,c;return Object(u.d)(this,(function(h){switch(h.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,c,h,l;return Object(u.d)(this,(function(u){switch(u.label){case 0:++o,u.label=1;case 1:return u.trys.push([1,4,,5]),[4,a.Hn(t)];case 2:return a.db=u.sent(),e=Wn.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch((function(t){return e.abort(t),Xn.reject(t)})).kn(),c={},s.catch((function(){})),[4,e.qn];case 3:return[2,(c.value=(u.sent(),s),c)];case 4:return h=u.sent(),l="FirebaseError"!==h.name&&o<3,f("SimpleDb","Transaction failed with error:",h.message,"Retrying:",l),a.close(),l?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}}))},a=this,h.label=1;case 1:return[5,s()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}}))}))},e.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},e}(),Jn=function(){function t(t){this.Zn=t,this.ts=!1,this.es=null}return Object.defineProperty(t.prototype,"xn",{get:function(){return this.ts},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ns",{get:function(){return this.es},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Zn=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.ts=!0},t.prototype.ss=function(t){this.es=t},t.prototype.delete=function(){return nr(this.Zn.delete())},t}(),$n=function(t){function e(e,n){var r=this;return(r=t.call(this,O.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(u.c)(e,t),e}(T);function tr(t){return"IndexedDbTransactionError"===t.name}var er=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(f("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(f("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),nr(n)},t.prototype.add=function(t){return f("SimpleDb","ADD",this.store.name,t,t),nr(this.store.add(t))},t.prototype.get=function(t){var e=this;return nr(this.store.get(t)).next((function(n){return void 0===n&&(n=null),f("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return f("SimpleDb","DELETE",this.store.name,t),nr(this.store.delete(t))},t.prototype.count=function(){return f("SimpleDb","COUNT",this.store.name),nr(this.store.count())},t.prototype.rs=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.os(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.cs=function(t,e){f("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.us=!1;var r=this.cursor(n);return this.os(r,(function(t,e,n){return n.delete()}))},t.prototype.hs=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.os(r,e)},t.prototype.ls=function(t){var e=this.cursor({});return new Xn((function(n,r){e.onerror=function(t){var e=ir(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.os=function(t,e){var n=[];return new Xn((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Jn(i),u=e(i.primaryKey,i.value,o);if(u instanceof Xn){var s=u.catch((function(t){return o.done(),Xn.reject(t)}));n.push(s)}o.xn?r():null===o.ns?i.continue():i.continue(o.ns)}else r()}})).next((function(){return Xn.Ln(n)}))},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.us?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function nr(t){return new Xn((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=ir(t.target.error);n(e)}}))}var rr=!1;function ir(t){var e=Zn.Qn(Object(i.m)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new T("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return rr||(rr=!0,setTimeout((function(){throw r}),0)),r}}return t}var or=function(){function t(t,e,n,r,i){this._s=t,this.fs=e,this.ds=n,this.op=r,this.ws=i,this.Es=new Kn,this.then=this.Es.promise.then.bind(this.Es.promise),this.Es.promise.catch((function(t){}))}return t.Ts=function(e,n,r,i,o){var u=new t(e,n,Date.now()+r,i,o);return u.start(r),u},t.prototype.start=function(t){var e=this;this.Is=setTimeout((function(){return e.As()}),t)},t.prototype.Rs=function(){return this.As()},t.prototype.cancel=function(t){null!==this.Is&&(this.clearTimeout(),this.Es.reject(new T(O.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.As=function(){var t=this;this._s.Ps((function(){return null!==t.Is?(t.clearTimeout(),t.op().then((function(e){return t.Es.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.Is&&(this.ws(this),clearTimeout(this.Is),this.Is=null)},t}();function ur(t,e){if(l("AsyncQueue",e+": "+t),tr(t))return new T(O.UNAVAILABLE,e+": "+t);throw t}var sr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ar=function(){function t(){this.ys=[]}return t.prototype.gs=function(t){this.ys.push(t)},t.prototype.Vs=function(){this.ys.forEach((function(t){return t()}))},t}();function cr(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=fr(e)),e=hr(t.get(n),e);return fr(e)}function hr(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function fr(t){return t+""}function lr(t){var e=t.length;if(y(e>=2),2===e)return y(""===t.charAt(0)&&""===t.charAt(1)),R.ct();for(var n=e-2,r=[],i="",o=0;o<e;){var u=t.indexOf("",o);switch((u<0||u>n)&&v(),t.charAt(u+1)){case"":var s=t.substring(o,u),a=void 0;0===i.length?a=s:(a=i+=s,i=""),r.push(a);break;case"":i+=t.substring(o,u),i+="\0";break;case"":i+=t.substring(o,u+1);break;default:v()}o=u+2}return new R(r)}var pr=function(t,e){this.seconds=t,this.nanoseconds=e},dr=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};dr.store="owner",dr.key="owner";var vr=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};vr.store="mutationQueues",vr.keyPath="userId";var yr=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};yr.store="mutations",yr.keyPath="batchId",yr.userMutationsIndex="userMutationsIndex",yr.userMutationsKeyPath=["userId","batchId"];var mr=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,cr(e)]},t.key=function(t,e,n){return[t,cr(e),n]},t}();mr.store="documentMutations",mr.PLACEHOLDER=new mr;var br=function(t,e){this.path=t,this.readTime=e},gr=function(t,e){this.path=t,this.version=e},wr=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};wr.store="remoteDocuments",wr.readTimeIndex="readTimeIndex",wr.readTimeIndexPath="readTime",wr.collectionReadTimeIndex="collectionReadTimeIndex",wr.collectionReadTimeIndexPath=["parentPath","readTime"];var _r=function(t){this.byteSize=t};_r.store="remoteDocumentGlobal",_r.key="remoteDocumentGlobalKey";var Ir=function(t,e,n,r,i,o,u){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=u};Ir.store="targets",Ir.keyPath="targetId",Ir.queryTargetsIndexName="queryTargetsIndex",Ir.queryTargetsKeyPath=["canonicalId","targetId"];var Er=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Er.store="targetDocuments",Er.keyPath=["targetId","path"],Er.documentTargetsIndex="documentTargetsIndex",Er.documentTargetsKeyPath=["path","targetId"];var Or=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Or.key="targetGlobalKey",Or.store="targetGlobal";var Tr=function(t,e){this.collectionId=t,this.parent=e};Tr.store="collectionParents",Tr.keyPath=["collectionId","parent"];var Nr=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Nr.store="clientMetadata",Nr.keyPath="clientId";var jr=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};jr.store="bundles",jr.keyPath="bundleId";var Ar=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Ar.store="namedQueries",Ar.keyPath="name";var Dr=Object(u.g)(Object(u.g)(Object(u.g)(Object(u.g)([vr.store,yr.store,mr.store,wr.store,Ir.store,dr.store,Or.store,Er.store],[Nr.store]),[_r.store]),[Tr.store]),[jr.store,Ar.store]),Sr=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).ps=e,r.bs=n,r}return Object(u.c)(e,t),e}(ar);function xr(t,e){var n=m(t);return Zn.zn(n.ps,e)}var kr=function(){function t(t,e,n,r){this.batchId=t,this.vs=e,this.baseMutations=n,this.mutations=r}return t.prototype.Ss=function(t,e,n){for(var r=n.Ds,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=Ee(o,e,r[i]))}return e},t.prototype.Cs=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++)(u=r[n]).key.isEqual(t)&&(e=Oe(u,e,this.vs));for(var i=0,o=this.mutations;i<o.length;i++){var u;(u=o[i]).key.isEqual(t)&&(e=Oe(u,e,this.vs))}return e},t.prototype.xs=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.Cs(r.key,t.get(r.key));i&&(n=n.zt(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),tn())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&_(this.mutations,t.mutations,(function(t,e){return Ne(t,e)}))&&_(this.baseMutations,t.baseMutations,(function(t,e){return Ne(t,e)}))},t}(),Pr=function(){function t(t,e,n,r){this.batch=t,this.Ns=e,this.Ds=n,this.Fs=r}return t.from=function(e,n,r){y(e.mutations.length===r.length);for(var i=Je(),o=e.mutations,u=0;u<o.length;u++)i=i.zt(o[u].key,r[u].version);return new t(e,n,r,i)},t}(),Lr=function(t){this.Os=t};function Vr(t,e){if(e.document)return kn(t.Os,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=q.Et(e.noDocument.path),r=qr(e.noDocument.readTime);return new mt(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=q.Et(e.unknownDocument.path);return r=qr(e.unknownDocument.version),new bt(i,r)}return v()}function Cr(t,e,n){var r=Rr(n),i=e.key.path.X().it();if(e instanceof yt){var o=function(t,e){return{name:Tn(t,e.key),fields:e.bt().mapValue.fields,updateTime:gn(t,e.version.j())}}(t.Os,e),u=e.hasCommittedMutations;return new wr(null,null,o,u,r,i)}if(e instanceof mt){var s=e.key.path.it(),a=Mr(e.version);return u=e.hasCommittedMutations,new wr(null,new br(s,a),null,u,r,i)}if(e instanceof bt){var c=e.key.path.it(),h=Mr(e.version);return new wr(new gr(c,h),null,null,!0,r,i)}return v()}function Rr(t){var e=t.j();return[e.seconds,e.nanoseconds]}function Ur(t){var e=new L(t[0],t[1]);return V.K(e)}function Mr(t){var e=t.j();return new pr(e.seconds,e.nanoseconds)}function qr(t){var e=new L(t.seconds,t.nanoseconds);return V.K(e)}function Fr(t,e){for(var n=(e.baseMutations||[]).map((function(e){return Ln(t.Os,e)})),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var u=e.mutations.map((function(e){return Ln(t.Os,e)})),s=L.fromMillis(e.localWriteTimeMs);return new kr(e.batchId,s,n,u)}function zr(t){var e,n,r=qr(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?qr(t.lastLimboFreeSnapshotVersion):V.min();return void 0!==t.query.documents?(y(1===(n=t.query).documents.length),e=Kt(Ft(An(n.documents[0])))):e=function(t){return Kt(Rn(t))}(t.query),new ne(e,t.targetId,0,t.lastListenSequenceNumber,r,i,E.fromBase64String(t.resumeToken))}function Gr(t,e){var n,r=Mr(e.kt),i=Mr(e.lastLimboFreeSnapshotVersion);n=Et(e.target)?Vn(t.Os,e.target):Cn(t.Os,e.target);var o=e.resumeToken.toBase64();return new Ir(e.targetId,_t(e.target),r,o,e.sequenceNumber,i,n)}function Br(t){var e=Rn({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Xt(e,e.limit,"L"):e}var Qr=function(){function t(){}return t.prototype.ks=function(t,e){return Yr(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:qr(e.createTime),version:e.version};var e}))},t.prototype.Ms=function(t,e){return Yr(t).put({bundleId:(n=e).id,createTime:Mr(In(n.createTime)),version:n.version});var n},t.prototype.Ls=function(t,e){return Hr(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Br(e.bundledQuery),readTime:qr(e.readTime)};var e}))},t.prototype.$s=function(t,e){return Hr(t).put(function(t){return{name:t.name,readTime:Mr(In(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Yr(t){return xr(t,jr.store)}function Hr(t){return xr(t,Ar.store)}var Kr=function(){function t(){this.Bs=new Xr}return t.prototype.qs=function(t,e){return this.Bs.add(e),Xn.resolve()},t.prototype.Us=function(t,e){return Xn.resolve(this.Bs.getEntries(e))},t}(),Xr=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.tt(),n=t.X(),r=this.index[e]||new Be(R.H),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.tt(),n=t.X(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Be(R.H)).it()},t}(),Wr=function(){function t(){this.Qs=new Xr}return t.prototype.qs=function(t,e){var n=this;if(!this.Qs.has(e)){var r=e.tt(),i=e.X();t.gs((function(){n.Qs.add(e)}));var o={collectionId:r,parent:cr(i)};return Zr(t).put(o)}return Xn.resolve()},t.prototype.Us=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[I(e),""],!1,!0);return Zr(t).rs(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(lr(o.parent))}return n}))},t}();function Zr(t){return xr(t,Tr.store)}var Jr={Ks:!1,Ws:0,js:0,Gs:0},$r=function(){function t(t,e,n){this.zs=t,this.Hs=e,this.Js=n}return t.Ys=function(e){return new t(e,t.Xs,t.Zs)},t}();function ti(t){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(e){if(t.code!==O.FAILED_PRECONDITION||t.message!==sr)throw t;return f("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}$r.Xs=10,$r.Zs=1e3,$r.ti=new $r(41943040,$r.Xs,$r.Zs),$r.ei=new $r(-1,0,0);var ei=function(){function t(t,e){this.ni=t,this.si=e,this.ii={}}return t.prototype.get=function(t){var e=this.ni(t),n=this.ii[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],u=o[0],s=o[1];if(this.si(u,t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.ni(t),r=this.ii[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.si(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.ii[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.ni(t),n=this.ii[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.si(n[r][0],t))return 1===n.length?delete this.ii[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){z(this.ii,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],u=o[0],s=o[1];t(u,s)}}))},t.prototype.et=function(){return G(this.ii)},t}(),ni=function(){function t(){this.ri=new ei((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.oi=!1}return t.prototype.ci=function(t){var e=this.ri.get(t);return e?e.readTime:V.min()},t.prototype.ai=function(t,e){this.ui(),this.ri.set(t.key,{hi:t,readTime:e})},t.prototype.li=function(t,e){void 0===e&&(e=null),this.ui(),this.ri.set(t,{hi:null,readTime:e})},t.prototype._i=function(t,e){this.ui();var n=this.ri.get(e);return void 0!==n?Xn.resolve(n.hi):this.fi(t,e)},t.prototype.getEntries=function(t,e){return this.di(t,e)},t.prototype.apply=function(t){return this.ui(),this.oi=!0,this.wi(t)},t.prototype.ui=function(){},t}();function ri(t,e,n){var r=t.store(yr.store),i=t.store(mr.store),o=[],u=IDBKeyRange.only(n.batchId),s=0,a=r.hs({range:u},(function(t,e,n){return s++,n.delete()}));o.push(a.next((function(){y(1===s)})));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=mr.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return Xn.Ln(o).next((function(){return c}))}function ii(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw v();e=t.noDocument}return JSON.stringify(e).length}var oi=function(){function t(t,e,n,r){this.userId=t,this.Qt=e,this.Ei=n,this.Ti=r,this.Ii={}}return t.mi=function(e,n,r,i){return y(""!==e.uid),new t(e.m()?e.uid:"",n,r,i)},t.prototype.Ai=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return si(t).hs({index:yr.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.Ri=function(t,e,n,r){var i=this,o=ai(t),u=si(t);return u.add({}).next((function(s){y("number"==typeof s);for(var a=new kr(s,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return Pn(t.Os,e)})),i=n.mutations.map((function(e){return Pn(t.Os,e)}));return new yr(e,n.batchId,n.vs.toMillis(),r,i)}(i.Qt,i.userId,a),h=[],f=new Be((function(t,e){return w(t.rt(),e.rt())})),l=0,p=r;l<p.length;l++){var d=p[l],v=mr.key(i.userId,d.key.path,s);f=f.add(d.key.path.X()),h.push(u.put(c)),h.push(o.put(v,mr.PLACEHOLDER))}return f.forEach((function(e){h.push(i.Ei.qs(t,e))})),t.gs((function(){i.Ii[s]=a.keys()})),Xn.Ln(h).next((function(){return a}))}))},t.prototype.Pi=function(t,e){var n=this;return si(t).get(e).next((function(t){return t?(y(t.userId===n.userId),Fr(n.Qt,t)):null}))},t.prototype.yi=function(t,e){var n=this;return this.Ii[e]?Xn.resolve(this.Ii[e]):this.Pi(t,e).next((function(t){if(t){var r=t.keys();return n.Ii[e]=r,r}return null}))},t.prototype.gi=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return si(t).hs({index:yr.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(y(e.batchId>=r),o=Fr(n.Qt,e)),i.done()})).next((function(){return o}))},t.prototype.Vi=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return si(t).hs({index:yr.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.pi=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return si(t).rs(yr.userMutationsIndex,n).next((function(t){return t.map((function(t){return Fr(e.Qt,t)}))}))},t.prototype.bi=function(t,e){var n=this,r=mr.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return ai(t).hs({range:i},(function(r,i,u){var s=r[0],a=r[1],c=r[2],h=lr(a);if(s===n.userId&&e.path.isEqual(h))return si(t).get(c).next((function(t){if(!t)throw v();y(t.userId===n.userId),o.push(Fr(n.Qt,t))}));u.done()})).next((function(){return o}))},t.prototype.vi=function(t,e){var n=this,r=new Be(w),i=[];return e.forEach((function(e){var o=mr.prefixForPath(n.userId,e.path),u=IDBKeyRange.lowerBound(o),s=ai(t).hs({range:u},(function(t,i,o){var u=t[0],s=t[1],a=t[2],c=lr(s);u===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()}));i.push(s)})),Xn.Ln(i).next((function(){return n.Si(t,r)}))},t.prototype.Di=function(t,e){var n=this,r=e.path,i=r.length+1,o=mr.prefixForPath(this.userId,r),u=IDBKeyRange.lowerBound(o),s=new Be(w);return ai(t).hs({range:u},(function(t,e,o){var u=t[0],a=t[1],c=t[2],h=lr(a);u===n.userId&&r.nt(h)?h.length===i&&(s=s.add(c)):o.done()})).next((function(){return n.Si(t,s)}))},t.prototype.Si=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(si(t).get(e).next((function(t){if(null===t)throw v();y(t.userId===n.userId),r.push(Fr(n.Qt,t))})))})),Xn.Ln(i).next((function(){return r}))},t.prototype.Ci=function(t,e){var n=this;return ri(t.ps,this.userId,e).next((function(r){return t.gs((function(){n.xi(e.batchId)})),Xn.forEach(r,(function(e){return n.Ti.Ni(t,e)}))}))},t.prototype.xi=function(t){delete this.Ii[t]},t.prototype.Fi=function(t){var e=this;return this.Ai(t).next((function(n){if(!n)return Xn.resolve();var r=IDBKeyRange.lowerBound(mr.prefixForUser(e.userId)),i=[];return ai(t).hs({range:r},(function(t,n,r){if(t[0]===e.userId){var o=lr(t[1]);i.push(o)}else r.done()})).next((function(){y(0===i.length)}))}))},t.prototype.Oi=function(t,e){return ui(t,this.userId,e)},t.prototype.ki=function(t){var e=this;return ci(t).get(this.userId).next((function(t){return t||new vr(e.userId,-1,"")}))},t}();function ui(t,e,n){var r=mr.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),u=!1;return ai(t).hs({range:o,us:!0},(function(t,n,r){var o=t[0],s=t[1];t[2],o===e&&s===i&&(u=!0),r.done()})).next((function(){return u}))}function si(t){return xr(t,yr.store)}function ai(t){return xr(t,mr.store)}function ci(t){return xr(t,vr.store)}var hi=function(){function t(t){this.Mi=t}return t.prototype.next=function(){return this.Mi+=2,this.Mi},t.Li=function(){return new t(0)},t.$i=function(){return new t(-1)},t}(),fi=function(){function t(t,e){this.Ti=t,this.Qt=e}return t.prototype.Bi=function(t){var e=this;return this.qi(t).next((function(n){var r=new hi(n.highestTargetId);return n.highestTargetId=r.next(),e.Ui(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.Qi=function(t){return this.qi(t).next((function(t){return V.K(new L(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.Ki=function(t){return this.qi(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.Wi=function(t,e,n){var r=this;return this.qi(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.j()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Ui(t,i)}))},t.prototype.ji=function(t,e){var n=this;return this.Gi(t,e).next((function(){return n.qi(t).next((function(r){return r.targetCount+=1,n.zi(e,r),n.Ui(t,r)}))}))},t.prototype.Hi=function(t,e){return this.Gi(t,e)},t.prototype.Ji=function(t,e){var n=this;return this.Yi(t,e.targetId).next((function(){return li(t).delete(e.targetId)})).next((function(){return n.qi(t)})).next((function(e){return y(e.targetCount>0),e.targetCount-=1,n.Ui(t,e)}))},t.prototype.Xi=function(t,e,n){var r=this,i=0,o=[];return li(t).hs((function(u,s){var a=zr(s);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.Ji(t,a)))})).next((function(){return Xn.Ln(o)})).next((function(){return i}))},t.prototype.In=function(t,e){return li(t).hs((function(t,n){var r=zr(n);e(r)}))},t.prototype.qi=function(t){return pi(t).get(Or.key).next((function(t){return y(null!==t),t}))},t.prototype.Ui=function(t,e){return pi(t).put(Or.key,e)},t.prototype.Gi=function(t,e){return li(t).put(Gr(this.Qt,e))},t.prototype.zi=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.Zi=function(t){return this.qi(t).next((function(t){return t.targetCount}))},t.prototype.tr=function(t,e){var n=_t(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return li(t).hs({range:r,index:Ir.queryTargetsIndexName},(function(t,n,r){var o=zr(n);It(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.er=function(t,e,n){var r=this,i=[],o=di(t);return e.forEach((function(e){var u=cr(e.path);i.push(o.put(new Er(n,u))),i.push(r.Ti.nr(t,n,e))})),Xn.Ln(i)},t.prototype.sr=function(t,e,n){var r=this,i=di(t);return Xn.forEach(e,(function(e){var o=cr(e.path);return Xn.Ln([i.delete([n,o]),r.Ti.ir(t,n,e)])}))},t.prototype.Yi=function(t,e){var n=di(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.rr=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=di(t),i=tn();return r.hs({range:n,us:!0},(function(t,e,n){var r=lr(t[1]),o=new q(r);i=i.add(o)})).next((function(){return i}))},t.prototype.Oi=function(t,e){var n=cr(e.path),r=IDBKeyRange.bound([n],[I(n)],!1,!0),i=0;return di(t).hs({index:Er.documentTargetsIndex,us:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.Sn=function(t,e){return li(t).get(e).next((function(t){return t?zr(t):null}))},t}();function li(t){return xr(t,Ir.store)}function pi(t){return xr(t,Or.store)}function di(t){return xr(t,Er.store)}function vi(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],u=w(n,i);return 0===u?w(r,o):u}var yi=function(){function t(t){this.cr=t,this.buffer=new Be(vi),this.ar=0}return t.prototype.ur=function(){return++this.ar},t.prototype.hr=function(t){var e=[t,this.ur()];if(this.buffer.size<this.cr)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();vi(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),mi=function(){function t(t,e){this.lr=t,this._s=e,this._r=!1,this.dr=null}return t.prototype.start=function(t){-1!==this.lr.params.zs&&this.wr(t)},t.prototype.stop=function(){this.dr&&(this.dr.cancel(),this.dr=null)},Object.defineProperty(t.prototype,"Er",{get:function(){return null!==this.dr},enumerable:!1,configurable:!0}),t.prototype.wr=function(t){var e=this,n=this._r?3e5:6e4;f("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.dr=this._s.Tr("lru_garbage_collection",n,(function(){return Object(u.b)(e,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:this.dr=null,this._r=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.Ir(this.lr)];case 2:return n.sent(),[3,7];case 3:return tr(e=n.sent())?(f("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,ti(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.wr(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),bi=function(){function t(t,e){this.mr=t,this.params=e}return t.prototype.Ar=function(t,e){return this.mr.Rr(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.Pr=function(t,e){var n=this;if(0===e)return Xn.resolve(P.q);var r=new yi(e);return this.mr.In(t,(function(t){return r.hr(t.sequenceNumber)})).next((function(){return n.mr.yr(t,(function(t){return r.hr(t)}))})).next((function(){return r.maxValue}))},t.prototype.Xi=function(t,e,n){return this.mr.Xi(t,e,n)},t.prototype.gr=function(t,e){return this.mr.gr(t,e)},t.prototype.Vr=function(t,e){var n=this;return-1===this.params.zs?(f("LruGarbageCollector","Garbage collection skipped; disabled"),Xn.resolve(Jr)):this.pr(t).next((function(r){return r<n.params.zs?(f("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.zs),Jr):n.br(t,e)}))},t.prototype.pr=function(t){return this.mr.pr(t)},t.prototype.br=function(t,e){var n,i,o,u,s,a,c,l=this,p=Date.now();return this.Ar(t,this.params.Hs).next((function(e){return e>l.params.Js?(f("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+l.params.Js+" from "+e),i=l.params.Js):i=e,u=Date.now(),l.Pr(t,i)})).next((function(r){return n=r,s=Date.now(),l.Xi(t,n,e)})).next((function(e){return o=e,a=Date.now(),l.gr(t,n)})).next((function(t){return c=Date.now(),h()<=r.a.DEBUG&&f("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(u-p)+"ms\n\tDetermined least recently used "+i+" in "+(s-u)+"ms\n\tRemoved "+o+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-p)+"ms"),Xn.resolve({Ks:!0,Ws:i,js:o,Gs:t})}))},t}(),gi=function(){function t(t,e){this.db=t,this.lr=function(t,e){return new bi(t,e)}(this,e)}return t.prototype.Rr=function(t){var e=this.vr(t);return this.db.Sr().Zi(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.vr=function(t){var e=0;return this.yr(t,(function(t){e++})).next((function(){return e}))},t.prototype.In=function(t,e){return this.db.Sr().In(t,e)},t.prototype.yr=function(t,e){return this.Dr(t,(function(t,n){return e(n)}))},t.prototype.nr=function(t,e,n){return wi(t,n)},t.prototype.ir=function(t,e,n){return wi(t,n)},t.prototype.Xi=function(t,e,n){return this.db.Sr().Xi(t,e,n)},t.prototype.Ni=function(t,e){return wi(t,e)},t.prototype.Cr=function(t,e){return function(t,e){var n=!1;return ci(t).ls((function(r){return ui(t,r,e).next((function(t){return t&&(n=!0),Xn.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.gr=function(t,e){var n=this,r=this.db.Fr().Nr(),i=[],o=0;return this.Dr(t,(function(u,s){if(s<=e){var a=n.Cr(t,u).next((function(e){if(!e)return o++,r._i(t,u).next((function(){return r.li(u),di(t).delete([0,cr(u.path)])}))}));i.push(a)}})).next((function(){return Xn.Ln(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.Mt(t.bs);return this.db.Sr().Hi(t,n)},t.prototype.Or=function(t,e){return wi(t,e)},t.prototype.Dr=function(t,e){var n,r=di(t),i=P.q;return r.hs({index:Er.documentTargetsIndex},(function(t,r){var o=t[0],u=(t[1],r.path),s=r.sequenceNumber;0===o?(i!==P.q&&e(new q(lr(n)),i),i=s,n=u):i=P.q})).next((function(){i!==P.q&&e(new q(lr(n)),i)}))},t.prototype.pr=function(t){return this.db.Fr().kr(t)},t}();function wi(t,e){return di(t).put(function(t,e){return new Er(0,cr(t.path),e)}(e,t.bs))}var _i=function(){function t(t,e){this.Qt=t,this.Ei=e}return t.prototype.ai=function(t,e,n){return Oi(t).put(Ti(e),n)},t.prototype.li=function(t,e){var n=Oi(t),r=Ti(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.Mr(t,r)}))},t.prototype._i=function(t,e){var n=this;return Oi(t).get(Ti(e)).next((function(t){return n.Lr(t)}))},t.prototype.$r=function(t,e){var n=this;return Oi(t).get(Ti(e)).next((function(t){var e=n.Lr(t);return e?{hi:e,size:ii(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=Ke();return this.Br(t,e,(function(t,e){var i=n.Lr(e);r=r.zt(t,i)})).next((function(){return r}))},t.prototype.qr=function(t,e){var n=this,r=Ke(),i=new Fe(q.H);return this.Br(t,e,(function(t,e){var o=n.Lr(e);o?(r=r.zt(t,o),i=i.zt(t,ii(e))):(r=r.zt(t,null),i=i.zt(t,0))})).next((function(){return{Ur:r,Qr:i}}))},t.prototype.Br=function(t,e,n){if(e.et())return Xn.resolve();var r=IDBKeyRange.bound(e.first().path.it(),e.last().path.it()),i=e.te(),o=i.oe();return Oi(t).hs({range:r},(function(t,e,r){for(var u=q.Et(t);o&&q.H(o,u)<0;)n(o,null),o=i.oe();o&&o.isEqual(u)&&(n(o,e),o=i.ce()?i.oe():null),o?r.ss(o.path.it()):r.done()})).next((function(){for(;o;)n(o,null),o=i.ce()?i.oe():null}))},t.prototype.Kr=function(t,e,n){var r=this,i=We(),o=e.path.length+1,u={};if(n.isEqual(V.min())){var s=e.path.it();u.range=IDBKeyRange.lowerBound(s)}else{var a=e.path.it(),c=Rr(n);u.range=IDBKeyRange.lowerBound([a,c],!0),u.index=wr.collectionReadTimeIndex}return Oi(t).hs(u,(function(t,n,u){if(t.length===o){var s=Vr(r.Qt,n);e.path.nt(s.key.path)?s instanceof yt&&$t(e,s)&&(i=i.zt(s.key,s)):u.done()}})).next((function(){return i}))},t.prototype.Nr=function(t){return new Ii(this,!!t&&t.Wr)},t.prototype.kr=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return Ei(t).get(_r.key).next((function(t){return y(!!t),t}))},t.prototype.Mr=function(t,e){return Ei(t).put(_r.key,e)},t.prototype.Lr=function(t){if(t){var e=Vr(this.Qt,t);return e instanceof mt&&e.version.isEqual(V.min())?null:e}return null},t}(),Ii=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jr=e,r.Wr=n,r.Gr=new ei((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return Object(u.c)(e,t),e.prototype.wi=function(t){var e=this,n=[],r=0,i=new Be((function(t,e){return w(t.rt(),e.rt())}));return this.ri.forEach((function(o,u){var s=e.Gr.get(o);if(u.hi){var a=Cr(e.jr.Qt,u.hi,e.ci(o));i=i.add(o.path.X());var c=ii(a);r+=c-s,n.push(e.jr.ai(t,o,a))}else if(r-=s,e.Wr){var h=Cr(e.jr.Qt,new mt(o,V.min()),e.ci(o));n.push(e.jr.ai(t,o,h))}else n.push(e.jr.li(t,o))})),i.forEach((function(r){n.push(e.jr.Ei.qs(t,r))})),n.push(this.jr.updateMetadata(t,r)),Xn.Ln(n)},e.prototype.fi=function(t,e){var n=this;return this.jr.$r(t,e).next((function(t){return null===t?(n.Gr.set(e,0),null):(n.Gr.set(e,t.size),t.hi)}))},e.prototype.di=function(t,e){var n=this;return this.jr.qr(t,e).next((function(t){var e=t.Ur;return t.Qr.forEach((function(t,e){n.Gr.set(t,e)})),e}))},e}(ni);function Ei(t){return xr(t,_r.store)}function Oi(t){return xr(t,wr.store)}function Ti(t){return t.path.it()}var Ni=function(){function t(t){this.Qt=t}return t.prototype.Jn=function(t,e,n,r){var i=this;y(n<r&&n>=0&&r<=11);var o=new Wn("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(dr.store)}(t),function(t){t.createObjectStore(vr.store,{keyPath:vr.keyPath}),t.createObjectStore(yr.store,{keyPath:yr.keyPath,autoIncrement:!0}).createIndex(yr.userMutationsIndex,yr.userMutationsKeyPath,{unique:!0}),t.createObjectStore(mr.store)}(t),ji(t),function(t){t.createObjectStore(wr.store)}(t));var u=Xn.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Er.store),t.deleteObjectStore(Ir.store),t.deleteObjectStore(Or.store)}(t),ji(t)),u=u.next((function(){return function(t){var e=t.store(Or.store),n=new Or(0,0,V.min().j(),0);return e.put(Or.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(u=u.next((function(){return function(t,e){return e.store(yr.store).rs().next((function(n){t.deleteObjectStore(yr.store),t.createObjectStore(yr.store,{keyPath:yr.keyPath,autoIncrement:!0}).createIndex(yr.userMutationsIndex,yr.userMutationsKeyPath,{unique:!0});var r=e.store(yr.store),i=n.map((function(t){return r.put(t)}));return Xn.Ln(i)}))}(t,o)}))),u=u.next((function(){!function(t){t.createObjectStore(Nr.store,{keyPath:Nr.keyPath})}(t)}))),n<5&&r>=5&&(u=u.next((function(){return i.zr(o)}))),n<6&&r>=6&&(u=u.next((function(){return function(t){t.createObjectStore(_r.store)}(t),i.Hr(o)}))),n<7&&r>=7&&(u=u.next((function(){return i.Jr(o)}))),n<8&&r>=8&&(u=u.next((function(){return i.Yr(t,o)}))),n<9&&r>=9&&(u=u.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(wr.store);e.createIndex(wr.readTimeIndex,wr.readTimeIndexPath,{unique:!1}),e.createIndex(wr.collectionReadTimeIndex,wr.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(u=u.next((function(){return i.Xr(o)}))),n<11&&r>=11&&(u=u.next((function(){!function(t){t.createObjectStore(jr.store,{keyPath:jr.keyPath})}(t),function(t){t.createObjectStore(Ar.store,{keyPath:Ar.keyPath})}(t)}))),u},t.prototype.Hr=function(t){var e=0;return t.store(wr.store).hs((function(t,n){e+=ii(n)})).next((function(){var n=new _r(e);return t.store(_r.store).put(_r.key,n)}))},t.prototype.zr=function(t){var e=this,n=t.store(vr.store),r=t.store(yr.store);return n.rs().next((function(n){return Xn.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.rs(yr.userMutationsIndex,i).next((function(r){return Xn.forEach(r,(function(r){y(r.userId===n.userId);var i=Fr(e.Qt,r);return ri(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.Jr=function(t){var e=t.store(Er.store),n=t.store(wr.store);return t.store(Or.store).get(Or.key).next((function(t){var r=[];return n.hs((function(n,i){var o=new R(n),u=function(t){return[0,cr(t)]}(o);r.push(e.get(u).next((function(n){return n?Xn.resolve():function(n){return e.put(new Er(0,cr(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return Xn.Ln(r)}))}))},t.prototype.Yr=function(t,e){t.createObjectStore(Tr.store,{keyPath:Tr.keyPath});var n=e.store(Tr.store),r=new Xr,i=function(t){if(r.add(t)){var e=t.tt(),i=t.X();return n.put({collectionId:e,parent:cr(i)})}};return e.store(wr.store).hs({us:!0},(function(t,e){var n=new R(t);return i(n.X())})).next((function(){return e.store(mr.store).hs({us:!0},(function(t,e){t[0];var n=t[1],r=(t[2],lr(n));return i(r.X())}))}))},t.prototype.Xr=function(t){var e=this,n=t.store(Ir.store);return n.hs((function(t,r){var i=zr(r),o=Gr(e.Qt,i);return n.put(o)}))},t}();function ji(t){t.createObjectStore(Er.store,{keyPath:Er.keyPath}).createIndex(Er.documentTargetsIndex,Er.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ir.store,{keyPath:Ir.keyPath}).createIndex(Ir.queryTargetsIndexName,Ir.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Or.store)}var Ai="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Di=function(){function t(e,n,r,i,o,u,s,a,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Zr=o,this.window=u,this.document=s,this.eo=c,this.no=h,this.so=null,this.io=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ro=null,this.inForeground=!1,this.oo=null,this.co=null,this.ao=Number.NEGATIVE_INFINITY,this.uo=function(t){return Promise.resolve()},!t.Kn())throw new T(O.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Ti=new gi(this,i),this.ho=n+"main",this.Qt=new Lr(a),this.lo=new Zn(this.ho,11,new Ni(this.Qt)),this._o=new fi(this.Ti,this.Qt),this.Ei=new Wr,this.fo=function(t,e){return new _i(t,e)}(this.Qt,this.Ei),this.wo=new Qr,this.window&&this.window.localStorage?this.Eo=this.window.localStorage:(this.Eo=null,!1===h&&l("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.To().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new T(O.FAILED_PRECONDITION,Ai);return t.Io(),t.mo(),t.Ao(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t._o.Ki(e)}))})).then((function(e){t.so=new P(e,t.eo)})).then((function(){t.io=!0})).catch((function(e){return t.lo&&t.lo.close(),Promise.reject(e)}))},t.prototype.Ro=function(t){var e=this;return this.uo=function(n){return Object(u.b)(e,void 0,void 0,(function(){return Object(u.d)(this,(function(e){return this.Er?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.Po=function(t){var e=this;this.lo.Xn((function(n){return Object(u.b)(e,void 0,void 0,(function(){return Object(u.d)(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.yo=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Zr.Ps((function(){return Object(u.b)(e,void 0,void 0,(function(){return Object(u.d)(this,(function(t){switch(t.label){case 0:return this.Er?[4,this.To()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.To=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return xi(e).put(new Nr(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Vo(e).next((function(e){e||(t.isPrimary=!1,t.Zr.po((function(){return t.uo(!1)})))}))})).next((function(){return t.bo(e)})).next((function(n){return t.isPrimary&&!n?t.vo(e).next((function(){return!1})):!!n&&t.So(e).next((function(){return!0}))}))})).catch((function(e){if(tr(e))return f("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return f("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Zr.po((function(){return t.uo(e)})),t.isPrimary=e}))},t.prototype.Vo=function(t){var e=this;return Si(t).get(dr.key).next((function(t){return Xn.resolve(e.Do(t))}))},t.prototype.Co=function(t){return xi(t).delete(this.clientId)},t.prototype.xo=function(){return Object(u.b)(this,void 0,void 0,(function(){var t,e,n,r,i=this;return Object(u.d)(this,(function(o){switch(o.label){case 0:return!this.isPrimary||this.No(this.ao,18e5)?[3,2]:(this.ao=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=xr(t,Nr.store);return e.rs().next((function(t){var n=i.Fo(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return Xn.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=o.sent(),this.Eo)for(e=0,n=t;e<n.length;e++)r=n[e],this.Eo.removeItem(this.Oo(r.clientId));o.label=2;case 2:return[2]}}))}))},t.prototype.Ao=function(){var t=this;this.co=this.Zr.Tr("client_metadata_refresh",4e3,(function(){return t.To().then((function(){return t.xo()})).then((function(){return t.Ao()}))}))},t.prototype.Do=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.bo=function(t){var e=this;return this.no?Xn.resolve(!0):Si(t).get(dr.key).next((function(n){if(null!==n&&e.No(n.leaseTimestampMs,5e3)&&!e.ko(n.ownerId)){if(e.Do(n)&&e.networkEnabled)return!0;if(!e.Do(n)){if(!n.allowTabSynchronization)throw new T(O.FAILED_PRECONDITION,Ai);return!1}}return!(!e.networkEnabled||!e.inForeground)||xi(t).rs().next((function(t){return void 0===e.Fo(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&f("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.Mo=function(){return Object(u.b)(this,void 0,void 0,(function(){var t=this;return Object(u.d)(this,(function(e){switch(e.label){case 0:return this.io=!1,this.Lo(),this.co&&(this.co.cancel(),this.co=null),this.$o(),this.Bo(),[4,this.lo.runTransaction("shutdown","readwrite",[dr.store,Nr.store],(function(e){var n=new Sr(e,P.q);return t.vo(n).next((function(){return t.Co(n)}))}))];case 1:return e.sent(),this.lo.close(),this.qo(),[2]}}))}))},t.prototype.Fo=function(t,e){var n=this;return t.filter((function(t){return n.No(t.updateTimeMs,e)&&!n.ko(t.clientId)}))},t.prototype.Uo=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return xi(e).rs().next((function(e){return t.Fo(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"Er",{get:function(){return this.io},enumerable:!1,configurable:!0}),t.prototype.Qo=function(t){return oi.mi(t,this.Qt,this.Ei,this.Ti)},t.prototype.Sr=function(){return this._o},t.prototype.Fr=function(){return this.fo},t.prototype.Ko=function(){return this.Ei},t.prototype.Wo=function(){return this.wo},t.prototype.runTransaction=function(t,e,n){var r=this;f("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.lo.runTransaction(t,o,Dr,(function(o){return i=new Sr(o,r.so?r.so.next():P.q),"readwrite-primary"===e?r.Vo(i).next((function(t){return!!t||r.bo(i)})).next((function(e){if(!e)throw l("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Zr.po((function(){return r.uo(!1)})),new T(O.FAILED_PRECONDITION,sr);return n(i)})).next((function(t){return r.So(i).next((function(){return t}))})):r.jo(i).next((function(){return n(i)}))})).then((function(t){return i.Vs(),t}))},t.prototype.jo=function(t){var e=this;return Si(t).get(dr.key).next((function(t){if(null!==t&&e.No(t.leaseTimestampMs,5e3)&&!e.ko(t.ownerId)&&!e.Do(t)&&!(e.no||e.allowTabSynchronization&&t.allowTabSynchronization))throw new T(O.FAILED_PRECONDITION,Ai)}))},t.prototype.So=function(t){var e=new dr(this.clientId,this.allowTabSynchronization,Date.now());return Si(t).put(dr.key,e)},t.Kn=function(){return Zn.Kn()},t.prototype.vo=function(t){var e=this,n=Si(t);return n.get(dr.key).next((function(t){return e.Do(t)?(f("IndexedDbPersistence","Releasing primary lease."),n.delete(dr.key)):Xn.resolve()}))},t.prototype.No=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(l("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.Io=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.oo=function(){t.Zr.Ps((function(){return t.inForeground="visible"===t.document.visibilityState,t.To()}))},this.document.addEventListener("visibilitychange",this.oo),this.inForeground="visible"===this.document.visibilityState)},t.prototype.$o=function(){this.oo&&(this.document.removeEventListener("visibilitychange",this.oo),this.oo=null)},t.prototype.mo=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ro=function(){e.Lo(),e.Zr.Ps((function(){return e.Mo()}))},this.window.addEventListener("unload",this.ro))},t.prototype.Bo=function(){this.ro&&(this.window.removeEventListener("unload",this.ro),this.ro=null)},t.prototype.ko=function(t){var e;try{var n=null!==(null===(e=this.Eo)||void 0===e?void 0:e.getItem(this.Oo(t)));return f("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return l("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.Lo=function(){if(this.Eo)try{this.Eo.setItem(this.Oo(this.clientId),String(Date.now()))}catch(t){l("Failed to set zombie client id.",t)}},t.prototype.qo=function(){if(this.Eo)try{this.Eo.removeItem(this.Oo(this.clientId))}catch(t){}},t.prototype.Oo=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Si(t){return xr(t,dr.store)}function xi(t){return xr(t,Nr.store)}function ki(t,e){var n=t.projectId;return t.o||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Pi=function(t,e){this.progress=t,this.Go=e},Li=function(){function t(t,e,n){this.fo=t,this.zo=e,this.Ei=n}return t.prototype.Ho=function(t,e){var n=this;return this.zo.bi(t,e).next((function(r){return n.Jo(t,e,r)}))},t.prototype.Jo=function(t,e,n){return this.fo._i(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].Cs(e,t);return t}))},t.prototype.Yo=function(t,e,n){var r=Ke();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].Cs(t,e);r=r.zt(t,e)})),r},t.prototype.Xo=function(t,e){var n=this;return this.fo.getEntries(t,e).next((function(e){return n.Zo(t,e)}))},t.prototype.Zo=function(t,e){var n=this;return this.zo.vi(t,e).next((function(r){var i=n.Yo(t,e,r),o=He();return i.forEach((function(t,e){e||(e=new mt(t,V.min())),o=o.zt(t,e)})),o}))},t.prototype.Kr=function(t,e,n){return function(t){return q.wt(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.tc(t,e.path):Yt(e)?this.ec(t,e,n):this.nc(t,e,n)},t.prototype.tc=function(t,e){return this.Ho(t,new q(e)).next((function(t){var e=We();return t instanceof yt&&(e=e.zt(t.key,t)),e}))},t.prototype.ec=function(t,e,n){var r=this,i=e.collectionGroup,o=We();return this.Ei.Us(t,i).next((function(u){return Xn.forEach(u,(function(u){var s=function(t,e){return new Mt(e,null,t.xt.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,u.child(i));return r.nc(t,s,n).next((function(t){t.forEach((function(t,e){o=o.zt(t,e)}))}))})).next((function(){return o}))}))},t.prototype.nc=function(t,e,n){var r,i,o=this;return this.fo.Kr(t,e,n).next((function(n){return r=n,o.zo.Di(t,e)})).next((function(e){return i=e,o.sc(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],u=0,s=o.mutations;u<s.length;u++){var a=s[u],c=a.key,h=Oe(a,r.get(c),o.vs);r=h instanceof yt?r.zt(c,h):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){$t(e,n)||(r=r.remove(t))})),r}))},t.prototype.sc=function(t,e,n){for(var r=tn(),i=0,o=e;i<o.length;i++)for(var u=0,s=o[i].mutations;u<s.length;u++){var a=s[u];a instanceof De&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.fo.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof yt&&(c=c.zt(t,e))})),c}))},t}(),Vi=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.ic=n,this.rc=r}return t.oc=function(e,n){for(var r=tn(),i=tn(),o=0,u=n.docChanges;o<u.length;o++){var s=u[o];switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Ci=function(){function t(){}return t.prototype.cc=function(t){this.ac=t},t.prototype.Kr=function(t,e,n,i){var o=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.xt.length||1===t.xt.length&&t.xt[0].field.ut())}(e)||n.isEqual(V.min())?this.uc(t,e):this.ac.Xo(t,i).next((function(u){var s=o.hc(e,u);return(zt(e)||Gt(e))&&o.lc(e.limitType,s,i,n)?o.uc(t,e):(h()<=r.a.DEBUG&&f("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Jt(e)),o.ac.Kr(t,e,n).next((function(t){return s.forEach((function(e){t=t.zt(e.key,e)})),t})))}))},t.prototype.hc=function(t,e){var n=new Be(te(t));return e.forEach((function(e,r){r instanceof yt&&$t(t,r)&&(n=n.add(r))})),n},t.prototype.lc=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version._(r)>0)},t.prototype.uc=function(t,e){return h()<=r.a.DEBUG&&f("QueryEngine","Using full collection scan to execute query:",Jt(e)),this.ac.Kr(t,e,V.min())},t}(),Ri=function(){function t(t,e,n,r){this.persistence=t,this._c=e,this.Qt=r,this.fc=new Fe(w),this.dc=new ei((function(t){return _t(t)}),It),this.wc=V.min(),this.zo=t.Qo(n),this.Ec=t.Fr(),this._o=t.Sr(),this.Tc=new Li(this.Ec,this.zo,this.persistence.Ko()),this.wo=t.Wo(),this._c.cc(this.Tc)}return t.prototype.Ir=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.Vr(n,e.fc)}))},t}();function Ui(t,e,n,r){return new Ri(t,e,n,r)}function Mi(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(u.d)(this,(function(u){switch(u.label){case 0:return n=m(t),r=n.zo,i=n.Tc,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n.zo.pi(t).next((function(u){return o=u,r=n.persistence.Qo(e),i=new Li(n.Ec,r,n.persistence.Ko()),r.pi(t)})).next((function(e){for(var n=[],r=[],u=tn(),s=0,a=o;s<a.length;s++){var c=a[s];n.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];u=u.add(l.key)}}for(var p=0,d=e;p<d.length;p++){var v=d[p];r.push(v.batchId);for(var y=0,m=v.mutations;y<m.length;y++){var b=m[y];u=u.add(b.key)}}return i.Xo(t,u).next((function(t){return{Ic:t,mc:n,Ac:r}}))}))}))];case 1:return o=u.sent(),[2,(n.zo=r,n.Tc=i,n._c.cc(n.Tc),o)]}}))}))}function qi(t,e){var n=m(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.Ec.Nr({Wr:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),u=Xn.resolve();return o.forEach((function(t){u=u.next((function(){return r._i(e,t)})).next((function(e){var o=e,u=n.Fs.get(t);y(null!==u),(!o||o.version._(u)<0)&&(o=i.Ss(t,o,n))&&r.ai(o,n.Ns)}))})),u.next((function(){return t.zo.Ci(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n.zo.Fi(t)})).next((function(){return n.Tc.Xo(t,r)}))}))}function Fi(t){var e=m(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e._o.Qi(t)}))}function zi(t,e){var n=m(t),r=e.kt,i=n.fc;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.Ec.Nr({Wr:!0});i=n.fc;var u=[];e.Fe.forEach((function(e,o){var s=i.get(o);if(s){u.push(n._o.sr(t,e.Qe,o).next((function(){return n._o.er(t,e.qe,o)})));var a=e.resumeToken;if(a.l()>0){var c=s.Lt(a,r).Mt(t.bs);i=i.zt(o,c),function(t,e,n){return y(e.resumeToken.l()>0),0===t.resumeToken.l()||e.kt.W()-t.kt.W()>=3e8||n.qe.size+n.Ue.size+n.Qe.size>0}(s,c,e)&&u.push(n._o.Hi(t,c))}}}));var s=He();if(e.ke.forEach((function(r,i){e.Me.has(r)&&u.push(n.persistence.Ti.Or(t,r))})),u.push(Gi(t,o,e.ke,r,void 0).next((function(t){s=t}))),!r.isEqual(V.min())){var a=n._o.Qi(t).next((function(e){return n._o.Wi(t,t.bs,r)}));u.push(a)}return Xn.Ln(u).next((function(){return o.apply(t)})).next((function(){return n.Tc.Zo(t,s)}))})).then((function(t){return n.fc=i,t}))}function Gi(t,e,n,r,i){var o=tn();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=He();return n.forEach((function(n,u){var s=t.get(n),a=(null==i?void 0:i.get(n))||r;u instanceof mt&&u.version.isEqual(V.min())?(e.li(n,a),o=o.zt(n,u)):null==s||u.version._(s.version)>0||0===u.version._(s.version)&&s.hasPendingWrites?(e.ai(u,a),o=o.zt(n,u)):f("LocalStore","Ignoring outdated watch update for ",n,". Current version:",s.version," Watch version:",u.version)})),o}))}function Bi(t,e){var n=m(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n.zo.gi(t,e)}))}function Qi(t,e){var n=m(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n._o.tr(t,e).next((function(i){return i?(r=i,Xn.resolve(r)):n._o.Bi(t).next((function(i){return r=new ne(e,i,0,t.bs),n._o.ji(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.fc.get(t.targetId);return(null===r||t.kt._(r.kt)>0)&&(n.fc=n.fc.zt(t.targetId,t),n.dc.set(e,t.targetId)),t}))}function Yi(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(u.d)(this,(function(u){switch(u.label){case 0:r=m(t),i=r.fc.get(e),o=n?"readwrite":"readwrite-primary",u.label=1;case 1:return u.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(t){return r.persistence.Ti.removeTarget(t,i)}))];case 2:u.sent(),u.label=3;case 3:return[3,5];case 4:if(!tr(s=u.sent()))throw s;return f("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.fc=r.fc.remove(e),r.dc.delete(i.target),[2]}}))}))}function Hi(t,e,n){var r=m(t),i=V.min(),o=tn();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=m(t),i=r.dc.get(n);return void 0!==i?Xn.resolve(r.fc.get(i)):r._o.tr(e,n)}(r,t,Kt(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r._o.rr(t,e.targetId).next((function(t){o=t}))})).next((function(){return r._c.Kr(t,e,n?i:V.min(),n?o:tn())})).next((function(t){return{documents:t,Rc:o}}))}))}function Ki(t,e){var n=m(t),r=m(n._o),i=n.fc.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.Sn(t,e).next((function(t){return t?t.target:null}))}))}function Xi(t){var e=m(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=m(t),i=He(),o=Rr(n),u=Oi(e),s=IDBKeyRange.lowerBound(o,!0);return u.hs({index:wr.readTimeIndex,range:s},(function(t,e){var n=Vr(r.Qt,e);i=i.zt(n.key,n),o=e.readTime})).next((function(){return{Go:i,readTime:Ur(o)}}))}(e.Ec,t,e.wc)})).then((function(t){var n=t.Go,r=t.readTime;return e.wc=r,n}))}function Wi(t){return Object(u.b)(this,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){return[2,(e=m(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=Oi(t),n=V.min();return e.hs({index:wr.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Ur(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.wc=t}))]}))}))}function Zi(t,e,n,r){return Object(u.b)(this,void 0,void 0,(function(){var i,o,s,a,c,h,f,l,p,d;return Object(u.d)(this,(function(u){switch(u.label){case 0:for(i=m(t),o=tn(),s=He(),a=Je(),c=0,h=n;c<h.length;c++)f=h[c],l=e.Pc(f.metadata.name),f.document&&(o=o.add(l)),s=s.zt(l,e.yc(f)),a=a.zt(l,e.gc(f.metadata.readTime));return p=i.Ec.Nr({Wr:!0}),[4,Qi(i,function(t){return Kt(Ft(R.ot("__bundle__/docs/"+t)))}(r))];case 1:return d=u.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return Gi(t,p,s,V.min(),a).next((function(e){return p.apply(t),e})).next((function(e){return i._o.Yi(t,d.targetId).next((function(){return i._o.er(t,o,d.targetId)})).next((function(){return i.Tc.Zo(t,e)}))}))}))]}}))}))}function Ji(t,e,n){return void 0===n&&(n=tn()),Object(u.b)(this,void 0,void 0,(function(){var r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:return[4,Qi(t,Kt(Br(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=m(t)).persistence.runTransaction("Save named query","readwrite",(function(t){var o=In(e.readTime);if(r.kt._(o)>=0)return i.wo.$s(t,e);var u=r.Lt(E.T,o);return i.fc=i.fc.zt(u.targetId,u),i._o.Hi(t,u).next((function(){return i._o.Yi(t,r.targetId)})).next((function(){return i._o.er(t,n,r.targetId)})).next((function(){return i.wo.$s(t,e)}))}))]}}))}))}var $i=function(){function t(t){this.Qt=t,this.Vc=new Map,this.bc=new Map}return t.prototype.ks=function(t,e){return Xn.resolve(this.Vc.get(e))},t.prototype.Ms=function(t,e){var n;return this.Vc.set(e.id,{id:(n=e).id,version:n.version,createTime:In(n.createTime)}),Xn.resolve()},t.prototype.Ls=function(t,e){return Xn.resolve(this.bc.get(e))},t.prototype.$s=function(t,e){return this.bc.set(e.name,function(t){return{name:t.name,query:Br(t.bundledQuery),readTime:In(t.readTime)}}(e)),Xn.resolve()},t}(),to=function(){function t(){this.vc=new Be(eo.Sc),this.Dc=new Be(eo.Cc)}return t.prototype.et=function(){return this.vc.et()},t.prototype.nr=function(t,e){var n=new eo(t,e);this.vc=this.vc.add(n),this.Dc=this.Dc.add(n)},t.prototype.xc=function(t,e){var n=this;t.forEach((function(t){return n.nr(t,e)}))},t.prototype.ir=function(t,e){this.Nc(new eo(t,e))},t.prototype.Fc=function(t,e){var n=this;t.forEach((function(t){return n.ir(t,e)}))},t.prototype.Oc=function(t){var e=this,n=new q(new R([])),r=new eo(n,t),i=new eo(n,t+1),o=[];return this.Dc.me([r,i],(function(t){e.Nc(t),o.push(t.key)})),o},t.prototype.kc=function(){var t=this;this.vc.forEach((function(e){return t.Nc(e)}))},t.prototype.Nc=function(t){this.vc=this.vc.delete(t),this.Dc=this.Dc.delete(t)},t.prototype.Mc=function(t){var e=new q(new R([])),n=new eo(e,t),r=new eo(e,t+1),i=tn();return this.Dc.me([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.Oi=function(t){var e=new eo(t,0),n=this.vc.Re(e);return null!==n&&t.isEqual(n.key)},t}(),eo=function(){function t(t,e){this.key=t,this.Lc=e}return t.Sc=function(t,e){return q.H(t.key,e.key)||w(t.Lc,e.Lc)},t.Cc=function(t,e){return w(t.Lc,e.Lc)||q.H(t.key,e.key)},t}(),no=function(){function t(t,e){this.Ei=t,this.Ti=e,this.zo=[],this.$c=1,this.Bc=new Be(eo.Sc)}return t.prototype.Ai=function(t){return Xn.resolve(0===this.zo.length)},t.prototype.Ri=function(t,e,n,r){var i=this.$c;this.$c++,this.zo.length>0&&this.zo[this.zo.length-1];var o=new kr(i,e,n,r);this.zo.push(o);for(var u=0,s=r;u<s.length;u++){var a=s[u];this.Bc=this.Bc.add(new eo(a.key,i)),this.Ei.qs(t,a.key.path.X())}return Xn.resolve(o)},t.prototype.Pi=function(t,e){return Xn.resolve(this.qc(e))},t.prototype.gi=function(t,e){var n=e+1,r=this.Uc(n),i=r<0?0:r;return Xn.resolve(this.zo.length>i?this.zo[i]:null)},t.prototype.Vi=function(){return Xn.resolve(0===this.zo.length?-1:this.$c-1)},t.prototype.pi=function(t){return Xn.resolve(this.zo.slice())},t.prototype.bi=function(t,e){var n=this,r=new eo(e,0),i=new eo(e,Number.POSITIVE_INFINITY),o=[];return this.Bc.me([r,i],(function(t){var e=n.qc(t.Lc);o.push(e)})),Xn.resolve(o)},t.prototype.vi=function(t,e){var n=this,r=new Be(w);return e.forEach((function(t){var e=new eo(t,0),i=new eo(t,Number.POSITIVE_INFINITY);n.Bc.me([e,i],(function(t){r=r.add(t.Lc)}))})),Xn.resolve(this.Qc(r))},t.prototype.Di=function(t,e){var n=e.path,r=n.length+1,i=n;q.wt(i)||(i=i.child(""));var o=new eo(new q(i),0),u=new Be(w);return this.Bc.Ae((function(t){var e=t.key.path;return!!n.nt(e)&&(e.length===r&&(u=u.add(t.Lc)),!0)}),o),Xn.resolve(this.Qc(u))},t.prototype.Qc=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.qc(t);null!==r&&n.push(r)})),n},t.prototype.Ci=function(t,e){var n=this;y(0===this.Kc(e.batchId,"removed")),this.zo.shift();var r=this.Bc;return Xn.forEach(e.mutations,(function(i){var o=new eo(i.key,e.batchId);return r=r.delete(o),n.Ti.Ni(t,i.key)})).next((function(){n.Bc=r}))},t.prototype.xi=function(t){},t.prototype.Oi=function(t,e){var n=new eo(e,0),r=this.Bc.Re(n);return Xn.resolve(e.isEqual(r&&r.key))},t.prototype.Fi=function(t){return this.zo.length,Xn.resolve()},t.prototype.Kc=function(t,e){return this.Uc(t)},t.prototype.Uc=function(t){return 0===this.zo.length?0:t-this.zo[0].batchId},t.prototype.qc=function(t){var e=this.Uc(t);return e<0||e>=this.zo.length?null:this.zo[e]},t}(),ro=function(){function t(t,e){this.Ei=t,this.Wc=e,this.docs=new Fe(q.H),this.size=0}return t.prototype.ai=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,u=this.Wc(e);return this.docs=this.docs.zt(r,{hi:e,size:u,readTime:n}),this.size+=u-o,this.Ei.qs(t,r.path.X())},t.prototype.li=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype._i=function(t,e){var n=this.docs.get(e);return Xn.resolve(n?n.hi:null)},t.prototype.getEntries=function(t,e){var n=this,r=Ke();return e.forEach((function(t){var e=n.docs.get(t);r=r.zt(t,e?e.hi:null)})),Xn.resolve(r)},t.prototype.Kr=function(t,e,n){for(var r=We(),i=new q(e.path.child("")),o=this.docs.ee(i);o.ce();){var u=o.oe(),s=u.key,a=u.value,c=a.hi,h=a.readTime;if(!e.path.nt(s.path))break;h._(n)<=0||c instanceof yt&&$t(e,c)&&(r=r.zt(c.key,c))}return Xn.resolve(r)},t.prototype.jc=function(t,e){return Xn.forEach(this.docs,(function(t){return e(t)}))},t.prototype.Nr=function(t){return new io(this)},t.prototype.kr=function(t){return Xn.resolve(this.size)},t}(),io=function(t){function e(e){var n=this;return(n=t.call(this)||this).jr=e,n}return Object(u.c)(e,t),e.prototype.wi=function(t){var e=this,n=[];return this.ri.forEach((function(r,i){i&&i.hi?n.push(e.jr.ai(t,i.hi,e.ci(r))):e.jr.li(r)})),Xn.Ln(n)},e.prototype.fi=function(t,e){return this.jr._i(t,e)},e.prototype.di=function(t,e){return this.jr.getEntries(t,e)},e}(ni),oo=function(){function t(t){this.persistence=t,this.Gc=new ei((function(t){return _t(t)}),It),this.lastRemoteSnapshotVersion=V.min(),this.highestTargetId=0,this.zc=0,this.Hc=new to,this.targetCount=0,this.Jc=hi.Li()}return t.prototype.In=function(t,e){return this.Gc.forEach((function(t,n){return e(n)})),Xn.resolve()},t.prototype.Qi=function(t){return Xn.resolve(this.lastRemoteSnapshotVersion)},t.prototype.Ki=function(t){return Xn.resolve(this.zc)},t.prototype.Bi=function(t){return this.highestTargetId=this.Jc.next(),Xn.resolve(this.highestTargetId)},t.prototype.Wi=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.zc&&(this.zc=e),Xn.resolve()},t.prototype.Gi=function(t){this.Gc.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Jc=new hi(e),this.highestTargetId=e),t.sequenceNumber>this.zc&&(this.zc=t.sequenceNumber)},t.prototype.ji=function(t,e){return this.Gi(e),this.targetCount+=1,Xn.resolve()},t.prototype.Hi=function(t,e){return this.Gi(e),Xn.resolve()},t.prototype.Ji=function(t,e){return this.Gc.delete(e.target),this.Hc.Oc(e.targetId),this.targetCount-=1,Xn.resolve()},t.prototype.Xi=function(t,e,n){var r=this,i=0,o=[];return this.Gc.forEach((function(u,s){s.sequenceNumber<=e&&null===n.get(s.targetId)&&(r.Gc.delete(u),o.push(r.Yi(t,s.targetId)),i++)})),Xn.Ln(o).next((function(){return i}))},t.prototype.Zi=function(t){return Xn.resolve(this.targetCount)},t.prototype.tr=function(t,e){var n=this.Gc.get(e)||null;return Xn.resolve(n)},t.prototype.er=function(t,e,n){return this.Hc.xc(e,n),Xn.resolve()},t.prototype.sr=function(t,e,n){this.Hc.Fc(e,n);var r=this.persistence.Ti,i=[];return r&&e.forEach((function(e){i.push(r.Ni(t,e))})),Xn.Ln(i)},t.prototype.Yi=function(t,e){return this.Hc.Oc(e),Xn.resolve()},t.prototype.rr=function(t,e){var n=this.Hc.Mc(e);return Xn.resolve(n)},t.prototype.Oi=function(t,e){return Xn.resolve(this.Hc.Oi(e))},t}(),uo=function(){function t(t,e){var n=this;this.Yc={},this.so=new P(0),this.io=!1,this.io=!0,this.Ti=t(this),this._o=new oo(this),this.Ei=new Kr,this.fo=function(t,e){return new ro(t,(function(t){return n.Ti.Xc(t)}))}(this.Ei),this.Qt=new Lr(e),this.wo=new $i(this.Qt)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.Mo=function(){return this.io=!1,Promise.resolve()},Object.defineProperty(t.prototype,"Er",{get:function(){return this.io},enumerable:!1,configurable:!0}),t.prototype.Po=function(){},t.prototype.yo=function(){},t.prototype.Ko=function(){return this.Ei},t.prototype.Qo=function(t){var e=this.Yc[t.A()];return e||(e=new no(this.Ei,this.Ti),this.Yc[t.A()]=e),e},t.prototype.Sr=function(){return this._o},t.prototype.Fr=function(){return this.fo},t.prototype.Wo=function(){return this.wo},t.prototype.runTransaction=function(t,e,n){var r=this;f("MemoryPersistence","Starting transaction:",t);var i=new so(this.so.next());return this.Ti.Zc(),n(i).next((function(t){return r.Ti.ta(i).next((function(){return t}))})).kn().then((function(t){return i.Vs(),t}))},t.prototype.ea=function(t,e){return Xn.$n(Object.values(this.Yc).map((function(n){return function(){return n.Oi(t,e)}})))},t}(),so=function(t){function e(e){var n=this;return(n=t.call(this)||this).bs=e,n}return Object(u.c)(e,t),e}(ar),ao=function(){function t(t){this.persistence=t,this.na=new to,this.sa=null}return t.ia=function(e){return new t(e)},Object.defineProperty(t.prototype,"ra",{get:function(){if(this.sa)return this.sa;throw v()},enumerable:!1,configurable:!0}),t.prototype.nr=function(t,e,n){return this.na.nr(n,e),this.ra.delete(n.toString()),Xn.resolve()},t.prototype.ir=function(t,e,n){return this.na.ir(n,e),this.ra.add(n.toString()),Xn.resolve()},t.prototype.Ni=function(t,e){return this.ra.add(e.toString()),Xn.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.na.Oc(e.targetId).forEach((function(t){return n.ra.add(t.toString())}));var r=this.persistence.Sr();return r.rr(t,e.targetId).next((function(t){t.forEach((function(t){return n.ra.add(t.toString())}))})).next((function(){return r.Ji(t,e)}))},t.prototype.Zc=function(){this.sa=new Set},t.prototype.ta=function(t){var e=this,n=this.persistence.Fr().Nr();return Xn.forEach(this.ra,(function(r){var i=q._t(r);return e.oa(t,i).next((function(t){t||n.li(i)}))})).next((function(){return e.sa=null,n.apply(t)}))},t.prototype.Or=function(t,e){var n=this;return this.oa(t,e).next((function(t){t?n.ra.delete(e.toString()):n.ra.add(e.toString())}))},t.prototype.Xc=function(t){return 0},t.prototype.oa=function(t,e){var n=this;return Xn.$n([function(){return Xn.resolve(n.na.Oi(e))},function(){return n.persistence.Sr().Oi(t,e)},function(){return n.persistence.ea(t,e)}])},t}();function co(t,e){return"firestore_clients_"+t+"_"+e}function ho(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.m()&&(r+="_"+e.uid),r}function fo(t,e){return"firestore_targets_"+t+"_"+e}var lo=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.ca=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),u=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(u=new T(i.error.code,i.error.message)),o?new t(e,n,i.state,u):(l("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.aa=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),po=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.ca=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new T(r.error.code,r.error.message)),i?new t(e,r.state,o):(l("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.aa=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),vo=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.ca=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=nn(),u=0;i&&u<r.activeTargetIds.length;++u)i=$(r.activeTargetIds[u]),o=o.add(r.activeTargetIds[u]);return i?new t(e,o):(l("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),yo=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.ca=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(l("SharedClientState","Failed to parse online state: "+e),null)},t}(),mo=function(){function t(){this.activeTargetIds=nn()}return t.prototype.ua=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.ha=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.aa=function(){var t={activeTargetIds:this.activeTargetIds.it(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),bo=function(){function t(t,e,n,r,i){this.window=t,this.Zr=e,this.persistenceKey=n,this.la=r,this._a=null,this.fa=null,this.M=null,this.da=this.wa.bind(this),this.Ea=new Fe(w),this.Er=!1,this.Ta=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ia=co(this.persistenceKey,this.la),this.ma=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Ea=this.Ea.zt(this.la,new mo),this.Aa=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Ra=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Pa=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.ya=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.ga=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.da)}return t.Kn=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(u.b)(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,a,c,h,f,l=this;return Object(u.d)(this,(function(u){switch(u.label){case 0:return[4,this._a.Uo()];case 1:for(t=u.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.la&&(i=this.getItem(co(this.persistenceKey,r)))&&(o=vo.ca(r,i))&&(this.Ea=this.Ea.zt(o.clientId,o));for(this.Va(),(s=this.storage.getItem(this.ya))&&(a=this.pa(s))&&this.ba(a),c=0,h=this.Ta;c<h.length;c++)f=h[c],this.wa(f);return this.Ta=[],this.window.addEventListener("unload",(function(){return l.Mo()})),this.Er=!0,[2]}}))}))},t.prototype.B=function(t){this.setItem(this.ma,JSON.stringify(t))},t.prototype.va=function(){return this.Sa(this.Ea)},t.prototype.Da=function(t){var e=!1;return this.Ea.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.Ca=function(t){this.xa(t,"pending")},t.prototype.Na=function(t,e,n){this.xa(t,e,n),this.Fa(t)},t.prototype.Oa=function(t){var e="not-current";if(this.Da(t)){var n=this.storage.getItem(fo(this.persistenceKey,t));if(n){var r=po.ca(t,n);r&&(e=r.state)}}return this.ka.ua(t),this.Va(),e},t.prototype.Ma=function(t){this.ka.ha(t),this.Va()},t.prototype.La=function(t){return this.ka.activeTargetIds.has(t)},t.prototype.$a=function(t){this.removeItem(fo(this.persistenceKey,t))},t.prototype.Ba=function(t,e,n){this.qa(t,e,n)},t.prototype.Ua=function(t,e,n){var r=this;e.forEach((function(t){r.Fa(t)})),this.currentUser=t,n.forEach((function(t){r.Ca(t)}))},t.prototype.Qa=function(t){this.Ka(t)},t.prototype.Wa=function(){this.ja()},t.prototype.Mo=function(){this.Er&&(this.window.removeEventListener("storage",this.da),this.removeItem(this.Ia),this.Er=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return f("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){f("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){f("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.wa=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(f("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Ia)return void l("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Zr.po((function(){return Object(u.b)(e,void 0,void 0,(function(){var t,e,r,i,o,s;return Object(u.d)(this,(function(u){if(this.Er){if(null!==n.key)if(this.Aa.test(n.key)){if(null==n.newValue)return t=this.Ga(n.key),[2,this.za(t,null)];if(e=this.Ha(n.key,n.newValue))return[2,this.za(e.clientId,e)]}else if(this.Ra.test(n.key)){if(null!==n.newValue&&(r=this.Ja(n.key,n.newValue)))return[2,this.Ya(r)]}else if(this.Pa.test(n.key)){if(null!==n.newValue&&(i=this.Xa(n.key,n.newValue)))return[2,this.Za(i)]}else if(n.key===this.ya){if(null!==n.newValue&&(o=this.pa(n.newValue)))return[2,this.ba(o)]}else if(n.key===this.ma)(s=function(t){var e=P.q;if(null!=t)try{var n=JSON.parse(t);y("number"==typeof n),e=n}catch(t){l("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==P.q&&this.M(s);else if(n.key===this.ga)return[2,this._a.tu()]}else this.Ta.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"ka",{get:function(){return this.Ea.get(this.la)},enumerable:!1,configurable:!0}),t.prototype.Va=function(){this.setItem(this.Ia,this.ka.aa())},t.prototype.xa=function(t,e,n){var r=new lo(this.currentUser,t,e,n),i=ho(this.persistenceKey,this.currentUser,t);this.setItem(i,r.aa())},t.prototype.Fa=function(t){var e=ho(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Ka=function(t){var e={clientId:this.la,onlineState:t};this.storage.setItem(this.ya,JSON.stringify(e))},t.prototype.qa=function(t,e,n){var r=fo(this.persistenceKey,t),i=new po(t,e,n);this.setItem(r,i.aa())},t.prototype.ja=function(){this.setItem(this.ga,"value-not-used")},t.prototype.Ga=function(t){var e=this.Aa.exec(t);return e?e[1]:null},t.prototype.Ha=function(t,e){var n=this.Ga(t);return vo.ca(n,e)},t.prototype.Ja=function(t,e){var n=this.Ra.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return lo.ca(new j(i),r,e)},t.prototype.Xa=function(t,e){var n=this.Pa.exec(t),r=Number(n[1]);return po.ca(r,e)},t.prototype.pa=function(t){return yo.ca(t)},t.prototype.Ya=function(t){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this._a.eu(t.batchId,t.state,t.error)]:(f("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.Za=function(t){return this._a.nu(t.targetId,t.state,t.error)},t.prototype.za=function(t,e){var n=this,r=e?this.Ea.zt(t,e):this.Ea.remove(t),i=this.Sa(this.Ea),o=this.Sa(r),u=[],s=[];return o.forEach((function(t){i.has(t)||u.push(t)})),i.forEach((function(t){o.has(t)||s.push(t)})),this._a.su(u,s).then((function(){n.Ea=r}))},t.prototype.ba=function(t){this.Ea.get(t.clientId)&&this.fa(t.onlineState)},t.prototype.Sa=function(t){var e=nn();return t.forEach((function(t,n){e=e.Pe(n.activeTargetIds)})),e},t}(),go=function(){function t(){this.iu=new mo,this.ru={},this.fa=null,this.M=null}return t.prototype.Ca=function(t){},t.prototype.Na=function(t,e,n){},t.prototype.Oa=function(t){return this.iu.ua(t),this.ru[t]||"not-current"},t.prototype.Ba=function(t,e,n){this.ru[t]=e},t.prototype.Ma=function(t){this.iu.ha(t)},t.prototype.La=function(t){return this.iu.activeTargetIds.has(t)},t.prototype.$a=function(t){delete this.ru[t]},t.prototype.va=function(){return this.iu.activeTargetIds},t.prototype.Da=function(t){return this.iu.activeTargetIds.has(t)},t.prototype.start=function(){return this.iu=new mo,Promise.resolve()},t.prototype.Ua=function(t,e,n){},t.prototype.Qa=function(t){},t.prototype.Mo=function(){},t.prototype.B=function(t){},t.prototype.Wa=function(){},t}(),wo=function(){function t(){}return t.prototype.ou=function(t){},t.prototype.Mo=function(){},t}(),_o=function(){function t(){var t=this;this.cu=function(){return t.au()},this.uu=function(){return t.hu()},this.lu=[],this._u()}return t.prototype.ou=function(t){this.lu.push(t)},t.prototype.Mo=function(){window.removeEventListener("online",this.cu),window.removeEventListener("offline",this.uu)},t.prototype._u=function(){window.addEventListener("online",this.cu),window.addEventListener("offline",this.uu)},t.prototype.au=function(){f("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.lu;t<e.length;t++)(0,e[t])(0)},t.prototype.hu=function(){f("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.lu;t<e.length;t++)(0,e[t])(1)},t.Kn=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Io={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Eo=function(){function t(t){this.fu=t.fu,this.du=t.du}return t.prototype.wu=function(t){this.Eu=t},t.prototype.Tu=function(t){this.Iu=t},t.prototype.onMessage=function(t){this.mu=t},t.prototype.close=function(){this.du()},t.prototype.send=function(t){this.fu(t)},t.prototype.Au=function(){this.Eu()},t.prototype.Ru=function(t){this.Iu(t)},t.prototype.Pu=function(t){this.mu(t)},t}(),Oo=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.i=e.i,n}return Object(u.c)(e,t),e.prototype.Su=function(t,e,n,r){return new Promise((function(i,u){var s=new o.f;s.listenOnce(o.c.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case o.a.NO_ERROR:var e=s.getResponseJson();f("Connection","XHR received:",JSON.stringify(e)),i(e);break;case o.a.TIMEOUT:f("Connection",'RPC "'+t+'" timed out'),u(new T(O.DEADLINE_EXCEEDED,"Request time out"));break;case o.a.HTTP_ERROR:var n=s.getStatus();if(f("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(O).indexOf(e)>=0?e:O.UNKNOWN}(r.status);u(new T(a,r.message))}else u(new T(O.UNKNOWN,"Server responded with status "+s.getStatus()))}else u(new T(O.UNAVAILABLE,"Connection failed."));break;default:v()}}finally{f("Connection",'RPC "'+t+'" completed.')}}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},e.prototype.Cu=function(t,e){var n=[this.gu,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Object(o.g)(),u=Object(o.h)(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.t.projectId+"/databases/"+this.t.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.i};this.vu(s.initMessageHeaders,e),Object(i.t)()||Object(i.w)()||Object(i.q)()||Object(i.s)()||Object(i.x)()||Object(i.p)()||(s.httpHeadersOverwriteParam="$httpHeaders");var a=n.join("");f("Connection","Creating WebChannel: "+a,s);var c=r.createWebChannel(a,s),h=!1,l=!1,d=new Eo({fu:function(t){l?f("Connection","Not sending because WebChannel is closed:",t):(h||(f("Connection","Opening WebChannel transport."),c.open(),h=!0),f("Connection","WebChannel sending:",t),c.send(t))},du:function(){return c.close()}}),v=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return v(c,o.e.EventType.OPEN,(function(){l||f("Connection","WebChannel transport opened.")})),v(c,o.e.EventType.CLOSE,(function(){l||(l=!0,f("Connection","WebChannel transport closed"),d.Ru())})),v(c,o.e.EventType.ERROR,(function(t){l||(l=!0,p("Connection","WebChannel transport errored:",t),d.Ru(new T(O.UNAVAILABLE,"The operation could not be completed")))})),v(c,o.e.EventType.MESSAGE,(function(t){var e;if(!l){var n=t.data[0];y(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){f("Connection","WebChannel received error:",i);var o=i.status,u=function(t){var e=Le[t];if(void 0!==e)return qe(e)}(o),s=i.message;void 0===u&&(u=O.INTERNAL,s="Unknown error status: "+o+" with message "+i.message),l=!0,d.Ru(new T(u,s)),c.close()}else f("Connection","WebChannel received:",n),d.Pu(n)}})),v(u,o.b.STAT_EVENT,(function(t){t.stat===o.d.PROXY?f("Connection","Detected buffering proxy"):t.stat===o.d.NOPROXY&&f("Connection","Detected no buffering proxy")})),setTimeout((function(){d.Au()}),0),d},e}(function(){function t(t){this.yu=t,this.t=t.t;var e=t.ssl?"https":"http";this.gu=e+"://"+t.host,this.Vu="projects/"+this.t.projectId+"/databases/"+this.t.database+"/documents"}return t.prototype.pu=function(t,e,n,r){var i=this.bu(t,e);f("RestConnection","Sending: ",i,n);var o={};return this.vu(o,r),this.Su(t,i,o,n).then((function(t){return f("RestConnection","Received: ",t),t}),(function(e){throw p("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Du=function(t,e,n,r){return this.pu(t,e,n,r)},t.prototype.vu=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.2.6",t["Content-Type"]="text/plain",e)for(var n in e.g)e.g.hasOwnProperty(n)&&(t[n]=e.g[n])},t.prototype.bu=function(t,e){var n=Io[t];return this.gu+"/v1/"+e+":"+n},t}());function To(){return"undefined"!=typeof window?window:null}function No(){return"undefined"!=typeof document?document:null}function jo(t){return new bn(t,!0)}var Ao=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Zr=t,this.fs=e,this.xu=n,this.Nu=r,this.Fu=i,this.Ou=0,this.ku=null,this.Mu=Date.now(),this.reset()}return t.prototype.reset=function(){this.Ou=0},t.prototype.Lu=function(){this.Ou=this.Fu},t.prototype.$u=function(t){var e=this;this.cancel();var n=Math.floor(this.Ou+this.Bu()),r=Math.max(0,Date.now()-this.Mu),i=Math.max(0,n-r);i>0&&f("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Ou+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.ku=this.Zr.Tr(this.fs,i,(function(){return e.Mu=Date.now(),t()})),this.Ou*=this.Nu,this.Ou<this.xu&&(this.Ou=this.xu),this.Ou>this.Fu&&(this.Ou=this.Fu)},t.prototype.qu=function(){null!==this.ku&&(this.ku.Rs(),this.ku=null)},t.prototype.cancel=function(){null!==this.ku&&(this.ku.cancel(),this.ku=null)},t.prototype.Bu=function(){return(Math.random()-.5)*this.Ou},t}(),Do=function(){function t(t,e,n,r,i,o){this.Zr=t,this.Uu=n,this.Qu=r,this.Ku=i,this.listener=o,this.state=0,this.Wu=0,this.ju=null,this.stream=null,this.Gu=new Ao(t,e)}return t.prototype.zu=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.Hu=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.Ju()},t.prototype.stop=function(){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(t){switch(t.label){case 0:return this.zu()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.Yu=function(){this.state=0,this.Gu.reset()},t.prototype.Xu=function(){var t=this;this.Hu()&&null===this.ju&&(this.ju=this.Zr.Tr(this.Uu,6e4,(function(){return t.Zu()})))},t.prototype.th=function(t){this.eh(),this.stream.send(t)},t.prototype.Zu=function(){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(t){return this.Hu()?[2,this.close(0)]:[2]}))}))},t.prototype.eh=function(){this.ju&&(this.ju.cancel(),this.ju=null)},t.prototype.close=function(t,e){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(n){switch(n.label){case 0:return this.eh(),this.Gu.cancel(),this.Wu++,3!==t?this.Gu.reset():e&&e.code===O.RESOURCE_EXHAUSTED?(l(e.toString()),l("Using maximum backoff delay to prevent overloading the backend."),this.Gu.Lu()):e&&e.code===O.UNAUTHENTICATED&&this.Ku.p(),null!==this.stream&&(this.nh(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Tu(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.nh=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.sh(this.Wu),n=this.Wu;this.Ku.getToken().then((function(e){t.Wu===n&&t.ih(e)}),(function(n){e((function(){var e=new T(O.UNKNOWN,"Fetching auth token failed: "+n.message);return t.rh(e)}))}))},t.prototype.ih=function(t){var e=this,n=this.sh(this.Wu);this.stream=this.oh(t),this.stream.wu((function(){n((function(){return e.state=2,e.listener.wu()}))})),this.stream.Tu((function(t){n((function(){return e.rh(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.Ju=function(){var t=this;this.state=4,this.Gu.$u((function(){return Object(u.b)(t,void 0,void 0,(function(){return Object(u.d)(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.rh=function(t){return f("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.sh=function(t){var e=this;return function(n){e.Zr.Ps((function(){return e.Wu===t?n():(f("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),So=function(t){function e(e,n,r,i,o){var u=this;return(u=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).Qt=i,u}return Object(u.c)(e,t),e.prototype.oh=function(t){return this.Qu.Cu("Listen",t)},e.prototype.onMessage=function(t){this.Gu.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:v()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.Bt?(y(void 0===e||"string"==typeof e),E.fromBase64String(e||"")):(y(void 0===e||e instanceof Uint8Array),E.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),u=(s=e.targetChange.cause)&&function(t){var e=void 0===t.code?O.UNKNOWN:qe(t.code);return new T(e,t.message||"")}(s);n=new fn(r,i,o,u||null)}else if("documentChange"in e){e.documentChange,(r=e.documentChange).document,r.document.name,r.document.updateTime,i=Nn(t,r.document.name),o=In(r.document.updateTime);var s=new lt({mapValue:{fields:r.document.fields}}),a=(u=new yt(i,o,s,{}),r.targetIds||[]),c=r.removedTargetIds||[];n=new cn(a,c,u.key,u)}else if("documentDelete"in e)e.documentDelete,(r=e.documentDelete).document,i=Nn(t,r.document),o=r.readTime?In(r.readTime):V.min(),s=new mt(i,o),u=r.removedTargetIds||[],n=new cn([],u,s.key,s);else if("documentRemove"in e)e.documentRemove,(r=e.documentRemove).document,i=Nn(t,r.document),o=r.removedTargetIds||[],n=new cn([],o,i,null);else{if(!("filter"in e))return v();e.filter;var h=e.filter;h.targetId,r=h.count||0,i=new Ue(r),o=h.targetId,n=new hn(o,i)}return n}(this.Qt,t),n=function(t){if(!("targetChange"in t))return V.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?V.min():e.readTime?In(e.readTime):V.min()}(t);return this.listener.ah(e,n)},e.prototype.uh=function(t){var e={};e.database=Dn(this.Qt),e.addTarget=function(t,e){var n,r=e.target;return(n=Et(r)?{documents:Vn(t,r)}:{query:Cn(t,r)}).targetId=e.targetId,e.resumeToken.l()>0?n.resumeToken=wn(t,e.resumeToken):e.kt._(V.min())>0&&(n.readTime=gn(t,e.kt.j())),n}(this.Qt,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return v()}}(0,e.Ot);return null==n?null:{"goog-listen-tags":n}}(this.Qt,t);n&&(e.labels=n),this.th(e)},e.prototype.hh=function(t){var e={};e.database=Dn(this.Qt),e.removeTarget=t,this.th(e)},e}(Do),xo=function(t){function e(e,n,r,i,o){var u=this;return(u=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).Qt=i,u.lh=!1,u}return Object(u.c)(e,t),Object.defineProperty(e.prototype,"_h",{get:function(){return this.lh},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.lh=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.nh=function(){this.lh&&this.fh([])},e.prototype.oh=function(t){return this.Qu.Cu("Write",t)},e.prototype.onMessage=function(t){if(y(!!t.streamToken),this.lastStreamToken=t.streamToken,this.lh){this.Gu.reset();var e=function(t,e){return t&&t.length>0?(y(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?In(t.updateTime):In(e);n.isEqual(V.min())&&(n=In(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new ge(n,r)}(t,e)}))):[]}(t.writeResults,t.commitTime),n=In(t.commitTime);return this.listener.dh(n,e)}return y(!t.writeResults||0===t.writeResults.length),this.lh=!0,this.listener.wh()},e.prototype.Eh=function(){var t={};t.database=Dn(this.Qt),this.th(t)},e.prototype.fh=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return Pn(e.Qt,t)}))};this.th(n)},e}(Do),ko=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Qu=n,i.Qt=r,i.Th=!1,i}return Object(u.c)(e,t),e.prototype.Ih=function(){if(this.Th)throw new T(O.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.pu=function(t,e,n){var r=this;return this.Ih(),this.credentials.getToken().then((function(i){return r.Qu.pu(t,e,n,i)})).catch((function(t){throw t.code===O.UNAUTHENTICATED&&r.credentials.p(),t}))},e.prototype.Du=function(t,e,n){var r=this;return this.Ih(),this.credentials.getToken().then((function(i){return r.Qu.Du(t,e,n,i)})).catch((function(t){throw t.code===O.UNAUTHENTICATED&&r.credentials.p(),t}))},e.prototype.terminate=function(){this.Th=!1},e}((function(){})),Po=function(){function t(t,e){this._s=t,this.fa=e,this.state="Unknown",this.mh=0,this.Ah=null,this.Rh=!0}return t.prototype.Ph=function(){var t=this;0===this.mh&&(this.yh("Unknown"),this.Ah=this._s.Tr("online_state_timeout",1e4,(function(){return t.Ah=null,t.gh("Backend didn't respond within 10 seconds."),t.yh("Offline"),Promise.resolve()})))},t.prototype.Vh=function(t){"Online"===this.state?this.yh("Unknown"):(this.mh++,this.mh>=1&&(this.ph(),this.gh("Connection failed 1 times. Most recent error: "+t.toString()),this.yh("Offline")))},t.prototype.set=function(t){this.ph(),this.mh=0,"Online"===t&&(this.Rh=!1),this.yh(t)},t.prototype.yh=function(t){t!==this.state&&(this.state=t,this.fa(t))},t.prototype.gh=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Rh?(l(e),this.Rh=!1):f("OnlineStateTracker",e)},t.prototype.ph=function(){null!==this.Ah&&(this.Ah.cancel(),this.Ah=null)},t}(),Lo=function(t,e,n,r,i){var o=this;this.bh=t,this.Sh=e,this._s=n,this.Dh={},this.Ch=[],this.xh=new Map,this.Nh=new Set,this.Fh=[],this.Oh=i,this.Oh.ou((function(t){n.Ps((function(){return Object(u.b)(o,void 0,void 0,(function(){return Object(u.d)(this,(function(t){switch(t.label){case 0:return Go(this)?(f("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(u.b)(this,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return(e=m(t)).Nh.add(4),[4,Co(e)];case 1:return n.sent(),e.kh.set("Unknown"),e.Nh.delete(4),[4,Vo(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.kh=new Po(n,r)};function Vo(t){return Object(u.b)(this,void 0,void 0,(function(){var e,n;return Object(u.d)(this,(function(r){switch(r.label){case 0:if(!Go(t))return[3,4];e=0,n=t.Fh,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Co(t){return Object(u.b)(this,void 0,void 0,(function(){var e,n;return Object(u.d)(this,(function(r){switch(r.label){case 0:e=0,n=t.Fh,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Ro(t,e){var n=m(t);n.xh.has(e.targetId)||(n.xh.set(e.targetId,e),zo(n)?Fo(n):iu(n).Hu()&&Mo(n,e))}function Uo(t,e){var n=m(t),r=iu(n);n.xh.delete(e),r.Hu()&&qo(n,e),0===n.xh.size&&(r.Hu()?r.Xu():Go(n)&&n.kh.set("Unknown"))}function Mo(t,e){t.Mh.on(e.targetId),iu(t).uh(e)}function qo(t,e){t.Mh.on(e),iu(t).hh(e)}function Fo(t){t.Mh=new pn({vn:function(e){return t.Dh.vn(e)},Sn:function(e){return t.xh.get(e)||null}}),iu(t).start(),t.kh.Ph()}function zo(t){return Go(t)&&!iu(t).zu()&&t.xh.size>0}function Go(t){return 0===m(t).Nh.size}function Bo(t){t.Mh=void 0}function Qo(t){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(e){return t.xh.forEach((function(e,n){Mo(t,e)})),[2]}))}))}function Yo(t,e){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(n){return Bo(t),zo(t)?(t.kh.Vh(e),Fo(t)):t.kh.set("Unknown"),[2]}))}))}function Ho(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i,o;return Object(u.d)(this,(function(s){switch(s.label){case 0:if(t.kh.set("Online"),!(e instanceof fn&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(u.d)(this,(function(u){switch(u.label){case 0:n=e.cause,r=0,i=e.targetIds,u.label=1;case 1:return r<i.length?(o=i[r],t.xh.has(o)?[4,t.Dh.Lh(o,n)]:[3,3]):[3,5];case 2:u.sent(),t.xh.delete(o),t.Mh.removeTarget(o),u.label=3;case 3:u.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),f("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,Ko(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof cn?t.Mh.dn(e):e instanceof hn?t.Mh.Pn(e):t.Mh.Tn(e),n.isEqual(V.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Fi(t.bh)];case 8:return i=s.sent(),n._(i)>=0?[4,function(t,e){var n=t.Mh.Vn(e);return n.Fe.forEach((function(n,r){if(n.resumeToken.l()>0){var i=t.xh.get(r);i&&t.xh.set(r,i.Lt(n.resumeToken,e))}})),n.Oe.forEach((function(e){var n=t.xh.get(e);if(n){t.xh.set(e,n.Lt(E.T,n.kt)),qo(t,e);var r=new ne(n.target,e,1,n.sequenceNumber);Mo(t,r)}})),t.Dh.$h(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return f("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,Ko(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}}))}))}function Ko(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r=this;return Object(u.d)(this,(function(i){switch(i.label){case 0:if(!tr(e))throw e;return t.Nh.add(1),[4,Co(t)];case 1:return i.sent(),t.kh.set("Offline"),n||(n=function(){return Fi(t.bh)}),t._s.po((function(){return Object(u.b)(r,void 0,void 0,(function(){return Object(u.d)(this,(function(e){switch(e.label){case 0:return f("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Nh.delete(1),[4,Vo(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Xo(t,e){return e().catch((function(n){return Ko(t,n,e)}))}function Wo(t){return Object(u.b)(this,void 0,void 0,(function(){var e,n,r,i,o;return Object(u.d)(this,(function(u){switch(u.label){case 0:e=m(t),n=ou(e),r=e.Ch.length>0?e.Ch[e.Ch.length-1].batchId:-1,u.label=1;case 1:if(!function(t){return Go(t)&&t.Ch.length<10}(e))return[3,7];u.label=2;case 2:return u.trys.push([2,4,,6]),[4,Bi(e.bh,r)];case 3:return null===(i=u.sent())?(0===e.Ch.length&&n.Xu(),[3,7]):(r=i.batchId,function(t,e){t.Ch.push(e);var n=ou(t);n.Hu()&&n._h&&n.fh(e.mutations)}(e,i),[3,6]);case 4:return o=u.sent(),[4,Ko(e,o)];case 5:return u.sent(),[3,6];case 6:return[3,1];case 7:return Zo(e)&&Jo(e),[2]}}))}))}function Zo(t){return Go(t)&&!ou(t).zu()&&t.Ch.length>0}function Jo(t){ou(t).start()}function $o(t){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(e){return ou(t).Eh(),[2]}))}))}function tu(t){return Object(u.b)(this,void 0,void 0,(function(){var e,n,r,i;return Object(u.d)(this,(function(o){for(e=ou(t),n=0,r=t.Ch;n<r.length;n++)i=r[n],e.fh(i.mutations);return[2]}))}))}function eu(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:return r=t.Ch.shift(),i=Pr.from(r,e,n),[4,Xo(t,(function(){return t.Dh.Bh(i)}))];case 1:return o.sent(),[4,Wo(t)];case 2:return o.sent(),[2]}}))}))}function nu(t,e){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(n){switch(n.label){case 0:return e&&ou(t)._h?[4,function(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r;return Object(u.d)(this,(function(i){switch(i.label){case 0:return Me(r=e.code)&&r!==O.ABORTED?(n=t.Ch.shift(),ou(t).Yu(),[4,Xo(t,(function(){return t.Dh.qh(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,Wo(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Zo(t)&&Jo(t),[2]}}))}))}function ru(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n;return Object(u.d)(this,(function(r){switch(r.label){case 0:return n=m(t),e?(n.Nh.delete(2),[4,Vo(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Nh.add(2),[4,Co(n)]);case 3:r.sent(),n.kh.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function iu(t){var e=this;return t.Uh||(t.Uh=function(t,e,n){var r=m(t);return r.Ih(),new So(e,r.Qu,r.credentials,r.Qt,n)}(t.Sh,t._s,{wu:Qo.bind(null,t),Tu:Yo.bind(null,t),ah:Ho.bind(null,t)}),t.Fh.push((function(n){return Object(u.b)(e,void 0,void 0,(function(){return Object(u.d)(this,(function(e){switch(e.label){case 0:return n?(t.Uh.Yu(),zo(t)?Fo(t):t.kh.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Uh.stop()];case 2:e.sent(),Bo(t),e.label=3;case 3:return[2]}}))}))}))),t.Uh}function ou(t){var e=this;return t.Qh||(t.Qh=function(t,e,n){var r=m(t);return r.Ih(),new xo(e,r.Qu,r.credentials,r.Qt,n)}(t.Sh,t._s,{wu:$o.bind(null,t),Tu:nu.bind(null,t),wh:tu.bind(null,t),dh:eu.bind(null,t)}),t.Fh.push((function(n){return Object(u.b)(e,void 0,void 0,(function(){return Object(u.d)(this,(function(e){switch(e.label){case 0:return n?(t.Qh.Yu(),[4,Wo(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Qh.stop()];case 3:e.sent(),t.Ch.length>0&&(f("RemoteStore","Stopping write stream with "+t.Ch.length+" pending writes"),t.Ch=[]),e.label=4;case 4:return[2]}}))}))}))),t.Qh}var uu=function(){this.Kh=void 0,this.listeners=[]},su=function(){this.queries=new ei((function(t){return Zt(t)}),Wt),this.onlineState="Unknown",this.Wh=new Set};function au(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,c;return Object(u.d)(this,(function(u){switch(u.label){case 0:if(n=m(t),r=e.query,i=!1,(o=n.queries.get(r))||(i=!0,o=new uu),!i)return[3,4];u.label=1;case 1:return u.trys.push([1,3,,4]),s=o,[4,n.jh(r)];case 2:return s.Kh=u.sent(),[3,4];case 3:return a=u.sent(),c=ur(a,"Initialization of query '"+Jt(e.query)+"' failed"),[2,void e.onError(c)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.Gh(n.onlineState),o.Kh&&e.zh(o.Kh)&&lu(n),[2]}}))}))}function cu(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(u.d)(this,(function(u){return n=m(t),r=e.query,i=!1,(o=n.queries.get(r))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.Hh(r))]:[2]}))}))}function hu(t,e){for(var n=m(t),r=!1,i=0,o=e;i<o.length;i++){var u=o[i],s=u.query,a=n.queries.get(s);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].zh(u)&&(r=!0);a.Kh=u}}r&&lu(n)}function fu(t,e,n){var r=m(t),i=r.queries.get(e);if(i)for(var o=0,u=i.listeners;o<u.length;o++)u[o].onError(n);r.queries.delete(e)}function lu(t){t.Wh.forEach((function(t){t.next()}))}var pu=function(){function t(t,e,n){this.query=t,this.Jh=e,this.Yh=!1,this.Xh=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.zh=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new un(t.query,t.docs,t.Se,e,t.De,t.fromCache,t.Ce,!0)}var o=!1;return this.Yh?this.Zh(t)&&(this.Jh.next(t),o=!0):this.tl(t,this.onlineState)&&(this.el(t),o=!0),this.Xh=t,o},t.prototype.onError=function(t){this.Jh.error(t)},t.prototype.Gh=function(t){this.onlineState=t;var e=!1;return this.Xh&&!this.Yh&&this.tl(this.Xh,t)&&(this.el(this.Xh),e=!0),e},t.prototype.tl=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.nl&&n||t.docs.et()&&"Offline"!==e)},t.prototype.Zh=function(t){if(t.docChanges.length>0)return!0;var e=this.Xh&&this.Xh.hasPendingWrites!==t.hasPendingWrites;return!(!t.Ce&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.el=function(t){t=un.Ne(t.query,t.docs,t.De,t.fromCache),this.Yh=!0,this.Jh.next(t)},t}(),du=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.sl=function(){return"metadata"in this.payload},t}(),vu=function(){function t(t){this.Qt=t}return t.prototype.Pc=function(t){return Nn(this.Qt,t)},t.prototype.yc=function(t){return t.metadata.exists?kn(this.Qt,t.document,!1):new mt(this.Pc(t.metadata.name),this.gc(t.metadata.readTime))},t.prototype.gc=function(t){return In(t)},t}();!function(){function t(t,e,n){this.il=t,this.bh=e,this.Qt=n,this.queries=[],this.documents=[],this.progress=yu(t)}t.prototype.rl=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.ol=function(t){for(var e=new Map,n=new vu(this.Qt),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var u=n.Pc(o.metadata.name),s=0,a=o.metadata.queries;s<a.length;s++){var c=a[s],h=(e.get(c)||tn()).add(u);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(u.b)(this,void 0,void 0,(function(){var t,e,n,r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:return[4,Zi(this.bh,new vu(this.Qt),this.documents,this.il.id)];case 1:t=o.sent(),e=this.ol(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?(i=r[n],[4,Ji(this.bh,i,e.get(i.name))]):[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Pi(Object.assign({},this.progress),t))]}}))}))}}();function yu(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var mu=function(t){this.key=t},bu=function(t){this.key=t},gu=function(){function t(t,e){this.query=t,this.cl=e,this.al=null,this.Be=!1,this.ul=tn(),this.De=tn(),this.hl=te(t),this.ll=new rn(this.hl)}return Object.defineProperty(t.prototype,"_l",{get:function(){return this.cl},enumerable:!1,configurable:!0}),t.prototype.fl=function(t,e){var n=this,r=e?e.dl:new on,i=e?e.ll:this.ll,o=e?e.De:this.De,u=i,s=!1,a=zt(this.query)&&i.size===this.query.limit?i.last():null,c=Gt(this.query)&&i.size===this.query.limit?i.first():null;if(t.Xt((function(t,e){var h=i.get(t),f=e instanceof yt?e:null;f&&(f=$t(n.query,f)?f:null);var l=!!h&&n.De.has(h.key),p=!!f&&(f.Vt||n.De.has(f.key)&&f.hasCommittedMutations),d=!1;h&&f?h.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.wl(h,f)||(r.track({type:2,doc:f}),d=!0,(a&&n.hl(f,a)>0||c&&n.hl(f,c)<0)&&(s=!0)):!h&&f?(r.track({type:0,doc:f}),d=!0):h&&!f&&(r.track({type:1,doc:h}),d=!0,(a||c)&&(s=!0)),d&&(f?(u=u.add(f),o=p?o.add(t):o.delete(t)):(u=u.delete(t),o=o.delete(t)))})),zt(this.query)||Gt(this.query))for(;u.size>this.query.limit;){var h=zt(this.query)?u.last():u.first();u=u.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{ll:u,dl:r,lc:s,De:o}},t.prototype.wl=function(t,e){return t.Vt&&e.hasCommittedMutations&&!e.Vt},t.prototype.wi=function(t,e,n){var r=this,i=this.ll;this.ll=t.ll,this.De=t.De;var o=t.dl.ve();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return v()}};return n(t)-n(e)}(t.type,e.type)||r.hl(t.doc,e.doc)})),this.El(n);var u=e?this.Tl():[],s=0===this.ul.size&&this.Be?1:0,a=s!==this.al;return this.al=s,0!==o.length||a?{snapshot:new un(this.query,t.ll,i,o,t.De,0===s,a,!1),Il:u}:{Il:u}},t.prototype.Gh=function(t){return this.Be&&"Offline"===t?(this.Be=!1,this.wi({ll:this.ll,dl:new on,De:this.De,lc:!1},!1)):{Il:[]}},t.prototype.ml=function(t){return!this.cl.has(t)&&!!this.ll.has(t)&&!this.ll.get(t).Vt},t.prototype.El=function(t){var e=this;t&&(t.qe.forEach((function(t){return e.cl=e.cl.add(t)})),t.Ue.forEach((function(t){})),t.Qe.forEach((function(t){return e.cl=e.cl.delete(t)})),this.Be=t.Be)},t.prototype.Tl=function(){var t=this;if(!this.Be)return[];var e=this.ul;this.ul=tn(),this.ll.forEach((function(e){t.ml(e.key)&&(t.ul=t.ul.add(e.key))}));var n=[];return e.forEach((function(e){t.ul.has(e)||n.push(new bu(e))})),this.ul.forEach((function(t){e.has(t)||n.push(new mu(t))})),n},t.prototype.Al=function(t){this.cl=t.Rc,this.ul=tn();var e=this.fl(t.documents);return this.wi(e,!0)},t.prototype.Rl=function(){return un.Ne(this.query,this.ll,this.De,0===this.al)},t}(),wu=function(t,e,n){this.query=t,this.targetId=e,this.view=n},_u=function(t){this.key=t,this.Pl=!1},Iu=function(){function t(t,e,n,r,i,o){this.bh=t,this.yl=e,this.gl=n,this.Vl=r,this.currentUser=i,this.pl=o,this.bl={},this.vl=new ei((function(t){return Zt(t)}),Wt),this.Sl=new Map,this.Dl=[],this.Cl=new Fe(q.H),this.xl=new Map,this.Nl=new to,this.Fl={},this.Ol=new Map,this.kl=hi.$i(),this.onlineState="Unknown",this.Ml=void 0}return Object.defineProperty(t.prototype,"Ll",{get:function(){return!0===this.Ml},enumerable:!1,configurable:!0}),t}();function Eu(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a;return Object(u.d)(this,(function(u){switch(u.label){case 0:return n=Ju(t),(o=n.vl.get(e))?(r=o.targetId,n.Vl.Oa(r),i=o.view.Rl(),[3,4]):[3,1];case 1:return[4,Qi(n.bh,Kt(e))];case 2:return s=u.sent(),a=n.Vl.Oa(s.targetId),r=s.targetId,[4,Ou(n,e,r,"current"===a)];case 3:i=u.sent(),n.Ll&&Ro(n.yl,s),u.label=4;case 4:return[2,i]}}))}))}function Ou(t,e,n,r){return Object(u.b)(this,void 0,void 0,(function(){var i,o,s,a,c,h;return Object(u.d)(this,(function(f){switch(f.label){case 0:return t.$l=function(e,n,r){return function(t,e,n,r){return Object(u.b)(this,void 0,void 0,(function(){var i,o,s;return Object(u.d)(this,(function(u){switch(u.label){case 0:return(i=e.view.fl(n)).lc?[4,Hi(t.bh,e.query,!1).then((function(t){var n=t.documents;return e.view.fl(n,i)}))]:[3,2];case 1:i=u.sent(),u.label=2;case 2:return o=r&&r.Fe.get(e.targetId),s=e.view.wi(i,t.Ll,o),[2,(Ru(t,e.targetId,s.Il),s.snapshot)]}}))}))}(t,e,n,r)},[4,Hi(t.bh,e,!0)];case 1:return i=f.sent(),o=new gu(e,i.Rc),s=o.fl(i.documents),a=an.$e(n,r&&"Offline"!==t.onlineState),c=o.wi(s,t.Ll,a),Ru(t,n,c.Il),h=new wu(e,n,o),[2,(t.vl.set(e,h),t.Sl.has(n)?t.Sl.get(n).push(e):t.Sl.set(n,[e]),c.snapshot)]}}))}))}function Tu(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:return n=m(t),r=n.vl.get(e),(i=n.Sl.get(r.targetId)).length>1?[2,(n.Sl.set(r.targetId,i.filter((function(t){return!Wt(t,e)}))),void n.vl.delete(e))]:n.Ll?(n.Vl.Ma(r.targetId),n.Vl.Da(r.targetId)?[3,2]:[4,Yi(n.bh,r.targetId,!1).then((function(){n.Vl.$a(r.targetId),Uo(n.yl,r.targetId),Vu(n,r.targetId)})).catch(ti)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return Vu(n,r.targetId),[4,Yi(n.bh,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}function Nu(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(u.d)(this,(function(u){switch(u.label){case 0:r=$u(t),u.label=1;case 1:return u.trys.push([1,5,,6]),[4,function(t,e){var n,r=m(t),i=L.now(),o=e.reduce((function(t,e){return t.add(e.key)}),tn());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Tc.Xo(t,o).next((function(o){n=o;for(var u=[],s=0,a=e;s<a.length;s++){var c=a[s],h=Te(c,n.get(c.key));null!=h&&u.push(new De(c.key,h,dt(h.proto.mapValue),we.exists(!0)))}return r.zo.Ri(t,i,u,e)}))})).then((function(t){var e=t.xs(n);return{batchId:t.batchId,ri:e}}))}(r.bh,e)];case 2:return i=u.sent(),r.Vl.Ca(i.batchId),function(t,e,n){var r=t.Fl[t.currentUser.A()];r||(r=new Fe(w)),r=r.zt(e,n),t.Fl[t.currentUser.A()]=r}(r,i.batchId,n),[4,qu(r,i.ri)];case 3:return u.sent(),[4,Wo(r.yl)];case 4:return u.sent(),[3,6];case 5:return o=u.sent(),s=ur(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}}))}))}function ju(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r;return Object(u.d)(this,(function(i){switch(i.label){case 0:n=m(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,zi(n.bh,e)];case 2:return r=i.sent(),e.Fe.forEach((function(t,e){var r=n.xl.get(e);r&&(y(t.qe.size+t.Ue.size+t.Qe.size<=1),t.qe.size>0?r.Pl=!0:t.Ue.size>0?y(r.Pl):t.Qe.size>0&&(y(r.Pl),r.Pl=!1))})),[4,qu(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,ti(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function Au(t,e,n){var r=m(t);if(r.Ll&&0===n||!r.Ll&&1===n){var i=[];r.vl.forEach((function(t,n){var r=n.view.Gh(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=m(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].Gh(e)&&(r=!0)})),r&&lu(n)}(r.gl,e),i.length&&r.bl.ah(i),r.onlineState=e,r.Ll&&r.Vl.Qa(e)}}function Du(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i,o,s,a,c;return Object(u.d)(this,(function(u){switch(u.label){case 0:return(r=m(t)).Vl.Ba(e,"rejected",n),i=r.xl.get(e),(o=i&&i.key)?(s=(s=new Fe(q.H)).zt(o,new mt(o,V.min())),a=tn().add(o),c=new sn(V.min(),new Map,new Be(w),s,a),[4,ju(r,c)]):[3,2];case 1:return u.sent(),r.Cl=r.Cl.remove(o),r.xl.delete(e),Mu(r),[3,4];case 2:return[4,Yi(r.bh,e,!1).then((function(){return Vu(r,e,n)})).catch(ti)];case 3:u.sent(),u.label=4;case 4:return[2]}}))}))}function Su(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:n=m(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,qi(n.bh,e)];case 2:return i=o.sent(),Lu(n,r,null),Pu(n,r),n.Vl.Na(r,"acknowledged"),[4,qu(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,ti(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function xu(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:r=m(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=m(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n.zo.Pi(t,e).next((function(e){return y(null!==e),r=e.keys(),n.zo.Ci(t,e)})).next((function(){return n.zo.Fi(t)})).next((function(){return n.Tc.Xo(t,r)}))}))}(r.bh,e)];case 2:return i=o.sent(),Lu(r,e,n),Pu(r,e),r.Vl.Na(e,"rejected",n),[4,qu(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,ti(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function ku(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(u.d)(this,(function(u){switch(u.label){case 0:Go((n=m(t)).yl)||f("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,function(t){var e=m(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e.zo.Vi(t)}))}(n.bh)];case 2:return-1===(r=u.sent())?[2,void e.resolve()]:((i=n.Ol.get(r)||[]).push(e),n.Ol.set(r,i),[3,4]);case 3:return o=u.sent(),s=ur(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}}))}))}function Pu(t,e){(t.Ol.get(e)||[]).forEach((function(t){t.resolve()})),t.Ol.delete(e)}function Lu(t,e,n){var r=m(t),i=r.Fl[r.currentUser.A()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Fl[r.currentUser.A()]=i}}function Vu(t,e,n){void 0===n&&(n=null),t.Vl.Ma(e);for(var r=0,i=t.Sl.get(e);r<i.length;r++){var o=i[r];t.vl.delete(o),n&&t.bl.Bl(o,n)}t.Sl.delete(e),t.Ll&&t.Nl.Oc(e).forEach((function(e){t.Nl.Oi(e)||Cu(t,e)}))}function Cu(t,e){var n=t.Cl.get(e);null!==n&&(Uo(t.yl,n),t.Cl=t.Cl.remove(e),t.xl.delete(n),Mu(t))}function Ru(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof mu?(t.Nl.nr(o.key,e),Uu(t,o)):o instanceof bu?(f("SyncEngine","Document no longer in limbo: "+o.key),t.Nl.ir(o.key,e),t.Nl.Oi(o.key)||Cu(t,o.key)):v()}}function Uu(t,e){var n=e.key;t.Cl.get(n)||(f("SyncEngine","New document in limbo: "+n),t.Dl.push(n),Mu(t))}function Mu(t){for(;t.Dl.length>0&&t.Cl.size<t.pl;){var e=t.Dl.shift(),n=t.kl.next();t.xl.set(n,new _u(e)),t.Cl=t.Cl.zt(e,n),Ro(t.yl,new ne(Kt(Ft(e.path)),n,2,P.q))}}function qu(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(u.d)(this,(function(a){switch(a.label){case 0:return r=m(t),i=[],o=[],s=[],r.vl.et()?[3,3]:(r.vl.forEach((function(t,u){s.push(r.$l(u,e,n).then((function(t){if(t){r.Ll&&r.Vl.Ba(u.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=Vi.oc(u.targetId,t);o.push(e)}})))})),[4,Promise.all(s)]);case 1:return a.sent(),r.bl.ah(i),[4,function(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,c,h,l;return Object(u.d)(this,(function(u){switch(u.label){case 0:n=m(t),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return Xn.forEach(e,(function(e){return Xn.forEach(e.ic,(function(r){return n.persistence.Ti.nr(t,e.targetId,r)})).next((function(){return Xn.forEach(e.rc,(function(r){return n.persistence.Ti.ir(t,e.targetId,r)}))}))}))}))];case 2:return u.sent(),[3,4];case 3:if(!tr(r=u.sent()))throw r;return f("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)s=o[i],a=s.targetId,s.fromCache||(c=n.fc.get(a),h=c.kt,l=c.$t(h),n.fc=n.fc.zt(a,l));return[2]}}))}))}(r.bh,o)];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))}function Fu(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r;return Object(u.d)(this,(function(i){switch(i.label){case 0:return(n=m(t)).currentUser.isEqual(e)?[3,3]:(f("SyncEngine","User change. New user:",e.A()),[4,Mi(n.bh,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Ol.forEach((function(t){t.forEach((function(t){t.reject(new T(O.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ol.clear()}(n),n.Vl.Ua(e,r.mc,r.Ac),[4,qu(n,r.Ic)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}function zu(t,e){var n=m(t),r=n.xl.get(e);if(r&&r.Pl)return tn().add(r.key);var i=tn(),o=n.Sl.get(e);if(!o)return i;for(var u=0,s=o;u<s.length;u++){var a=s[u],c=n.vl.get(a);i=i.Pe(c.view._l)}return i}function Gu(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:return[4,Hi((n=m(t)).bh,e.query,!0)];case 1:return r=o.sent(),i=e.view.Al(r),[2,(n.Ll&&Ru(n,e.targetId,i.Il),i)]}}))}))}function Bu(t){return Object(u.b)(this,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){return[2,Xi((e=m(t)).bh).then((function(t){return qu(e,t)}))]}))}))}function Qu(t,e,n,r){return Object(u.b)(this,void 0,void 0,(function(){var i,o;return Object(u.d)(this,(function(u){switch(u.label){case 0:return[4,function(t,e){var n=m(t),r=m(n.zo);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.yi(t,e).next((function(e){return e?n.Tc.Xo(t,e):Xn.resolve(null)}))}))}((i=m(t)).bh,e)];case 1:return null===(o=u.sent())?[3,6]:"pending"!==n?[3,3]:[4,Wo(i.yl)];case 2:return u.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Lu(i,e,r||null),Pu(i,e),function(t,e){m(m(t).zo).xi(e)}(i.bh,e)):v(),u.label=4;case 4:return[4,qu(i,o)];case 5:return u.sent(),[3,7];case 6:f("SyncEngine","Cannot apply mutation batch with id: "+e),u.label=7;case 7:return[2]}}))}))}function Yu(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,c,h;return Object(u.d)(this,(function(u){switch(u.label){case 0:return Ju(n=m(t)),$u(n),!0!==e||!0===n.Ml?[3,3]:(r=n.Vl.va(),[4,Hu(n,r.it())]);case 1:return i=u.sent(),n.Ml=!0,[4,ru(n.yl,!0)];case 2:for(u.sent(),o=0,s=i;o<s.length;o++)a=s[o],Ro(n.yl,a);return[3,7];case 3:return!1!==e||!1===n.Ml?[3,7]:(c=[],h=Promise.resolve(),n.Sl.forEach((function(t,e){n.Vl.La(e)?c.push(e):h=h.then((function(){return Vu(n,e),Yi(n.bh,e,!0)})),Uo(n.yl,e)})),[4,h]);case 4:return u.sent(),[4,Hu(n,c)];case 5:return u.sent(),function(t){var e=m(t);e.xl.forEach((function(t,n){Uo(e.yl,n)})),e.Nl.kc(),e.xl=new Map,e.Cl=new Fe(q.H)}(n),n.Ml=!1,[4,ru(n.yl,!1)];case 6:u.sent(),u.label=7;case 7:return[2]}}))}))}function Hu(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,c,h,f,l,p,d,v,y;return Object(u.d)(this,(function(u){switch(u.label){case 0:n=m(t),r=[],i=[],o=0,s=e,u.label=1;case 1:return o<s.length?(a=s[o],c=void 0,(h=n.Sl.get(a))&&0!==h.length?[4,Qi(n.bh,Kt(h[0]))]:[3,7]):[3,13];case 2:c=u.sent(),f=0,l=h,u.label=3;case 3:return f<l.length?(p=l[f],d=n.vl.get(p),[4,Gu(n,d)]):[3,6];case 4:(v=u.sent()).snapshot&&i.push(v.snapshot),u.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,Ki(n.bh,a)];case 8:return y=u.sent(),[4,Qi(n.bh,y)];case 9:return c=u.sent(),[4,Ou(n,Ku(y),a,!1)];case 10:u.sent(),u.label=11;case 11:r.push(c),u.label=12;case 12:return o++,[3,1];case 13:return[2,(n.bl.ah(i),r)]}}))}))}function Ku(t){return qt(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Xu(t){var e=m(t);return m(m(e.bh).persistence).Uo()}function Wu(t,e,n,r){return Object(u.b)(this,void 0,void 0,(function(){var i,o,s;return Object(u.d)(this,(function(u){switch(u.label){case 0:return(i=m(t)).Ml?(f("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Sl.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Xi(i.bh)];case 3:return o=u.sent(),s=sn.Le(e,"current"===n),[4,qu(i,o,s)];case 4:return u.sent(),[3,8];case 5:return[4,Yi(i.bh,e,!0)];case 6:return u.sent(),Vu(i,e,r),[3,8];case 7:v(),u.label=8;case 8:return[2]}}))}))}function Zu(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i,o,s,a,c,h,l,p,d;return Object(u.d)(this,(function(v){switch(v.label){case 0:if(!(r=Ju(t)).Ml)return[3,10];i=0,o=e,v.label=1;case 1:return i<o.length?(s=o[i],r.Sl.has(s)?(f("SyncEngine","Adding an already active target "+s),[3,5]):[4,Ki(r.bh,s)]):[3,6];case 2:return a=v.sent(),[4,Qi(r.bh,a)];case 3:return c=v.sent(),[4,Ou(r,Ku(a),c.targetId,!1)];case 4:v.sent(),Ro(r.yl,c),v.label=5;case 5:return i++,[3,1];case 6:h=function(t){return Object(u.d)(this,(function(e){switch(e.label){case 0:return r.Sl.has(t)?[4,Yi(r.bh,t,!1).then((function(){Uo(r.yl,t),Vu(r,t)})).catch(ti)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},l=0,p=n,v.label=7;case 7:return l<p.length?(d=p[l],[5,h(d)]):[3,10];case 8:v.sent(),v.label=9;case 9:return l++,[3,7];case 10:return[2]}}))}))}function Ju(t){var e=m(t);return e.yl.Dh.$h=ju.bind(null,e),e.yl.Dh.vn=zu.bind(null,e),e.yl.Dh.Lh=Du.bind(null,e),e.bl.ah=hu.bind(null,e.gl),e.bl.Bl=fu.bind(null,e.gl),e}function $u(t){var e=m(t);return e.yl.Dh.Bh=Su.bind(null,e),e.yl.Dh.qh=xu.bind(null,e),e}var ts=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(e){switch(e.label){case 0:return this.Qt=jo(t.yu.t),this.Vl=this.Wl(t),this.persistence=this.jl(t),[4,this.persistence.start()];case 1:return e.sent(),this.Gl=this.zl(t),this.bh=this.Hl(t),[2]}}))}))},t.prototype.zl=function(t){return null},t.prototype.Hl=function(t){return Ui(this.persistence,new Ci,t.Jl,this.Qt)},t.prototype.jl=function(t){return new uo(ao.ia,this.Qt)},t.prototype.Wl=function(t){return new go},t.prototype.terminate=function(){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(t){switch(t.label){case 0:return this.Gl&&this.Gl.stop(),[4,this.Vl.Mo()];case 1:return t.sent(),[4,this.persistence.Mo()];case 2:return t.sent(),[2]}}))}))},t}(),es=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Yl=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(u.c)(e,t),e.prototype.initialize=function(e){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,Wi(this.bh)];case 2:return n.sent(),[4,this.Yl.initialize(this,e)];case 3:return n.sent(),[4,$u(this.Yl._a)];case 4:return n.sent(),[4,Wo(this.Yl.yl)];case 5:return n.sent(),[2]}}))}))},e.prototype.Hl=function(t){return Ui(this.persistence,new Ci,t.Jl,this.Qt)},e.prototype.zl=function(t){var e=this.persistence.Ti.lr;return new mi(e,t._s)},e.prototype.jl=function(t){var e=ki(t.yu.t,t.yu.persistenceKey),n=void 0!==this.cacheSizeBytes?$r.Ys(this.cacheSizeBytes):$r.ti;return new Di(this.synchronizeTabs,e,t.clientId,n,t._s,To(),No(),this.Qt,this.Vl,!!this.forceOwnership)},e.prototype.Wl=function(t){return new go},e}(ts),ns=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Yl=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(u.c)(e,t),e.prototype.initialize=function(e){return Object(u.b)(this,void 0,void 0,(function(){var n,r=this;return Object(u.d)(this,(function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Yl._a,this.Vl instanceof bo?(this.Vl._a={eu:Qu.bind(null,n),nu:Wu.bind(null,n),su:Zu.bind(null,n),Uo:Xu.bind(null,n),tu:Bu.bind(null,n)},[4,this.Vl.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.Ro((function(t){return Object(u.b)(r,void 0,void 0,(function(){return Object(u.d)(this,(function(e){switch(e.label){case 0:return[4,Yu(this.Yl._a,t)];case 1:return e.sent(),this.Gl&&(t&&!this.Gl.Er?this.Gl.start(this.bh):t||this.Gl.stop()),[2]}}))}))}))];case 4:return i.sent(),[2]}}))}))},e.prototype.Wl=function(t){var e=To();if(!bo.Kn(e))throw new T(O.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=ki(t.yu.t,t.yu.persistenceKey);return new bo(e,t._s,n,t.clientId,t.Jl)},e}(es),rs=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n=this;return Object(u.d)(this,(function(r){switch(r.label){case 0:return this.bh?[3,2]:(this.bh=t.bh,this.Vl=t.Vl,this.Sh=this.Xl(e),this.yl=this.Zl(e),this.gl=this.t_(e),this._a=this.e_(e,!t.synchronizeTabs),this.Vl.fa=function(t){return Au(n._a,t,1)},this.yl.Dh.n_=Fu.bind(null,this._a),[4,ru(this.yl,this._a.Ll)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.t_=function(t){return new su},t.prototype.Xl=function(t){var e,n=jo(t.yu.t),r=(e=t.yu,new Oo(e));return function(t,e,n){return new ko(t,e,n)}(t.credentials,r,n)},t.prototype.Zl=function(t){var e,n,r,i,o,u=this;return e=this.bh,n=this.Sh,r=t._s,i=function(t){return Au(u._a,t,0)},o=_o.Kn()?new _o:new wo,new Lo(e,n,r,i,o)},t.prototype.e_=function(t,e){return function(t,e,n,r,i,o,u){var s=new Iu(t,e,n,r,i,o);return u&&(s.Ml=!0),s}(this.bh,this.yl,this.gl,this.Vl,t.Jl,t.pl,e)},t.prototype.terminate=function(){return function(t){return Object(u.b)(this,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return e=m(t),f("RemoteStore","RemoteStore shutting down."),e.Nh.add(5),[4,Co(e)];case 1:return n.sent(),e.Oh.Mo(),e.kh.set("Unknown"),[2]}}))}))}(this.yl)},t}();var is=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.s_(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.s_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.i_=function(){this.muted=!0},t.prototype.s_=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),os=(function(){function t(t,e){var n=this;this.r_=t,this.Qt=e,this.metadata=new Kn,this.buffer=new Uint8Array,this.o_=new TextDecoder("utf-8"),this.c_().then((function(t){t&&t.sl()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}t.prototype.close=function(){return this.r_.cancel()},t.prototype.getMetadata=function(){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(t){return[2,this.metadata.promise]}))}))},t.prototype.Ql=function(){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.c_())]}}))}))},t.prototype.c_=function(){return Object(u.b)(this,void 0,void 0,(function(){var t,e,n,r;return Object(u.d)(this,(function(i){switch(i.label){case 0:return[4,this.a_()];case 1:return null===(t=i.sent())?[2,null]:(e=this.o_.decode(t),n=Number(e),isNaN(n)&&this.u_("length string ("+e+") is not valid number"),[4,this.h_(n)]);case 2:return r=i.sent(),[2,new du(JSON.parse(r),t.length+n)]}}))}))},t.prototype.l_=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},t.prototype.a_=function(){return Object(u.b)(this,void 0,void 0,(function(){var t,e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return this.l_()<0?[4,this.__()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.l_())<0&&this.u_("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},t.prototype.h_=function(t){return Object(u.b)(this,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.__()]:[3,3];case 1:n.sent()&&this.u_("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.o_.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},t.prototype.u_=function(t){throw this.r_.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.__=function(){return Object(u.b)(this,void 0,void 0,(function(){var t,e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return[4,this.r_.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))}}(),function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new T(O.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.f_=new M(t)}return t.prototype.isEqual=function(t){return this.f_.isEqual(t.f_)},t}()),us=function(t){this._methodName=t},ss=function(t){this.d_=t};function as(t,e,n){if(!n)throw new T(O.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function cs(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new T(O.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function hs(t,e,n,r){if(!0===e&&!0===r)throw new T(O.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function fs(t){if(!q.wt(t))throw new T(O.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function ls(t){if(q.wt(t))throw new T(O.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function ps(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":v()}function ds(t,e){if("_delegate"in t&&(t=t.d_),!(t instanceof e)){if(e.name===t.constructor.name)throw new T(O.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=ps(t);throw new T(O.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function vs(t,e){if(e<=0)throw new T(O.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var ys=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new T(O.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new T(O.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,hs("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),ms=new Map,bs=function(){function t(t,e){this.w_="(lite)",this.E_=new ys({}),this.T_=!1,t instanceof a?(this.I_=t,this.m_=new D):(this.A_=t,this.I_=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new T(O.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new a(t.options.projectId)}(t),this.m_=new S(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this.A_)throw new T(O.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.A_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"R_",{get:function(){return this.T_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"P_",{get:function(){return void 0!==this.y_},enumerable:!1,configurable:!0}),t.prototype.g_=function(t){if(this.T_)throw new T(O.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.E_=new ys(t),void 0!==t.credentials&&(this.m_=function(t){if(!t)return new D;switch(t.type){case"gapi":var e=t.client;return y(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new k(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new T(O.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype.V_=function(){return this.E_},t.prototype.p_=function(){return this.T_=!0,this.E_},t.prototype._delete=function(){return this.y_||(this.y_=this.b_()),this.y_},t.prototype.toJSON=function(){return{app:this.A_,t:this.I_,settings:this.E_}},t.prototype.b_=function(){return this,(t=ms.get(this))&&(f("ComponentProvider","Removing Datastore"),ms.delete(this),t.terminate()),Promise.resolve();var t},t}(),gs=function(){function t(t,e,n){this.v_=e,this.S_=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"D_",{get:function(){return this.S_.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.S_.path.tt()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this.S_.path.rt()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new _s(this.firestore,this.v_,this.S_.path.X())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this.S_)},t}(),ws=function(){function t(t,e,n){this.v_=e,this.C_=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this.C_)},t}(),_s=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,Ft(r))||this).firestore=e,i.D_=r,i.type="collection",i}return Object(u.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this.C_.path.tt()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.C_.path.rt()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this.D_.X();return t.et()?null:new gs(this.firestore,null,new q(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this.D_)},e}(ws);function Is(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof ss&&(t=t.d_),as("collection","path",e),t instanceof bs)return ls(n=R.ot.apply(R,Object(u.g)([e],r))),new _s(t,null,n);if(!(t instanceof gs||t instanceof _s))throw new T(O.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return ls(n=R.ot.apply(R,Object(u.g)([t.path],r)).child(R.ot(e))),new _s(t.firestore,null,n)}function Es(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof ss&&(t=t.d_),1===arguments.length&&(e=g.u()),as("doc","path",e),t instanceof bs)return fs(n=R.ot.apply(R,Object(u.g)([e],r))),new gs(t,null,new q(n));if(!(t instanceof gs||t instanceof _s))throw new T(O.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return fs(n=t.D_.child(R.ot.apply(R,Object(u.g)([e],r)))),new gs(t.firestore,t instanceof _s?t.v_:null,new q(n))}function Os(t,e){return t instanceof ss&&(t=t.d_),e instanceof ss&&(e=e.d_),(t instanceof gs||t instanceof _s)&&(e instanceof gs||e instanceof _s)&&t.firestore===e.firestore&&t.path===e.path&&t.v_===e.v_}function Ts(t,e){return t instanceof ss&&(t=t.d_),e instanceof ss&&(e=e.d_),t instanceof ws&&e instanceof ws&&t.firestore===e.firestore&&Wt(t.C_,e.C_)&&t.v_===e.v_}var Ns=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new T(O.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new T(O.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.x_=t,this.N_=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this.x_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this.N_},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.x_===t.x_&&this.N_===t.N_},t.prototype.toJSON=function(){return{latitude:this.x_,longitude:this.N_}},t.prototype.U=function(t){return w(this.x_,t.x_)||w(this.N_,t.N_)},t}(),js=/^__.*__$/,As=function(){function t(t,e,n){this.data=t,this.Gt=e,this.fieldTransforms=n}return t.prototype.F_=function(t,e){return null!==this.Gt?new De(t,this.data,this.Gt,e,this.fieldTransforms):new Ae(t,this.data,e,this.fieldTransforms)},t}(),Ds=function(){function t(t,e,n){this.data=t,this.Gt=e,this.fieldTransforms=n}return t.prototype.F_=function(t,e){return new De(t,this.data,this.Gt,e,this.fieldTransforms)},t}();function Ss(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw v()}}var xs=function(){function t(t,e,n,r,i,o){this.settings=t,this.t=e,this.Qt=n,this.ignoreUndefinedProperties=r,void 0===i&&this.O_(),this.fieldTransforms=i||[],this.Gt=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k_",{get:function(){return this.settings.k_},enumerable:!1,configurable:!0}),t.prototype.M_=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.t,this.Qt,this.ignoreUndefinedProperties,this.fieldTransforms,this.Gt)},t.prototype.L_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.M_({path:n,B_:!1});return r.q_(t),r},t.prototype.U_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.M_({path:n,B_:!1});return r.O_(),r},t.prototype.Q_=function(t){return this.M_({path:void 0,B_:!0})},t.prototype.K_=function(t){return Zs(t,this.settings.methodName,this.settings.W_||!1,this.path,this.settings.j_)},t.prototype.contains=function(t){return void 0!==this.Gt.find((function(e){return t.nt(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.nt(e.field)}))},t.prototype.O_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.q_(this.path.get(t))},t.prototype.q_=function(t){if(0===t.length)throw this.K_("Document fields must not be empty");if(Ss(this.k_)&&js.test(t))throw this.K_('Document fields cannot begin and end with "__"')},t}(),ks=function(){function t(t,e,n){this.t=t,this.ignoreUndefinedProperties=e,this.Qt=n||jo(t)}return t.prototype.G_=function(t,e,n,r){return void 0===r&&(r=!1),new xs({k_:t,methodName:e,j_:n,path:M.ct(),B_:!1,W_:r},this.t,this.Qt,this.ignoreUndefinedProperties)},t}();function Ps(t){var e=t.p_(),n=jo(t.I_);return new ks(t.I_,!!e.ignoreUndefinedProperties,n)}function Ls(t,e,n,r,i,o){void 0===o&&(o={});var u=t.G_(o.merge||o.mergeFields?2:0,e,n,i);Hs("Data must be an object, but it was:",u,r);var s,a,c=Qs(r,u);if(o.merge)s=new B(u.Gt),a=u.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,l=o.mergeFields;f<l.length;f++){var p=Ks(e,l[f],n);if(!u.contains(p))throw new T(O.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");Js(h,p)||h.push(p)}s=new B(h),a=u.fieldTransforms.filter((function(t){return s.Tt(t.field)}))}else s=null,a=u.fieldTransforms;return new As(new lt(c),s,a)}var Vs=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.z_=function(t){if(2!==t.k_)throw 1===t.k_?t.K_(this._methodName+"() can only appear at the top level of your update data"):t.K_(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.Gt.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(us);function Cs(t,e,n){return new xs({k_:3,j_:e.settings.j_,methodName:t._methodName,B_:n},e.t,e.Qt,e.ignoreUndefinedProperties)}var Rs=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.z_=function(t){return new be(t.path,new he)},e.prototype.isEqual=function(t){return t instanceof e},e}(us),Us=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).H_=n,r}return Object(u.c)(e,t),e.prototype.z_=function(t){var e=Cs(this,t,!0),n=this.H_.map((function(t){return Bs(t,e)})),r=new fe(n);return new be(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(us),Ms=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).H_=n,r}return Object(u.c)(e,t),e.prototype.z_=function(t){var e=Cs(this,t,!0),n=this.H_.map((function(t){return Bs(t,e)})),r=new pe(n);return new be(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(us),qs=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).J_=n,r}return Object(u.c)(e,t),e.prototype.z_=function(t){var e=new ve(t.Qt,oe(t.Qt,this.J_));return new be(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(us);function Fs(t,e,n,r){var i=t.G_(1,e,n);Hs("Data must be an object, but it was:",i,r);var o=[],u=new pt;z(r,(function(t,r){var s=Ws(e,t,n);r instanceof ss&&(r=r.d_);var a=i.U_(s);if(r instanceof Vs)o.push(s);else{var c=Bs(r,a);null!=c&&(o.push(s),u.set(s,c))}}));var s=new B(o);return new Ds(u.Pt(),s,i.fieldTransforms)}function zs(t,e,n,r,i,o){var u=t.G_(1,e,n),s=[Ks(e,r,n)],a=[i];if(o.length%2!=0)throw new T(O.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)s.push(Ks(e,o[c])),a.push(o[c+1]);for(var h=[],f=new pt,l=s.length-1;l>=0;--l)if(!Js(h,s[l])){var p=s[l],d=a[l];d instanceof ss&&(d=d.d_);var v=u.U_(p);if(d instanceof Vs)h.push(p);else{var y=Bs(d,v);null!=y&&(h.push(p),f.set(p,y))}}var m=new B(h);return new Ds(f.Pt(),m,u.fieldTransforms)}function Gs(t,e,n,r){return void 0===r&&(r=!1),Bs(n,t.G_(r?4:3,e))}function Bs(t,e){if(t instanceof ss&&(t=t.d_),Ys(t))return Hs("Unsupported field value:",e,t),Qs(t,e);if(t instanceof us)return function(t,e){if(!Ss(e.k_))throw e.K_(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.K_(t._methodName+"() is not currently supported inside arrays");var n=t.z_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.Gt.push(e.path),t instanceof Array){if(e.settings.B_&&4!==e.k_)throw e.K_("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var u=Bs(o[i],e.Q_(r));null==u&&(u={nullValue:"NULL_VALUE"}),n.push(u),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(t instanceof ss&&(t=t.d_),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return oe(e.Qt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=L.fromDate(t);return{timestampValue:gn(e.Qt,n)}}if(t instanceof L)return n=new L(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:gn(e.Qt,n)};if(t instanceof Ns)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof N)return{bytesValue:wn(e.Qt,t.I)};if(t instanceof gs){n=e.t;var r=t.firestore.I_;if(!r.isEqual(n))throw e.K_("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:En(t.firestore.I_||e.t,t.S_.path)}}throw e.K_("Unsupported field value: "+ps(t))}(t,e)}function Qs(t,e){var n={};return G(t)?e.path&&e.path.length>0&&e.Gt.push(e.path):z(t,(function(t,r){var i=Bs(r,e.L_(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Ys(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof L||t instanceof Ns||t instanceof N||t instanceof gs||t instanceof us)}function Hs(t,e,n){if(!Ys(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=ps(n);throw"an object"===r?e.K_(t+" a custom object"):e.K_(t+" "+r)}}function Ks(t,e,n){if(e instanceof ss&&(e=e.d_),e instanceof os)return e.f_;if("string"==typeof e)return Ws(t,e);throw Zs("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Xs=new RegExp("[~\\*/\\[\\]]");function Ws(t,e,n){if(e.search(Xs)>=0)throw Zs("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(os.bind.apply(os,Object(u.g)([void 0],e.split("."))))).f_}catch(r){throw Zs("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Zs(t,e,n,r,i){var o=r&&!r.et(),u=void 0!==i,s="Function "+e+"() called with invalid data";n&&(s+=" (via `toFirestore()`)");var a="";return(o||u)&&(a+=" (found",o&&(a+=" in field "+r),u&&(a+=" in document "+i),a+=")"),new T(O.INVALID_ARGUMENT,(s+=". ")+t+a)}function Js(t,e){return t.some((function(t){return t.isEqual(e)}))}var $s=function(){function t(t){this.Sh=t,this.Y_=new Map,this.mutations=[],this.X_=!1,this.Z_=null,this.tf=new Set}return t.prototype.ef=function(t){return Object(u.b)(this,void 0,void 0,(function(){var e,n=this;return Object(u.d)(this,(function(r){switch(r.label){case 0:if(this.nf(),this.mutations.length>0)throw new T(O.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a;return Object(u.d)(this,(function(u){switch(u.label){case 0:return n=m(t),r=Dn(n.Qt)+"/documents",i={documents:e.map((function(t){return Tn(n.Qt,t)}))},[4,n.Du("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){y(!!e.found),e.found.name,e.found.updateTime;var n=Nn(t,e.found.name),r=In(e.found.updateTime),i=new lt({mapValue:{fields:e.found.fields}});return new yt(n,r,i,{})}(t,e):"missing"in e?function(t,e){y(!!e.missing),y(!!e.readTime);var n=Nn(t,e.missing),r=In(e.readTime);return new mt(n,r)}(t,e):v()}(n.Qt,t);s.set(e.key.toString(),e)})),a=[],[2,(e.forEach((function(t){var e=s.get(t.toString());y(!!e),a.push(e)})),a)]}}))}))}(this.Sh,t)];case 1:return[2,((e=r.sent()).forEach((function(t){t instanceof mt||t instanceof yt?n.sf(t):v()})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.F_(t,this.jt(t))),this.tf.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.F_(t,this.rf(t)))}catch(t){this.Z_=t}this.tf.add(t.toString())},t.prototype.delete=function(t){this.write(new Ce(t,this.jt(t))),this.tf.add(t.toString())},t.prototype.commit=function(){return Object(u.b)(this,void 0,void 0,(function(){var t,e=this;return Object(u.d)(this,(function(n){switch(n.label){case 0:if(this.nf(),this.Z_)throw this.Z_;return t=this.Y_,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=q._t(n);e.mutations.push(new Re(r,e.jt(r)))})),[4,function(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:return n=m(t),r=Dn(n.Qt)+"/documents",i={writes:e.map((function(t){return Pn(n.Qt,t)}))},[4,n.pu("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.Sh,this.mutations)];case 1:return n.sent(),this.X_=!0,[2]}}))}))},t.prototype.sf=function(t){var e;if(t instanceof yt)e=t.version;else{if(!(t instanceof mt))throw v();e=V.min()}var n=this.Y_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new T(O.ABORTED,"Document version changed between two reads.")}else this.Y_.set(t.key.toString(),e)},t.prototype.jt=function(t){var e=this.Y_.get(t.toString());return!this.tf.has(t.toString())&&e?we.updateTime(e):we.Kt()},t.prototype.rf=function(t){var e=this.Y_.get(t.toString());if(!this.tf.has(t.toString())&&e){if(e.isEqual(V.min()))throw new T(O.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return we.updateTime(e)}return we.exists(!0)},t.prototype.write=function(t){this.nf(),this.mutations.push(t)},t.prototype.nf=function(){},t}(),ta=function(){function t(t,e,n,r){this._s=t,this.Sh=e,this.updateFunction=n,this.Es=r,this.cf=5,this.Gu=new Ao(this._s,"transaction_retry")}return t.prototype.run=function(){this.af()},t.prototype.af=function(){var t=this;this.Gu.$u((function(){return Object(u.b)(t,void 0,void 0,(function(){var t,e,n=this;return Object(u.d)(this,(function(r){return t=new $s(this.Sh),(e=this.uf(t))&&e.then((function(e){n._s.Ps((function(){return t.commit().then((function(){n.Es.resolve(e)})).catch((function(t){n.hf(t)}))}))})).catch((function(t){n.hf(t)})),[2]}))}))}))},t.prototype.uf=function(t){try{var e=this.updateFunction(t);return!Z(e)&&e.catch&&e.then?e:(this.Es.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Es.reject(t),null}},t.prototype.hf=function(t){var e=this;this.cf>0&&this.lf(t)?(this.cf-=1,this._s.Ps((function(){return e.af(),Promise.resolve()}))):this.Es.reject(t)},t.prototype.lf=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Me(e)}return!1},t}(),ea=function(){function t(t,e,n){var r=this;this.credentials=t,this._s=e,this.yu=n,this.user=j.UNAUTHENTICATED,this.clientId=g.u(),this._f=function(){},this.C=new Kn,this.credentials.v((function(t){f("FirestoreClient","Received user=",t.uid),r.user=t,r._f(t),r.C.resolve()}))}return t.prototype.getConfiguration=function(){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(t){switch(t.label){case 0:return[4,this.C.promise];case 1:return[2,(t.sent(),{_s:this._s,yu:this.yu,clientId:this.clientId,credentials:this.credentials,Jl:this.user,pl:100})]}}))}))},t.prototype.ff=function(t){var e=this;this._f=t,this.C.promise.then((function(){return e._f(e.user)}))},t.prototype.df=function(){if(this._s.wf)throw new T(O.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this._s.Ef();var e=new Kn;return this._s.Tf((function(){return Object(u.b)(t,void 0,void 0,(function(){var t,n;return Object(u.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.If?[4,this.If.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.mf?[4,this.mf.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.S(),e.resolve(),[3,6];case 5:return t=r.sent(),n=ur(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();function na(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i=this;return Object(u.d)(this,(function(o){switch(o.label){case 0:return t._s.Af(),f("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.Jl,t.ff((function(n){r.isEqual(n)||(r=n,t._s.po((function(){return Object(u.b)(i,void 0,void 0,(function(){return Object(u.d)(this,(function(t){switch(t.label){case 0:return[4,Mi(e.bh,n)];case 1:return t.sent(),[2]}}))}))})))})),e.persistence.Po((function(){return t.terminate()})),t.mf=e,[2]}}))}))}function ra(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r;return Object(u.d)(this,(function(i){switch(i.label){case 0:return t._s.Af(),[4,ia(t)];case 1:return n=i.sent(),f("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.ff((function(n){return t._s.po((function(){return function(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r;return Object(u.d)(this,(function(i){switch(i.label){case 0:return(n=m(t))._s.Af(),f("RemoteStore","RemoteStore received new credentials"),r=Go(n),n.Nh.add(3),[4,Co(n)];case 1:return i.sent(),r&&n.kh.set("Unknown"),[4,n.Dh.n_(e)];case 2:return i.sent(),n.Nh.delete(3),[4,Vo(n)];case 3:return i.sent(),[2]}}))}))}(e.yl,n)}))})),t.If=e,[2]}}))}))}function ia(t){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(e){switch(e.label){case 0:return t.mf?[3,2]:(f("FirestoreClient","Using default OfflineComponentProvider"),[4,na(t,new ts)]);case 1:e.sent(),e.label=2;case 2:return[2,t.mf]}}))}))}function oa(t){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(e){switch(e.label){case 0:return t.If?[3,2]:(f("FirestoreClient","Using default OnlineComponentProvider"),[4,ra(t,new rs)]);case 1:e.sent(),e.label=2;case 2:return[2,t.If]}}))}))}function ua(t){return ia(t).then((function(t){return t.persistence}))}function sa(t){return ia(t).then((function(t){return t.bh}))}function aa(t){return oa(t).then((function(t){return t.yl}))}function ca(t){return oa(t).then((function(t){return t._a}))}function ha(t){return Object(u.b)(this,void 0,void 0,(function(){var e,n;return Object(u.d)(this,(function(r){switch(r.label){case 0:return[4,oa(t)];case 1:return e=r.sent(),[2,((n=e.gl).jh=Eu.bind(null,e._a),n.Hh=Tu.bind(null,e._a),n)]}}))}))}function fa(t,e,n){var r=this;void 0===n&&(n={});var i=new Kn;return t._s.Ps((function(){return Object(u.b)(r,void 0,void 0,(function(){var r;return Object(u.d)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new is({next:function(o){e.Ps((function(){return cu(t,u)}));var s=o.docs.has(n);!s&&o.fromCache?i.reject(new T(O.UNAVAILABLE,"Failed to get document because the client is offline.")):s&&o.fromCache&&r&&"server"===r.source?i.reject(new T(O.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),u=new pu(Ft(n.path),o,{includeMetadataChanges:!0,nl:!0});return au(t,u)},[4,ha(t)];case 1:return[2,r.apply(void 0,[o.sent(),t._s,e,n,i])]}}))}))})),i.promise}function la(t,e,n){var r=this;void 0===n&&(n={});var i=new Kn;return t._s.Ps((function(){return Object(u.b)(r,void 0,void 0,(function(){var r;return Object(u.d)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new is({next:function(n){e.Ps((function(){return cu(t,u)})),n.fromCache&&"server"===r.source?i.reject(new T(O.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),u=new pu(n,o,{includeMetadataChanges:!0,nl:!0});return au(t,u)},[4,ha(t)];case 1:return[2,r.apply(void 0,[o.sent(),t._s,e,n,i])]}}))}))})),i.promise}var pa=function(){function t(){var t=this;this.Rf=Promise.resolve(),this.Pf=[],this.yf=!1,this.gf=[],this.Vf=null,this.pf=!1,this.bf=[],this.Gu=new Ao(this,"async_queue_retry"),this.vf=function(){var e=No();e&&f("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Gu.qu()};var e=No();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.vf)}return Object.defineProperty(t.prototype,"wf",{get:function(){return this.yf},enumerable:!1,configurable:!0}),t.prototype.Ps=function(t){this.enqueue(t)},t.prototype.Tf=function(t){this.Sf(),this.Df(t)},t.prototype.Ef=function(){if(!this.yf){this.yf=!0;var t=No();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.vf)}},t.prototype.enqueue=function(t){return this.Sf(),this.yf?new Promise((function(t){})):this.Df(t)},t.prototype.po=function(t){var e=this;this.Ps((function(){return e.Pf.push(t),e.Cf()}))},t.prototype.Cf=function(){return Object(u.b)(this,void 0,void 0,(function(){var t,e=this;return Object(u.d)(this,(function(n){switch(n.label){case 0:if(0===this.Pf.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.Pf[0]()];case 2:return n.sent(),this.Pf.shift(),this.Gu.reset(),[3,4];case 3:if(!tr(t=n.sent()))throw t;return f("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.Pf.length>0&&this.Gu.$u((function(){return e.Cf()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Df=function(t){var e=this,n=this.Rf.then((function(){return e.pf=!0,t().catch((function(t){throw e.Vf=t,e.pf=!1,l("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.pf=!1,t}))}));return this.Rf=n,n},t.prototype.Tr=function(t,e,n){var r=this;this.Sf(),this.bf.indexOf(t)>-1&&(e=0);var i=or.Ts(this,t,e,n,(function(t){return r.xf(t)}));return this.gf.push(i),i},t.prototype.Sf=function(){this.Vf&&v()},t.prototype.Af=function(){},t.prototype.Nf=function(){return Object(u.b)(this,void 0,void 0,(function(){var t;return Object(u.d)(this,(function(e){switch(e.label){case 0:return[4,t=this.Rf];case 1:e.sent(),e.label=2;case 2:if(t!==this.Rf)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.Ff=function(t){for(var e=0,n=this.gf;e<n.length;e++)if(n[e].fs===t)return!0;return!1},t.prototype.Of=function(t){var e=this;return this.Nf().then((function(){e.gf.sort((function(t,e){return t.ds-e.ds}));for(var n=0,r=e.gf;n<r.length;n++){var i=r[n];if(i.Rs(),"all"!==t&&i.fs===t)break}return e.Nf()}))},t.prototype.kf=function(t){this.bf.push(t)},t.prototype.xf=function(t){var e=this.gf.indexOf(t);this.gf.splice(e,1)},t}();function da(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this.Mf={},this.Lf=new Kn,this.$f={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this.Mf={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this.Lf.promise.catch(t)},t.prototype.then=function(t,e){return this.Lf.promise.then(t,e)},t.prototype.ql=function(t){this.Ul(t),this.Mf.complete&&this.Mf.complete(),this.Lf.resolve(t)},t.prototype.Kl=function(t){this.$f.taskState="Error",this.Mf.next&&this.Mf.next(this.$f),this.Mf.error&&this.Mf.error(t),this.Lf.reject(t)},t.prototype.Ul=function(t){this.$f=t,this.Mf.next&&this.Mf.next(t)}}();var va=-1,ya=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).Bf=new pa,r.w_="name"in e?e.name:"[DEFAULT]",r}return Object(u.c)(e,t),e.prototype.b_=function(){return this.qf||ba(this),this.qf.terminate()},e}(bs);function ma(t){return t.qf||ba(t),t.qf.df(),t.qf}function ba(t){var e=t.p_(),n=function(t,e,n){return new s(t,e,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling)}(t.I_,t.w_,e);t.qf=new ea(t.m_,t.Bf,n)}function ga(t,e,n){var r=this,i=new Kn;return t._s.enqueue((function(){return Object(u.b)(r,void 0,void 0,(function(){var r;return Object(u.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,na(t,n)];case 1:return o.sent(),[4,ra(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===O.FAILED_PRECONDITION||t.code===O.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}}))}))})).then((function(){return i.promise}))}function wa(t){if(t.R_||t.P_)throw new T(O.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var _a=function(){function t(){}return t.prototype.Uf=function(t,e){switch(void 0===e&&(e="none"),tt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return H(t.integerValue||t.doubleValue);case 3:return this.Qf(t.timestampValue);case 4:return this.Kf(t,e);case 5:return t.stringValue;case 6:return this.Wf(K(t.bytesValue));case 7:return this.jf(t.referenceValue);case 8:return this.Gf(t.geoPointValue);case 9:return this.zf(t.arrayValue,e);case 10:return this.Hf(t.mapValue,e);default:throw v()}},t.prototype.Hf=function(t,e){var n=this,r={};return z(t.fields||{},(function(t,i){r[t]=n.Uf(i,e)})),r},t.prototype.Gf=function(t){return new Ns(H(t.latitude),H(t.longitude))},t.prototype.zf=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.Uf(t,e)}))},t.prototype.Kf=function(t,e){switch(e){case"previous":var n=function t(e){var n=e.mapValue.fields.__previous_value__;return X(n)?t(n):n}(t);return null==n?null:this.Uf(n,e);case"estimate":return this.Qf(W(t));default:return null}},t.prototype.Qf=function(t){var e=Y(t);return new L(e.seconds,e.nanos)},t.prototype.Jf=function(t,e){var n=R.ot(t);y(Hn(n));var r=new a(n.get(1),n.get(3)),i=new q(n.Y(5));return r.isEqual(e)||l("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}(),Ia=function(){function t(t,e,n,r,i){this.Yf=t,this.Xf=e,this.S_=n,this.Zf=r,this.v_=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this.S_.path.tt()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new gs(this.Yf,this.v_,this.S_)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this.Zf},t.prototype.data=function(){if(this.Zf){if(this.v_){var t=new Ea(this.Yf,this.Xf,this.S_,this.Zf,null);return this.v_.fromFirestore(t)}return this.Xf.Uf(this.Zf.bt())}},t.prototype.get=function(t){if(this.Zf){var e=this.Zf.data().field(Oa("DocumentSnapshot.get",t));if(null!==e)return this.Xf.Uf(e)}},t}(),Ea=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Ia);function Oa(t,e){return"string"==typeof e?Ws(t,e):e instanceof ss?e.d_.f_:e.f_}function Ta(t){if(Gt(t)&&0===t.xt.length)throw new T(O.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Na=function(){};function ja(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o.td(t)}return t}var Aa=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).ed=e,i.nd=n,i.sd=r,i.type="where",i}return Object(u.c)(e,t),e.prototype.td=function(t){var e=Ps(t.firestore),n=function(t,e,n,r,i,o,u){var s;if(i.ut()){if("array-contains"===o||"array-contains-any"===o)throw new T(O.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Va(u,o);for(var a=[],c=0,h=u;c<h.length;c++){var f=h[c];a.push(La(r,t,f))}s={arrayValue:{values:a}}}else s=La(r,t,u)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Va(u,o),s=Gs(n,"where",u,"in"===o||"not-in"===o);var l=Ot.create(i,o,s);return function(t,e){if(e.Ct()){var n=Qt(t);if(null!==n&&!n.isEqual(e.field))throw new T(O.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Bt(t);null!==r&&Ca(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new T(O.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new T(O.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t.C_,0,e,t.firestore.I_,this.ed,this.nd,this.sd);return new ws(t.firestore,t.v_,function(t,e){var n=t.filters.concat([e]);return new Mt(t.path,t.collectionGroup,t.xt.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t.C_,n))},e}(Na),Da=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).ed=e,r.rd=n,r.type="orderBy",r}return Object(u.c)(e,t),e.prototype.td=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new T(O.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new T(O.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Vt(e,n);return function(t,e){if(null===Bt(t)){var n=Qt(t);null!==n&&Ca(t,n,e.field)}}(t,r),r}(t.C_,this.ed,this.rd);return new ws(t.firestore,t.v_,function(t,e){var n=t.xt.concat([e]);return new Mt(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t.C_,e))},e}(Na),Sa=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.od=n,i.ad=r,i}return Object(u.c)(e,t),e.prototype.td=function(t){return new ws(t.firestore,t.v_,Xt(t.C_,this.od,this.ad))},e}(Na),xa=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.ud=n,i.hd=r,i}return Object(u.c)(e,t),e.prototype.td=function(t){var e=Pa(t,this.type,this.ud,this.hd);return new ws(t.firestore,t.v_,function(t,e){return new Mt(t.path,t.collectionGroup,t.xt.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t.C_,e))},e}(Na),ka=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.ud=n,i.hd=r,i}return Object(u.c)(e,t),e.prototype.td=function(t){var e=Pa(t,this.type,this.ud,this.hd);return new ws(t.firestore,t.v_,function(t,e){return new Mt(t.path,t.collectionGroup,t.xt.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t.C_,e))},e}(Na);function Pa(t,e,n,r){if(n[0]instanceof ss&&(n[0]=n[0].d_),n[0]instanceof Ia)return function(t,e,n,r,i){if(!r)throw new T(O.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],u=0,s=Ht(t);u<s.length;u++){var a=s[u];if(a.field.ut())o.push(ut(e,r.key));else{var c=r.field(a.field);if(X(c))throw new T(O.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=a.field.rt();throw new T(O.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Pt(o,i)}(t.C_,t.firestore.I_,e,n[0].Zf,r);var i=Ps(t.firestore);return function(t,e,n,r,i,o){var u=t.xt;if(i.length>u.length)throw new T(O.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var s=[],a=0;a<i.length;a++){var c=i[a];if(u[a].field.ut()){if("string"!=typeof c)throw new T(O.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Yt(t)&&-1!==c.indexOf("/"))throw new T(O.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(R.ot(c));if(!q.wt(h))throw new T(O.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var f=new q(h);s.push(ut(e,f))}else{var l=Gs(n,r,c);s.push(l)}}return new Pt(s,o)}(t.C_,t.firestore.I_,i,e,n,r)}function La(t,e,n){if(n instanceof ss&&(n=n.d_),"string"==typeof n){if(""===n)throw new T(O.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Yt(e)&&-1!==n.indexOf("/"))throw new T(O.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(R.ot(n));if(!q.wt(r))throw new T(O.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return ut(t,new q(r))}if(n instanceof gs)return ut(t,n.S_);throw new T(O.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+ps(n)+".")}function Va(t,e){if(!Array.isArray(t)||0===t.length)throw new T(O.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new T(O.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Ca(t,e,n){if(!n.isEqual(e))throw new T(O.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function Ra(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Ua=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(u.c)(e,t),e.prototype.Wf=function(t){return new N(t)},e.prototype.jf=function(t){var e=this.Jf(t,this.firestore.I_);return new gs(this.firestore,null,e)},e}(_a),Ma=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),qa=function(t){function e(e,n,r,i,o,u){var s=this;return(s=t.call(this,e,n,r,i,u)||this).Yf=e,s.ld=e,s.metadata=o,s}return Object(u.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this.Zf){if(this.v_){var e=new Fa(this.Yf,this.Xf,this.S_,this.Zf,this.metadata,null);return this.v_.fromFirestore(e,t)}return this.Xf.Uf(this.Zf.bt(),t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this.Zf){var n=this.Zf.data().field(Oa("DocumentSnapshot.get",t));if(null!==n)return this.Xf.Uf(n,e.serverTimestamps)}},e}(Ia),Fa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(qa),za=function(){function t(t,e,n,r){this.Yf=t,this.Xf=e,this._d=r,this.metadata=new Ma(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._d.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._d.docs.forEach((function(r){t.call(e,new Fa(n.Yf,n.Xf,r.key,r,new Ma(n._d.De.has(r.key),n._d.fromCache),n.query.v_))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._d.xe)throw new T(O.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.fd&&this.dd===e||(this.fd=function(t,e){if(t._d.Se.et()){var n=0;return t._d.docChanges.map((function(e){var r=new Fa(t.Yf,t.Xf,e.doc.key,e.doc,new Ma(t._d.De.has(e.doc.key),t._d.fromCache),t.query.v_);return e.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=t._d.Se;return t._d.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new Fa(t.Yf,t.Xf,e.doc.key,e.doc,new Ma(t._d.De.has(e.doc.key),t._d.fromCache),t.query.v_),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Ga(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this.dd=e),this.fd},t}();function Ga(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return v()}}function Ba(t,e){return t instanceof qa&&e instanceof qa?t.Yf===e.Yf&&t.S_.isEqual(e.S_)&&(null===t.Zf?null===e.Zf:t.Zf.isEqual(e.Zf))&&t.v_===e.v_:t instanceof za&&e instanceof za&&t.Yf===e.Yf&&Ts(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._d.isEqual(e._d)}var Qa=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(u.c)(e,t),e.prototype.Wf=function(t){return new N(t)},e.prototype.jf=function(t){var e=this.Jf(t,this.firestore.I_);return new gs(this.firestore,null,e)},e}(_a);function Ya(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=ds(t,gs);var o=ds(t.firestore,ya),u=Ps(o);return e instanceof ss&&(e=e.d_),Ka(o,[("string"==typeof e||e instanceof os?zs(u,"updateDoc",t.S_,e,n,r):Fs(u,"updateDoc",t.S_,e)).F_(t.S_,we.exists(!0))])}function Ha(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t instanceof ss&&(t=t.d_);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||da(i[a])||(s=i[a],a++);var c,h,f,l={includeMetadataChanges:s.includeMetadataChanges};if(da(i[a])){var p=i[a];i[a]=null===(e=p.next)||void 0===e?void 0:e.bind(p),i[a+1]=null===(n=p.error)||void 0===n?void 0:n.bind(p),i[a+2]=null===(r=p.complete)||void 0===r?void 0:r.bind(p)}if(t instanceof gs)h=ds(t.firestore,ya),f=Ft(t.S_.path),c={next:function(e){i[a]&&i[a](Xa(h,t,e))},error:i[a+1],complete:i[a+2]};else{var d=ds(t,ws);h=ds(d.firestore,ya),f=d.C_;var v=new Qa(h);c={next:function(t){i[a]&&i[a](new za(h,v,d,t))},error:i[a+1],complete:i[a+2]},Ta(t.C_)}return function(t,e,n,r){var i=this,o=new is(r),s=new pu(e,o,n);return t._s.Ps((function(){return Object(u.b)(i,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return e=au,[4,ha(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))})),function(){o.i_(),t._s.Ps((function(){return Object(u.b)(i,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return e=cu,[4,ha(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))}))}}(ma(h),f,l,c)}function Ka(t,e){return function(t,e){var n=this,r=new Kn;return t._s.Ps((function(){return Object(u.b)(n,void 0,void 0,(function(){var n;return Object(u.d)(this,(function(i){switch(i.label){case 0:return n=Nu,[4,ca(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(ma(t),e)}function Xa(t,e,n){var r=n.docs.get(e.S_),i=new Qa(t);return new qa(t,i,e.S_,r,new Ma(n.hasPendingWrites,n.fromCache),e.v_)}var Wa=function(){function t(t,e){this.Yf=t,this.wd=e,this.Ed=[],this.Td=!1,this.Id=Ps(t)}return t.prototype.set=function(t,e,n){this.md();var r=Za(t,this.Yf),i=Ra(r.v_,e,n),o=Ls(this.Id,"WriteBatch.set",r.S_,i,null!==r.v_,n);return this.Ed.push(o.F_(r.S_,we.Kt())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this.md();var o,u=Za(t,this.Yf);return e instanceof ss&&(e=e.d_),o="string"==typeof e||e instanceof os?zs(this.Id,"WriteBatch.update",u.S_,e,n,r):Fs(this.Id,"WriteBatch.update",u.S_,e),this.Ed.push(o.F_(u.S_,we.exists(!0))),this},t.prototype.delete=function(t){this.md();var e=Za(t,this.Yf);return this.Ed=this.Ed.concat(new Ce(e.S_,we.Kt())),this},t.prototype.commit=function(){return this.md(),this.Td=!0,this.Ed.length>0?this.wd(this.Ed):Promise.resolve()},t.prototype.md=function(){if(this.Td)throw new T(O.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function Za(t,e){if(t instanceof ss&&(t=t.d_),t.firestore!==e)throw new T(O.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Ja=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).Yf=e,r}return Object(u.c)(e,t),e.prototype.get=function(e){var n=this,r=Za(e,this.Yf),i=new Qa(this.Yf);return t.prototype.get.call(this,e).then((function(t){return new qa(n.Yf,i,r.S_,t.Zf,new Ma(!1,!1),r.v_)}))},e}(function(){function t(t,e){this.Yf=t,this.Ad=e,this.Id=Ps(t)}return t.prototype.get=function(t){var e=this,n=Za(t,this.Yf),r=new Ua(this.Yf);return this.Ad.ef([n.S_]).then((function(t){if(!t||1!==t.length)return v();var i=t[0];if(i instanceof mt)return new Ia(e.Yf,r,n.S_,null,n.v_);if(i instanceof yt)return new Ia(e.Yf,r,i.key,i,n.v_);throw v()}))},t.prototype.set=function(t,e,n){var r=Za(t,this.Yf),i=Ra(r.v_,e,n),o=Ls(this.Id,"Transaction.set",r.S_,i,null!==r.v_,n);return this.Ad.set(r.S_,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,u=Za(t,this.Yf);return e instanceof ss&&(e=e.d_),o="string"==typeof e||e instanceof os?zs(this.Id,"Transaction.update",u.S_,e,n,r):Fs(this.Id,"Transaction.update",u.S_,e),this.Ad.update(u.S_,o),this},t.prototype.delete=function(t){var e=Za(t,this.Yf);return this.Ad.delete(e.S_),this},t}());function $a(){if("undefined"==typeof Uint8Array)throw new T(O.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function tc(){if("undefined"==typeof atob)throw new T(O.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var ec=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.fromBase64String=function(t){return tc(),new e(N.fromBase64String(t))},e.fromUint8Array=function(t){return $a(),new e(N.fromUint8Array(t))},e.prototype.toBase64=function(){return tc(),this.d_.toBase64()},e.prototype.toUint8Array=function(){return $a(),this.d_.toUint8Array()},e.prototype.isEqual=function(t){return this.d_.isEqual(t.d_)},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e}(ss),nc=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){wa(t=ds(t,ya));var n=ma(t),r=t.p_(),i=new rs;return ga(n,i,new es(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t.d_,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){wa(t=ds(t,ya));var e=ma(t),n=t.p_(),r=new rs;return ga(e,r,new ns(r,n.cacheSizeBytes))}(t.d_)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t.R_&&!t.P_)throw new T(O.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Kn;return t.Bf.Tf((function(){return Object(u.b)(e,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(u.b)(this,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return Zn.Kn()?(e=t+"main",[4,Zn.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(ki(t.I_,t.w_))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t.d_)},t}(),rc=function(t){function e(e,n,r){var i=this;return(i=t.call(this,n)||this).Rd=r,i.INTERNAL={delete:function(){return i.terminate()}},e instanceof a||(i.Pd=e),i}return Object(u.c)(e,t),Object.defineProperty(e.prototype,"I_",{get:function(){return this.d_.I_},enumerable:!1,configurable:!0}),e.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this.d_.V_()),t)).merge,this.d_.g_(t)},e.prototype.useEmulator=function(t,e){!function(t,e,n){var r=(t=ds(t,bs)).V_();"firestore.googleapis.com"!==r.host&&r.host!==e&&p("Host has been set in both settings() and useEmulator(), emulator host will be used"),t.g_(Object.assign(Object.assign({},r),{host:e+":"+n,ssl:!1}))}(this.d_,t,e)},e.prototype.enableNetwork=function(){return function(t){var e=this;return t._s.enqueue((function(){return Object(u.b)(e,void 0,void 0,(function(){var e,n;return Object(u.d)(this,(function(r){switch(r.label){case 0:return[4,ua(t)];case 1:return e=r.sent(),[4,aa(t)];case 2:return n=r.sent(),[2,(e.yo(!0),function(t){var e=m(t);return e.Nh.delete(0),Vo(e)}(n))]}}))}))}))}(ma(ds(this.d_,ya)))},e.prototype.disableNetwork=function(){return function(t){var e=this;return t._s.enqueue((function(){return Object(u.b)(e,void 0,void 0,(function(){var e,n;return Object(u.d)(this,(function(r){switch(r.label){case 0:return[4,ua(t)];case 1:return e=r.sent(),[4,aa(t)];case 2:return n=r.sent(),[2,(e.yo(!1),function(t){return Object(u.b)(this,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return(e=m(t)).Nh.add(0),[4,Co(e)];case 1:return n.sent(),e.kh.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(ma(ds(this.d_,ya)))},e.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&hs("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Rd.enableMultiTabIndexedDbPersistence(this):this.Rd.enableIndexedDbPersistence(this,n)},e.prototype.clearPersistence=function(){return this.Rd.clearIndexedDbPersistence(this)},e.prototype.terminate=function(){return this.Pd&&(this.Pd._removeServiceInstance("firestore"),this.Pd._removeServiceInstance("firestore-exp")),this.d_._delete()},e.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Kn;return t._s.Ps((function(){return Object(u.b)(e,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(r){switch(r.label){case 0:return e=ku,[4,ca(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(ma(ds(this.d_,ya)))},e.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new is(e);return t._s.Ps((function(){return Object(u.b)(n,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return e=function(t,e){m(t).Wh.add(e),e.next()},[4,ha(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.i_(),t._s.Ps((function(){return Object(u.b)(n,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return e=function(t,e){m(t).Wh.delete(e)},[4,ha(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(ma(t=ds(t,ya)),da(e)?e:{next:e})}(this.d_,t)},Object.defineProperty(e.prototype,"app",{get:function(){if(!this.Pd)throw new T(O.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Pd},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new bc(this,Is(this.d_,t))}catch(t){throw hc(t,"collection()","Firestore.collection()")}},e.prototype.doc=function(t){try{return new cc(this,Es(this.d_,t))}catch(t){throw hc(t,"doc()","Firestore.doc()")}},e.prototype.collectionGroup=function(t){try{return new vc(this,function(t,e){if(t=ds(t,bs),as("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new T(O.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new ws(t,null,function(t){return new Mt(R.ct(),t)}(e))}(this.d_,t))}catch(t){throw hc(t,"collectionGroup()","Firestore.collectionGroup()")}},e.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new Kn;return t._s.Ps((function(){return Object(u.b)(n,void 0,void 0,(function(){var n;return Object(u.d)(this,(function(i){switch(i.label){case 0:return[4,function(t){return oa(t).then((function(t){return t.Sh}))}(t)];case 1:return n=i.sent(),new ta(t._s,n,e,r).run(),[2]}}))}))})),r.promise}(ma(t),(function(n){return e(new Ja(t,n))}))}(this.d_,(function(n){return t(new uc(e,n))}))},e.prototype.batch=function(){var t=this;return ma(this.d_),new sc(new Wa(this.d_,(function(e){return Ka(t.d_,e)})))},e.prototype.loadBundle=function(t){throw new T(O.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},e.prototype.namedQuery=function(t){throw new T(O.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},e}(ss),ic=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(u.c)(e,t),e.prototype.Wf=function(t){return new ec(new N(t))},e.prototype.jf=function(t){var e=this.Jf(t,this.firestore.I_);return cc.yd(e,this.firestore,null)},e}(_a);function oc(t){var e;e=t,c.setLogLevel(e)}var uc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).Yf=e,r.Xf=new ic(e),r}return Object(u.c)(e,t),e.prototype.get=function(t){var e=this,n=gc(t);return this.d_.get(n).then((function(t){return new pc(e.Yf,new qa(e.Yf.d_,e.Xf,t.S_,t.Zf,t.metadata,n.v_))}))},e.prototype.set=function(t,e,n){var r=gc(t);return n?(cs("Transaction.set",n),this.d_.set(r,e,n)):this.d_.set(r,e),this},e.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=gc(t);return 2===arguments.length?this.d_.update(s,e):(r=this.d_).update.apply(r,Object(u.g)([s,e,n],i)),this},e.prototype.delete=function(t){var e=gc(t);return this.d_.delete(e),this},e}(ss),sc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.set=function(t,e,n){var r=gc(t);return n?(cs("WriteBatch.set",n),this.d_.set(r,e,n)):this.d_.set(r,e),this},e.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=gc(t);return 2===arguments.length?this.d_.update(s,e):(r=this.d_).update.apply(r,Object(u.g)([s,e,n],i)),this},e.prototype.delete=function(t){var e=gc(t);return this.d_.delete(e),this},e.prototype.commit=function(){return this.d_.commit()},e}(ss),ac=function(t){function e(e,n,r){var i=this;return(i=t.call(this,r)||this).Yf=e,i.Xf=n,i}return Object(u.c)(e,t),e.prototype.fromFirestore=function(t,e){var n=new Fa(this.Yf.d_,this.Xf,t.S_,t.Zf,t.metadata,null);return this.d_.fromFirestore(new dc(this.Yf,n),null!=e?e:{})},e.prototype.toFirestore=function(t,e){return e?this.d_.toFirestore(t,e):this.d_.toFirestore(t)},e.gd=function(t,n){var r=e.Vd,i=r.get(t);i||(i=new WeakMap,r.set(t,i));var o=i.get(n);return o||(o=new e(t,new ic(t),n),i.set(n,o)),o},e}(ss);ac.Vd=new WeakMap;var cc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).firestore=e,r.Xf=new ic(e),r}return Object(u.c)(e,t),e.pd=function(t,n,r){if(t.length%2!=0)throw new T(O.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.rt()+" has "+t.length);return new e(n,new gs(n.d_,r,new q(t)))},e.yd=function(t,n,r){return new e(n,new gs(n.d_,r,t))},Object.defineProperty(e.prototype,"id",{get:function(){return this.d_.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new bc(this.firestore,this.d_.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.d_.path},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new bc(this.firestore,Is(this.d_,t))}catch(t){throw hc(t,"collection()","DocumentReference.collection()")}},e.prototype.isEqual=function(t){return t instanceof ss&&(t=t.d_),t instanceof gs&&Os(this.d_,t)},e.prototype.set=function(t,e){e=cs("DocumentReference.set",e);try{return function(t,e,n){t=ds(t,gs);var r=ds(t.firestore,ya),i=Ra(t.v_,e,n);return Ka(r,[Ls(Ps(r),"setDoc",t.S_,i,null!==t.v_,n).F_(t.S_,we.Kt())])}(this.d_,t,e)}catch(t){throw hc(t,"setDoc()","DocumentReference.set()")}},e.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Ya(this.d_,t):Ya.apply(void 0,Object(u.g)([this.d_,t,e],n))}catch(t){throw hc(t,"updateDoc()","DocumentReference.update()")}},e.prototype.delete=function(){return Ka(ds((t=this.d_).firestore,ya),[new Ce(t.S_,we.Kt())]);var t},e.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=fc(e),i=lc(e,(function(e){return new pc(t.firestore,new qa(t.firestore.d_,t.Xf,e.S_,e.Zf,e.metadata,t.d_.v_))}));return Ha(this.d_,r,i)},e.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=ds(t,gs);var e=ds(t.firestore,ya),n=ma(e),r=new Qa(e);return function(t,e){var n=this,r=new Kn;return t._s.Ps((function(){return Object(u.b)(n,void 0,void 0,(function(){var n;return Object(u.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=m(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Tc.Ho(t,e)}))}(t,e)];case 1:return(i=o.sent())instanceof yt?n.resolve(i):i instanceof mt?n.resolve(null):n.reject(new T(O.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=ur(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}}))}))},[4,sa(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t.S_).then((function(n){return new qa(e,r,t.S_,n,new Ma(n instanceof yt&&n.Vt,!0),t.v_)}))}(this.d_):"server"===(null==t?void 0:t.source)?function(t){t=ds(t,gs);var e=ds(t.firestore,ya);return fa(ma(e),t.S_,{source:"server"}).then((function(n){return Xa(e,t,n)}))}(this.d_):function(t){t=ds(t,gs);var e=ds(t.firestore,ya);return fa(ma(e),t.S_).then((function(n){return Xa(e,t,n)}))}(this.d_)).then((function(t){return new pc(e.firestore,new qa(e.firestore.d_,e.Xf,t.S_,t.Zf,t.metadata,e.d_.v_))}))},e.prototype.withConverter=function(t){return new e(this.firestore,this.d_.withConverter(ac.gd(this.firestore,t)))},e}(ss);function hc(t,e,n){return t.message=t.message.replace(e,n),t}function fc(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!da(r))return r}return{}}function lc(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=da(t[0])?t[0]:da(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var pc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).Yf=e,r}return Object(u.c)(e,t),Object.defineProperty(e.prototype,"ref",{get:function(){return new cc(this.Yf,this.d_.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.d_.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this.d_.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return this.d_.exists()},enumerable:!1,configurable:!0}),e.prototype.data=function(t){return this.d_.data(t)},e.prototype.get=function(t,e){return this.d_.get(t,e)},e.prototype.isEqual=function(t){return Ba(this.d_,t.d_)},e}(ss),dc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.data=function(t){return this.d_.data(t)},e}(pc),vc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).firestore=e,r.Xf=new ic(e),r}return Object(u.c)(e,t),e.prototype.where=function(t,n,r){try{return new e(this.firestore,ja(this.d_,function(t,e,n){var r=e,i=Oa("where",t);return new Aa(i,r,n)}(t,n,r)))}catch(t){throw hc(t,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.orderBy=function(t,n){try{return new e(this.firestore,ja(this.d_,function(t,e){void 0===e&&(e="asc");var n=e,r=Oa("orderBy",t);return new Da(r,n)}(t,n)))}catch(t){throw hc(t,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.limit=function(t){try{return new e(this.firestore,ja(this.d_,function(t){return vs("limit",t),new Sa("limit",t,"F")}(t)))}catch(t){throw hc(t,"limit()","Query.limit()")}},e.prototype.limitToLast=function(t){try{return new e(this.firestore,ja(this.d_,function(t){return vs("limitToLast",t),new Sa("limitToLast",t,"L")}(t)))}catch(t){throw hc(t,"limitToLast()","Query.limitToLast()")}},e.prototype.startAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,ja(this.d_,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new xa("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw hc(t,"startAt()","Query.startAt()")}},e.prototype.startAfter=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,ja(this.d_,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new xa("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw hc(t,"startAfter()","Query.startAfter()")}},e.prototype.endBefore=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,ja(this.d_,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ka("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw hc(t,"endBefore()","Query.endBefore()")}},e.prototype.endAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,ja(this.d_,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ka("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw hc(t,"endAt()","Query.endAt()")}},e.prototype.isEqual=function(t){return Ts(this.d_,t.d_)},e.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=ds(t,ws);var e=ds(t.firestore,ya),n=ma(e),r=new Qa(e);return function(t,e){var n=this,r=new Kn;return t._s.Ps((function(){return Object(u.b)(n,void 0,void 0,(function(){var n;return Object(u.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i,o,s,a;return Object(u.d)(this,(function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,Hi(t,e,!0)];case 1:return a=u.sent(),r=new gu(e,a.Rc),i=r.fl(a.documents),o=r.wi(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=ur(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}}))}))},[4,sa(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t.C_).then((function(n){return new za(e,r,t,n)}))}(this.d_):"server"===(null==t?void 0:t.source)?function(t){t=ds(t,ws);var e=ds(t.firestore,ya),n=ma(e),r=new Qa(e);return la(n,t.C_,{source:"server"}).then((function(n){return new za(e,r,t,n)}))}(this.d_):function(t){t=ds(t,ws);var e=ds(t.firestore,ya),n=ma(e),r=new Qa(e);return Ta(t.C_),la(n,t.C_).then((function(n){return new za(e,r,t,n)}))}(this.d_)).then((function(t){return new mc(e.firestore,new za(e.firestore.d_,e.Xf,e.d_,t._d))}))},e.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=fc(e),i=lc(e,(function(e){return new mc(t.firestore,new za(t.firestore.d_,t.Xf,t.d_,e._d))}));return Ha(this.d_,r,i)},e.prototype.withConverter=function(t){return new e(this.firestore,this.d_.withConverter(ac.gd(this.firestore,t)))},e}(ss),yc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).Yf=e,r}return Object(u.c)(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return this.d_.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doc",{get:function(){return new dc(this.Yf,this.d_.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldIndex",{get:function(){return this.d_.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newIndex",{get:function(){return this.d_.newIndex},enumerable:!1,configurable:!0}),e}(ss),mc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).Yf=e,r}return Object(u.c)(e,t),Object.defineProperty(e.prototype,"query",{get:function(){return new vc(this.Yf,this.d_.query)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this.d_.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.d_.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this.d_.empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"docs",{get:function(){var t=this;return this.d_.docs.map((function(e){return new dc(t.Yf,e)}))},enumerable:!1,configurable:!0}),e.prototype.docChanges=function(t){var e=this;return this.d_.docChanges(t).map((function(t){return new yc(e.Yf,t)}))},e.prototype.forEach=function(t,e){var n=this;this.d_.forEach((function(r){t.call(e,new dc(n.Yf,r))}))},e.prototype.isEqual=function(t){return Ba(this.d_,t.d_)},e}(ss),bc=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r.d_=n,r}return Object(u.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this.d_.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.d_.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this.d_.parent;return t?new cc(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new cc(this.firestore,void 0===t?Es(this.d_):Es(this.d_,t))}catch(t){throw hc(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=ds(t.firestore,ya),r=Es(t),i=Ra(t.v_,e);return Ka(n,[Ls(Ps(t.firestore),"addDoc",r.S_,i,null!==t.v_,{}).F_(r.S_,we.exists(!1))]).then((function(){return r}))}(this.d_,t).then((function(t){return new cc(e.firestore,t)}))},e.prototype.isEqual=function(t){return Os(this.d_,t.d_)},e.prototype.withConverter=function(t){return new e(this.firestore,this.d_.withConverter(ac.gd(this.firestore,t)))},e}(vc);function gc(t){return t instanceof ss&&(t=t.d_),ds(t,gs)}var wc=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,new(os.bind.apply(os,Object(u.g)([void 0],e))))||this}return Object(u.c)(e,t),e.documentId=function(){return new e(M.ht().rt())},e.prototype.isEqual=function(t){return t instanceof ss&&(t=t.d_),t instanceof os&&this.d_.f_.isEqual(t.f_)},e}(ss),_c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.serverTimestamp=function(){var t=new Rs("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new e(t)},e.delete=function(){var t=new Vs("deleteField");return t._methodName="FieldValue.delete",new e(t)},e.arrayUnion=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Us("arrayUnion",t)}.apply(void 0,t);return r._methodName="FieldValue.arrayUnion",new e(r)},e.arrayRemove=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ms("arrayRemove",t)}.apply(void 0,t);return r._methodName="FieldValue.arrayRemove",new e(r)},e.increment=function(t){var n=function(t){return new qs("increment",t)}(t);return n._methodName="FieldValue.increment",new e(n)},e.prototype.isEqual=function(t){return this.d_.isEqual(t.d_)},e}(ss)}).call(this,n("8oxB"))}}]);
//# sourceMappingURL=22559bd3-842dd5561564a5105736.js.map